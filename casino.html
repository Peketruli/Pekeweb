<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino Pekepuntos</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
    body {
        background: linear-gradient(45deg, #FF5733, #FF8D1A, #FFC300, #FF5733);
        background-size: 400% 400%;
        animation: gradientBG 10s ease infinite;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 50px;
    }

    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .auth-container, .user-info {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .auth-button {
        padding: 10px 20px;
        font-size: 1em;
        color: white;
        background-color: #333;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }

    .user-info { display: none; cursor: pointer; }
    #userLogo { width: 40px; height: 40px; border-radius: 50%; }
    #userName { font-weight: bold; }

    .dropdown-menu {
        display: none;
        position: absolute;
        top: 60px;
        right: 20px;
        background-color: black;
        color: black;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        width: 150px;
        text-align: left;
    }
    .dropdown-menu td { padding: 10px; cursor: pointer; }
    .dropdown-menu td:hover { background-color: #ddd; color:black; }

    #pekepuntos { margin-top: 150px; font-size: 2em; }
</style>
</head>
<body>

<h1>ðŸŽ° Casino de Pekepuntos ðŸŽ°</h1>

<div class="auth-container" id="authContainer">
    <button class="auth-button" onclick="window.location.href='login.html'">Iniciar sesiÃ³n o registrarse</button>
</div>

<div class="user-info" id="userInfo">
    <h3 id="userName"></h3>
    <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
</div>

<div class="dropdown-menu" id="dropdownMenu">
    <table>
        <tr><td onclick="logout()">ðŸšª Cerrar sesiÃ³n</td></tr>
    </table>
</div>

<div id="pekepuntos">Pekepuntos: 0</div>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

document.addEventListener("DOMContentLoaded", function () {
    loadUserInfo();

    const userInfo = document.getElementById("userInfo");
    const dropdownMenu = document.getElementById("dropdownMenu");

    userInfo.addEventListener("click", function () {
        dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
    });

    document.addEventListener("click", function (event) {
        if (!userInfo.contains(event.target) && !dropdownMenu.contains(event.target)) {
            dropdownMenu.style.display = "none";
        }
    });
});

function logout() {
    supabase.auth.signOut();
    localStorage.removeItem("currentUser");
    window.location.href = "login.html";
}

function loadUserInfo() {
    const user = JSON.parse(localStorage.getItem("currentUser"));
    const authContainer = document.getElementById("authContainer");
    const userInfo = document.getElementById("userInfo");

    if (user) {
        userInfo.style.display = "flex";
        authContainer.style.display = "none";
        document.getElementById("userName").textContent = user.username || "Usuario";
        document.getElementById("userLogo").src = user.logo || "logoDefault.png";

        cargarPekepuntos(user.id);
    } else {
        userInfo.style.display = "none";
        authContainer.style.display = "flex";
    }
}

async function cargarPekepuntos(usuarioId) {
    const { data, error } = await supabase
        .from('usuarios')
        .select('pekepuntos')
        .eq('id', usuarioId)
        .single();

    if (error) {
        console.error(error);
        document.getElementById("pekepuntos").textContent = "Error al cargar Pekepuntos";
        return;
    }

    document.getElementById("pekepuntos").textContent = `Pekepuntos: ${data.pekepuntos}`;
}
</script>
</body>
</html>
