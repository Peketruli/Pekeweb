<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Casino - Recompensas</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
  :root { --table-bg: #ffffff; --table-text: #000000; }

  body{
    background-color: #2c2c2c;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 40px;
  }

  .auth-container, .user-info {
    position: absolute; top: 20px; right: 20px; display:flex; gap:10px; align-items:center;
  }
  .auth-button { padding:8px 12px; background:#333; border-radius:6px; color:white; border:none; cursor:pointer; }
  .user-info { display:none; cursor:pointer; }
  #userLogo { width:40px; height:40px; border-radius:50%; object-fit:cover; }
  #userName { font-weight:700; margin-right:6px; }

  .dropdown-menu { display:none; position:absolute; top:60px; right:20px; background:#111; color:#fff; border-radius:6px; padding:8px; box-shadow:0 6px 18px rgba(0,0,0,0.4); }
  .dropdown-menu div { padding:8px; cursor:pointer; }
  .dropdown-menu div:hover { background:#222; }

  .section { margin-top:30px; padding:18px; background:#333; border-radius:10px; }
  .section h2 { color:#ffd54f; margin-bottom:12px; }

  .top5-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; align-items:center; }
  .top5-item { width:90%; background:#3b3b3b; border-radius:8px; padding:8px 12px; display:flex; align-items:center; gap:12px; color:white; }
  .top5-item img { width:36px; height:36px; border-radius:50%; object-fit:cover; }

  .game-button, .reward-button { padding:10px 14px; margin:6px; border-radius:8px; border:none; cursor:pointer; background:#ff4081; color:white; }
  .game-button:hover, .reward-button:hover { transform:scale(1.03); }

  table.site-table {
    width:90%;
    margin:14px auto;
    border-collapse:collapse;
    background: var(--table-bg);
    color: var(--table-text);
    border-radius:8px;
    overflow:hidden;
  }
  table.site-table th, table.site-table td {
    padding:10px 12px;
    border-bottom:1px solid rgba(0,0,0,0.08);
  }

  @media (max-width:600px){ .top5-item { width:100%; } }
</style>
</head>
<body>
<button class="auth-button" onclick="window.location.href='Hub.html'">Volver a la P√°gina Principal</button>

<h1>üé∞ Casino - Recompensas</h1>

<div class="auth-container" id="authContainer">
  <button class="auth-button" onclick="window.location.href='login.html'">Iniciar sesi√≥n / Registrarse</button>
</div>

<div class="user-info" id="userInfo">
  <span id="userName">Usuario</span>
  <img id="userLogo" src="logoDefault.png" alt="logo"/>
</div>

<div class="dropdown-menu" id="dropdownMenu">
  <div onclick="logout()">üö™ Cerrar sesi√≥n</div>
</div>

<div id="pekepuntos" style="margin-top:20px; font-size:1.2rem;">Pekepuntos: 0</div>

<div class="section" id="top5Section">
  <h2>üèÜ Top 5 Jugadores</h2>
  <ul id="top5List" class="top5-list"></ul>
</div>

<div class="section" id="gamesSection">
  <h2>üéÆ Juegos Disponibles</h2>
  <button class="game-button" onclick="window.location.href='blackjack.html'">Blackjack</button>
  <button class="game-button" onclick="window.location.href='ruleta.html'">Ruleta</button>
  <button class="game-button" onclick="window.location.href='poker.html'">Poker</button>
</div>

<div class="section" id="rewardsSection">
  <h2>üéÅ Recompensas (Personalizaciones)</h2>

  <div style="margin-bottom:12px;">
    <button class="reward-button" id="rewardBgBtn">Recompensa 1: Cambiar Fondo</button>
    <input type="color" id="backgroundPicker" style="display:none; margin-left:8px;" />
  </div>

  <div style="margin-bottom:12px;">
    <button class="reward-button" id="rewardNameBtn">Recompensa 2: Cambiar Color del Nombre</button>
    <input type="color" id="nameColorPicker" style="display:none; margin-left:8px;" />
  </div>

  <div style="margin-bottom:12px;">
    <button class="reward-button" id="reward3Btn">Recompensa 3: Cambiar color de tablas</button>
    <input type="color" id="tableColorPicker" style="display:none;" onchange="setTableColor(this.value)">
  </div>

  <div id="exclusiveTop5" style="display:none; margin-top:10px;">üéñ Est√°s en Top 5 ‚Üí tu foto aparece en la lista.</div>
  <div id="exclusiveTop3" style="display:none; margin-top:6px;">ü•â Top 3 ‚Üí nombre en <span style="color:#b87333">cobre</span>.</div>
  <div id="exclusiveTop2" style="display:none; margin-top:6px;">ü•à Top 2 ‚Üí nombre en <span style="color:silver">plata</span>.</div>
  <div id="exclusiveTop1" style="display:none; margin-top:6px;">üëë Top 1 ‚Üí nombre en <span style="color:gold">oro</span>.</div>
</div>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI"; // mismo que en tu hub
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

async function verificarSesion() {
  const user = JSON.parse(localStorage.getItem("currentUser"));
  if (!user) {
    alert("‚ö†Ô∏è No has iniciado sesi√≥n. Redirigiendo al login...");
    window.location.href = "login.html";
    return;
  }

  try {
    // Verificar si el usuario existe realmente en la tabla 'usuarios'
    const { data, error } = await supabase
      .from("usuarios")
      .select("id, username, pekepuntos, logo")
      .eq("username", user.username)
      .single();

    if (error || !data) {
      console.error("Error al verificar usuario:", error);
      alert("‚ùå Error al comprobar la sesi√≥n. Por favor inicia sesi√≥n de nuevo.");
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
      return;
    }

    console.log("‚úÖ Sesi√≥n v√°lida:", data);
    return data;

  } catch (e) {
    console.error("Error al conectar con Supabase:", e);
    alert("‚ö†Ô∏è Error de conexi√≥n con Supabase. Intenta m√°s tarde.");
  }
}

document.addEventListener("DOMContentLoaded", verificarSesion);
</script>
</body>
</html>
