<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino Pekepuntos</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
    body {
        background-color: #2c2c2c;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 50px;
    }

    .auth-container, .user-info {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .auth-button {
        padding: 10px 20px;
        font-size: 1em;
        color: white;
        background-color: #333;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }

    .user-info { display: none; cursor: pointer; }
    #userLogo { width: 40px; height: 40px; border-radius: 50%; }
    #userName { font-weight: bold; }

    .dropdown-menu {
        display: none;
        position: absolute;
        top: 60px;
        right: 20px;
        background-color: black;
        color: black;
        border-radius: 5px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        width: 150px;
        text-align: left;
    }
    .dropdown-menu td { padding: 10px; cursor: pointer; }
    .dropdown-menu td:hover { background-color: #ddd; color:black; }

    #pekepuntos {
        margin-top: 100px;
        font-size: 2em;
    }

    .section {
        margin-top: 40px;
        padding: 20px;
        background-color: #3a3a3a;
        border-radius: 10px;
    }

    .section h2 {
        margin-bottom: 20px;
        color: #ffcc00;
    }

    .top5-list, .games-list, .rewards-list {
        list-style: none;
        padding: 0;
    }

    .top5-list li, .games-list li, .rewards-list li {
        padding: 10px;
        margin: 5px 0;
        background-color: #4a4a4a;
        border-radius: 5px;
    }

    .game-button, .reward-button {
        padding: 10px 20px;
        margin: 5px;
        background-color: #ff4081;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .game-button:hover, .reward-button:hover { transform: scale(1.1); }
</style>
</head>
<body>

<h1>游꿣 Casino de Pekepuntos 游꿣</h1>

<div class="auth-container" id="authContainer">
    <button class="auth-button" onclick="window.location.href='login.html'">Iniciar sesi칩n o registrarse</button>
</div>

<div class="user-info" id="userInfo">
    <h3 id="userName"></h3>
    <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
</div>

<div class="dropdown-menu" id="dropdownMenu">
    <table>
        <tr><td onclick="logout()">游뛁 Cerrar sesi칩n</td></tr>
    </table>
</div>

<div id="pekepuntos">Pekepuntos: 0</div>

<!-- Top 5 usuarios -->
<div class="section" id="top5Section">
    <h2>游끥 Top 5 Jugadores</h2>
    <ul class="top5-list" id="top5List">
        <!-- Se llenar치 din치micamente -->
    </ul>
</div>

<!-- Juegos -->
<div class="section" id="gamesSection">
    <h2>游꿡 Juegos Disponibles</h2>
    <button class="game-button" onclick="window.location.href='blackjack.html'">Juego 1</button>
    <button class="game-button" onclick="alert('Juego 2 en desarrollo')">Juego 2</button>
    <button class="game-button" onclick="alert('Juego 3 en desarrollo')">Juego 3</button>
</div>

<!-- Recompensas -->
<div class="section" id="rewardsSection">
    <h2>游꾸 Recompensas</h2>
    <button class="reward-button" onclick="alert('Recompensa 1 en desarrollo')">Recompensa 1</button>
    <button class="reward-button" onclick="alert('Recompensa 2 en desarrollo')">Recompensa 2</button>
    <button class="reward-button" onclick="alert('Recompensa 3 en desarrollo')">Recompensa 3</button>
</div>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

document.addEventListener("DOMContentLoaded", function () {
    loadUserInfo();
    loadTop5();
    const userInfo = document.getElementById("userInfo");
    const dropdownMenu = document.getElementById("dropdownMenu");

    userInfo.addEventListener("click", function () {
        dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
    });

    document.addEventListener("click", function (event) {
        if (!userInfo.contains(event.target) && !dropdownMenu.contains(event.target)) {
            dropdownMenu.style.display = "none";
        }
    });
});

function logout() {
    supabase.auth.signOut();
    localStorage.removeItem("currentUser");
    window.location.href = "login.html";
}

function loadUserInfo() {
    const user = JSON.parse(localStorage.getItem("currentUser"));
    const authContainer = document.getElementById("authContainer");
    const userInfo = document.getElementById("userInfo");

    if (user) {
        userInfo.style.display = "flex";
        authContainer.style.display = "none";
        document.getElementById("userName").textContent = user.username || "Usuario";
        document.getElementById("userLogo").src = user.logo || "logoDefault.png";
        cargarPekepuntos(user.id);
    } else {
        userInfo.style.display = "none";
        authContainer.style.display = "flex";
    }
}

async function cargarPekepuntos(usuarioId) {
    const { data, error } = await supabase
        .from('usuarios')
        .select('pekepuntos')
        .eq('id', usuarioId)
        .single();

    if (error) {
        console.error(error);
        document.getElementById("pekepuntos").textContent = "Error al cargar Pekepuntos";
        return;
    }

    document.getElementById("pekepuntos").textContent = `Pekepuntos: ${data.pekepuntos}`;
}

async function loadTop5() {
    const { data, error } = await supabase
        .from('usuarios')
        .select('username, pekepuntos')
        .order('pekepuntos', { ascending: false })
        .limit(5);

    if (error) {
        console.error(error);
        return;
    }

    const top5List = document.getElementById('top5List');
    top5List.innerHTML = "";
    data.forEach((user, index) => {
        const li = document.createElement('li');
        li.textContent = `${index + 1}. ${user.username} - ${user.pekepuntos} Pekepuntos`;
        top5List.appendChild(li);
    });
}
</script>
</body>
</html>
