<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Evento de Navidad ‚Äî Pekeweb</title>

<style>
  :root{
    --bg1:#081726;
    --bg2:#0f2a45;
    --card:#122636;
    --accent:#2aa198;
    --muted:rgba(255,255,255,0.18);
  }

  html,body{height:100%; margin:0; font-family:Inter, Arial, sans-serif; background: linear-gradient(180deg,var(--bg1),var(--bg2)); color:#fff; -webkit-font-smoothing:antialiased;}

  /* Suave efecto tipo nieve */
  body::before{
    content:"";
    position:fixed; inset:0;
    pointer-events:none;
    background:
      radial-gradient(circle, rgba(255,255,255,0.9) 0 2px, transparent 3px) 0 0/6px 6px,
      radial-gradient(circle, rgba(255,255,255,0.35) 0 1px, transparent 2px) 0 0/4px 4px;
    opacity:0.18;
    animation: drift 10s linear infinite;
  }
  @keyframes drift { from { transform: translateY(-0px);} to { transform: translateY(400px);} }

  header{
    text-align:center;
    padding:28px 12px;
    border-bottom:1px solid rgba(255,255,255,0.04);
  }
  header h1{ margin:0; font-size:1.6rem; letter-spacing:0.6px; text-shadow:0 6px 20px rgba(0,0,0,0.6); }

  .wrap{ max-width:1100px; margin:28px auto; padding:18px; display:grid; grid-template-columns: 1fr 360px; gap:18px; }

  /* Panel principal */
  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px; padding:18px; border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 6px 24px rgba(0,0,0,0.45);
  }

  /* Calendario */
  #calendario {
    display:grid;
    grid-template-columns: repeat(6, 1fr);
    gap:10px;
  }
  .day {
    background:var(--card);
    border-radius:10px;
    padding:18px;
    text-align:center;
    cursor:pointer;
    user-select:none;
    font-weight:600;
    border:2px solid transparent;
    transition: transform .18s ease, background .18s ease, border-color .18s;
  }
  .day:hover{ transform: translateY(-4px); }
  .day.disabled{ opacity:0.36; cursor:not-allowed; filter:grayscale(0.65); transform:none; }
  .day.opened{ background: linear-gradient(180deg,#167a6e,#0f6b61); border-color: #9ff3e3; color:#021; box-shadow: 0 8px 18px rgba(0,0,0,0.45); }

  /* Right column (coleccionables + mu√±ecos) */
  .rightCol{ display:flex; flex-direction:column; gap:14px; }
  .coleccionables-grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:10px;
  }
  .coleccionable {
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:8px; padding:10px; min-height:64px;
    display:flex; align-items:center; gap:10px; border:1px solid var(--muted);
    font-family: "Courier New", monospace;
  }
  .coleccionable.locked{ opacity:0.45; filter: grayscale(60%); }
  .coleccionable .icon{ font-size:1.6rem; width:48px; text-align:center; }
  .coleccionable .meta{ flex:1; font-size:0.95rem; white-space:pre-wrap; }

  /* Mu√±ecos list */
  .snow-box{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:8px; padding:12px; border:1px solid var(--muted); }
  .snow-box h3{ margin:0 0 8px 0; font-size:1rem; }
  .snow-list{ max-height:280px; overflow:auto; padding-right:6px; }
  .snow-list div{ padding:6px 8px; border-bottom:1px dashed rgba(255,255,255,0.03); font-size:0.95rem; }

  /* Mu√±ecos escondidos (emojis) */
  .snowman-hidden{ position:absolute; font-size:2.0rem; cursor:pointer; transition: transform .15s ease, opacity .2s ease; user-select:none; }
  .snowman-hidden:hover{ transform: scale(1.25); }

  /* Alert (mes) */
  #alertaMes{ display:none; margin-bottom:10px; padding:10px; background:#8b1a1a; border-radius:8px; color:#fff; font-weight:700; text-align:center; }

  /* Modal b√°sico */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.55); display:none; align-items:center; justify-content:center; z-index:60; }
  .modal{ background:linear-gradient(180deg,#0b2433,#02151b); padding:18px; border-radius:10px; min-width:320px; max-width:640px; border:1px solid rgba(255,255,255,0.06); }
  .modal h3{ margin:0 0 10px 0; }
  .btn{ background:var(--accent); color:#021; padding:8px 10px; border-radius:8px; font-weight:700; cursor:pointer; border:none; }

  /* Responsive */
  @media (max-width:980px){
    .wrap{ grid-template-columns: 1fr; padding:12px; }
    .coleccionables-grid{ grid-template-columns: repeat(3, 1fr); }
  }
</style>
</head>

<body>

<header>
  <h1>üéÑ Pekeweb ‚Äî Evento de Navidad</h1>
</header>

<!-- MU√ëECOS ESCONDIDOS (posiciona libremente; 5 de prueba) -->
<div class="snowman-hidden" style="top:140px; left:36px;">‚õÑ</div>
<div class="snowman-hidden" style="top:360px; right:58px;">‚õÑ</div>
<div class="snowman-hidden" style="top:700px; left:48%;">‚õÑ</div>
<div class="snowman-hidden" style="bottom:240px; left:220px;">‚õÑ</div>
<div class="snowman-hidden" style="top:920px; right:30%;">‚õÑ</div>

<div class="wrap">

  <div class="panel">
    <div id="alertaMes">‚õî El calendario solo funciona en diciembre. Si no es diciembre, las casillas est√°n bloqueadas.</div>

    <h2 style="margin-top:0">üéÖ Calendario de Adviento</h2>
    <p style="margin:6px 0 12px 0; color:rgba(255,255,255,0.6); font-size:0.95rem;">Abre la casilla del d√≠a correspondiente. D√≠as impares suelen dar coleccionables o mensajes.</p>

    <div id="calendario"></div>
  </div>

  <aside class="rightCol">
    <div class="panel">
      <h2 style="margin-top:0">‚≠ê Coleccionables</h2>
      <div id="coleccionables" class="coleccionables-grid"></div>
    </div>

    <div class="panel snow-box">
      <h3>‚õÑ Mu√±ecos recogidos ‚Äî Total: <span id="snowCount">0</span></h3>
      <div id="listaMu√±ecos" class="snow-list"></div>
    </div>
  </aside>

</div>

<!-- Modal para mostrar coleccionable / mensajes -->
<div id="modalBack" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <h3 id="modalTitle"></h3>
    <pre id="modalBody" style="white-space:pre-wrap; font-family: 'Courier New', monospace; font-size:0.95rem;"></pre>
    <div style="text-align:right; margin-top:12px;">
      <button id="modalClose" class="btn">Cerrar</button>
    </div>
  </div>
</div>

<script>
/* ===========================
   Variables y carga inicial
   =========================== */
const now = new Date();
const currentDay = now.getDate();
const currentMonth = now.getMonth(); // 11 = diciembre

// Elementos
const calendarioEl = document.getElementById('calendario');
const alertaMes = document.getElementById('alertaMes');
const coleccionablesEl = document.getElementById('coleccionables');
const listaMu√±ecosEl = document.getElementById('listaMu√±ecos');
const snowCountEl = document.getElementById('snowCount');

const modalBack = document.getElementById('modalBack');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const modalClose = document.getElementById('modalClose');

modalClose.addEventListener('click', hideModal);
modalBack.addEventListener('click', (e)=>{ if(e.target===modalBack) hideModal(); });

function showModal(title, body){
  modalTitle.textContent = title || "";
  modalBody.textContent = body || "";
  modalBack.style.display = 'flex';
  modalBack.setAttribute('aria-hidden','false');
}
function hideModal(){
  modalBack.style.display = 'none';
  modalBack.setAttribute('aria-hidden','true');
}

/* ===========================
   Coleccionables (emoji + pixel art)
   =========================== */
let coleccion = JSON.parse(localStorage.getItem('coleccionables')) || [
  { id:1, nombre:"üéÑ √Årbol de Navidad", unlocked:false, art:"üéÑ" },
  { id:2, nombre:"üéÅ Regalo", unlocked:false, art:"üéÅ" },
  { id:3, nombre:"‚ùÑÔ∏è Copo de nieve", unlocked:false, art:"‚ùÑÔ∏è" },
  { id:4, nombre:"‚≠ê Estrella", unlocked:false, art:"‚≠ê" },
  { id:5, nombre:"üç≠ Bast√≥n de caramelo", unlocked:false, art:"üç≠" },
  { id:6, nombre:"üéÖ Gorro navide√±o", unlocked:false, art:"üéÖ" },
  { id:7, nombre:"‚õÑ Mu√±eco de nieve", unlocked:false, art:"‚õÑ" },
  { id:8, nombre:"ü¶å Reno", unlocked:false, art:"ü¶å" },
  // √©picos (pixel-art en texto)
  { id:9, nombre:"üéÄ Corona navide√±a", unlocked:false, art:"üéÄ\n  /\\\n /  \\\n \\  /\n  \\/" },
  { id:10, nombre:"üïØÔ∏è Vela (pixel)", unlocked:false, art:
`‚¨õ‚¨õüïØÔ∏è‚¨õ‚¨õ
‚¨õüïØÔ∏èüïØÔ∏èüïØÔ∏è‚¨õ
üïØÔ∏èüïØÔ∏èüïØÔ∏èüïØÔ∏èüïØÔ∏è
‚¨õüïØÔ∏èüïØÔ∏èüïØÔ∏è‚¨õ
‚¨õ‚¨õüïØÔ∏è‚¨õ‚¨õ` },
  { id:11, nombre:"üîî Campana (pixel)", unlocked:false, art:
`‚¨õ‚¨õüîî‚¨õ‚¨õ
‚¨õüîîüîîüîî‚¨õ
üîîüîîüîîüîîüîî
‚¨õüîîüîîüîî‚¨õ
‚¨õ‚¨õüîî‚¨õ‚¨õ` },
  { id:12, nombre:"üü¢ Bola (pixel)", unlocked:false, art:
`‚¨õ‚¨õüü¢‚¨õ‚¨õ
‚¨õüü¢üü¢üü¢‚¨õ
üü¢üü¢üü¢üü¢üü¢
‚¨õüü¢üü¢üü¢‚¨õ
‚¨õ‚¨õüü¢‚¨õ‚¨õ` }
];

function saveColeccion(){
  localStorage.setItem('coleccionables', JSON.stringify(coleccion));
}

/* Render coleccionables */
function renderColeccionables(){
  coleccionablesEl.innerHTML = '';
  coleccion.forEach(c=>{
    const div = document.createElement('div');
    div.className = 'coleccionable' + (c.unlocked? '':' locked');
    // Use icon + meta text
    const icon = document.createElement('div'); icon.className='icon'; icon.textContent = c.art.split('\n')[0] || c.art;
    const meta = document.createElement('div'); meta.className='meta';
    meta.textContent = c.unlocked ? c.nombre + (c.art.includes('\n') ? '\n\n' + c.art : '') : '???';
    div.appendChild(icon); div.appendChild(meta);
    // Click opens modal with detail (if unlocked or even locked to preview)
    div.addEventListener('click', ()=> {
      if(c.unlocked) showModal(c.nombre, c.art);
      else showModal('Bloqueado', 'Este coleccionable a√∫n no est√° desbloqueado.\n\nPosible manera de obtenerlo: abrir ciertas casillas o recoger mu√±ecos.');
    });
    coleccionablesEl.appendChild(div);
  });
}
renderColeccionables();

/* Unlock helper */
function unlockCollectible(id){
  const item = coleccion.find(x => x.id === id);
  if(item && !item.unlocked){
    item.unlocked = true;
    saveColeccion();
    renderColeccionables();
    showModal('¬°Coleccionable desbloqueado!', item.nombre + (item.art.includes('\n') ? '\n\n' + item.art : ''));
  }
}

/* Unlock next available (used por cada 5 mu√±ecos) */
function unlockNextCollectible(){
  const next = coleccion.find(x => !x.unlocked);
  if(next) unlockCollectible(next.id);
}

/* ===========================
   Calendario (control de d√≠as y contenidos)
   =========================== */

// Si no es Diciembre, bloqueamos y mostramos alerta
if(currentMonth !== 11){
  alertaMes.style.display = 'block';
} else {
  alertaMes.style.display = 'none';
}

/* d√≠as que ya se abrieron (persistencia) */
let daysOpened = JSON.parse(localStorage.getItem('daysOpened')) || [];

/* contenido diario: d√≠as impares -> coleccionable o mensajes */
const dailyContent = {
  1:{type:'collectible', itemId:1},
  3:{type:'message', text:'¬°Gracias por seguir aqu√≠! üéÑ'},
  5:{type:'collectible', itemId:2},
  7:{type:'collectible', itemId:3},
  9:{type:'message', text:'¬°Feliz Navidad anticipada! üéÅ'},
  11:{type:'collectible', itemId:4},
  13:{type:'collectible', itemId:5},
  15:{type:'message', text:'Gracias por estar aqu√≠ üéÖ'},
  17:{type:'collectible', itemId:6},
  19:{type:'collectible', itemId:7},
  21:{type:'message', text:'Casi es Navidad‚Ä¶ üéÑ'},
  23:{type:'collectible', itemId:8},
  24:{type:'collectible', itemId:12, special:true} // d√≠a 24: premio especial
};

function renderCalendar(){
  calendarioEl.innerHTML = '';
  for(let i=1;i<=24;i++){
    const d = document.createElement('div');
    d.className = 'day';
    d.textContent = i;

    // bloque por mes
    if(currentMonth !== 11) d.classList.add('disabled');
    else {
      // si el d√≠a es mayor que hoy -> deshabilitado
      if(i > currentDay) d.classList.add('disabled');
    }

    // si ya lo abrimos antes
    if(daysOpened.includes(i)){
      d.classList.add('opened');
      d.textContent = 'üéÅ';
    }

    // click
    d.addEventListener('click', ()=>{
      // si no es diciembre o d√≠a futuro -> no permitir
      if(currentMonth !== 11 || i > currentDay) return;
      if(daysOpened.includes(i)) return;

      // abrir
      daysOpened.push(i);
      localStorage.setItem('daysOpened', JSON.stringify(daysOpened));
      d.classList.add('opened'); d.textContent = 'üéÅ';

      // ejecutar contenido
      const content = dailyContent[i];
      if(content){
        if(content.type === 'message'){
          showModal('Mensaje del d√≠a ' + i, content.text);
        } else if(content.type === 'collectible'){
          unlockCollectible(content.itemId);
          if(content.special) showModal('¬°Gran premio!', '¬°Has desbloqueado el premio especial del d√≠a 24!');
        }
      } else {
        // contenido por defecto: peque√±o mensaje de ambientaci√≥n
        showModal('D√≠a ' + i, '¬°Feliz d√≠a! No hay premio concreto hoy, pero gracias por pasarte.');
      }
    });

    calendarioEl.appendChild(d);
  }
}

renderCalendar();

/* ===========================
   Mu√±ecos de nieve (persistencia + ocultan en reload)
   =========================== */

let snowmen = JSON.parse(localStorage.getItem('snowmen')) || [];
let collectedIDs = JSON.parse(localStorage.getItem('collectedSnowmenIDs')) || [];

/* inicializar: ocultar los mu√±ecos ya recogidos */
document.querySelectorAll('.snowman-hidden').forEach((el, idx)=>{
  if(collectedIDs.includes(idx)){
    el.style.opacity = '0';
    el.style.pointerEvents = 'none';
  }
  el.addEventListener('click', ()=>{
    // a√±adir nombre
    const name = "Mu√±eco #" + (snowmen.length + 1);
    snowmen.push(name);
    localStorage.setItem('snowmen', JSON.stringify(snowmen));
    renderSnowmen();

    // guardar id recogido para que no vuelva a salir
    collectedIDs.push(idx);
    localStorage.setItem('collectedSnowmenIDs', JSON.stringify(collectedIDs));

    // ocultar visualmente
    el.style.opacity = '0';
    el.style.pointerEvents = 'none';

    // cada 5 mu√±ecos desbloquear siguiente coleccionable
    if(snowmen.length % 5 === 0){
      unlockNextCollectible();
    }
  });
});

/* render lista de mu√±ecos */
function renderSnowmen(){
  listaMu√±ecosEl.innerHTML = '';
  snowmen.forEach(s=>{
    const v = document.createElement('div'); v.textContent = s;
    listaMu√±ecosEl.appendChild(v);
  });
  snowCountEl.textContent = snowmen.length;
}
renderSnowmen();

/* ===========================
   Helpers para debugging / util
   =========================== */

/* Funci√≥n p√∫blica (√∫til en consola) para resetear todo (solo para admins) */
window._resetEvento = function(){
  if(!confirm('Resetear progreso del evento (localStorage). ¬øSeguro?')) return;
  localStorage.removeItem('coleccionables');
  localStorage.removeItem('daysOpened');
  localStorage.removeItem('snowmen');
  localStorage.removeItem('collectedSnowmenIDs');
  location.reload();
};

</script>
</body>
</html>
