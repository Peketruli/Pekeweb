<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ„ Evento de Navidad â€” Pekeweb ğŸ</title>
<style>
body{
Â  margin:0;
Â  padding:0;
Â  font-family:Arial, sans-serif;
Â  color:#fff;
Â  background: linear-gradient(180deg, #0b1a2a 0%, #123456 100%);
Â  background-attachment: fixed;
Â  overflow-x:hidden;
Â  position:relative;
}

header{
Â  text-align:center;
Â  padding:10px;
Â  font-size:2rem;
Â  font-weight: bold;
Â  text-shadow:0 0 15px rgba(255,255,255,0.4);
Â  display:flex;
Â  justify-content:space-between;
Â  align-items:center;
}

header button{
Â  padding:8px 12px;
Â  font-size:1rem;
Â  border:none;
Â  border-radius:6px;
Â  background:#b31e1e;
Â  color:#fff;
Â  cursor:pointer;
}

.container{
Â  max-width:1100px;
Â  margin:0 auto;
Â  padding:20px;
}

#alertaMes{
Â  background:#b31e1e;
Â  padding:15px;
Â  border-radius:10px;
Â  margin-bottom:20px;
Â  display:none;
Â  text-align:center;
Â  font-weight:bold;
}

.calendar{
Â  display:grid;
Â  grid-template-columns: repeat(6,1fr);
Â  gap:10px;
Â  margin-bottom:30px;
}

.day{
Â  background:#1d3557;
Â  border-radius:10px;
Â  padding:20px;
Â  text-align:center;
Â  font-size:1.4rem;
Â  cursor:pointer;
Â  transition:0.3s;
Â  border:2px solid rgba(255,255,255,0.2);
Â  user-select:none;
}

.day.disabled{
Â  background:#15263a;
Â  cursor:not-allowed;
Â  opacity:0.4;
}

.day.opened{
Â  background:#2a9d8f;
Â  transform: scale(1.05);
}

h2{
Â  margin-top:40px;
Â  text-shadow:0 0 10px rgba(255,255,255,0.3);
}

.coleccionables-grid{
Â  display:grid;
Â  grid-template-columns: repeat(auto-fill,minmax(120px,1fr));
Â  gap:15px;
Â  margin-top:15px;
}

.item-col{
Â  background:#1d2a38;
Â  padding:10px;
Â  border-radius:10px;
Â  text-align:center;
Â  border:2px solid rgba(255,255,255,0.2);
Â  font-size:1.4rem;
}

.item-col.locked{
Â  opacity:0.4;
Â  filter: grayscale(100%);
}

.snow-container{
Â  margin-top:30px;
Â  background:#162330;
Â  border-radius:10px;
Â  padding:20px;
Â  border:1px solid rgba(255,255,255,0.2);
}

.snow-list div{
Â  padding:5px;
Â  margin:5px 0;
Â  border-bottom:1px dashed rgba(255,255,255,0.2);
}

.hidden-snowman{
Â  position:absolute;
Â  font-size:2rem;
Â  cursor:pointer;
Â  transition:0.25s;
}

.hidden-snowman.catched{
Â  opacity:0;
Â  transform:scale(0);
}
</style>
</head>
<body>

<header>
Â  <span>ğŸ„ Evento de Navidad â€” Pekeweb ğŸ</span>
Â  <button onclick="location.href='h.html'">â¬… Volver</button>
</header>

<div class="hidden-snowman" data-id="1">â›„</div>
<div class="hidden-snowman" data-id="2">â›„</div>
<div class="hidden-snowman" data-id="3">â›„</div>
<div class="hidden-snowman" data-id="4">â›„</div>
<div class="hidden-snowman" data-id="5">â›„</div>

<div class="container">
Â  <div id="alertaMes">âŒ El calendario solo estÃ¡ disponible en DICIEMBRE.</div>

Â  <h2>ğŸ… Calendario de Adviento</h2>
Â  <div class="calendar" id="calendar"></div>

Â  <h2>â­ Coleccionables</h2>
Â  <div class="coleccionables-grid" id="coleccionables"></div>

Â  <div class="snow-container">
Â  Â  <h2>â›„ MuÃ±ecos de nieve recogidos</h2>
Â  Â  <p>Total: <b id="snowCount">0</b></p>
Â  Â  <div class="snow-list" id="snowList"></div>
Â  </div>
</div>

<script>
// ==================== COLECCIONABLES GLOBAL ====================
const coleccionables = document.getElementById("coleccionables");
let coleccion = JSON.parse(localStorage.getItem("coleccionables"));

if(!coleccion){
Â  const total = 22;
Â  const emojiList = ["ğŸ","ğŸ„","â›„","â„ï¸","ğŸ¦Œ","ğŸª","ğŸ•¯ï¸","ğŸ…","ğŸŒŸ","ğŸ§¦","ğŸ«","ğŸ””",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "ğŸ›·","ğŸ‰","ğŸ·","ğŸ¥§","ğŸŒ²","ğŸ¶","ğŸ§¸","ğŸ­","ğŸ©","ğŸ¥‚"];
Â  coleccion = [];
Â  for(let i=0;i<total;i++) coleccion.push({id:i+1,nombre:emojiList[i],unlocked:false});
Â  localStorage.setItem("coleccionables", JSON.stringify(coleccion));
}

function renderCollectibles(){
Â  coleccionables.innerHTML="";
Â  coleccion.forEach(c=>{
Â  Â  const div=document.createElement("div");
Â  Â  div.classList.add("item-col");
Â  Â  if(!c.unlocked) div.classList.add("locked");
Â  Â  div.textContent = c.unlocked ? c.nombre : "???";
Â  Â  coleccionables.appendChild(div);
Â  });
}
renderCollectibles();

function unlockCollectible(id){
Â  // El ID es 1-based, el Ã­ndice del array es 0-based.
Â  if(coleccion[id-1] && !coleccion[id-1].unlocked){
Â  Â  coleccion[id-1].unlocked=true;
Â  Â  localStorage.setItem("coleccionables", JSON.stringify(coleccion));
Â  Â  renderCollectibles();
Â  Â  return true; // Indica que se desbloqueÃ³ uno nuevo
Â  }
Â  return false; // Ya estaba desbloqueado o ID fuera de rango
}


// ==================== CALENDARIO ====================
const today = new Date();
const currentDay = today.getDate();
const currentMonth = today.getMonth();
const calendar = document.getElementById("calendar");
const alertaMes = document.getElementById("alertaMes");
let daysOpened = JSON.parse(localStorage.getItem("daysOpened")) || [];

const dailyMessages = [
Â  "Â¡Disfruta de un chocolate caliente! â˜•â„ï¸",
Â  "Cuelga tus calcetines navideÃ±os ğŸ„ğŸ§¦",
Â  "Â¡Mira las luces de Navidad! âœ¨",
Â  "No olvides cantar villancicos ğŸ¶ğŸ…",
Â  "Decora tu Ã¡rbol de Navidad ğŸ„ğŸŒŸ",
Â  "Es hora de hornear galletas ğŸª",
Â  "EnvÃ­a una tarjeta navideÃ±a a un amigo ğŸ’Œ",
Â  "Pon villancicos en tu playlist ğŸµ",
Â  "Abre un regalo virtual ğŸ",
Â  "Â¡Siente la magia de la Navidad! â„ï¸âœ¨"
];

// 12 dÃ­as con coleccionable
const dailyContent = {
Â  1: { type:"collectible", itemId:1 },
Â  3: { type:"collectible", itemId:2 },
Â  5: { type:"collectible", itemId:3 },
Â  7: { type:"collectible", itemId:4 },
Â  9: { type:"collectible", itemId:5 },
Â  11:{ type:"collectible", itemId:6 },
Â  13:{ type:"collectible", itemId:7 },
Â  15:{ type:"collectible", itemId:8 },
Â  17:{ type:"collectible", itemId:9 },
Â  19:{ type:"collectible", itemId:10 },
Â  21:{ type:"collectible", itemId:11 },
Â  23:{ type:"collectible", itemId:12 }
};

for(let i = 1; i <= 24; i++){
Â  const day = document.createElement("div");
Â  day.classList.add("day");
Â  day.textContent = i;

Â  if(currentMonth !== 11) day.classList.add("disabled");
Â  else if(i > currentDay) day.classList.add("disabled");

Â  if(daysOpened.includes(i)){
Â  Â  day.classList.add("opened");
Â  Â  day.textContent="ğŸ";
Â  }

Â  day.addEventListener("click", () => {
Â  Â  if(day.classList.contains("disabled")) return;

Â  Â  day.classList.add("opened");
Â  Â  day.textContent="ğŸ";

Â  Â  if(!daysOpened.includes(i)){
Â  Â  Â  daysOpened.push(i);
Â  Â  Â  localStorage.setItem("daysOpened", JSON.stringify(daysOpened));
Â  Â  }

Â  Â  if(dailyContent[i]) showContent(dailyContent[i]);
Â  Â  else{
Â  Â  Â  const msg = dailyMessages[Math.floor(Math.random()*dailyMessages.length)];
Â  Â  Â  alert(msg);
Â  Â  }
Â  });

Â  calendar.appendChild(day);
}

function showContent(content){
Â  if(content.type==="message") alert(content.text);
Â  else if(content.type==="collectible"){
Â  Â  if(unlockCollectible(content.itemId)){
Â  Â  Â  alert("â­ Â¡Coleccionable desbloqueado!");
Â  Â  }
Â  }
}

// ==================== MUÃ‘ECOS ESCONDIDOS ====================
let snowmen = JSON.parse(localStorage.getItem("snowmen")) || [];
let collectedIDs = JSON.parse(localStorage.getItem("collectedSnowmenIDs")) || [];
const snowList = document.getElementById("snowList");
const snowCount = document.getElementById("snowCount");

// Rango de IDs de coleccionables para muÃ±ecos
const firstCollectibleIndex = 13; // Primer coleccionable para muÃ±ecos (ID 13)
const maxCollectibleIndex = 22; // Ãšltimo coleccionable para muÃ±ecos (ID 22)

function updateSnowList(){
Â  snowList.innerHTML="";
Â  snowmen.forEach(n=>{
Â  Â  const div=document.createElement("div");
Â  Â  div.textContent=n;
Â  Â  snowList.appendChild(div);
Â  });
Â  snowCount.textContent=snowmen.length;
}
updateSnowList();

// NUEVA FUNCIÃ“N AÃ‘ADIDA: Comprueba y desbloquea coleccionables pendientes al cargar la pÃ¡gina
function checkAndUnlockSnowmanCollectibles() {
    const totalCollected = snowmen.length;
    // Calcula cuÃ¡ntos sets de 5 muÃ±ecos se han completado (0, 1, 2, 3, etc.)
    const setsCompleted = Math.floor(totalCollected / 5);

    let unlockedCount = 0;
    
    // Itera desde el primer ID de muÃ±eco (13) hasta el Ãºltimo ID que deberÃ­a estar desbloqueado
    // Ejemplo: 10 muÃ±ecos recogidos -> setsCompleted = 2. Debe desbloquear IDs 13 y 14.
    for (let i = 0; i < setsCompleted; i++) {
        const collectibleId = firstCollectibleIndex + i;
        
        // AsegÃºrate de no intentar desbloquear IDs fuera del rango [13, 22]
        if (collectibleId > maxCollectibleIndex) break;

        // Intentar desbloquear. La funciÃ³n unlockCollectible solo actualiza si estaba bloqueado.
        if (unlockCollectible(collectibleId)) {
            unlockedCount++;
        }
    }

    if (unlockedCount > 0) {
         // Avisar si se desbloqueÃ³ algo al cargar (Ãºtil para progreso de h.html)
        alert(`ğŸ‰ Â¡Desbloqueaste ${unlockedCount} coleccionable(s) de MuÃ±eco de Nieve!`);
    }
}

// Llamar a la funciÃ³n inmediatamente para verificar el progreso acumulado (ej. de h.html)
checkAndUnlockSnowmanCollectibles(); 

// ----------------------------------------------------------------------
// El resto del cÃ³digo de MuÃ±ecos (listeners) sigue, pero ajustamos la lÃ³gica del alert
// ----------------------------------------------------------------------

document.querySelectorAll(".hidden-snowman").forEach(sm=>{
Â  const id = sm.dataset.id;

Â  // PosiciÃ³n aleatoria en la ventana (considerando un margen)
Â  const padding = 50; // margen para que no se salga de la pantalla
Â  const maxX = window.innerWidth - 50;
Â  const maxY = window.innerHeight - 150; // dejando espacio para header
Â  sm.style.left = (Math.random() * (maxX - padding) + padding) + "px";
Â  sm.style.top = (Math.random() * (maxY - padding) + padding) + "px";

Â  // Ocultar si ya recogido
Â  if(collectedIDs.includes(id)) sm.style.display="none";

Â  sm.addEventListener("click", ()=>{
Â  Â  if(collectedIDs.includes(id)) return;

Â  Â  sm.classList.add("catched");
Â  Â  setTimeout(()=> sm.style.display="none", 200);

Â  Â  // Guardamos el muÃ±eco antes de chequear el total
Â  Â  snowmen.push("MuÃ±eco #" + (snowmen.length + 1));
Â  Â  localStorage.setItem("snowmen", JSON.stringify(snowmen));

Â  Â  collectedIDs.push(id);
Â  Â  localStorage.setItem("collectedSnowmenIDs", JSON.stringify(collectedIDs));

Â  Â  updateSnowList();

Â  Â  // ComprobaciÃ³n y Desbloqueo usando la nueva funciÃ³n
    const totalCollected = snowmen.length;
    let unlockedNow = false;
    
    // Verificamos si este click completa un nuevo set de 5
Â  Â  if(totalCollected % 5 === 0){
        // Calculamos el ID del coleccionable que toca desbloquear
        const collectibleToUnlock = firstCollectibleIndex + (totalCollected / 5) - 1;
        
        if(collectibleToUnlock <= maxCollectibleIndex) {
            if(unlockCollectible(collectibleToUnlock)){
                unlockedNow = true;
                alert("â„ï¸ Has conseguido 5 muÃ±ecos â†’ Coleccionable desbloqueado!");
            }
        } else {
            alert("âœ… Â¡MuÃ±eco recogido! Ya has desbloqueado todos los coleccionables disponibles con muÃ±ecos.");
        }
Â  Â  }
    
    // Mensaje de muÃ±eco recogido si no se desbloqueÃ³ un coleccionable
    if (!unlockedNow && (totalCollected % 5 !== 0 || totalCollected > maxCollectibleIndex * 5)){
        const nextNeeded = 5 - (totalCollected % 5);
        if (nextNeeded === 5 && totalCollected > 0) { /* No hacemos nada si es 5, ya que se desbloqueÃ³ arriba */ } 
        else if (nextNeeded > 0) {
            alert(`â›„ Â¡MuÃ±eco de nieve recogido! Faltan ${nextNeeded} para el prÃ³ximo coleccionable.`);
        }
    }
Â  });
});
</script>

</body>
</html>
