<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Monopoly Online â€” Peketruli</title>
<style>
  /* ====== Tus estilos originales ====== */
  :root{
    --bg:#cfe7ef; --panel:#fff; --leftWidth:240px; --hand-gap:10px;
  }
  html,body{height:100%;margin:0;padding:0;background:var(--bg);font-family:Arial,Helvetica,sans-serif;color:#111}
  #page{display:grid;grid-template-columns:var(--leftWidth) 700px 360px;gap:18px;justify-content:center;align-items:start;padding:18px;min-height:100vh;box-sizing:border-box;}
  #leftCol{display:flex;flex-direction:column;gap:var(--hand-gap);align-items:stretch;}
  .handPanel{background:#0b6b3a;color:#fff;padding:8px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.12);min-height:180px;}
  .handPanel.ai{background:#23394d;color:#f7eab6;}
  .handTitle{font-weight:700;font-size:14px;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;}
  .handGrid{display:flex;flex-wrap:wrap;gap:8px;align-items:flex-start;}
  .handCard{width:100px;background:#fff;color:#111;border-radius:6px;padding:6px;box-shadow:0 6px 14px rgba(0,0,0,0.12);cursor:pointer;font-size:12px;position:relative;}
  .handCard .stripe{height:10px;border-radius:4px;margin-bottom:6px;}
  #centerCol{display:flex;justify-content:center;align-items:flex-start;}
  canvas{background:#fafafa;border:4px solid #333;box-shadow:0 8px 30px rgba(0,0,0,0.12);}
  #hud{width:360px;background:var(--panel);padding:14px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.08);max-height:82vh;overflow:auto;}
  .btn{display:block;width:100%;padding:10px;margin:8px 0;border-radius:6px;border:none;font-weight:600;cursor:pointer;}
  #rollBtn{background:#2b8aef;color:#fff;}
  #onlineBtn{background:#16a085;color:#fff;}
  .info{background:#f3f6f8;padding:8px;border-radius:6px;margin-top:8px;font-size:14px;color:#111;}
  #onlineModal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:10000;}
  #onlineBox{background:#fff;padding:20px;border-radius:10px;width:320px;text-align:center;}
  #onlineBox input{width:100%;padding:8px;margin-top:8px;border:1px solid #ccc;border-radius:6px;}
</style>
</head>
<body>
<div id="onlineModal">
  <div id="onlineBox">
    <h2>Monopoly Online</h2>
    <p>Introduce tu nombre y elige modo:</p>
    <input id="playerNameInput" placeholder="Tu nombre">
    <div style="margin-top:10px;">
      <button id="createRoomBtn" class="btn" style="background:#2ecc71;color:#fff;">Crear partida</button>
      <button id="joinRoomBtn" class="btn" style="background:#3498db;color:#fff;">Unirse a partida</button>
    </div>
    <div id="joinBox" style="display:none;margin-top:10px;">
      <input id="roomCodeInput" placeholder="CÃ³digo de sala">
      <button id="connectRoomBtn" class="btn" style="background:#9b59b6;color:#fff;">Conectar</button>
    </div>
    <div id="roomInfo" style="margin-top:10px;font-weight:600;"></div>
  </div>
</div>

<div id="page" style="display:none">
  <div id="leftCol">
    <div id="playerHandPanel" class="handPanel">
      <div class="handTitle"><span>Tu mano</span><span id="playerMoney">$1500</span></div>
      <div id="playerHand" class="handGrid"><div class="handEmpty">Sin propiedades</div></div>
    </div>
    <div id="aiHandPanel" class="handPanel ai">
      <div class="handTitle"><span>Oponente</span><span id="aiMoney">$1500</span></div>
      <div id="aiHand" class="handGrid"><div class="handEmpty">Sin propiedades</div></div>
    </div>
  </div>

  <div id="centerCol"><canvas id="gameCanvas" width="700" height="700"></canvas></div>

  <div id="hud">
    <h2>Turno: <span id="turnName">Jugador</span></h2>
    <button id="rollBtn" class="btn">ðŸŽ² Tirar dados</button>
    <div class="info" id="infoBox">Esperando...</div>
    <button id="onlineBtn" class="btn">ðŸ”Œ Desconectar</button>
  </div>
</div>

<script>
/* ======== Sistema Online ======== */
let socket = null;
let playerName = "";
let roomCode = "";
let isHost = false;
let playerIndex = 0;

const onlineModal = document.getElementById("onlineModal");
const pageDiv = document.getElementById("page");
const playerNameInput = document.getElementById("playerNameInput");
const createRoomBtn = document.getElementById("createRoomBtn");
const joinRoomBtn = document.getElementById("joinRoomBtn");
const connectRoomBtn = document.getElementById("connectRoomBtn");
const roomCodeInput = document.getElementById("roomCodeInput");
const joinBox = document.getElementById("joinBox");
const roomInfo = document.getElementById("roomInfo");

createRoomBtn.onclick = ()=>{
  playerName = playerNameInput.value.trim() || "Jugador";
  roomCode = Math.random().toString(36).substring(2,7).toUpperCase();
  isHost = true;
  connectToServer();
};

joinRoomBtn.onclick = ()=>{
  joinBox.style.display = "block";
};
connectRoomBtn.onclick = ()=>{
  playerName = playerNameInput.value.trim() || "Jugador";
  roomCode = roomCodeInput.value.trim().toUpperCase();
  isHost = false;
  connectToServer();
};

function connectToServer(){
  socket = new WebSocket("wss://monopoly-server-peketruli.glitch.me"); // puedes usar un servidor Node.js propio
  socket.onopen = ()=>{
    socket.send(JSON.stringify({type:"join", room:roomCode, name:playerName}));
    roomInfo.textContent = `Conectando a la sala ${roomCode}...`;
  };
  socket.onmessage = (e)=>{
    const data = JSON.parse(e.data);
    if(data.type==="joined"){
      roomInfo.textContent = `Sala ${roomCode} creada. Esperando jugador...`;
      if(data.ready){
        startOnlineGame(data.players);
      }
    }
    if(data.type==="start"){
      startOnlineGame(data.players);
    }
    if(data.type==="state"){
      syncGameState(data.state);
    }
  };
}

/* ======== Inicio del juego ======== */
function startOnlineGame(playersData){
  onlineModal.style.display="none";
  pageDiv.style.display="grid";
  playersData.forEach((p,i)=>{ players[i].name = p.name; });
  playerIndex = playersData.findIndex(p=>p.name===playerName);
  current = 0;
  showMsg(`Partida iniciada (${roomCode}).`);
  drawBoard();
}

/* ======== SincronizaciÃ³n del estado ======== */
function sendState(){
  if(socket && socket.readyState===1){
    socket.send(JSON.stringify({type:"state", room:roomCode, state:getCurrentState()}));
  }
}
function getCurrentState(){
  return {
    players: players.map(p=>({
      name:p.name, pos:p.pos, money:p.money, inJail:p.inJail, properties:p.properties.map(pp=>pp.name)
    })),
    current
  };
}
function syncGameState(state){
  state.players.forEach((p,i)=>{
    players[i].pos=p.pos; players[i].money=p.money; players[i].inJail=p.inJail;
  });
  current = state.current;
  drawBoard(); updateHUD();
}

/* ======== Juego base (simplificado de tu versiÃ³n) ======== */
const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d");
const players=[{name:"Jugador",color:"#1f77b4",pos:0,money:1500,properties:[]},{name:"Oponente",color:"#d62728",pos:0,money:1500,properties:[]}];
let current=0;
function showMsg(t){document.getElementById("infoBox").textContent=t;}
function drawBoard(){
  ctx.clearRect(0,0,700,700);
  ctx.fillStyle="#fafafa";ctx.fillRect(0,0,700,700);
  players.forEach((p,i)=>{
    ctx.fillStyle=p.color;
    ctx.beginPath();ctx.arc(100+ i*100 + p.pos*10%600,350,15,0,Math.PI*2);ctx.fill();
  });
}
function updateHUD(){
  document.getElementById("turnName").textContent=players[current].name;
  document.getElementById("playerMoney").textContent="$"+players[0].money;
  document.getElementById("aiMoney").textContent="$"+players[1].money;
}

document.getElementById("rollBtn").onclick=()=>{
  if(current!==playerIndex)return showMsg("No es tu turno.");
  const roll=Math.floor(Math.random()*6)+1;
  const p=players[current];
  p.pos=(p.pos+roll)%40;
  p.money+=10;
  showMsg(`${p.name} tirÃ³ ${roll}. Avanza y gana $10.`);
  drawBoard();updateHUD();
  current=(current+1)%2;
  sendState();
};
</script>
</body>
</html>
