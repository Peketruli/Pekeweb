<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Monopoly Cl√°sico V2</title>
<style>
  body {
    margin: 0;
    background: #0c4a27;
    color: #fff;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #hud {
    display: flex;
    justify-content: space-between;
    width: 700px;
    margin-top: 10px;
  }
  #game {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 10px;
  }
  #hands {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 180px;
  }
  .hand {
    border-radius: 8px;
    padding: 8px;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  #playerHand { background: #065f46; }
  #aiHand { background: #374151; }
  .hand h3 { margin: 0 0 5px 0; text-align: center; }
  .card {
    background: #fff;
    color: #000;
    padding: 5px;
    border-radius: 6px;
    font-size: 12px;
    text-align: center;
    position: relative;
  }
  .card:hover .tooltip {
    display: block;
  }
  .tooltip {
    position: absolute;
    bottom: 110%;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: #fff;
    padding: 5px;
    border-radius: 6px;
    display: none;
    font-size: 11px;
    width: 160px;
  }
  #board {
    background: #fafafa;
    border: 6px solid #000;
  }
  #message { margin-top: 10px; height: 24px; }
  #draw-card {
    position: absolute;
    top: 300px;
    left: 50%;
    transform: translateX(-50%);
    width: 130px;
    height: 170px;
    background: orange;
    color: #000;
    border-radius: 10px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: transform 0.4s ease, opacity 0.4s ease;
  }
  #buyModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%) scale(0);
    background: #fff;
    color: #000;
    border-radius: 10px;
    padding: 20px;
    width: 260px;
    text-align: center;
    z-index: 10;
    transition: transform 0.3s ease;
  }
  #buyModal.show { transform: translate(-50%,-50%) scale(1); }
  #buyModal button {
    margin: 5px;
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  #overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s ease;
  }
  #overlay.show { opacity: 1; pointer-events: auto; }
</style>
</head>
<body>
<h2>üé≤ Monopoly Cl√°sico V2</h2>
<div id="hud">
  <div id="money">üí∞ Jugador: 1500 | ü§ñ IA: 1500</div>
  <button id="roll">Tirar Dados</button>
  <div id="turn">Turno: Jugador</div>
</div>
<div id="game">
  <div id="hands">
    <div id="playerHand" class="hand"><h3>üßç T√∫</h3></div>
    <div id="aiHand" class="hand"><h3>ü§ñ IA</h3></div>
  </div>
  <canvas id="board" width="700" height="700"></canvas>
</div>
<div id="message"></div>
<div id="draw-card">Carta</div>

<div id="overlay"></div>
<div id="buyModal">
  <h3 id="buyTitle"></h3>
  <p id="buyInfo"></p>
  <button id="buyYes">Comprar</button>
  <button id="buyNo">Cancelar</button>
</div>

<script>
const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");
const rollBtn = document.getElementById("roll");
const msg = document.getElementById("message");
const drawCardEl = document.getElementById("draw-card");
const playerHandEl = document.getElementById("playerHand");
const aiHandEl = document.getElementById("aiHand");
const buyModal = document.getElementById("buyModal");
const overlay = document.getElementById("overlay");
const buyYes = document.getElementById("buyYes");
const buyNo = document.getElementById("buyNo");
const buyTitle = document.getElementById("buyTitle");
const buyInfo = document.getElementById("buyInfo");

let turn="player", playerMoney=1500, aiMoney=1500;
let playerPos=0, aiPos=0, playerProps=[], aiProps=[], pendingTile=null;

const propertyData=[ /* igual que antes, 40 casillas con tipo */ ];
// Para abreviar, puedes mantener el bloque de propiedades del V2 anterior aqu√≠

function drawBoard(){
  const s=700,c=100,cell=60;
  ctx.clearRect(0,0,s,s);
  ctx.strokeStyle="#000"; ctx.lineWidth=2;
  ctx.strokeRect(0,0,s,s);
  for(let i=0;i<10;i++){
    ctx.strokeRect(s-c-(i*cell),s-c,cell,c); // abajo
    ctx.strokeRect(0,s-c-(i*cell),c,cell);   // izquierda
    ctx.strokeRect(c+(i*cell),0,cell,c);     // arriba
    ctx.strokeRect(s-c,c+(i*cell),c,cell);   // derecha
  }
  ctx.strokeRect(0,0,c,c);
  ctx.strokeRect(s-c,0,c,c);
  ctx.strokeRect(0,s-c,c,c);
  ctx.strokeRect(s-c,s-c,c,c);
  ctx.fillStyle="#000";
  ctx.font="11px sans-serif";
  ctx.fillText("Salida",s-70,s-10);
  ctx.fillText("C√°rcel",10,s-10);
  ctx.fillText("Parking",10,20);
  ctx.fillText("Ve a la C√°rcel",s-90,20);
}

function showMessage(t){ msg.textContent=t; }
function updateHUD(){
  document.getElementById("money").textContent=`üí∞ Jugador: ${playerMoney} | ü§ñ IA: ${aiMoney}`;
  document.getElementById("turn").textContent=`Turno: ${turn==="player"?"Jugador":"IA"}`;
}
function animateCard(text){
  drawCardEl.textContent=text;
  drawCardEl.style.opacity="1";
  drawCardEl.style.transform="translateY(-30px)";
  setTimeout(()=>{drawCardEl.style.opacity="0";drawCardEl.style.transform="";},2000);
}
function addCardTo(handEl,card){
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`<b>${card.name}</b><br>${card.price?"$"+card.price:""}`;
  if(card.color) div.style.borderTop=`15px solid ${card.color}`;
  const tip=document.createElement("div");
  tip.className="tooltip";
  tip.innerHTML=card.info||"";
  div.appendChild(tip);
  handEl.appendChild(div);
}
function rentForStation(props){
  let count=props.filter(p=>p.type==="station").length;
  return [0,25,50,100,200][count];
}
function showBuyModal(tile){
  overlay.classList.add("show");
  buyModal.classList.add("show");
  buyTitle.textContent=`Comprar ${tile.name}`;
  buyInfo.textContent=`Precio: $${tile.price}`;
  pendingTile=tile;
}
buyNo.onclick=()=>{overlay.classList.remove("show");buyModal.classList.remove("show");pendingTile=null;nextTurn();}
buyYes.onclick=()=>{
  const t=pendingTile;
  if(!t)return;
  if(playerMoney>=t.price){
    playerMoney-=t.price;
    t.owner="player";
    addCardTo(playerHandEl,{...t,info:`Renta base $${t.price*0.1}`});
    playerProps.push(t);
    showMessage(`Compraste ${t.name}`);
  }
  overlay.classList.remove("show");
  buyModal.classList.remove("show");
  pendingTile=null;
  updateHUD();
  nextTurn();
}
function rollDice(){return [1+Math.floor(Math.random()*6),1+Math.floor(Math.random()*6)];}
function handleTile(player,pos){
  const tile=propertyData[pos];
  if(tile.type==="suerte"||tile.type==="arca"){
    animateCard(tile.type==="suerte"?"Suerte":"Arca");
    if(tile.type==="suerte"){playerMoney+=100;showMessage("Ganaste $100 de Suerte!");}
    else {playerMoney-=50;showMessage("Pagas $50 al Arca!");}
    updateHUD();
    return;
  }
  if(tile.price && !tile.owner){
    if(player==="player"){showBuyModal(tile);}
    else{
      if(aiMoney>=tile.price){
        aiMoney-=tile.price;
        tile.owner="ai";
        aiProps.push(tile);
        addCardTo(aiHandEl,{...tile,info:`Renta base $${tile.price*0.1}`});
        showMessage(`IA compr√≥ ${tile.name}`);
      }
    }
  } else if(tile.owner && tile.owner!==player){
    let rent=tile.type==="station"?rentForStation(tile.owner==="player"?playerProps:aiProps)
      :tile.type==="company"?((Math.floor(Math.random()*6)+1)*4)
      :Math.floor(tile.price*0.1);
    if(player==="player"){playerMoney-=rent;aiMoney+=rent;}
    else{aiMoney-=rent;playerMoney+=rent;}
    showMessage(`${player==="player"?"Pagas":"Recibes"} $${rent} por ${tile.name}`);
    updateHUD();
  }
}
function nextTurn(){
  turn=turn==="player"?"ai":"player";
  updateHUD();
  if(turn==="ai") setTimeout(aiMove,1000);
}
function aiMove(){
  const [d1,d2]=rollDice();
  const total=d1+d2;
  aiPos=(aiPos+total)%40;
  handleTile("ai",aiPos);
  if(d1===d2) setTimeout(aiMove,1200);
  else nextTurn();
}
rollBtn.onclick=()=>{
  const [d1,d2]=rollDice();
  const total=d1+d2;
  playerPos=(playerPos+total)%40;
  handleTile("player",playerPos);
  if(d1!==d2 && !pendingTile) nextTurn();
}
drawBoard(); updateHUD(); showMessage("Tu turno. Tira los dados.");
</script>
</body>
</html>
