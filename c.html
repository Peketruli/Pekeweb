<!DOCTYPE html>
<html lang="es">  
<head>  
<meta charset="utf-8" />  
<meta name="viewport" content="width=device-width, initial-scale=1" />  
<title>Casino</title>  
<script src="https://unpkg.com/@supabase/supabase-js"></script>  
<style>  
 :root {
  --neon-orange: #ff6f00;
  --neon-purple: #b517ff;
  --neon-green: #00ff9d;
  --dark-bg: #1a001a;
  --section-bg: rgba(30, 0, 30, 0.85);
  --table-bg: rgba(40, 0, 40, 0.8);
  --table-text: #fff;
}

body {
  background: radial-gradient(circle at 20% 20%, #1a001a, #000000 90%);
  background-attachment: fixed;
  color: white;
  font-family: 'Poppins', Arial, sans-serif;
  text-align: center;
  padding: 40px;
  overflow-x: hidden;
}

/* Efecto de brillo animado del fondo */
@keyframes pulseGlow {
  0%, 100% { box-shadow: 0 0 30px var(--neon-purple); }
  50% { box-shadow: 0 0 60px var(--neon-orange); }
}

h1 {
  font-size: 2.6rem;
  color: var(--neon-orange);
  text-shadow: 0 0 12px var(--neon-orange), 0 0 25px var(--neon-purple);
  margin-bottom: 20px;
}

/* Usuario y Auth */
.auth-container, .user-info {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 10px;
  align-items: center;
}

.auth-button {
  padding: 10px 16px;
  background: linear-gradient(90deg, var(--neon-purple), var(--neon-orange));
  border-radius: 10px;
  border: none;
  color: white;
  cursor: pointer;
  font-weight: 600;
  text-shadow: 0 0 8px black;
  transition: transform 0.2s, box-shadow 0.3s;
}

.auth-button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 18px var(--neon-orange);
}

.user-info {
  display: none;
  cursor: pointer;
}

#userLogo {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--neon-green);
  box-shadow: 0 0 10px var(--neon-green);
}

#userName {
  font-weight: 700;
  margin-right: 6px;
  color: var(--neon-green);
  text-shadow: 0 0 8px var(--neon-green);
}

/* Men√∫ desplegable */
.dropdown-menu {
  display: none;
  position: absolute;
  top: 60px;
  right: 20px;
  background: var(--section-bg);
  color: #fff;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 0 0 15px var(--neon-purple);
}

.dropdown-menu div {
  padding: 10px;
  cursor: pointer;
  border-radius: 6px;
}

.dropdown-menu div:hover {
  background: var(--neon-purple);
}

/* Secciones */
.section {
  margin-top: 40px;
  padding: 20px;
  background: var(--section-bg);
  border-radius: 12px;
  box-shadow: 0 0 20px var(--neon-purple);
  border: 1px solid var(--neon-orange);
  transition: transform 0.3s ease, box-shadow 0.4s ease;
}

.section:hover {
  transform: scale(1.01);
  box-shadow: 0 0 35px var(--neon-orange);
}

.section h2 {
  color: var(--neon-orange);
  text-shadow: 0 0 12px var(--neon-orange), 0 0 25px var(--neon-purple);
  margin-bottom: 14px;
}

/* Top 5 */
.top5-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
  align-items: center;
}

.top5-item {
  width: 90%;
  background: rgba(20, 0, 20, 0.7);
  border-radius: 8px;
  padding: 10px 14px;
  display: flex;
  align-items: center;
  gap: 12px;
  color: white;
  border: 1px solid var(--neon-purple);
  box-shadow: 0 0 12px var(--neon-purple);
  transition: transform 0.2s, box-shadow 0.3s;
}

.top5-item:hover {
  transform: scale(1.03);
  box-shadow: 0 0 20px var(--neon-orange);
}

.top5-item img {
  width: 38px;
  height: 38px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--neon-orange);
  box-shadow: 0 0 10px var(--neon-orange);
}

/* Botones de juegos y recompensas */
.game-button, .reward-button {
  padding: 12px 18px;
  margin: 6px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  background: linear-gradient(90deg, var(--neon-green), var(--neon-purple));
  color: black;
  font-weight: 600;
  text-shadow: 0 0 4px #fff;
  box-shadow: 0 0 15px var(--neon-purple);
  transition: all 0.3s ease;
}

.game-button:hover, .reward-button:hover {
  transform: scale(1.06);
  box-shadow: 0 0 25px var(--neon-orange);
}

/* Tablas */
table.site-table {
  width: 90%;
  margin: 14px auto;
  border-collapse: collapse;
  background: var(--table-bg);
  color: var(--table-text);
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 0 15px var(--neon-green);
}

table.site-table th, table.site-table td {
  padding: 10px 12px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

/* Efecto ne√≥n en el borde */
.led-border {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border: 3px solid var(--neon-orange);
  box-shadow: 0 0 25px var(--neon-orange);
  border-radius: 10px;
  pointer-events: none;
  animation: pulseGlow 3s infinite ease-in-out;
}

@media (max-width: 600px) {
  .top5-item { width: 100%; }
}
</style>
</head>  

<body> 
  <div class="led-border"></div>
  <button class="auth-button" onclick="window.location.href='h.html'">üèöÔ∏è Volver</button>    
<h1>üé∞ Casino üé∞</h1>  

<div class="auth-container" id="authContainer">  
  <button class="auth-button" onclick="window.location.href='l.html'">Iniciar sesi√≥n / Registrarse</button>  
</div>  

<div class="user-info" id="userInfo">  
  <span id="userName">Usuario</span>  
  <img id="userLogo" src="logoDefault.png" alt="logo"/>  
</div>  

<div class="dropdown-menu" id="dropdownMenu">  
  <div onclick="logout()">üö™ Cerrar sesi√≥n</div>  
</div>  

<div id="pekepuntos" style="margin-top:20px; font-size:1.2rem;">Pekepuntos: 0</div>  

<div class="section" id="top5Section">  
  <h2>üèÜ Top 5 Jugadores</h2>  
  <ul id="top5List" class="top5-list"></ul>  
</div>  

<div class="section" id="gamesSection">  
  <h2>üéÆ Juegos Disponibles</h2>  
  <button class="game-button" onclick="window.location.href='bl.html'">Blackjack</button>  
  <button class="game-button" onclick="window.location.href='r.html'">Ruleta</button>  
</div>  

<div class="section" id="rewardsSection">  
  <h2>üéÅ Recompensas (Personalizaciones)</h2>    
  <div style="margin-bottom:12px;">  
    <button class="reward-button" id="rewardBgBtn">Recompensa 1: Cambiar Fondo</button>  
    <input type="color" id="backgroundPicker" style="display:none; margin-left:8px;" />  
  </div>    
  <div style="margin-bottom:12px;">  
    <button class="reward-button" id="rewardNameBtn">Recompensa 2: Cambiar Color del Nombre</button>  
    <input type="color" id="nameColorPicker" style="display:none; margin-left:8px;" />  
  </div>    
  <div style="margin-bottom:12px;">  
    <button class="reward-button" id="reward3Btn">Recompensa 3: Cambiar color de tablas</button>  
    <input type="color" id="tableColorPicker" style="display:none;" onchange="setTableColor(this.value)">  
  </div>    
  <div id="exclusiveTop5" style="display:none; margin-top:10px;">üéñ Est√°s en Top 5 ‚Üí tu foto aparece en la lista.</div>  
  <div id="exclusiveTop3" style="display:none; margin-top:6px;">ü•â Top 3 ‚Üí nombre en <span style="color:#b87333">cobre</span>.</div>  
  <div id="exclusiveTop2" style="display:none; margin-top:6px;">ü•à Top 2 ‚Üí nombre en <span style="color:silver">plata</span>.</div>  
  <div id="exclusiveTop1" style="display:none; margin-top:6px;">üëë Top 1 ‚Üí nombre en <span style="color:gold">oro</span>.</div>  
</div>  

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let currentUser = null;

// -------------------- INICIALIZACI√ìN --------------------
document.addEventListener("DOMContentLoaded", async () => {
    await initUser();

    document.getElementById("logoutBtn").addEventListener("click", logout);
    document.getElementById("dailyButton")?.addEventListener("click", reclamarRecompensa);

    document.getElementById("rewardBgBtn").addEventListener("click", () => toggleShow("backgroundPicker"));
    document.getElementById("rewardNameBtn").addEventListener("click", () => toggleShow("nameColorPicker"));
    document.getElementById("reward3Btn").addEventListener("click", () => toggleShow("tableColorPicker"));

    document.getElementById("backgroundPicker")?.addEventListener("input", (e) => setBackgroundColor(e.target.value));
    document.getElementById("nameColorPicker")?.addEventListener("input", (e) => setNameColor(e.target.value));
    document.getElementById("tableColorPicker")?.addEventListener("input", (e) => setTableColor(e.target.value));

    await loadTop5();
});

// -------------------- LOGIN / LOGOUT --------------------
async function logout() {
    localStorage.removeItem("currentUser");
    currentUser = null;
    window.location.href = "l.html";
}

// -------------------- USUARIO --------------------
async function initUser() {
    try {
        const saved = localStorage.getItem("currentUser");
        if (saved) {
            currentUser = JSON.parse(saved);
        } else {
            alert("No est√°s logueado");
            window.location.href = "l.html";
            return;
        }

        renderUserUI();
        showDailyButton();
    } catch (err) {
        console.error("Error initUser:", err);
    }
}

function renderUserUI() {
    if (!currentUser) return;

    const userName = document.getElementById("userName");
    const userLogo = document.getElementById("userLogo");
    const pekepuntos = document.getElementById("pekepuntos");

    if (userName) userName.textContent = currentUser.username || "Usuario";
    if (userLogo) userLogo.src = currentUser.logo || "logoDefault.png";
    if (pekepuntos) pekepuntos.textContent = `Pekepuntos: ${(currentUser.pekepuntos || 0).toLocaleString()}`;

    if (currentUser.fondo_color) document.body.style.backgroundColor = currentUser.fondo_color;
    if (currentUser.nombre_color) document.getElementById("userName").style.color = currentUser.nombre_color;
    if (currentUser.tabla_color) applyTableColor(currentUser.tabla_color);
}

// -------------------- TOP 5 --------------------
async function loadTop5() {
    const top5List = document.getElementById("top5List");
    if (!top5List) return;

    top5List.innerHTML = "<li>Cargando...</li>";
    const { data, error } = await supabase.from("usuarios").select("username, pekepuntos, logo, nombre_color").order("pekepuntos", { ascending: false }).limit(5);

    if (error) {
        top5List.innerHTML = `<li>Error: ${error.message}</li>`;
        return;
    }

    top5List.innerHTML = "";
    (data || []).forEach((u, idx) => {
        const li = document.createElement("li");
        const color = idx === 0 ? "gold" : idx === 1 ? "silver" : idx === 2 ? "#b87333" : u.nombre_color || "#fff";
        li.innerHTML = `
            <img src="${u.logo || "logoDefault.png"}" alt="logo" />
            <strong style="color:${color}">${idx + 1}. ${u.username}</strong>
            <span>${(u.pekepuntos || 0).toLocaleString()} Pekepuntos</span>
        `;
        top5List.appendChild(li);
    });
}

// -------------------- RECOMPENSAS DIARIAS --------------------
function showDailyButton() {
    const container = document.getElementById("dailyContainer");
    if (!container || !currentUser) return;

    container.innerHTML = `<button id="dailyButton">üéÅ Reclamar 100 Pekepuntos diarios</button>`;
    document.getElementById("dailyButton").addEventListener("click", reclamarRecompensa);
}

async function reclamarRecompensa() {
    if (!currentUser) return;

    const now = new Date();
    const last = currentUser.last_claim ? new Date(currentUser.last_claim) : null;
    if (last) {
        const diffHours = (now - last) / 36e5;
        if (diffHours < 24) return alert(`Ya reclamaste hoy. Espera ${Math.ceil(24 - diffHours)}h`);
    }

    const nuevos = (currentUser.pekepuntos || 0) + 100;
    const { error } = await supabase.from("usuarios").update({ pekepuntos: nuevos, last_claim: now.toISOString() }).eq("id", currentUser.id);
    if (error) return alert("Error al reclamar pekepuntos: " + error.message);

    currentUser.pekepuntos = nuevos;
    currentUser.last_claim = now.toISOString();
    localStorage.setItem("currentUser", JSON.stringify(currentUser));

    document.getElementById("pekepuntos").textContent = `Pekepuntos: ${nuevos.toLocaleString()}`;
    alert("¬°Recompensa diaria reclamada!");
}

// -------------------- PERSONALIZACI√ìN --------------------
function toggleShow(id) {
    const el = document.getElementById(id);
    if (el) el.style.display = el.style.display === "block" ? "none" : "block";
}

async function setBackgroundColor(color) {
    document.body.style.backgroundColor = color;
    if (currentUser) await updateUserField("fondo_color", color);
}
async function setNameColor(color) {
    document.getElementById("userName").style.color = color;
    if (currentUser) await updateUserField("nombre_color", color);
}
async function setTableColor(color) {
    applyTableColor(color);
    if (currentUser) await updateUserField("tabla_color", color);
}
function applyTableColor(color) {
    document.querySelectorAll("table").forEach(tbl => tbl.style.backgroundColor = color);
}

async function updateUserField(field, value) {
    const { error } = await supabase.from("usuarios").update({ [field]: value }).eq("id", currentUser.id);
    if (!error) currentUser[field] = value;
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
}
</script>
</body>  
</html>
