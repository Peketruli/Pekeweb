<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tetris</title>
<style>
:root{
  --bg:#0b1220;
  --panel:#071026;
  --accent:#39a0ff;
  --tile-size:28px;
}

body{
  margin:0;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Arial, sans-serif;
  background: var(--bg);
  overflow:hidden; /* Evita scroll */
}

.wrap {
  display:flex;
  gap:12px;
  align-items:flex-start;
  justify-content:center;
  max-height:calc(100vh - 20px);
}

.panel {
  background: var(--panel);
  padding:12px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  display:flex;
  flex-direction:column;
  align-items:center;
}

canvas {
  background: #08203a;
  border-radius:6px;
  display:block;
  max-height:100%;
}

.controls {
  display:flex;
  gap:6px;
  margin-top:10px;
  flex-wrap:wrap;
  justify-content:center;
}

.btn {
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  color:#fff;
  padding:6px 8px;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}
.btn:hover{border-color:rgba(255,255,255,0.12)}

.touch-controls {
  display:flex;
  gap:6px;
  justify-content:center;
  margin-top:6px;
}
.touch-controls .btn{
  padding:10px 12px;
  font-size:14px;
}

.right {
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:center;
  max-width:140px;      /* Anchura normal */
  max-height:400px;      /* Limita la altura del panel derecho */
  overflow-y:auto;       /* Si hay demasiado contenido, permite scroll interno */
}


.preview, .hold {
  display:grid;
  grid-template-columns: repeat(4, 24px); /* ligeramente más pequeño */
  grid-template-rows: repeat(4, 24px);
  gap:2px;
  background: rgba(255,255,255,0.02);
  border-radius:4px;
  padding:2px;
  width:100%;
}

.value {
  color: var(--accent);
  font-weight:600;
  font-size:14px;
  text-align:center;
}

</style>
</head>
<body>
<button onclick="window.location.href='golf.html'">← Volver</button>
<div class="wrap">
  <div class="panel">
    <canvas id="game" width="220" height="616"></canvas>
    <div class="controls">
      <button class="btn" id="start">Start</button>
      <button class="btn" id="pause">Pause</button>
      <button class="btn" id="reset">Reset</button>
      <button class="btn" id="harddrop">Hard Drop</button>
    </div>
    <div class="touch-controls">
      <button class="btn" id="left-btn">◀</button>
      <button class="btn" id="rotate-btn">⟳</button>
      <button class="btn" id="right-btn">▶</button>
      <button class="btn" id="down-btn">▼</button>
      <button class="btn" id="hold-btn">Hold</button>
    </div>
  </div>
  <div class="panel right">
    <div class="value">Score: <span id="score">0</span></div>
    <div class="value">Level: <span id="level">1</span></div>
    <div class="value">Lines: <span id="lines">0</span></div>
    <div style="margin-top:10px;">
      <div>Hold</div>
      <div class="hold" id="hold-grid"></div>
    </div>
    <div style="margin-top:10px;">
      <div>Siguientes</div>
      <div id="nexts"></div>
    </div>
  </div>
</div>

<script>
/* ---------- Código Tetris (sin textos extras) ---------- */
const COLS=10, VISIBLE_ROWS=20, HIDDEN_ROWS=2, ROWS=VISIBLE_ROWS+HIDDEN_ROWS, TILE=28;
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
canvas.width=COLS*TILE; canvas.height=VISIBLE_ROWS*TILE;

const scoreEl=document.getElementById('score');
const levelEl=document.getElementById('level');
const linesEl=document.getElementById('lines');
const nextsEl=document.getElementById('nexts');
const holdGrid=document.getElementById('hold-grid');

const startBtn=document.getElementById('start');
const pauseBtn=document.getElementById('pause');
const resetBtn=document.getElementById('reset');
const hardDropBtn=document.getElementById('harddrop');
const leftBtn=document.getElementById('left-btn');
const rightBtn=document.getElementById('right-btn');
const rotateBtn=document.getElementById('rotate-btn');
const downBtn=document.getElementById('down-btn');
const holdBtn=document.getElementById('hold-btn');

const COLORS={I:'#00f0f0',J:'#0000f0',L:'#f0a000',O:'#f0f000',S:'#00f000',T:'#a000f0',Z:'#f00000'};
const TETROMINOS={
I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],
J:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],
L:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],
O:[[[1,1],[1,1]]],
S:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]]],
T:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],
Z:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]]]
};

function cloneMatrix(m){return m.map(r=>r.slice());}
function createEmptyGrid(){return Array.from({length:ROWS},()=>Array(COLS).fill(null));}
let grid=createEmptyGrid(), current=null, nextQueue=[], holdPiece=null, holdUsed=false;
let score=0, level=1, lines=0, dropInterval=800, lastDropTime=0, playing=false, paused=false;

function generateBag(){let types=Object.keys(TETROMINOS); let bag=types.slice(); for(let i=bag.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[bag[i],bag[j]]=[bag[j],bag[i]];} return bag;}
function ensureNext(){while(nextQueue.length<6){if(!nextQueue._bag||nextQueue._bag.length===0) nextQueue._bag=generateBag(); nextQueue.push(nextQueue._bag.pop());}}
function matEquals(a,b){if(a.length!==b.length)return false;for(let i=0;i<a.length;i++){if(a[i].length!==b[i].length)return false;for(let j=0;j<a[i].length;j++){if(a[i][j]!==b[i][j])return false;}}return true;}
function rotateMatrix(mat){const H=mat.length,W=mat[0].length,res=[];for(let c=0;c<W;c++){const row=[];for(let r=H-1;r>=0;r--){row.push(mat[r][c]);}res.push(row);}return res;}
function createPiece(type){const states=TETROMINOS[type].map(s=>cloneMatrix(s));let rotations=states;while(rotations.length<4){const last=rotations[rotations.length-1];const next=rotateMatrix(last);if(!rotations.some(r=>matEquals(r,next)))rotations.push(next);else break;} return {type,rotations,rot:0,matrix:rotations[0],row:-HIDDEN_ROWS,col:0};}

function spawnPiece(){ensureNext();const t=nextQueue.shift();const p=createPiece(t);p.row=-HIDDEN_ROWS;p.col=Math.floor((COLS-p.matrix[0].length)/2);current=p;holdUsed=false;if(collides(current.matrix,current.row,current.col))gameOver();updateStats();}
function collides(matrix,row,col){for(let r=0;r<matrix.length;r++){for(let c=0;c<matrix[r].length;c++){if(matrix[r][c]){const gr=row+r,gc=col+c;if(gc<0||gc>=COLS||gr>=ROWS)return true;if(gr>=0&&grid[gr][gc])return true;}}}return false;}
function lockPiece(){const m=current.matrix;for(let r=0;r<m.length;r++){for(let c=0;c<m[r].length;c++){if(m[r][c]){const gr=current.row+r,gc=current.col+c;if(gr>=0&&gr<ROWS&&gc>=0&&gc<COLS)grid[gr][gc]={type:current.type,color:COLORS[current.type]};}}}clearLines();spawnPiece();}
function clearLines(){let cleared=0;for(let r=ROWS-1;r>=0;r--){if(grid[r].every(cell=>cell!==null)){grid.splice(r,1);grid.unshift(new Array(COLS).fill(null));cleared++;r++;}}if(cleared>0){const pointsMap={1:100,2:300,3:500,4:800};score+=(pointsMap[cleared]||cleared*200)*level;lines+=cleared;const newLevel=Math.floor(lines/10)+1;if(newLevel!==level){level=newLevel;dropInterval=Math.max(80,800-(level-1)*60);}updateStats();}}

function move(dx,dy){const nr=current.row+dy,nc=current.col+dx;if(!collides(current.matrix,nr,nc)){current.row=nr;current.col=nc;return true;}return false;}
function softDrop(){if(!move(0,1))lockPiece();else{score++;updateStats();}}
function hardDrop(){let dropped=0;while(move(0,1))dropped++;score+=2*dropped;lockPiece();updateStats();}
function hold(){if(holdUsed)return;if(!holdPiece){holdPiece=current.type;spawnPiece();}else{const tmp=holdPiece;holdPiece=current.type;current=createPiece(tmp);}holdUsed=true;renderHold();}
function tryRotate(){const oldRot=current.rot,newRot=(oldRot+1)%current.rotations.length,newMat=current.rotations[newRot],kicks=[0,-1,1,-2,2];for(let k of kicks){if(!collides(newMat,current.row,current.col+k)){current.rot=newRot;current.matrix=newMat;current.col+=k;return true;}}return false;}

function updateStats(){scoreEl.textContent=score;levelEl.textContent=level;linesEl.textContent=lines;renderNext();renderHold();}
function renderNext(){nextsEl.innerHTML='';ensureNext();const previewList=nextQueue.slice(0,5);for(let t of previewList){const preview=document.createElement('div');preview.className='preview';preview.style.gridTemplateColumns=`repeat(4, ${TILE}px)`;preview.style.gridTemplateRows=`repeat(4, ${TILE}px)`;const frag=document.createDocumentFragment();for(let i=0;i<16;i++){const cell=document.createElement('div');cell.style.width=`${TILE}px`;cell.style.height=`${TILE}px`;frag.appendChild(cell);}preview.appendChild(frag);const states=TETROMINOS[t];const m=states[0];const h=m.length,w=m[0].length,offsetR=Math.floor((4-h)/2),offsetC=Math.floor((4-w)/2);for(let r=0;r<h;r++){for(let c=0;c<w;c++){if(m[r][c]){const idx=(offsetR+r)*4+(offsetC+c);const cell=preview.children[idx];cell.style.background=COLORS[t];cell.style.borderRadius='4px';}}}nextsEl.appendChild(preview);}}
function renderHold(){holdGrid.innerHTML='';holdGrid.style.gridTemplateColumns=`repeat(4, ${TILE}px)`;holdGrid.style.gridTemplateRows=`repeat(4, ${TILE}px)`;const frag=document.createDocumentFragment();for(let i=0;i<16;i++){const cell=document.createElement('div');cell.style.width=`${TILE}px`;cell.style.height=`${TILE}px`;frag.appendChild(cell);}holdGrid.appendChild(frag);if(holdPiece){const states=TETROMINOS[holdPiece];const m=states[0];const h=m.length,w=m[0].length,offsetR=Math.floor((4-h)/2),offsetC=Math.floor((4-w)/2);for(let r=0;r<h;r++){for(let c=0;c<w;c++){if(m[r][c]){const idx=(offsetR+r)*4+(offsetC+c);const cell=holdGrid.children[idx];cell.style.background=COLORS[holdPiece];cell.style.borderRadius='4px';}}}}}

function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let r=HIDDEN_ROWS;r<ROWS;r++){for(let c=0;c<COLS;c++){const cell=grid[r][c];const y=(r-HIDDEN_ROWS)*TILE,x=c*TILE;if(cell){ctx.fillStyle=cell.color;ctx.fillRect(x+1,y+1,TILE-2,TILE-2);}else{ctx.strokeStyle='rgba(255,255,255,0.03)';ctx.strokeRect(x+0.5,y+0.5,TILE-1,TILE-1);}}}if(current){const m=current.matrix;for(let r=0;r<m.length;r++){for(let c=0;c<m[r].length;c++){if(m[r][c]){const gr=current.row+r,gc=current.col+c,screenR=gr-HIDDEN_ROWS;if(screenR>=0){ctx.fillStyle=COLORS[current.type];ctx.fillRect(gc*TILE+1,screenR*TILE+1,TILE-2,TILE-2);}}}}}}

function loop(time){if(!playing||paused){requestAnimationFrame(loop);return;}if(!lastDropTime)lastDropTime=time;if(time-lastDropTime>dropInterval){if(!move(0,1))lockPiece();lastDropTime=time;}draw();requestAnimationFrame(loop);}
function startGame(){if(!playing){playing=true;paused=false;if(!current){ensureNext();spawnPiece();}lastDropTime=performance.now();requestAnimationFrame(loop);}else paused=false;}
function pauseGame(){paused=true;}
function resetGame(){playing=false;paused=false;grid=createEmptyGrid();current=null;nextQueue=[];nextQueue._bag=[];holdPiece=null;holdUsed=false;score=0;level=1;lines=0;dropInterval=800;updateStats();draw();}

/* Game over */
function gameOver(){playing=false;paused=true;alert('Game Over — puntuación: '+score);}

/* Keyboard controls */
document.addEventListener('keydown',e=>{if(!playing||paused)return;if(e.key==='ArrowLeft'){move(-1,0);draw();}
else if(e.key==='ArrowRight'){move(1,0);draw();}
else if(e.key==='ArrowDown'){softDrop();draw();}
else if(e.key==='ArrowUp'){tryRotate();draw();}
else if(e.code==='Space'){hardDrop();draw();}
else if(e.key.toLowerCase()==='c'){hold();draw();}
else if(e.key.toLowerCase()==='p'){paused=!paused;}});

/* Touch buttons */
leftBtn.addEventListener('click',()=>{if(playing&&!paused){move(-1,0);draw();}});
rightBtn.addEventListener('click',()=>{if(playing&&!paused){move(1,0);draw();}});
rotateBtn.addEventListener('click',()=>{if(playing&&!paused){tryRotate();draw();}});
downBtn.addEventListener('click',()=>{if(playing&&!paused){softDrop();draw();}});
holdBtn.addEventListener('click',()=>{if(playing&&!paused){hold();draw();}});
hardDropBtn.addEventListener('click',()=>{if(playing&&!paused){hardDrop();draw();}});

startBtn.addEventListener('click',()=>{startGame();});
pauseBtn.addEventListener('click',()=>{pauseGame();});
resetBtn.addEventListener('click',()=>{resetGame();startGame();});

ensureNext();updateStats();draw();startGame();
</script>
</body>
</html>
