<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Solitario Klondike</title>
<style>
    body {
        margin: 0;
        background-color: #0b3d0b;
        font-family: Arial, sans-serif;
        color: white;
        overflow: hidden;
    }

    #top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #062906;
        padding: 10px 20px;
        border-bottom: 2px solid #1a501a;
    }

    #top-bar button {
        background: #333;
        border: none;
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
    }

    #top-bar button:hover { background: #555; }

    #board {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        gap: 20px;
    }

    #top-area {
        display: flex;
        justify-content: space-between;
        width: 90%;
        margin-bottom: 30px;
    }

    #left {
        display: flex;
        gap: 15px;
    }

    #right {
        display: flex;
        gap: 15px;
    }

    .pile {
        width: 90px;
        height: 130px;
        background: rgba(255,255,255,0.1);
        border: 2px dashed rgba(255,255,255,0.2);
        border-radius: 8px;
        position: relative;
    }

    .column {
        width: 90px;
        height: 500px;
        position: relative;
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
    }

    #tableau {
        display: flex;
        justify-content: center;
        gap: 10px;
    }

    .card {
        width: 90px;
        height: 130px;
        border-radius: 8px;
        background: white;
        color: black;
        position: absolute;
        cursor: grab;
        box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        transition: transform 0.2s;
        user-select: none;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 5px;
        font-weight: bold;
    }

    .card .corner {
        font-size: 16px;
        text-align: left;
        line-height: 1.1;
    }

    .card .symbol {
        text-align: center;
        font-size: 40px;
        line-height: 70px;
    }

    .card.red { color: red; }

    .card.back {
        background: linear-gradient(45deg, #900, #b00);
        border: 2px solid #400;
    }

    .card.dragging {
        opacity: 0.5;
        transform: rotate(5deg);
    }
</style>
</head>
<body>

<div id="top-bar">
    <button onclick="window.location.href='golf.html'">‚Üê Volver</button>
    <h2>Solitario Klondike</h2>
    <button onclick="iniciarJuego()">Reiniciar</button>
</div>

<div id="board">
    <div id="top-area">
        <div id="left">
            <div id="deck" class="pile"></div>
            <div id="waste" class="pile"></div>
        </div>
        <div id="right">
            <div id="f0" class="pile foundation"></div>
            <div id="f1" class="pile foundation"></div>
            <div id="f2" class="pile foundation"></div>
            <div id="f3" class="pile foundation"></div>
        </div>
    </div>

    <div id="tableau"></div>
</div>

<script>
const palos = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
let mazo = [], descarte = [];
let tableau = [[],[],[],[],[],[],[]];
let fundaciones = [[],[],[],[]];
let cartasArrastradas = [];
let origen = null;

/* === CREAR MAZO === */
function crearMazo() {
    mazo = [];
    for (let palo of palos) {
        for (let valor = 1; valor <= 13; valor++) {
            mazo.push({
                valor,
                palo,
                color: (palo === '‚ô•' || palo === '‚ô¶') ? 'red' : 'black',
                visible: false
            });
        }
    }
}

/* === BARAJAR === */
function barajar() {
    for (let i = mazo.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [mazo[i], mazo[j]] = [mazo[j], mazo[i]];
    }
}

/* === REPARTIR === */
function repartirCartas() {
    tableau = [[],[],[],[],[],[],[]];
    for (let i = 0; i < 7; i++) {
        for (let j = 0; j <= i; j++) {
            const carta = mazo.pop();
            carta.visible = (j === i);
            tableau[i].push(carta);
        }
    }
    render();
}

/* === ROBAR === */
function robarCarta() {
    if (mazo.length === 0) {
        if (descarte.length > 0) {
            mazo = descarte.reverse().map(c => ({...c, visible:false}));
            descarte = [];
        }
    } else {
        const carta = mazo.pop();
        carta.visible = true;
        descarte.push(carta);
    }
    render();
}

/* === REGLAS === */
function puedeMoverAFoundation(carta, fundacion) {
    if (fundacion.length === 0) return carta.valor === 1;
    const top = fundacion[fundacion.length - 1];
    return carta.palo === top.palo && carta.valor === top.valor + 1;
}

function puedeMoverATabla(carta, columna) {
    if (columna.length === 0) return carta.valor === 13;
    const top = columna[columna.length - 1];
    return top.visible && carta.color !== top.color && carta.valor === top.valor - 1;
}

/* === ELIMINAR CARTAS DEL ORIGEN === */
function eliminarCartasDeOrigen(cartas) {
    for (let t = 0; t < 7; t++) {
        const col = tableau[t];
        const idx = col.indexOf(cartas[0]);
        if (idx !== -1) {
            col.splice(idx, cartas.length);
            if (col.length > 0) col[col.length - 1].visible = true;
            return;
        }
    }
    if (descarte.includes(cartas[0])) descarte.pop();
}

/* === RENDER === */
function render() {
    const deckDiv = document.getElementById('deck');
    deckDiv.innerHTML = '';
    const back = document.createElement('div');
    back.className = 'card back';
    back.onclick = robarCarta;
    if (mazo.length > 0 || descarte.length > 0) deckDiv.appendChild(back);

    const wasteDiv = document.getElementById('waste');
    wasteDiv.innerHTML = '';
    if (descarte.length > 0) {
        const carta = descarte[descarte.length - 1];
        wasteDiv.appendChild(crearCartaDiv(carta, [carta]));
    }

    for (let i = 0; i < 4; i++) {
        const fDiv = document.getElementById('f'+i);
        fDiv.innerHTML = '';
        if (fundaciones[i].length > 0) {
            const carta = fundaciones[i][fundaciones[i].length - 1];
            fDiv.appendChild(crearCartaDiv(carta, [carta]));
        }
    }

    const tabla = document.getElementById('tableau');
    tabla.innerHTML = '';
    for (let i = 0; i < 7; i++) {
        const col = document.createElement('div');
        col.className = 'column';
        col.dataset.index = i;
        let offset = 0;
        for (let j = 0; j < tableau[i].length; j++) {
            const carta = tableau[i][j];
            const pila = tableau[i].slice(j);
            const div = crearCartaDiv(carta, pila);
            div.style.top = offset + 'px';
            col.appendChild(div);
            offset += 25;
        }
        tabla.appendChild(col);
    }

    if (fundaciones.every(f => f.length === 13))
        setTimeout(() => alert("üéâ ¬°Ganaste el Solitario!"), 300);
}

/* === CREAR DIV CARTA === */
function crearCartaDiv(carta, pila) {
    const div = document.createElement('div');
    div.className = 'card ' + (carta.visible ? (carta.color === 'red' ? 'red' : '') : 'back');
    if (carta.visible) {
        const valorTexto = (carta.valor === 1 ? 'A' :
                           carta.valor === 11 ? 'J' :
                           carta.valor === 12 ? 'Q' :
                           carta.valor === 13 ? 'K' : carta.valor);
        div.innerHTML = `
            <div class="corner">${valorTexto}<br>${carta.palo}</div>
            <div class="symbol">${carta.palo}</div>
        `;
        div.draggable = true;
        div.ondragstart = e => {
            cartasArrastradas = pila;
            origen = e.target.parentElement;
            div.classList.add('dragging');
        };
        div.ondragend = e => {
            cartasArrastradas = [];
            div.classList.remove('dragging');
        };
    }
    return div;
}

/* === DROP === */
document.addEventListener("dragover", e => e.preventDefault());
document.addEventListener("drop", e => {
    e.preventDefault();
    const col = e.target.closest('.column');
    const fund = e.target.closest('.foundation');
    if (cartasArrastradas.length === 0) return;

    const cartaBase = cartasArrastradas[0];
    if (fund) {
        for (let f = 0; f < 4; f++) {
            if (puedeMoverAFoundation(cartaBase, fundaciones[f])) {
                eliminarCartasDeOrigen(cartasArrastradas);
                fundaciones[f].push(cartaBase);
                render();
                return;
            }
        }
    } else if (col) {
        const index = parseInt(col.dataset.index);
        if (puedeMoverATabla(cartaBase, tableau[index])) {
            eliminarCartasDeOrigen(cartasArrastradas);
            tableau[index] = tableau[index].concat(cartasArrastradas);
            render();
        }
    }
});

/* === INICIAR === */
function iniciarJuego() {
    crearMazo();
    barajar();
    descarte = [];
    fundaciones = [[],[],[],[]];
    repartirCartas();
}
window.onload = iniciarJuego;
</script>
</body>
</html>
