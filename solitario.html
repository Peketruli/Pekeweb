<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Solitario (Klondike)</title>
<style>
    :root{
        --bg:#0b3d0b;
        --panel:#062906;
        --slot: rgba(255,255,255,0.08);
        --slot-border: rgba(255,255,255,0.12);
    }
    *{box-sizing:border-box;user-select:none}
    body{
        margin:0;
        font-family:Arial, Helvetica, sans-serif;
        background:var(--bg);
        color:#fff;
        height:100vh;
        overflow:hidden;
    }

    #top-bar{
        height:56px;
        background:var(--panel);
        border-bottom:2px solid #134013;
        display:flex;
        align-items:center;
        justify-content:space-between;
        gap:12px;
        padding:0 16px;
    }
    #top-bar h2{margin:0;font-size:18px}
    #top-bar .left, #top-bar .right{display:flex;gap:8px;align-items:center}

    button{
        background:#333;border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;
    }
    button:hover{background:#4a4a4a}

    #game{
        padding:14px;
        height:calc(100vh - 56px);
        display:flex;
        flex-direction:column;
        gap:12px;
    }

    #top-area{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        width:100%;
    }
    #left-top{
        display:flex;
        gap:12px;
        align-items:center;
    }
    .slot{
        width:92px;
        height:132px;
        background:var(--slot);
        border:2px dashed var(--slot-border);
        border-radius:10px;
        position:relative;
        display:flex;
        align-items:center;
        justify-content:center;
        overflow:visible;
    }

    .card{
        width:92px;
        height:132px;
        border-radius:8px;
        position:absolute;
        left:0;
        top:0;
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:700;
        font-size:20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.6);
        cursor:pointer;
        background:white;
        color:black;
        transition: transform 0.05s linear;
    }
    .card.red{ color: #b91c1c; }
    .card.back{
        background: linear-gradient(180deg,#b91c1c,#8a1010);
        color:transparent;
        border:2px solid rgba(0,0,0,0.3);
    }

    #tableau{
        display:flex;
        gap:12px;
        align-items:flex-start;
        justify-content:center;
        height:100%;
        width:100%;
        padding:8px;
    }
    .column{
        width:92px;
        min-height:150px;
        background:var(--slot);
        border-radius:10px;
        position:relative;
        padding:6px 0;
        border:1px solid transparent;
    }

    .dragging{
        opacity:0.8;
        z-index:9999;
        transform:scale(1.05);
    }

    @media (max-width:900px){
        .slot, .card{ width:70px; height:100px; font-size:16px; }
        .column{ width:70px }
    }
</style>
</head>
<body>
    <div id="top-bar">
        <div class="left">
            <button onclick="window.location.href='menu.html'">‚Üê Volver</button>
            <h2>Solitario</h2>
        </div>
        <div class="right">
            <button onclick="iniciarJuego()">Reiniciar</button>
            <button onclick="autoMoverTodo()">Auto-mover</button>
        </div>
    </div>

    <div id="game">
        <div id="top-area">
            <div id="left-top">
                <div id="deck" class="slot" title="Mazo (haz clic)"> </div>
                <div id="waste" class="slot" title="Descarte"> </div>
            </div>

            <div id="foundations" style="display:flex;gap:12px">
                <div id="f0" class="slot" data-foundation="0" title="Fundaci√≥n ‚ô†"></div>
                <div id="f1" class="slot" data-foundation="1" title="Fundaci√≥n ‚ô•"></div>
                <div id="f2" class="slot" data-foundation="2" title="Fundaci√≥n ‚ô¶"></div>
                <div id="f3" class="slot" data-foundation="3" title="Fundaci√≥n ‚ô£"></div>
            </div>
        </div>

        <div id="tableau"></div>
    </div>

<script>
/* === SOLITARIO COMPLETO CON DRAG & DROP Y BARJA ROJA === */

const palos = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
let mazo = [], descarte = [];
let tableau = [[],[],[],[],[],[],[]];
let fundaciones = [[],[],[],[]];
let cartaArrastrada = null;
let origen = null;

/* === CREACI√ìN DEL MAZO === */
function crearMazo() {
    mazo = [];
    for (let palo of palos) {
        for (let valor = 1; valor <= 13; valor++) {
            let nombre = valor;
            if (valor === 1) nombre = 'A';
            else if (valor === 11) nombre = 'J';
            else if (valor === 12) nombre = 'Q';
            else if (valor === 13) nombre = 'K';
            mazo.push({
                valor,
                palo,
                color: (palo === '‚ô•' || palo === '‚ô¶') ? 'red' : 'black',
                visible: false
            });
        }
    }
}

/* === BARAJAR CARTAS === */
function barajar() {
    for (let i = mazo.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [mazo[i], mazo[j]] = [mazo[j], mazo[i]];
    }
}

/* === REPARTIR === */
function repartirCartas() {
    tableau = [[],[],[],[],[],[],[]];
    for (let i = 0; i < 7; i++) {
        for (let j = 0; j <= i; j++) {
            const carta = mazo.pop();
            carta.visible = (j === i);
            tableau[i].push(carta);
        }
    }
    render();
}

/* === ROBAR CARTA === */
function robarCarta() {
    if (mazo.length === 0) {
        mazo = descarte.reverse().map(c => ({...c, visible:false}));
        descarte = [];
    } else {
        const carta = mazo.pop();
        carta.visible = true;
        descarte.push(carta);
    }
    render();
}

/* === REGLAS === */
function puedeMoverAFoundation(carta, fundacion) {
    if (fundacion.length === 0) return carta.valor === 1;
    const top = fundacion[fundacion.length - 1];
    return carta.palo === top.palo && carta.valor === top.valor + 1;
}

function puedeMoverATabla(carta, columna) {
    if (columna.length === 0) return carta.valor === 13;
    const top = columna[columna.length - 1];
    return top.visible && carta.color !== top.color && carta.valor === top.valor - 1;
}

/* === MOVER CARTA === */
function moverCarta(carta, destino, tipo) {
    if (!carta.visible) return;

    if (tipo === 'foundation') {
        for (let f = 0; f < 4; f++) {
            if (puedeMoverAFoundation(carta, fundaciones[f])) {
                eliminarCartaDeOrigen(carta);
                fundaciones[f].push(carta);
                render();
                return true;
            }
        }
    } else if (tipo === 'tableau') {
        for (let t = 0; t < 7; t++) {
            if (puedeMoverATabla(carta, tableau[t])) {
                eliminarCartaDeOrigen(carta);
                tableau[t].push(carta);
                render();
                return true;
            }
        }
    }
    render();
    return false;
}

/* === ELIMINAR CARTA DE SU ORIGEN === */
function eliminarCartaDeOrigen(carta) {
    for (let t = 0; t < 7; t++) {
        const idx = tableau[t].indexOf(carta);
        if (idx !== -1) {
            tableau[t].splice(idx, 1);
            if (tableau[t].length > 0)
                tableau[t][tableau[t].length - 1].visible = true;
            return;
        }
    }
    const dIdx = descarte.indexOf(carta);
    if (dIdx !== -1) descarte.splice(dIdx, 1);
}

/* === RENDERIZAR === */
function render() {
    const deckDiv = document.getElementById('deck');
    deckDiv.innerHTML = '';
    if (mazo.length > 0) {
        const back = document.createElement('div');
        back.className = 'card back red-back';
        back.onclick = robarCarta;
        deckDiv.appendChild(back);
    }

    const wasteDiv = document.getElementById('waste');
    wasteDiv.innerHTML = '';
    if (descarte.length > 0) {
        const carta = descarte[descarte.length - 1];
        const div = crearCartaDiv(carta);
        wasteDiv.appendChild(div);
    }

    for (let i = 0; i < 4; i++) {
        const fDiv = document.getElementById('f'+i);
        fDiv.innerHTML = '';
        if (fundaciones[i].length > 0) {
            const carta = fundaciones[i][fundaciones[i].length - 1];
            fDiv.appendChild(crearCartaDiv(carta));
        }
    }

    const tabla = document.getElementById('tableau');
    tabla.innerHTML = '';
    for (let i = 0; i < 7; i++) {
        const col = document.createElement('div');
        col.className = 'column';
        col.dataset.index = i;
        let offset = 0;
        for (const carta of tableau[i]) {
            const div = crearCartaDiv(carta);
            div.style.top = offset + 'px';
            col.appendChild(div);
            offset += 25;
        }
        tabla.appendChild(col);
    }

    if (fundaciones.every(f => f.length === 13))
        setTimeout(() => alert("üéâ ¬°Ganaste el Solitario!"), 300);
}

/* === CREAR CARTA DIV === */
function crearCartaDiv(carta) {
    const div = document.createElement('div');
    div.className = 'card ' + (carta.visible ? (carta.color === 'red' ? 'red' : '') : 'back red-back');
    if (carta.visible) {
        const valorTexto = (carta.valor === 1 ? 'A' :
                           carta.valor === 11 ? 'J' :
                           carta.valor === 12 ? 'Q' :
                           carta.valor === 13 ? 'K' : carta.valor);
        div.textContent = valorTexto + carta.palo;
        div.draggable = true;
        div.ondragstart = e => {
            cartaArrastrada = carta;
            origen = e.target.parentElement;
            setTimeout(() => e.target.style.opacity = "0.3", 0);
        };
        div.ondragend = e => {
            cartaArrastrada = null;
            e.target.style.opacity = "1";
        };
    }
    return div;
}

/* === DROP AREAS === */
document.addEventListener("dragover", e => e.preventDefault());
document.addEventListener("drop", e => {
    e.preventDefault();
    const col = e.target.closest('.column');
    const fund = e.target.closest('.foundation');
    if (!cartaArrastrada) return;

    if (fund) moverCarta(cartaArrastrada, fund, 'foundation');
    else if (col) {
        const index = parseInt(col.dataset.index);
        if (puedeMoverATabla(cartaArrastrada, tableau[index])) {
            eliminarCartaDeOrigen(cartaArrastrada);
            tableau[index].push(cartaArrastrada);
            render();
        }
    }
});

/* === INICIO === */
function iniciarJuego() {
    crearMazo();
    barajar();
    descarte = [];
    fundaciones = [[],[],[],[]];
    repartirCartas();
}
window.onload = iniciarJuego;
</script>
</body>
</html>
