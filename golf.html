<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zona de Juegos - Pac-Man</title>
<style>
body { margin:0; font-family:Arial, sans-serif; background:#000; color:#fff; overflow:hidden; }
#menu, #playScreen, #gameArea {
  position:absolute; top:0; left:0; width:100%; height:100%; display:flex;
  justify-content:center; align-items:center; flex-direction:column;
}
#menu { background: radial-gradient(circle at center,#111,#000); }
.card { background:#222; padding:20px; margin:10px; border-radius:10px; cursor:pointer; width:200px; text-align:center; transition:0.2s; }
.card:hover { background:#444; transform:scale(1.05); }
#gameArea { display:none; flex-direction:column; }
#playScreen { display:none; background: rgba(0,0,0,0.9); }
button { margin-top:10px; padding:10px 25px; border:none; border-radius:8px; background:#0af; color:#fff; font-weight:bold; cursor:pointer; transition:0.2s; }
button:hover { background:#09f; }
#scoreBoard { position:absolute; top:10px; left:10px; font-size:18px; background:rgba(0,0,0,0.4); padding:6px 10px; border-radius:6px; }
canvas { background:#000; border:2px solid #333; border-radius:10px; }
</style>
</head>
<body>

<div id="menu">
  <h1>ðŸŽ® Zona de Juegos</h1>
  <div class="card" onclick="loadGame('pacman')">Pac-Man</div>
</div>

<div id="playScreen">
  <h2 id="gameTitle">Pac-Man</h2>
  <button onclick="startGame()">Play</button>
  <button onclick="backToMenu()">Volver</button>
</div>

<div id="gameArea">
  <div id="scoreBoard"></div>
  <div id="gameContainer"></div>
  <button onclick="backToMenu()" style="position:absolute;bottom:15px;">Volver al menÃº</button>
</div>

<script>
let currentGame = null;
function loadGame(game){
  currentGame = game;
  document.getElementById('menu').style.display='none';
  document.getElementById('playScreen').style.display='flex';
  document.getElementById('gameArea').style.display='none';
}
function startGame(){
  document.getElementById('playScreen').style.display='none';
  document.getElementById('gameArea').style.display='flex';
  const container=document.getElementById('gameContainer');
  container.innerHTML='';
  document.getElementById('scoreBoard').innerText='';
  if(currentGame==='pacman') initPacman(container);
}
function backToMenu(){
  document.getElementById('menu').style.display='flex';
  document.getElementById('gameArea').style.display='none';
  document.getElementById('playScreen').style.display='none';
  document.getElementById('gameContainer').innerHTML='';
  document.getElementById('scoreBoard').innerText='';
}

// --- PAC-MAN ---
function initPacman(container){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=448; canvas.height=496;
  container.appendChild(canvas);

  const tileSize=16;
  const map=[
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"       .  #      #  .       ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
  ];

  let score=0;
  let lives=3;
  let pac={x:13,y:23,dir:'',nextDir:''};
  let powerMode=false;
  let powerTimer=0;

  const ghosts=[
    {x:13,y:11, color:'red', dir:'left', home:{x:13,y:11}, frightened:false},
    {x:14,y:11, color:'pink', dir:'right', home:{x:14,y:11}, frightened:false},
    {x:12,y:11, color:'cyan', dir:'up', home:{x:12,y:11}, frightened:false},
    {x:15,y:11, color:'orange', dir:'down', home:{x:15,y:11}, frightened:false},
  ];

  document.addEventListener('keydown', e=>{
    if(e.key.includes('Arrow')){
      pac.nextDir=e.key.replace('Arrow','').toLowerCase();
    }
  });

  function canMove(x,y){
    if(!map[y] || !map[y][x]) return false;
    return map[y][x]!=='#';
  }

  function movePac(){
    let nx=pac.x, ny=pac.y;
    switch(pac.nextDir){
      case 'up': if(canMove(pac.x,pac.y-1)) pac.dir='up'; break;
      case 'down': if(canMove(pac.x,pac.y+1)) pac.dir='down'; break;
      case 'left': if(canMove(pac.x-1,pac.y)) pac.dir='left'; break;
      case 'right': if(canMove(pac.x+1,pac.y)) pac.dir='right'; break;
    }
    switch(pac.dir){
      case 'up': if(canMove(pac.x,pac.y-1)) pac.y--; break;
      case 'down': if(canMove(pac.x,pac.y+1)) pac.y++; break;
      case 'left': if(canMove(pac.x-1,pac.y)) pac.x--; break;
      case 'right': if(canMove(pac.x+1,pac.y)) pac.x++; break;
    }
    if(pac.x<0) pac.x=map[0].length-1;
    if(pac.x>=map[0].length) pac.x=0;
  }

  function moveGhosts(){
    ghosts.forEach(g=>{
      let dirs=['up','down','left','right'].filter(d=>{
        let tx=g.x, ty=g.y;
        if(d==='up') ty--; else if(d==='down') ty++; else if(d==='left') tx--; else if(d==='right') tx++;
        return canMove(tx,ty);
      });

      // Comportamiento: normal o asustado
      if(powerMode && g.frightened){
        // huye de Pac-Man
        if(pac.x>g.x && dirs.includes('left')) g.dir='left';
        else if(pac.x<g.x && dirs.includes('right')) g.dir='right';
        else if(pac.y>g.y && dirs.includes('up')) g.dir='up';
        else if(pac.y<pac.y && dirs.includes('down')) g.dir='down';
        else g.dir=dirs[Math.floor(Math.random()*dirs.length)];
      } else {
        // persecuciÃ³n simple
        let dist=Math.hypot(pac.x-g.x,pac.y-g.y);
        if(dist<6){
          if(pac.x>g.x && dirs.includes('right')) g.dir='right';
          else if(pac.x<g.x && dirs.includes('left')) g.dir='left';
          else if(pac.y>g.y && dirs.includes('down')) g.dir='down';
          else if(pac.y<g.y && dirs.includes('up')) g.dir='up';
          else g.dir=dirs[Math.floor(Math.random()*dirs.length)];
        } else g.dir=dirs[Math.floor(Math.random()*dirs.length)];
      }

      switch(g.dir){
        case 'up': g.y--; break;
        case 'down': g.y++; break;
        case 'left': g.x--; break;
        case 'right': g.x++; break;
      }

      if(g.x<0) g.x=map[0].length-1;
      if(g.x>=map[0].length) g.x=0;
    });
  }

  function checkPellets(){
    let c=map[pac.y][pac.x];
    if(c==='.') {
      score+=10;
      map[pac.y]=map[pac.y].substring(0,pac.x)+' '+map[pac.y].substring(pac.x+1);
    }
    if(c==='o') {
      score+=50;
      powerMode=true;
      powerTimer=600; // frames (~10 segundos)
      ghosts.forEach(g=>g.frightened=true);
      map[pac.y]=map[pac.y].substring(0,pac.x)+' '+map[pac.y].substring(pac.x+1);
    }
  }

  function checkCollisions(){
    ghosts.forEach(g=>{
      if(g.x===pac.x && g.y===pac.y){
        if(powerMode && g.frightened){
          score+=200;
          g.x=g.home.x; g.y=g.home.y;
          g.frightened=false;
        } else if(!powerMode){
          lives--;
          if(lives<=0){ alert('Game Over! PuntuaciÃ³n: '+score); backToMenu(); return; }
          pac={x:13,y:23,dir:'',nextDir:''};
          ghosts.forEach(g=>{g.x=g.home.x; g.y=g.home.y;});
        }
      }
    });
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<map.length;y++){
      for(let x=0;x<map[y].length;x++){
        let c=map[y][x];
        if(c==='#'){ ctx.fillStyle='#1919A6'; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);}
        else if(c==='.'||c==='o'){
          ctx.fillStyle='orange';
          ctx.beginPath();
          ctx.arc(x*tileSize+tileSize/2,y*tileSize+tileSize/2,(c==='o'?4:2),0,Math.PI*2);
          ctx.fill();
        }
      }
    }
    // Pac-Man
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(pac.x*tileSize+tileSize/2,pac.y*tileSize+tileSize/2,tileSize/2,0,Math.PI*2);
    ctx.fill();
    // Fantasmas
    ghosts.forEach(g=>{
      ctx.fillStyle=(powerMode && g.frightened)?'blue':g.color;
      ctx.beginPath();
      ctx.arc(g.x*tileSize+tileSize/2,g.y*tileSize+tileSize/2,tileSize/2,0,Math.PI*2);
      ctx.fill();
    });
    document.getElementById('scoreBoard').innerText=`PuntuaciÃ³n: ${score} | Vidas: ${lives}`;
  }

  function loop(){
    movePac();
    moveGhosts();
    checkPellets();
    checkCollisions();
    draw();
    if(powerMode){
      powerTimer--;
      if(powerTimer<=0){
        powerMode=false;
        ghosts.forEach(g=>g.frightened=false);
      }
    }
    requestAnimationFrame(loop);
  }
  loop();
}
</script>
</body>
</html>
