<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pac-Man ‚Äî F√≠sica mejorada</title>
<style>
  body{margin:0;background:#000;color:#fff;font-family:Arial;overflow:hidden}
  #menu,#playScreen,#gameArea{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column}
  #menu{background:radial-gradient(circle at center,#111,#000)}
  .card{background:#222;padding:18px;border-radius:10px;margin:8px;width:220px;text-align:center;cursor:pointer}
  .card:hover{transform:scale(1.03)}
  #playScreen{display:none;background:rgba(0,0,0,0.85)}
  #gameArea{display:none}
  button{padding:10px 18px;border-radius:8px;border:0;background:#0af;color:#001;cursor:pointer}
  #scoreBoard{position:absolute;left:12px;top:12px;background:rgba(0,0,0,0.5);padding:6px 10px;border-radius:6px}
  canvas{image-rendering:pixelated;border-radius:6px}
</style>
</head>
<body>

<div id="menu">
  <h1>üéÆ Zona de Juegos</h1>
  <div class="card" onclick="loadGame('pacman')">Pac-Man (mejorado)</div>
  <div class="card" onclick="loadGame('buscaminas')">Buscaminas</div>
  <div class="card" onclick="loadGame('solitario')">Solitario</div>
  <div class="card" onclick="loadGame('flota')">Hundir la Flota</div>
</div>

<div id="playScreen">
  <h2 id="gameTitle">Pac-Man</h2>
  <div style="display:flex;gap:12px">
    <button onclick="startGame()">PLAY</button>
    <button onclick="backToMenu()">Volver</button>
  </div>
</div>

<div id="gameArea">
  <div id="scoreBoard">Puntuaci√≥n: 0</div>
  <div id="gameContainer"></div>
  <button style="position:fixed;right:12px;bottom:12px" onclick="backToMenu()">Volver al men√∫</button>
</div>

<script>
function initPacman(container){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=448; canvas.height=496;
  container.appendChild(canvas);
  
  const tileSize=16;
  const map=[
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"       .  #      #  .       ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
];

  let score=0;
  let px=13*tileSize, py=23*tileSize;
  let vx=0, vy=0, nextVx=0, nextVy=0;
  let mouthAngle=0, mouthDir=1;
  const speed=1.5;
  let lives=3;

  // Fantasmas
  const ghosts=[
    {x:13*tileSize, y:11*tileSize, color:'red', dir:{x:1,y:0}},
    {x:14*tileSize, y:11*tileSize, color:'pink', dir:{x:-1,y:0}},
    {x:12*tileSize, y:11*tileSize, color:'cyan', dir:{x:0,y:1}},
    {x:15*tileSize, y:11*tileSize, color:'orange', dir:{x:0,y:-1}},
  ];

  function canMove(nx,ny){
    const cx=Math.floor(nx/tileSize);
    const cy=Math.floor(ny/tileSize);
    const char=map[cy]?.[cx];
    return char && char!=='#';
  }

  document.addEventListener('keydown', e=>{
    switch(e.key){
      case 'ArrowUp': nextVx=0; nextVy=-speed; break;
      case 'ArrowDown': nextVx=0; nextVy=speed; break;
      case 'ArrowLeft': nextVx=-speed; nextVy=0; break;
      case 'ArrowRight': nextVx=speed; nextVy=0; break;
    }
  });

  function resetPositions(){
    px=13*tileSize; py=23*tileSize;
    vx=vy=nextVx=nextVy=0;
    ghosts.forEach((g,i)=>{
      g.x=(13+i%2)*tileSize;
      g.y=(11+i)*tileSize/2;
    });
  }

  function moveGhosts(){
    ghosts.forEach(g=>{
      const options=[];
      const dirs=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];
      dirs.forEach(d=>{
        if(canMove(g.x+d.x*speed,g.y+d.y*speed)) options.push(d);
      });
      // Si Pacman est√° cerca, pers√≠guelo
      const dist=Math.hypot(px-g.x,py-g.y);
      if(dist<80){
        g.dir.x=Math.sign(px-g.x);
        g.dir.y=Math.sign(py-g.y);
      }else if(Math.random()<0.05 && options.length>0){
        g.dir=options[Math.floor(Math.random()*options.length)];
      }
      // Movimiento
      if(canMove(g.x+g.dir.x*speed,g.y+g.dir.y*speed)){
        g.x+=g.dir.x*speed;
        g.y+=g.dir.y*speed;
      }
      // T√∫nel fantasma tambi√©n
      if(g.x<-tileSize) g.x=canvas.width;
      if(g.x>canvas.width) g.x=-tileSize;
    });
  }

  function loop(){
    // Cambiar direcci√≥n
    if(canMove(px+nextVx,py+nextVy)) { vx=nextVx; vy=nextVy; }

    // Movimiento Pacman
    if(canMove(px+vx,py+vy)){ px+=vx; py+=vy; }

    // Teletransporte t√∫nel
    if(px<-tileSize) px=canvas.width;
    if(px>canvas.width) px=-tileSize;

    // Comer puntos
    const cx=Math.floor(px/tileSize);
    const cy=Math.floor(py/tileSize);
    if(map[cy]?.[cx]==='.'){
      map[cy]=map[cy].substring(0,cx)+' '+map[cy].substring(cx+1);
      score+=10;
    } else if(map[cy]?.[cx]==='o'){
      map[cy]=map[cy].substring(0,cx)+' '+map[cy].substring(cx+1);
      score+=50;
    }

    // Fantasmas
    moveGhosts();

    // Colisi√≥n con fantasmas
    for(const g of ghosts){
      const dist=Math.hypot(px-g.x,py-g.y);
      if(dist<tileSize/1.2){
        lives--;
        if(lives<=0){
          alert('¬°Game Over! Puntuaci√≥n: '+score);
          backToMenu();
          return;
        } else {
          resetPositions();
          return;
        }
      }
    }

    // Animaci√≥n boca
    mouthAngle+=mouthDir*0.2;
    if(mouthAngle>1 || mouthAngle<0) mouthDir*=-1;

    // Dibujo
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<map.length;y++){
      for(let x=0;x<map[y].length;x++){
        const c=map[y][x];
        if(c==='#'){ ctx.fillStyle='#1919A6'; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize); }
        else if(c==='.'||c==='o'){
          ctx.fillStyle='orange';
          const r=(c==='o')?4:2;
          ctx.beginPath();
          ctx.arc(x*tileSize+tileSize/2,y*tileSize+tileSize/2,r,0,Math.PI*2);
          ctx.fill();
        }
      }
    }
    // Pac-Man
    ctx.fillStyle='yellow';
    ctx.beginPath();
    let angleStart, angleEnd;
    if(vx>0){ angleStart=mouthAngle; angleEnd=2*Math.PI-mouthAngle; }
    else if(vx<0){ angleStart=Math.PI+mouthAngle; angleEnd=Math.PI-mouthAngle; }
    else if(vy>0){ angleStart=Math.PI/2+mouthAngle; angleEnd=Math.PI/2-mouthAngle; }
    else if(vy<0){ angleStart=-Math.PI/2+mouthAngle; angleEnd=-Math.PI/2-mouthAngle; }
    else { angleStart=0; angleEnd=2*Math.PI; }
    ctx.moveTo(px+tileSize/2,py+tileSize/2);
    ctx.arc(px+tileSize/2,py+tileSize/2,tileSize/2,angleStart,angleEnd);
    ctx.closePath();
    ctx.fill();

    // Fantasmas
    ghosts.forEach(g=>{
      ctx.fillStyle=g.color;
      ctx.beginPath();
      ctx.arc(g.x+tileSize/2,g.y+tileSize/2,tileSize/2,Math.PI,0);
      ctx.lineTo(g.x+tileSize,g.y+tileSize);
      ctx.lineTo(g.x,g.y+tileSize);
      ctx.closePath();
      ctx.fill();
    });

    document.getElementById('scoreBoard').innerText=`Puntuaci√≥n: ${score} | Vidas: ${lives}`;
    requestAnimationFrame(loop);
  }
  loop();
}
</script>
</body>
</html>
