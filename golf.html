<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pac-Man Fluido</title>
<style>
body { margin:0; font-family:Arial, sans-serif; background:#000; color:#fff; overflow:hidden; }
#menu, #playScreen, #gameArea {
  position:absolute; top:0; left:0; width:100%; height:100%; display:flex;
  justify-content:center; align-items:center; flex-direction:column;
}
#menu { background: radial-gradient(circle at center,#111,#000); }
.card { background:#222; padding:20px; margin:10px; border-radius:10px; cursor:pointer; width:200px; text-align:center; transition:0.2s; }
.card:hover { background:#444; transform:scale(1.05); }
#gameArea { display:none; flex-direction:column; }
#playScreen { display:none; background: rgba(0,0,0,0.9); }
button { margin-top:10px; padding:10px 25px; border:none; border-radius:8px; background:#0af; color:#fff; font-weight:bold; cursor:pointer; transition:0.2s; }
button:hover { background:#09f; }
#scoreBoard { position:absolute; top:10px; left:10px; font-size:18px; background:rgba(0,0,0,0.4); padding:6px 10px; border-radius:6px; }
canvas { background:#000; border:2px solid #333; border-radius:10px; }
</style>
</head>
<body>

<div id="menu">
  <h1>🎮 Zona de Juegos</h1>
  <div class="card" onclick="loadGame('pacman')">Pac-Man</div>
</div>

<div id="playScreen">
  <h2 id="gameTitle">Pac-Man</h2>
  <button onclick="startGame()">Play</button>
  <button onclick="backToMenu()">Volver</button>
</div>

<div id="gameArea">
  <div id="scoreBoard"></div>
  <div id="gameContainer"></div>
  <button onclick="backToMenu()" style="position:absolute;bottom:15px;">Volver al menú</button>
</div>

<script>
let currentGame = null;
function loadGame(game){
  currentGame = game;
  document.getElementById('menu').style.display='none';
  document.getElementById('playScreen').style.display='flex';
  document.getElementById('gameArea').style.display='none';
}
function startGame(){
  document.getElementById('playScreen').style.display='none';
  document.getElementById('gameArea').style.display='flex';
  const container=document.getElementById('gameContainer');
  container.innerHTML='';
  document.getElementById('scoreBoard').innerText='';
  if(currentGame==='pacman') initPacman(container);
}
function backToMenu(){
  document.getElementById('menu').style.display='flex';
  document.getElementById('gameArea').style.display='none';
  document.getElementById('playScreen').style.display='none';
  document.getElementById('gameContainer').innerHTML='';
  document.getElementById('scoreBoard').innerText='';
}

// --- PAC-MAN FLUIDO ---
function initPacman(container){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=448; canvas.height=496;
  container.appendChild(canvas);

  const tileSize=16;
  const map=[
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"       .  #      #  .       ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
  ];

  let score=0;
  let lives=3;
  let powerMode=false;
  let powerTimer=0;

  const speed = 2; // px/frame

  // Pac-Man
  let pac = {
    x: 13*tileSize, y: 23*tileSize, // posición en píxeles
    dir:'', nextDir:'',
    radius: tileSize/2
  };

  const ghosts=[
    {x:13*tileSize, y:11*tileSize, dir:'left', home:{x:13*tileSize,y:11*tileSize}, color:'red', frightened:false},
    {x:14*tileSize, y:11*tileSize, dir:'right', home:{x:14*tileSize,y:11*tileSize}, color:'pink', frightened:false},
    {x:12*tileSize, y:11*tileSize, dir:'up', home:{x:12*tileSize,y:11*tileSize}, color:'cyan', frightened:false},
    {x:15*tileSize, y:11*tileSize, dir:'down', home:{x:15*tileSize,y:11*tileSize}, color:'orange', frightened:false},
  ];

  document.addEventListener('keydown', e=>{
    if(e.key.includes('Arrow')){
      pac.nextDir = e.key.replace('Arrow','').toLowerCase();
    }
  });

  function getTile(px, py){
    let tx=Math.floor(px/tileSize);
    let ty=Math.floor(py/tileSize);
    return {tx, ty};
  }

  function canMovePixel(px, py, dir){
    let nx=px, ny=py;
    if(dir==='up') ny-=speed;
    else if(dir==='down') ny+=speed;
    else if(dir==='left') nx-=speed;
    else if(dir==='right') nx+=speed;
    let {tx, ty}=getTile(nx, ny);
    if(!map[ty] || !map[ty][tx]) return false;
    return map[ty][tx]!=='#';
  }

  function movePac(){
    // Cambiar dirección si posible
    if(pac.nextDir && canMovePixel(pac.x, pac.y, pac.nextDir)) pac.dir=pac.nextDir;
    // Mover en dirección actual
    if(pac.dir && canMovePixel(pac.x, pac.y, pac.dir)){
      if(pac.dir==='up') pac.y-=speed;
      else if(pac.dir==='down') pac.y+=speed;
      else if(pac.dir==='left') pac.x-=speed;
      else if(pac.dir==='right') pac.x+=speed;
    }
    // túnel lateral
    if(pac.x<0) pac.x = canvas.width-1;
    if(pac.x>canvas.width-1) pac.x = 0;
  }

  function moveGhosts(){
    ghosts.forEach(g=>{
      // Cambiar dirección si toca el centro de la casilla
      let {tx, ty}=getTile(g.x, g.y);
      let cx=tx*tileSize+tileSize/2;
      let cy=ty*tileSize+tileSize/2;
      if(Math.abs(g.x-cx)<speed && Math.abs(g.y-cy)<speed){
        let dirs=['up','down','left','right'].filter(d=>{
          let nx=g.x, ny=g.y;
          if(d==='up') ny-=speed;
          else if(d==='down') ny+=speed;
          else if(d==='left') nx-=speed;
          else if(d==='right') nx+=speed;
          return canMovePixel(nx, ny, d);
        });
        g.dir=dirs[Math.floor(Math.random()*dirs.length)];
      }
      if(g.dir==='up') g.y-=speed;
      else if(g.dir==='down') g.y+=speed;
      else if(g.dir==='left') g.x-=speed;
      else if(g.dir==='right') g.x+=speed;
      // túnel lateral
      if(g.x<0) g.x=canvas.width-1;
      if(g.x>canvas.width-1) g.x=0;
    });
  }

  function checkPellets(){
    let {tx, ty}=getTile(pac.x, pac.y);
    let c = map[ty][tx];
    if(c==='.' || c==='o'){
      if(c==='.') score+=10;
      if(c==='o'){
        score+=50;
        powerMode=true;
        powerTimer=600;
        ghosts.forEach(g=>g.frightened=true);
      }
      map[ty]=map[ty].substring(0,tx)+' '+map[ty].substring(tx+1);
    }
  }

  function checkCollisions(){
    ghosts.forEach(g=>{
      let dx=pac.x-g.x, dy=pac.y-g.y;
      if(Math.hypot(dx, dy)<tileSize/1.5){
        if(powerMode && g.frightened){
          score+=200;
          g.x=g.home.x; g.y=g.home.y;
          g.frightened=false;
        } else if(!powerMode){
          lives--;
          if(lives<=0){ alert('Game Over! Puntuación: '+score); backToMenu(); return; }
          pac={x:13*tileSize,y:23*tileSize,dir:'',nextDir:''};
          ghosts.forEach(g=>{g.x=g.home.x; g.y=g.home.y; g.frightened=false;});
        }
      }
    });
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<map.length;y++){
      for(let x=0;x<map[y].length;x++){
        let c=map[y][x];
        if(c==='#'){ ctx.fillStyle='#1919A6'; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize);}
        else if(c==='.'||c==='o'){
          ctx.fillStyle='orange';
          ctx.beginPath();
          ctx.arc(x*tileSize+tileSize/2, y*tileSize+tileSize/2, c==='o'?4:2,0,Math.PI*2);
          ctx.fill();
        }
      }
    }
    // Pac-Man
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(pac.x, pac.y, pac.radius,0,Math.PI*2);
    ctx.fill();
    // Fantasmas
    ghosts.forEach(g=>{
      ctx.fillStyle=(powerMode && g.frightened)?'blue':g.color;
      ctx.beginPath();
      ctx.arc(g.x, g.y, pac.radius,0,Math.PI*2);
      ctx.fill();
    });
    document.getElementById('scoreBoard').innerText=`Puntuación: ${score} | Vidas: ${lives}`;
  }

  function loop(){
    movePac();
    moveGhosts();
    checkPellets();
    checkCollisions();
    if(powerMode){
      powerTimer--;
      if(powerTimer<=0){
        powerMode=false;
        ghosts.forEach(g=>g.frightened=false);
      }
    }
    draw();
    requestAnimationFrame(loop);
  }

  loop();
}
</script>
</body>
</html>
