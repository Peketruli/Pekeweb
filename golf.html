<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zona de Juegos - Pac-Man</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #000;
  color: #fff;
  overflow: hidden;
}
#menu, #playScreen, #gameArea {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
#menu { background: radial-gradient(circle at center,#111,#000); }
.card {
  background: #222;
  padding: 20px;
  margin: 10px;
  border-radius: 10px;
  cursor: pointer;
  width: 200px;
  text-align: center;
  transition: 0.2s;
}
.card:hover { background: #444; transform: scale(1.05); }
#gameArea { display: none; flex-direction: column; }
#playScreen { display: none; background: rgba(0,0,0,0.9); }
button {
  margin-top: 10px;
  padding: 10px 25px;
  border: none;
  border-radius: 8px;
  background: #0af;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: 0.2s;
}
button:hover { background: #09f; }
#scoreBoard {
  position: absolute;
  top: 10px; left: 10px;
  font-size: 18px;
  background: rgba(0,0,0,0.4);
  padding: 6px 10px;
  border-radius: 6px;
}
canvas { background: #000; border: 2px solid #333; border-radius: 10px; }
</style>
</head>
<body>

<div id="menu">
  <h1>🎮 Zona de Juegos</h1>
  <div class="card" onclick="loadGame('pacman')">Pac-Man</div>
</div>

<div id="playScreen">
  <h2 id="gameTitle">Pac-Man</h2>
  <button id="playBtn">Play</button>
  <button onclick="backToMenu()">Volver</button>
</div>

<div id="gameArea">
  <div id="scoreBoard"></div>
  <div id="gameContainer"></div>
  <button onclick="backToMenu()" style="position:absolute;bottom:15px;">Volver al menú</button>
</div>

<script>
let currentGame = null;
let gameRunning = false;

function loadGame(game){
  currentGame = game;
  document.getElementById('menu').style.display='none';
  document.getElementById('playScreen').style.display='flex';
  document.getElementById('gameArea').style.display='none';
}

document.getElementById('playBtn').addEventListener('click', startGame);

function startGame(){
  if (gameRunning) return;
  gameRunning = true;
  document.getElementById('playScreen').style.display='none';
  document.getElementById('gameArea').style.display='flex';
  const container=document.getElementById('gameContainer');
  container.innerHTML='';
  document.getElementById('scoreBoard').innerText='';
  if(currentGame==='pacman') initPacman(container);
}

function backToMenu(){
  gameRunning = false;
  document.getElementById('menu').style.display='flex';
  document.getElementById('gameArea').style.display='none';
  document.getElementById('playScreen').style.display='none';
  document.getElementById('gameContainer').innerHTML='';
  document.getElementById('scoreBoard').innerText='';
}

/* ----------------- PAC-MAN ------------------ */
function initPacman(container){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=448; canvas.height=496;
  container.appendChild(canvas);
  
  const tile=16;
  const map=[
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"       .  #      #  .       ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
];

  let score=0;
  let lives=3;
  let pac = {x:13, y:23, dir:'left', nextDir:'left', speed:0.1};
  const ghosts=[
    {x:13, y:11, dir:'left', color:'red'},
    {x:14, y:11, dir:'right', color:'pink'},
    {x:12, y:11, dir:'up', color:'cyan'},
    {x:15, y:11, dir:'down', color:'orange'}
  ];

  document.addEventListener('keydown', e=>{
    if(e.key.includes('Arrow')){
      pac.nextDir = e.key.replace('Arrow','').toLowerCase();
    }
  });

  function canMove(x,y){
    const gx=Math.floor(x), gy=Math.floor(y);
    if(!map[gy] || !map[gy][gx]) return false;
    return map[gy][gx]!=='#';
  }

  function updatePac(){
    // sólo cambiar dirección si está centrado y libre
    const cx=Math.round(pac.x), cy=Math.round(pac.y);
    if(Math.abs(pac.x-cx)<0.05 && Math.abs(pac.y-cy)<0.05){
      if(pac.nextDir==='up' && canMove(cx,cy-1)) pac.dir='up';
      else if(pac.nextDir==='down' && canMove(cx,cy+1)) pac.dir='down';
      else if(pac.nextDir==='left' && canMove(cx-1,cy)) pac.dir='left';
      else if(pac.nextDir==='right' && canMove(cx+1,cy)) pac.dir='right';
      pac.x=cx; pac.y=cy;
    }

    let nx=pac.x, ny=pac.y;
    if(pac.dir==='up') ny-=pac.speed;
    else if(pac.dir==='down') ny+=pac.speed;
    else if(pac.dir==='left') nx-=pac.speed;
    else if(pac.dir==='right') nx+=pac.speed;

    if(canMove(nx,ny)){ pac.x=nx; pac.y=ny; }
    // túnel
    if(pac.x<0) pac.x=map[0].length-1;
    if(pac.x>=map[0].length) pac.x=0;
  }

  function updateGhosts(){
    ghosts.forEach(g=>{
      const gx=Math.round(g.x), gy=Math.round(g.y);
      // posible cambio de dirección sólo en centro
      if(Math.abs(g.x-gx)<0.05 && Math.abs(g.y-gy)<0.05){
        const dirs=['up','down','left','right'].filter(d=>{
          let tx=gx, ty=gy;
          if(d==='up') ty--; else if(d==='down') ty++; else if(d==='left') tx--; else if(d==='right') tx++;
          return canMove(tx,ty);
        });
        // persecución básica
        const dist=Math.hypot(pac.x-gx,pac.y-gy);
        if(dist<6){
          if(pac.x>gx && dirs.includes('right')) g.dir='right';
          else if(pac.x<gx && dirs.includes('left')) g.dir='left';
          else if(pac.y>gy && dirs.includes('down')) g.dir='down';
          else if(pac.y<gy && dirs.includes('up')) g.dir='up';
        } else {
          g.dir=dirs[Math.floor(Math.random()*dirs.length)];
        }
        g.x=gx; g.y=gy;
      }

      const speed=0.08;
      if(g.dir==='up' && canMove(g.x,g.y-speed)) g.y-=speed;
      else if(g.dir==='down' && canMove(g.x,g.y+speed)) g.y+=speed;
      else if(g.dir==='left' && canMove(g.x-speed,g.y)) g.x-=speed;
      else if(g.dir==='right' && canMove(g.x+speed,g.y)) g.x+=speed;
      if(g.x<0) g.x=map[0].length-1;
      if(g.x>=map[0].length) g.x=0;
    });
  }

  function eatPellets(){
    const gx=Math.round(pac.x), gy=Math.round(pac.y);
    const c=map[gy][gx];
    if(c==='.'||c==='o'){
      score+=(c==='o'?50:10);
      map[gy]=map[gy].substring(0,gx)+' '+map[gy].substring(gx+1);
    }
  }

  function checkCollision(){
    for(const g of ghosts){
      if(Math.abs(pac.x-g.x)<0.5 && Math.abs(pac.y-g.y)<0.5){
        lives--;
        if(lives<=0){
          alert('Game Over! Puntuación: '+score);
          backToMenu();
          return;
        }
        resetPositions();
      }
    }
  }

  function resetPositions(){
    pac.x=13; pac.y=23; pac.dir='left'; pac.nextDir='left';
    ghosts[0].x=13; ghosts[0].y=11;
    ghosts[1].x=14; ghosts[1].y=11;
    ghosts[2].x=12; ghosts[2].y=11;
    ghosts[3].x=15; ghosts[3].y=11;
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<map.length;y++){
      for(let x=0;x<map[y].length;x++){
        const c=map[y][x];
        if(c==='#'){ ctx.fillStyle='#1919A6'; ctx.fillRect(x*tile,y*tile,tile,tile);}
        else if(c==='.'||c==='o'){
          ctx.fillStyle='orange';
          ctx.beginPath();
          ctx.arc(x*tile+tile/2,y*tile+tile/2,c==='o'?4:2,0,Math.PI*2);
          ctx.fill();
        }
      }
    }
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(pac.x*tile+tile/2,pac.y*tile+tile/2,tile/2,0,Math.PI*2);
    ctx.fill();

    ghosts.forEach(g=>{
      ctx.fillStyle=g.color;
      ctx.beginPath();
      ctx.arc(g.x*tile+tile/2,g.y*tile+tile/2,tile/2,0,Math.PI*2);
      ctx.fill();
    });

    document.getElementById('scoreBoard').innerText=`Puntuación: ${score} | Vidas: ${lives}`;
  }

  function loop(){
    if(!gameRunning) return;
    updatePac();
    updateGhosts();
    eatPellets();
    checkCollision();
    draw();
    requestAnimationFrame(loop);
  }
  loop();
}
</script>
</body>
</html>
