<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pac-Man Clásico</title>
<style>
  body { margin:0; background:#000; color:#fff; font-family:Arial; display:flex; justify-content:center; align-items:center; height:100vh; }
  canvas { image-rendering:pixelated; background:#000; display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
// --- CONFIGURACIÓN ---
const TILE = 20;
const MAP = [
  "####################",
  "#........##........#",
  "#.##.###.##.###.##.#",
  "#o##.###.##.###.##o#",
  "#..................#",
  "#.##.#.######.#.##.#",
  "#....#....##....#..#",
  "####.### #### ###.##",
  "####.#        #.####",
  "#......######......#",
  "####################"
];
const ROWS = MAP.length;
const COLS = MAP[0].length;

// --- CANVAS ---
const canvas = document.getElementById("game");
canvas.width = COLS * TILE;
canvas.height = ROWS * TILE;
const ctx = canvas.getContext("2d");

// --- ESTADOS ---
let pac = { x:9, y:8, dir:{x:0,y:0}, nextDir:{x:0,y:0}, speed:0.2, radius:8, mouth:0 };
let ghosts = [
  { x:9, y:5, color:'red', dir:{x:0,y:-1}, speed:0.15 },
  { x:10, y:5, color:'pink', dir:{x:0,y:-1}, speed:0.15 },
  { x:8, y:5, color:'cyan', dir:{x:0,y:-1}, speed:0.15 },
  { x:11, y:5, color:'orange', dir:{x:0,y:-1}, speed:0.15 }
];
let score = 0;
let lives = 3;

// --- INPUT ---
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowUp') pac.nextDir = {x:0,y:-1};
  if(e.key==='ArrowDown') pac.nextDir = {x:0,y:1};
  if(e.key==='ArrowLeft') pac.nextDir = {x:-1,y:0};
  if(e.key==='ArrowRight') pac.nextDir = {x:1,y:0};
});

// --- FUNCIONES ---
function drawMap(){
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      if(MAP[y][x]==='#'){
        ctx.fillStyle='#001f6f';
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      } else if(MAP[y][x]==='.'){
        ctx.fillStyle='#ffd54d';
        ctx.beginPath();
        ctx.arc(x*TILE+TILE/2,y*TILE+TILE/2,3,0,Math.PI*2);
        ctx.fill();
      } else if(MAP[y][x]==='o'){
        ctx.fillStyle='#ffd54d';
        ctx.beginPath();
        ctx.arc(x*TILE+TILE/2,y*TILE+TILE/2,6,0,Math.PI*2);
        ctx.fill();
      }
    }
  }
}

function tileIsWall(x,y){
  return MAP[y] && MAP[y][x]==='#';
}

function movePac(){
  // Cambiar dirección si es posible
  let tx = Math.floor(pac.x + pac.nextDir.x);
  let ty = Math.floor(pac.y + pac.nextDir.y);
  if(!tileIsWall(tx,ty)){
    pac.dir = {...pac.nextDir};
  }
  // mover
  pac.x += pac.dir.x * pac.speed;
  pac.y += pac.dir.y * pac.speed;
  // limitar dentro del mapa
  if(pac.x<0) pac.x=0;
  if(pac.x>COLS-1) pac.x=COLS-1;
  if(pac.y<0) pac.y=0;
  if(pac.y>ROWS-1) pac.y=ROWS-1;
}

function eatPellets(){
  let tx = Math.floor(pac.x);
  let ty = Math.floor(pac.y);
  if(MAP[ty][tx]==='.') { MAP[ty] = MAP[ty].substr(0,tx)+' '+MAP[ty].substr(tx+1); score+=10; }
  if(MAP[ty][tx]==='o') { MAP[ty] = MAP[ty].substr(0,tx)+' '+MAP[ty].substr(tx+1); score+=50; }
}

function moveGhosts(){
  ghosts.forEach(g=>{
    // Movimiento simple aleatorio si chocan pared
    let nextX = g.x + g.dir.x*g.speed;
    let nextY = g.y + g.dir.y*g.speed;
    let tx = Math.floor(nextX);
    let ty = Math.floor(nextY);
    if(tileIsWall(tx,ty)) {
      const dirs = [{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];
      g.dir = dirs[Math.floor(Math.random()*dirs.length)];
    } else {
      g.x = nextX; g.y = nextY;
    }
  });
}

function checkCollision(){
  ghosts.forEach(g=>{
    const dx = g.x-pac.x;
    const dy = g.y-pac.y;
    if(Math.sqrt(dx*dx+dy*dy)<0.5){
      lives--;
      pac.x=9; pac.y=8;
      pac.dir={x:0,y:0};
      if(lives<=0) alert("GAME OVER - Score: "+score);
    }
  });
}

function drawPac(){
  ctx.fillStyle='yellow';
  const angle = 0.25 + 0.25*Math.sin(pac.mouth);
  pac.mouth+=0.3;
  const dirAngle = Math.atan2(pac.dir.y,pac.dir.x)||0;
  let a1 = -angle+dirAngle;
  let a2 = angle+dirAngle;
  if(pac.dir.x===0 && pac.dir.y===0) { ctx.beginPath(); ctx.arc(pac.x*TILE+TILE/2,pac.y*TILE+TILE/2,8,0,Math.PI*2); ctx.fill(); return; }
  ctx.beginPath();
  ctx.moveTo(pac.x*TILE+TILE/2,pac.y*TILE+TILE/2);
  ctx.arc(pac.x*TILE+TILE/2,pac.y*TILE+TILE/2,8,a1,a2);
  ctx.closePath();
  ctx.fill();
}

function drawGhosts(){
  ghosts.forEach(g=>{
    ctx.fillStyle=g.color;
    ctx.beginPath();
    ctx.arc(g.x*TILE+TILE/2,g.y*TILE+TILE/2,8,0,Math.PI*2);
    ctx.fill();
  });
}

// --- LOOP ---
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMap();
  movePac();
  eatPellets();
  moveGhosts();
  checkCollision();
  drawPac();
  drawGhosts();
  ctx.fillStyle='white';
  ctx.fillText(`Score: ${score}  Lives: ${lives}`,5,15);
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
