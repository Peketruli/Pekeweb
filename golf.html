<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zona de Juegos - Pac-Man</title>
<style>
body { margin:0; font-family:Arial, sans-serif; background:#000; color:#fff; overflow:hidden; }
#menu, #playScreen, #gameArea {
  position:absolute; top:0; left:0; width:100%; height:100%; display:flex;
  justify-content:center; align-items:center; flex-direction:column;
}
#menu { background: radial-gradient(circle at center,#111,#000); }
.card { background:#222; padding:20px; margin:10px; border-radius:10px; cursor:pointer; width:200px; text-align:center; transition:0.2s; }
.card:hover { background:#444; transform:scale(1.05); }
#gameArea { display:none; flex-direction:column; }
#playScreen { display:none; background: rgba(0,0,0,0.9); }
button { margin-top:10px; padding:10px 25px; border:none; border-radius:8px; background:#0af; color:#fff; font-weight:bold; cursor:pointer; transition:0.2s; }
button:hover { background:#09f; }
#scoreBoard { position:absolute; top:10px; left:10px; font-size:18px; background:rgba(0,0,0,0.4); padding:6px 10px; border-radius:6px; }
canvas { background:#000; border:2px solid #333; border-radius:10px; }
</style>
</head>
<body>

<div id="menu">
  <h1>ðŸŽ® Zona de Juegos</h1>
  <div class="card" onclick="loadGame('pacman')">Pac-Man</div>
</div>

<div id="playScreen">
  <h2 id="gameTitle">Pac-Man</h2>
  <button onclick="startGame()">Play</button>
  <button onclick="backToMenu()">Volver</button>
</div>

<div id="gameArea">
  <div id="scoreBoard"></div>
  <div id="gameContainer"></div>
  <button onclick="backToMenu()" style="position:absolute;bottom:15px;">Volver al menÃº</button>
</div>

<script>
function initPacman(container){
  const canvas=document.createElement('canvas');
  const ctx=canvas.getContext('2d');
  canvas.width=448; canvas.height=496;
  container.appendChild(canvas);
  
  const tileSize=16;
  const map=[ /* --- tu mapa igual que antes --- */ 
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"       .  #      #  .       ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
];

  let score=0;
  let lives=3;

  // Posiciones en pÃ­xeles
  let pac={x:13*tileSize,y:23*tileSize,dir:'',nextDir:''};
  const ghosts=[
    {x:13*tileSize,y:11*tileSize,color:'red',dir:'left',home:{x:13*tileSize,y:11*tileSize}},
    {x:14*tileSize,y:11*tileSize,color:'pink',dir:'right',home:{x:14*tileSize,y:11*tileSize}},
    {x:12*tileSize,y:11*tileSize,color:'cyan',dir:'up',home:{x:12*tileSize,y:11*tileSize}},
    {x:15*tileSize,y:11*tileSize,color:'orange',dir:'down',home:{x:15*tileSize,y:11*tileSize}},
  ];

  const pacSpeed=2;      // velocidad Pac-Man (px/frame)
  const ghostSpeed=1.5;  // velocidad fantasmas (px/frame)

  document.addEventListener('keydown', e=>{
    if(e.key.includes('Arrow')) pac.nextDir=e.key.replace('Arrow','').toLowerCase();
  });

  function canMove(px,py,dir){
    let x=Math.floor(px/tileSize);
    let y=Math.floor(py/tileSize);
    if(dir==='up') y--; else if(dir==='down') y++;
    else if(dir==='left') x--; else if(dir==='right') x++;
    if(!map[y]||!map[y][x]) return false;
    return map[y][x]!=='#';
  }

  function moveEntity(ent,speed){
    if(ent.nextDir && canMove(ent.x,ent.y,ent.nextDir)){
      ent.dir=ent.nextDir;
    }
    let nx=ent.x, ny=ent.y;
    switch(ent.dir){
      case 'up': ny-=speed; break;
      case 'down': ny+=speed; break;
      case 'left': nx-=speed; break;
      case 'right': nx+=speed; break;
    }
    // comprobar colisiÃ³n con paredes
    if(canMove(ent.x,ent.y,ent.dir)){ ent.x=nx; ent.y=ny; }
    // tÃºnel lateral
    if(ent.x<0) ent.x=(map[0].length-1)*tileSize;
    if(ent.x>=map[0].length*tileSize) ent.x=0;
  }

  function moveGhosts(){
    ghosts.forEach(g=>{
      const dirs=['up','down','left','right'].filter(d=>canMove(g.x,g.y,d));
      let dist=Math.hypot((pac.x-g.x)/tileSize,(pac.y-g.y)/tileSize);
      if(dist<6){
        if(pac.x>g.x && dirs.includes('right')) g.dir='right';
        else if(pac.x<g.x && dirs.includes('left')) g.dir='left';
        else if(pac.y>g.y && dirs.includes('down')) g.dir='down';
        else if(pac.y<g.y && dirs.includes('up')) g.dir='up';
        else g.dir=dirs[Math.floor(Math.random()*dirs.length)];
      }else g.dir=dirs[Math.floor(Math.random()*dirs.length)];
      moveEntity(g,ghostSpeed);
    });
  }

  function checkPellets(){
    const gx=Math.floor(pac.x/tileSize);
    const gy=Math.floor(pac.y/tileSize);
    let c=map[gy][gx];
    if(c==='.'||c==='o'){
      score+= c==='.' ? 10 : 50;
      map[gy]=map[gy].substring(0,gx)+' '+map[gy].substring(gx+1);
    }
  }

  function checkCollisions(){
    for(let g of ghosts){
      let d=Math.hypot(g.x-pac.x,g.y-pac.y);
      if(d<tileSize/2){
        lives--;
        if(lives<=0){ alert('Game Over! Score: '+score); backToMenu(); return true; }
        pac={x:13*tileSize,y:23*tileSize,dir:'',nextDir:''};
        ghosts.forEach(gg=>{gg.x=gg.home.x; gg.y=gg.home.y;});
        return true;
      }
    }
    return false;
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<map.length;y++){
      for(let x=0;x<map[y].length;x++){
        const c=map[y][x];
        if(c==='#'){ ctx.fillStyle='#1919A6'; ctx.fillRect(x*tileSize,y*tileSize,tileSize,tileSize); }
        else if(c==='.'||c==='o'){ ctx.fillStyle='orange'; ctx.beginPath(); ctx.arc(x*tileSize+tileSize/2,y*tileSize+tileSize/2,c==='o'?4:2,0,Math.PI*2); ctx.fill(); }
      }
    }
    // Pac-Man
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(pac.x+tileSize/2,pac.y+tileSize/2,tileSize/2,0,Math.PI*2);
    ctx.fill();
    // Fantasmas
    ghosts.forEach(g=>{
      ctx.fillStyle=g.color;
      ctx.beginPath();
      ctx.arc(g.x+tileSize/2,g.y+tileSize/2,tileSize/2,0,Math.PI*2);
      ctx.fill();
    });
    document.getElementById('scoreBoard').innerText=`PuntuaciÃ³n: ${score} | Vidas: ${lives}`;
  }

  let last=0;
  function loop(ts){
    if(ts-last>1000/60){ // ~60fps
      moveEntity(pac,pacSpeed);
      moveGhosts();
      checkPellets();
      if(!checkCollisions()) draw();
      last=ts;
    }
    requestAnimationFrame(loop);
  }
  loop();
}
</script>
</body>
</html>
