<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pac-Man (Versión Clásica)</title>
<style>
  body {
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    overflow: hidden;
  }
  #score { position: absolute; top: 10px; left: 10px; font-size: 18px; }
  canvas {
    background: black;
    display: block;
    margin: 40px auto;
    image-rendering: pixelated;
  }
</style>
</head>
<body>
<div id="score">Puntos: 0 | Vidas: 3</div>
<canvas id="game" width="448" height="496"></canvas>

<script>
const TILE = 16;
const ROWS = 31;
const COLS = 28;
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

const map = [
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"      .   #      #   .      ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
].map(r => r.split(''));

const directions = {
  ArrowUp: {x: 0, y: -1},
  ArrowDown: {x: 0, y: 1},
  ArrowLeft: {x: -1, y: 0},
  ArrowRight: {x: 1, y: 0}
};

let score = 0;
let lives = 3;
let powerTimer = 0;

const pacman = {
  x: 13, y: 23,
  dir: {x: 0, y: 0},
  nextDir: {x: 0, y: 0},
  speed: 0.1,
  radius: 7
};

const ghosts = [
  {x: 13, y: 11, color: "#ff0000", dir: {x:1,y:0}},
  {x: 14, y: 11, color: "#ffb8ff", dir: {x:-1,y:0}},
  {x: 12, y: 11, color: "#00ffff", dir: {x:0,y:1}},
  {x: 15, y: 11, color: "#ffb852", dir: {x:0,y:-1}}
];

function isWall(x, y) {
  if (y < 0 || y >= ROWS || x < 0 || x >= COLS) return true;
  return map[Math.floor(y)][Math.floor(x)] === "#";
}

document.addEventListener("keydown", e => {
  if (directions[e.key]) pacman.nextDir = directions[e.key];
});

function move(entity) {
  const nextX = entity.x + entity.dir.x * entity.speed;
  const nextY = entity.y + entity.dir.y * entity.speed;
  if (!isWall(nextX, nextY)) {
    entity.x = nextX;
    entity.y = nextY;
  } else {
    entity.dir = {x:0, y:0};
  }
}

function update() {
  // aplicar dirección de Pac-Man si puede girar
  const tx = Math.round(pacman.x);
  const ty = Math.round(pacman.y);
  if (Math.abs(pacman.x - tx) < 0.1 && Math.abs(pacman.y - ty) < 0.1) {
    if (!isWall(tx + pacman.nextDir.x, ty + pacman.nextDir.y))
      pacman.dir = {...pacman.nextDir};
  }

  move(pacman);
  // túnel
  if (pacman.x < 0) pacman.x = COLS - 1;
  if (pacman.x >= COLS) pacman.x = 0;

  // comer puntos
  const cx = Math.floor(pacman.x);
  const cy = Math.floor(pacman.y);
  const cell = map[cy][cx];
  if (cell === ".") {
    score += 10;
    map[cy][cx] = " ";
  } else if (cell === "o") {
    score += 50;
    map[cy][cx] = " ";
    powerTimer = 600;
  }

  // mover fantasmas
  for (const g of ghosts) {
    // IA simple: moverse hacia Pac-Man si posible
    const dirs = [
      {x:1,y:0}, {x:-1,y:0}, {x:0,y:1}, {x:0,y:-1}
    ].filter(d => !isWall(Math.floor(g.x + d.x), Math.floor(g.y + d.y)));

    // elige la dirección que acerque más a Pac-Man
    let bestDir = g.dir, bestDist = Infinity;
    for (const d of dirs) {
      const dx = (g.x + d.x) - pacman.x;
      const dy = (g.y + d.y) - pacman.y;
      const dist = dx*dx + dy*dy;
      if (dist < bestDist) { bestDist = dist; bestDir = d; }
    }
    g.dir = bestDir;
    g.x += g.dir.x * 0.1;
    g.y += g.dir.y * 0.1;

    // colisión con Pac-Man
    const dx = g.x - pacman.x, dy = g.y - pacman.y;
    if (dx*dx + dy*dy < 0.3) {
      if (powerTimer > 0) {
        score += 200;
        g.x = 13; g.y = 11; // reset fantasma
      } else {
        lives--;
        if (lives <= 0) return gameOver();
        resetPositions();
      }
    }
  }

  if (powerTimer > 0) powerTimer--;

  draw();
  requestAnimationFrame(update);
}

function resetPositions() {
  pacman.x = 13; pacman.y = 23;
  pacman.dir = {x:0,y:0}; pacman.nextDir = {x:0,y:0};
  ghosts[0].x = 13; ghosts[0].y = 11;
  ghosts[1].x = 14; ghosts[1].y = 11;
  ghosts[2].x = 12; ghosts[2].y = 11;
  ghosts[3].x = 15; ghosts[3].y = 11;
}

function gameOver() {
  alert("GAME OVER\nPuntos: "+score);
  location.reload();
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for (let y=0;y<ROWS;y++){
    for (let x=0;x<COLS;x++){
      if (map[y][x]==="#"){
        ctx.fillStyle="#001f6f";
        ctx.fillRect(x*TILE, y*TILE, TILE, TILE);
      } else if (map[y][x]==="."){
        ctx.fillStyle="#ffd54d";
        ctx.beginPath();
        ctx.arc(x*TILE+TILE/2, y*TILE+TILE/2, 2, 0, Math.PI*2);
        ctx.fill();
      } else if (map[y][x]==="o"){
        ctx.fillStyle="#ffd54d";
        ctx.beginPath();
        ctx.arc(x*TILE+TILE/2, y*TILE+TILE/2, 5, 0, Math.PI*2);
        ctx.fill();
      }
    }
  }
  // Pac-Man
  ctx.fillStyle="#ffea00";
  ctx.beginPath();
  ctx.arc(pacman.x*TILE+TILE/2, pacman.y*TILE+TILE/2, pacman.radius, 0, Math.PI*2);
  ctx.fill();
  // Fantasmas
  for (const g of ghosts){
    ctx.fillStyle = powerTimer>0 ? "#0000cc" : g.color;
    ctx.beginPath();
    ctx.arc(g.x*TILE+TILE/2, g.y*TILE+TILE/2, pacman.radius, 0, Math.PI*2);
    ctx.fill();
  }
  scoreEl.textContent = `Puntos: ${score} | Vidas: ${lives}`;
}

resetPositions();
update();
</script>
</body>
</html>
