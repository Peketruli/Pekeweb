<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pac-Man Clásico</title>
<style>
  body{margin:0;background:#000;overflow:hidden;font-family:Arial,sans-serif;}
  canvas{display:block;margin:auto;background:#000;image-rendering:pixelated;}
  #scoreBoard{position:absolute;top:10px;left:10px;color:#fff;font-weight:bold;}
</style>
</head>
<body>
<div id="scoreBoard">Puntuación: 0 | Vidas: 3</div>
<canvas id="gameCanvas"></canvas>
<script>
const TILE = 20;
const ROWS = 31;
const COLS = 28;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = COLS*TILE;
canvas.height = ROWS*TILE;

// Mapa básico Pac-Man ('.' = pellet, 'o' = power, '#' = pared, ' ' = vacío)
const RAW_MAP = [
"############################",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#.####.#####.##.#####.####.#",
"#..........................#",
"#.####.##.########.##.####.#",
"#.####.##.########.##.####.#",
"#......##....##....##......#",
"######.##### ## #####.######",
"######.##### ## #####.######",
"######.##          ##.######",
"######.## ###--### ##.######",
"######.## #      # ##.######",
"      .   #      #   .      ",
"######.## #      # ##.######",
"######.## ######## ##.######",
"######.##          ##.######",
"######.## ######## ##.######",
"######.## ######## ##.######",
"#............##............#",
"#.####.#####.##.#####.####.#",
"#o####.#####.##.#####.####o#",
"#...##................##...#",
"###.##.##.########.##.##.###",
"###.##.##.########.##.##.###",
"#......##....##....##......#",
"#.##########.##.##########.#",
"#.##########.##.##########.#",
"#..........................#",
"############################"
];

let map = RAW_MAP.map(r=>r.split(''));
let score = 0;
let lives = 3;

// Pac-Man
let pac = {
  x: 13*TILE + TILE/2,
  y: 23*TILE + TILE/2,
  dir: {x:0,y:0},
  nextDir: {x:0,y:0},
  speed:2,
  radius:8,
  mouth:0
};

// Fantasmas simples
const ghosts = [
  {x:13*TILE+TILE/2, y:11*TILE+TILE/2, color:'#ff0000', dir:{x:1,y:0}, speed:1.5},
  {x:14*TILE+TILE/2, y:11*TILE+TILE/2, color:'#00ffff', dir:{x:-1,y:0}, speed:1.5},
  {x:12*TILE+TILE/2, y:11*TILE+TILE/2, color:'#ffb852', dir:{x:0,y:1}, speed:1.5},
  {x:15*TILE+TILE/2, y:11*TILE+TILE/2, color:'#ffb8ff', dir:{x:0,y:-1}, speed:1.5}
];

const keyMap = {ArrowUp:{x:0,y:-1}, ArrowDown:{x:0,y:1}, ArrowLeft:{x:-1,y:0}, ArrowRight:{x:1,y:0}};
document.addEventListener('keydown', e=>{ if(keyMap[e.key]){ pac.nextDir = {...keyMap[e.key]}; e.preventDefault(); }});

function inside(x,y){ return x>=0 && x<COLS && y>=0 && y<ROWS; }
function isWall(x,y){ return !inside(x,y) || map[y][x]==='#'; }
function tileFromPx(x,y){ return {x:Math.floor(x/TILE),y:Math.floor(y/TILE)}; }

function tryChangeDir(){
  const nextTile = tileFromPx(pac.x + pac.nextDir.x*TILE/2, pac.y + pac.nextDir.y*TILE/2);
  if(!isWall(nextTile.x,nextTile.y)) pac.dir = {...pac.nextDir};
}

function movePac(){
  tryChangeDir();
  pac.x += pac.dir.x*pac.speed;
  pac.y += pac.dir.y*pac.speed;
  const t = tileFromPx(pac.x,pac.y);
  if(isWall(t.x,t.y)){ pac.x -= pac.dir.x*pac.speed; pac.y -= pac.dir.y*pac.speed; pac.dir={x:0,y:0}; }
  if(pac.x<-pac.radius) pac.x=canvas.width+pac.radius;
  if(pac.x>canvas.width+pac.radius) pac.x=-pac.radius;
  // comer pellets
  if(map[t.y][t.x]==='.'){ map[t.y][t.x]=' '; score+=10; }
  if(map[t.y][t.x]==='o'){ map[t.y][t.x]=' '; score+=50; }
}

function moveGhosts(){
  ghosts.forEach(g=>{
    g.x += g.dir.x*g.speed;
    g.y += g.dir.y*g.speed;
    const t = tileFromPx(g.x,g.y);
    if(isWall(t.x,t.y)){ g.dir.x*=-1; g.dir.y*=-1; }
    if(g.x<-TILE) g.x=canvas.width+TILE;
    if(g.x>canvas.width+TILE) g.x=-TILE;
  });
}

function checkCollisions(){
  ghosts.forEach(g=>{
    const dx = pac.x-g.x, dy = pac.y-g.y;
    if(dx*dx+dy*dy < (pac.radius*2)*(pac.radius*2)*0.8){
      lives--;
      if(lives<=0){ alert('GAME OVER\nPuntos: '+score); location.reload(); }
      else resetPositions();
    }
  });
}

function resetPositions(){
  pac.x=13*TILE+TILE/2; pac.y=23*TILE+TILE/2; pac.dir={x:0,y:0}; pac.nextDir={x:0,y:0};
  ghosts[0].x=13*TILE+TILE/2; ghosts[0].y=11*TILE+TILE/2;
  ghosts[1].x=14*TILE+TILE/2; ghosts[1].y=11*TILE+TILE/2;
  ghosts[2].x=12*TILE+TILE/2; ghosts[2].y=11*TILE+TILE/2;
  ghosts[3].x=15*TILE+TILE/2; ghosts[3].y=11*TILE+TILE/2;
}

function draw(){
  ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
  // mapa
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      const c = map[y][x], px = x*TILE, py = y*TILE;
      if(c==='#'){ ctx.fillStyle='#001f6f'; ctx.fillRect(px,py,TILE,TILE); }
      else if(c==='.'){ ctx.fillStyle='#ffd54d'; ctx.beginPath(); ctx.arc(px+TILE/2,py+TILE/2,3,0,Math.PI*2); ctx.fill(); }
      else if(c==='o'){ ctx.fillStyle='#ffd54d'; ctx.beginPath(); ctx.arc(px+TILE/2,py+TILE/2,6,0,Math.PI*2); ctx.fill(); }
    }
  }
  // Pac-Man
  const mouth = 0.25*Math.sin(pac.mouth);
  ctx.fillStyle='#ffea00';
  const angle = Math.atan2(pac.dir.y,pac.dir.x)||0;
  ctx.beginPath(); ctx.moveTo(pac.x,pac.y);
  ctx.arc(pac.x,pac.y,pac.radius,-mouth+angle,mouth+angle,false); ctx.closePath(); ctx.fill();
  pac.mouth+=0.3;
  // fantasmas
  ghosts.forEach(g=>{
    ctx.fillStyle=g.color;
    ctx.beginPath(); ctx.arc(g.x,g.y,pac.radius,Math.PI,0,false);
    ctx.lineTo(g.x+pac.radius,g.y+pac.radius); ctx.lineTo(g.x-pac.radius,g.y+pac.radius); ctx.closePath(); ctx.fill();
  });
  document.getElementById('scoreBoard').innerText=`Puntuación: ${score} | Vidas: ${lives}`;
}

function update(){
  movePac();
  moveGhosts();
  checkCollisions();
  draw();
  requestAnimationFrame(update);
}

resetPositions();
update();
</script>
</body>
</html>
