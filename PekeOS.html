<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PekeOS Halloween Edition</title>
<style>
* { box-sizing: border-box; font-family: 'MS Sans Serif', Tahoma, sans-serif; }
body, html { margin:0; padding:0; height:100%; background:#111; color:#fff; overflow:hidden; }

/* Pantalla de encendido/apagado */
#powerScreen {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:#000; display:flex; align-items:center; justify-content:center; flex-direction:column;
  z-index:9999; color:#fff; cursor:pointer; transition: background 0.5s;
}
#powerScreen h1 {
  font-size:2em; text-shadow: 0 0 10px orange; animation: blink 1s infinite;
}
@keyframes blink {
  0%, 50%, 100% { opacity:1; }
  25%, 75% { opacity:0.4; }
}

/* Escritorio */
.desktop { position:relative; height:100%; padding:16px; display:none; background:#111 url('') no-repeat center center; background-size:cover; }
.icons { display:flex; flex-wrap:wrap; gap:14px; }
.icon { width:70px; text-align:center; cursor:pointer; transition: transform 0.2s; }
.icon:hover { transform: scale(1.1); }
.icon .thumb { width:64px; height:64px; border:2px solid #666; background:#000; border-radius:6px;
               display:flex; align-items:center; justify-content:center; font-size:28px; }
.icon span { display:block; margin-top:6px; color:#ffe9b6; text-shadow: 0 0 2px orange; }

/* Barra de tareas retro */
.taskbar {
  position:fixed; bottom:0; left:0; right:0; height:42px;
  background:#222; border-top:3px solid #ff6f00; display:flex; align-items:center;
  padding:4px 6px; gap:8px; color:#fff; display:none;
}
.start-btn { display:flex; align-items:center; gap:6px; padding:6px 10px; background:#333;
             border:2px solid #555; box-shadow: inset 1px 1px 0 rgba(255,255,255,.1);
             cursor:pointer; color:#fff; transition: all 0.2s; }
.start-btn:hover { background:#444; }
.task-buttons { display:flex; gap:4px; flex:1; }
.task-buttons button { padding:4px 8px; background:#333; border:2px outset #555; color:#fff;
                       cursor:pointer; display:flex; align-items:center; gap:4px; font-size:14px; transition: all 0.2s; }
.task-buttons button.active { background:#555; border-style:inset; }
.tray { display:flex; gap:8px; align-items:center; color:#fff; }
.clock { background:#333; padding:4px 8px; border:2px solid #555; color:#fff; font-weight:bold; }

/* Ventanas */
.win {
  position:absolute; width:520px; background:#111; border:2px solid #ff6f00;
  box-shadow:6px 6px 0 rgba(0,0,0,.8); display:flex; flex-direction:column; color:#fff;
  animation: fadeIn 0.3s;
}
@keyframes fadeIn { from {opacity:0; transform:scale(0.9);} to {opacity:1; transform:scale(1);} }
.titlebar {
  height:28px; background:linear-gradient(#222,#111); color:#fff; display:flex; align-items:center;
  padding:0 6px; gap:8px; user-select:none; border-bottom:1px solid #555;
}
.titlebar .title { flex:1; font-size:13px; }
.titlebar .controls { display:flex; gap:6px; }
.btn { width:20px; height:20px; border:2px solid #111; background:#222; color:#fff;
       display:flex; align-items:center; justify-content:center; cursor:pointer; transition: all 0.2s; }
.btn:hover { background:#333; }
.content { padding:0; background:#000; flex:1; overflow:auto; color:#fff; }

/* Start menu */
.start-menu {
  position:absolute; bottom:42px; left:6px; width:200px; background:#111; border:2px solid #ff6f00;
  display:none; flex-direction:column; color:#fff; padding:8px; box-shadow:3px 3px 0 rgba(0,0,0,0.8);
}
.start-menu button { margin:4px 0; padding:6px; background:#222; border:1px solid #444; color:#fff; cursor:pointer; transition: all 0.2s; }
.start-menu button:hover { background:#333; }

/* Plantilla ventana */
</style>
</head>
<body>

<!-- Pantalla de encendido -->
<div id="powerScreen">
  <h1>Pulsa para encender üí°</h1>
</div>

<!-- Escritorio -->
<div class="desktop">
  <div class="icons">
    <div class="icon" data-app="golf.html" data-emoji="üïπÔ∏è"><div class="thumb">üïπÔ∏è</div><span>Zona Arcade</span></div>
    <div class="icon" data-app="e.html" data-emoji="üìä"><div class="thumb">üìä</div><span>Encuestas</span></div>
    <div class="icon" data-app="c.html" data-emoji="üé∞"><div class="thumb">üé∞</div><span>Casino</span></div>
    <div class="icon" data-app="periodico.html" data-emoji="üì∞"><div class="thumb">üì∞</div><span>Noticias</span></div>
    <div class="icon" data-app="po.html" data-emoji="üèõÔ∏è"><div class="thumb">üèõÔ∏è</div><span>Pol√≠tica</span></div>
    <div class="icon" data-app="ch.html" data-emoji="üí¨"><div class="thumb">üí¨</div><span>Chat</span></div>
  </div>
</div>

<!-- Barra de tareas -->
<div class="taskbar">
  <div class="start-btn">üéÉ PekeOS</div>
  <div class="task-buttons" id="taskButtons"></div>
  <div class="tray"><div class="clock" id="clock">00:00</div></div>
</div>

<!-- Start Menu -->
<div class="start-menu" id="startMenu">
  <button id="settingsBtn">Ajustes</button>
  <button id="shutdownBtn">Apagar</button>
</div>

<!-- Plantilla de ventana -->
<template id="winTpl">
  <div class="win" data-wid="">
    <div class="titlebar">
      <div class="title">Ventana</div>
      <div class="controls">
        <div class="btn" data-action="min">_</div>
        <div class="btn" data-action="max">‚¨ú</div>
        <div class="btn" data-action="close">X</div>
      </div>
    </div>
    <div class="content"></div>
  </div>
</template>
<script>
const desktop = document.querySelector('.desktop');
const tpl = document.getElementById('winTpl');
let zIndex = 10;
let windows = {};

const powerScreen = document.getElementById('powerScreen');
const taskbar = document.querySelector('.taskbar');
const startMenu = document.getElementById('startMenu');

// Reloj
function nowTime() {
  const d = new Date();
  return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
}
document.getElementById('clock').textContent = nowTime();
setInterval(() => document.getElementById('clock').textContent = nowTime(), 30000);

// ===== Encendido con animaci√≥n =====
function powerOn() {
  powerScreen.innerHTML = '<h1>Cargando PekeOS... üéÉ</h1>';
  let dots = 0;
  const interval = setInterval(() => {
    dots = (dots + 1) % 4;
    powerScreen.querySelector('h1').textContent = 'Cargando PekeOS' + '.'.repeat(dots) + ' üéÉ';
  }, 500);
  setTimeout(() => {
    clearInterval(interval);
    powerScreen.style.display = 'none';
    desktop.style.display = 'block';
    taskbar.style.display = 'flex';
  }, 2500);
}

// Apagado con animaci√≥n
function powerOff() {
  desktop.style.display = 'none';
  taskbar.style.display = 'none';
  startMenu.style.display = 'none';
  powerScreen.style.display = 'flex';
  powerScreen.innerHTML = '<h1>Apagando PekeOS... üíÄ</h1>';
  setTimeout(() => {
    powerScreen.innerHTML = '<h1>Pulsa para encender üí°</h1>';
  }, 2000);
}

// Evento click para encender
powerScreen.addEventListener('click', powerOn);

// ===== Crear ventana =====
function createWindow({title='Ventana', src=null, id=null, x=60, y=60, w=520, h=360, emoji=null}) {
  const node = tpl.content.firstElementChild.cloneNode(true);
  const wid = id || 'w_' + Date.now();
  node.dataset.wid = wid;
  node.style.left = x + 'px';
  node.style.top = y + 'px';
  node.style.width = w + 'px';
  node.style.height = h + 'px';
  node.querySelector('.title').textContent = title;

  const content = node.querySelector('.content');
  if (src) {
    const iframe = document.createElement('iframe');
    iframe.src = src;
    content.appendChild(iframe);
  }

  makeDraggable(node);
  makeResizable(node);
  attachControls(node);
  document.body.appendChild(node);
  focusWindow(node);
  addTaskButton(node, title, emoji);
  windows[wid] = node;
  return node;
}

// ===== Traer al frente =====
function focusWindow(node) {
  node.style.zIndex = ++zIndex;
  node.classList.remove('minimized');
}

// ===== Controles de ventana =====
function attachControls(node) {
  const wid = node.dataset.wid;
  node.querySelectorAll('.btn').forEach(b => {
    b.addEventListener('click', () => {
      const a = b.dataset.action;
      if (a === 'close') {
        const taskBtn = document.querySelector(`[data-task-btn-id='${node.dataset.taskBtnId}']`);
        if (taskBtn) taskBtn.remove();
        node.remove();
        delete windows[wid];
      } else if (a === 'min') {
        node.classList.add('minimized');
        node.style.display = 'none';
      } else if (a === 'max') {
        if (node.dataset.maxed === '1') {
          node.style.left = node.dataset.prevLeft;
          node.style.top = node.dataset.prevTop;
          node.style.width = node.dataset.prevWidth;
          node.style.height = node.dataset.prevHeight;
          node.dataset.maxed = '0';
        } else {
          node.dataset.prevLeft = node.style.left;
          node.dataset.prevTop = node.style.top;
          node.dataset.prevWidth = node.style.width;
          node.dataset.prevHeight = node.style.height;
          node.style.left = '6px';
          node.style.top = '6px';
          node.style.width = (window.innerWidth-12) + 'px';
          node.style.height = (window.innerHeight-72) + 'px';
          node.dataset.maxed = '1';
        }
      }
    });
  });
  node.addEventListener('mousedown', () => focusWindow(node));
}

// ===== Arrastrar ventana =====
function makeDraggable(el) {
  const title = el.querySelector('.titlebar');
  let ox, oy, dx, dy, drag=false;
  title.addEventListener('mousedown', (e) => {
    drag = true; ox = e.clientX; oy = e.clientY;
    dx = parseInt(el.style.left)||0;
    dy = parseInt(el.style.top)||0;
    focusWindow(el);
    document.addEventListener('mousemove', move);
    document.addEventListener('mouseup', up);
  });
  function move(e) { if (!drag) return; el.style.left = (dx + (e.clientX - ox)) + 'px'; el.style.top = (dy + (e.clientY - oy)) + 'px'; }
  function up() { drag=false; document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', up); }
}

// ===== Redimensionar ventana =====
function makeResizable(el) {
  const grip = document.createElement('div');
  grip.style.width='12px'; grip.style.height='12px'; grip.style.position='absolute';
  grip.style.right='2px'; grip.style.bottom='2px'; grip.style.cursor='nwse-resize';
  grip.style.background='transparent'; el.appendChild(grip);

  let startX, startY, startW, startH, resizing=false;
  grip.addEventListener('mousedown', (e) => {
    e.stopPropagation();
    resizing = true;
    startX = e.clientX; startY = e.clientY;
    startW = el.offsetWidth; startH = el.offsetHeight;
    document.addEventListener('mousemove', resize);
    document.addEventListener('mouseup', stopResize);
  });

  function resize(e) { if(!resizing) return; el.style.width = (startW + e.clientX - startX) + 'px'; el.style.height = (startH + e.clientY - startY) + 'px'; }
  function stopResize() { resizing=false; document.removeEventListener('mousemove', resize); document.removeEventListener('mouseup', stopResize); }
}

// ===== Abrir apps al hacer doble click =====
document.querySelectorAll('.icon').forEach(ic => {
  ic.addEventListener('dblclick', () => {
    const src = ic.dataset.app;
    const emoji = ic.dataset.emoji;
    createWindow({title: ic.querySelector('span').textContent, src, emoji});
  });
});

// ===== Start menu toggle =====
const startBtn = document.querySelector('.start-btn');
startBtn.addEventListener('click', () => { startMenu.style.display = startMenu.style.display==='flex'?'none':'flex'; });

// ===== Start menu acciones =====
document.getElementById('settingsBtn').addEventListener('click', () => {
  createWindow({title:'Ajustes', src:'ajustes.html', w:400, h:300});
  startMenu.style.display='none';
});
document.getElementById('shutdownBtn').addEventListener('click', powerOff);

// ===== Barra de tareas: a√±adir bot√≥n =====
function addTaskButton(winNode, title, emoji) {
  const taskButtons = document.getElementById('taskButtons');
  const btn = document.createElement('button');
  if(emoji) { const span = document.createElement('span'); span.textContent = emoji; btn.appendChild(span); }
  const text = document.createTextNode(title); btn.appendChild(text);
  btn.addEventListener('click', () => {
    if(winNode.classList.contains('minimized')) { winNode.style.display='flex'; winNode.classList.remove('minimized'); focusWindow(winNode); btn.classList.add('active'); }
    else { winNode.classList.add('minimized'); winNode.style.display='none'; btn.classList.remove('active'); }
  });
  const id = Date.now(); winNode.dataset.taskBtnId = id; btn.dataset.taskBtnId = id;
  taskButtons.appendChild(btn);
}
</script>
</body>
</html>
