<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PekeOS ‚Äî Ne√≥n</title>
<style>
:root{
  --bg-grad: linear-gradient(180deg,#05060a 0%, #07121b 100%);
  --neon: #00ffd0;
  --accent: #00ffd0;
  --win-opacity: 0.96;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#cfeff0}
html,body{height:100%;width:100%;background:var(--bg-grad);overflow:hidden}
#desktop{
  position:relative;width:100%;height:100%;
  padding:18px; transition:background .3s;
  background:
    radial-gradient(800px 300px at 10% 20%, rgba(0,255,208,0.03), transparent 8%),
    radial-gradient(600px 200px at 90% 80%, rgba(0,155,255,0.02), transparent 6%);
}

/* icons */
.icons{position:absolute; inset:0}
.icon{width:88px;text-align:center;cursor:pointer;position:absolute;user-select:none;transition:transform .14s}
.icon:hover{transform:translateY(-6px) scale(1.06)}
.icon .thumb{width:68px;height:68px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:34px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(0,255,208,0.06);color:var(--neon);text-shadow:0 0 8px rgba(0,255,208,0.25)}
.icon span{display:block;margin-top:8px;color:#8fffe8;font-size:12px}

/* taskbar */
.taskbar{
  position:fixed;left:12px;right:12px;bottom:12px;height:56px;display:flex;align-items:center;gap:12px;padding:8px;
  background:rgba(10,12,14,0.35);backdrop-filter:blur(8px) saturate(120%);border-radius:14px;border:1px solid rgba(0,255,208,0.08);z-index:1000;
}
.start-btn{width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:10px;cursor:pointer;border:1px solid rgba(0,255,208,0.12)}
.start-btn img{width:30px;height:30px}
.task-apps{display:flex;gap:8px;align-items:center;flex:1;padding-left:8px}
.task-btn{display:flex;gap:8px;align-items:center;padding:6px 10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(0,255,208,0.06);cursor:pointer}
.task-btn.active{outline:2px solid rgba(0,255,208,0.15)}

/* clock */
.clock{min-width:72px;text-align:right;color:#9ef7ea;font-weight:600;font-size:14px}

/* start menu */
#startMenu{
  position:fixed;left:20px;bottom:82px;width:320px;background:linear-gradient(180deg,rgba(10,12,14,0.9),rgba(6,8,10,0.85));
  border-radius:12px;padding:12px;z-index:1200;display:none;backdrop-filter:blur(6px);border:1px solid rgba(0,255,208,0.06)
}
.start-search{display:flex;gap:8px;align-items:center;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px}
.start-cats{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.cat{padding:8px 10px;border-radius:8px;background:rgba(0,255,208,0.03);color:#9fffe9;cursor:pointer}

/* windows */
.win{position:absolute;width:640px;height:420px;background:linear-gradient(180deg,rgba(6,8,10,0.96),rgba(8,10,12,0.96));border-radius:12px;border:1px solid rgba(0,255,208,0.06);box-shadow:0 30px 80px rgba(2,10,16,0.6);overflow:hidden;display:flex;flex-direction:column;opacity:var(--win-opacity)}
.titlebar{height:44px;display:flex;align-items:center;gap:10px;padding:8px 12px;border-bottom:1px solid rgba(255,255,255,0.02);user-select:none}
.titlebar .title{flex:1;font-weight:700;color:#e6fff9}
.win-btn{width:30px;height:30px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.content{flex:1;background:#000}
/* resizer */
.resizer{position:absolute;width:14px;height:14px;right:0;bottom:0;cursor:se-resize}

/* small */
.hidden{display:none}

/* responsive */
@media (max-width:720px){.win{width:92%;height:70%;left:4% !important;top:12% !important}}
</style>
</head>
<body>
  <div id="desktop">
    <div class="icons">
      <!-- restored original icons -->
      <div class="icon" data-app="golf.html" style="top:10px; left:10px;"><div class="thumb">üïπÔ∏è</div><span>Zona Arcade</span></div>
      <div class="icon" data-app="prueba.html" style="top:100px; left:10px;"><div class="thumb">üé∞</div><span>Casino</span></div>

      <div class="icon" data-app="periodico.html" style="top:10px; right:10px;"><div class="thumb">üì∞</div><span>Noticias</span></div>
      <div class="icon" data-app="e.html" style="top:100px; right:10px;"><div class="thumb">üó≥Ô∏è</div><span>Encuestas</span></div>
      <div class="icon" data-app="po.html" style="top:190px; right:10px;"><div class="thumb">üìú</div><span>Partidos</span></div>
      <div class="icon" data-app="posts.html" style="top:280px; right:10px;"><div class="thumb">üìù</div><span>Posts PekeOS</span></div>

      <div class="icon" data-app="archivos.html" style="bottom:150px; left:10px;"><div class="thumb">üìÅ</div><span>Archivos</span></div>
      <div class="icon" data-app="chat.html" style="bottom:150px; left:110px;"><div class="thumb">‚úâÔ∏è</div><span>Whatsapp</span></div>

      <div class="icon" data-app="admin.html" style="bottom:150px; right:10px;"><div class="thumb">‚úèÔ∏è</div><span>Admin</span></div>
      <div class="icon" data-app="ajustes.html" style="bottom:40px; right:10px;"><div class="thumb">‚öôÔ∏è</div><span>Ajustes</span></div>
      <div class="icon" data-app="estado de la OS.html" style="bottom:40px; left:110px;"><div class="thumb">üìä</div><span>Estado OS</span></div>
    </div>
  </div>

  <!-- taskbar -->
  <div class="taskbar" id="taskbar">
    <div class="start-btn" id="startBtn" title="Inicio"><img src="PekeOSmini.png" alt="PekeOS"></div>
    <div class="task-apps" id="taskApps"></div>
    <div class="clock" id="clock">00:00</div>
  </div>

  <!-- start menu -->
  <div id="startMenu" role="dialog" aria-label="Menu inicio">
    <div class="start-search"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#9ef7ea" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="#9ef7ea" stroke-width="1.6"></circle></svg><input id="startSearch" placeholder="Buscar apps..." /></div>
    <div class="start-cats" id="startCats"><div class="cat" data-filter="all">Todo</div><div class="cat" data-filter="ocio">Ocio</div><div class="cat" data-filter="noticias">Noticias</div><div class="cat" data-filter="redes">Redes</div><div class="cat" data-filter="admin">Admin</div></div>
    <div id="startList" style="margin-top:8px;max-height:260px;overflow:auto"></div>
  </div>

  <!-- window template -->
  <template id="winTpl">
    <div class="win" data-winid="">
      <div class="titlebar">
        <div class="title">Ventana</div>
        <div class="controls">
          <div class="win-btn" data-action="min" title="Minimizar">‚îÄ</div>
          <div class="win-btn" data-action="max" title="Maximizar">‚ñ¢</div>
          <div class="win-btn" data-action="close" title="Cerrar">‚úï</div>
        </div>
      </div>
      <div class="content"></div>
      <div class="resizer"></div>
    </div>
  </template>

<script>
/* ----------------- reloj ----------------- */
function updateClock(){ const n=new Date(); document.getElementById('clock').textContent = String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0'); }
setInterval(updateClock,1000); updateClock();

/* ----------------- ventanas / taskbar ----------------- */
const winTpl = document.getElementById('winTpl');
const taskAppsEl = document.getElementById('taskApps');
let zIndexCounter = 200, winCounter = 0;
const openWindows = new Map(); // id -> {winEl, taskBtn, ...}

/* Crear ventana globalmente accesible para iframes hijos */
window.createWindow = function(title='Ventana', src=null, opts={}){
  const node = winTpl.content.firstElementChild.cloneNode(true);
  const id = 'win_'+(++winCounter);
  node.dataset.winid = id;
  node.querySelector('.title').textContent = title;

  // content
  if(src){
    const iframe = document.createElement('iframe');
    iframe.src = src;
    iframe.style.width = '100%'; iframe.style.height = '100%'; iframe.style.border = '0';
    node.querySelector('.content').appendChild(iframe);
    // allow child to call parent functions: iframe can call parent.createWindow, parent.applySettings, etc.
  } else {
    node.querySelector('.content').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;color:#9fffe3">Sin contenido</div>';
  }

  node.style.left = (120 + Math.random()*140) + 'px';
  node.style.top = (80 + Math.random()*90) + 'px';
  node.style.zIndex = ++zIndexCounter;
  node.style.opacity = getComputedStyle(document.documentElement).getPropertyValue('--win-opacity') || '0.96';

  document.body.appendChild(node);
  makeDraggable(node);
  makeResizable(node);
  attachWindowControls(node);

  // taskbar button
  const taskBtn = document.createElement('div');
  taskBtn.className = 'task-btn';
  taskBtn.innerHTML = `<div class="label">${title}</div>`;
  taskAppsEl.appendChild(taskBtn);

  taskBtn.addEventListener('click', ()=>{
    const info = openWindows.get(id);
    if(!info) return;
    if(info.minimized){ restoreWindow(id); }
    else { minimizeWindow(id); }
  });

  openWindows.set(id, {winEl: node, taskBtn, minimized:false, maxed:false});
  focusWindow(node);
  return id;
};

function focusWindow(winEl){
  zIndexCounter++;
  winEl.style.zIndex = zIndexCounter;
  // set active class on task buttons
  openWindows.forEach((v,k)=> v.taskBtn.classList.toggle('active', v.winEl===winEl));
}

function minimizeWindow(id){
  const info = openWindows.get(id); if(!info) return;
  info.winEl.style.display = 'none'; info.minimized = true; info.taskBtn.classList.remove('active');
}
function restoreWindow(id){
  const info = openWindows.get(id); if(!info) return;
  info.winEl.style.display = 'flex'; info.minimized = false; focusWindow(info.winEl);
}
function toggleMaximize(id){
  const info = openWindows.get(id); if(!info) return;
  const win = info.winEl;
  if(info.maxed){
    info.maxed=false;
    if(win._prevRect){ win.style.left = win._prevRect.left+'px'; win.style.top = win._prevRect.top+'px'; win.style.width = win._prevRect.width+'px'; win.style.height = win._prevRect.height+'px'; }
    win.classList.remove('maxed');
  } else {
    win._prevRect = { left: parseInt(win.style.left)||win.getBoundingClientRect().left, top: parseInt(win.style.top)||win.getBoundingClientRect().top, width: win.getBoundingClientRect().width, height: win.getBoundingClientRect().height };
    win.style.left = '6px'; win.style.top = '6px'; win.style.width = (window.innerWidth-12)+'px'; win.style.height = (window.innerHeight-90)+'px';
    info.maxed = true; win.classList.add('maxed');
  }
  focusWindow(info.winEl);
}
function closeWindow(id){
  const info = openWindows.get(id); if(!info) return;
  info.winEl.remove(); info.taskBtn.remove(); openWindows.delete(id);
}

/* attach control handlers */
function attachWindowControls(winEl){
  const id = winEl.dataset.winid;
  winEl.addEventListener('mousedown', ()=> focusWindow(winEl));
  winEl.querySelectorAll('.win-btn').forEach(btn=>{
    btn.addEventListener('click',(e)=>{
      e.stopPropagation();
      const a = btn.dataset.action;
      if(a==='min') minimizeWindow(id);
      if(a==='max') toggleMaximize(id);
      if(a==='close') closeWindow(id);
    });
  });
  winEl.querySelector('.titlebar').addEventListener('dblclick', ()=> toggleMaximize(id));
}

/* drag */
function makeDraggable(winEl){
  const bar = winEl.querySelector('.titlebar');
  let dragging=false, startX=0, startY=0, origX=0, origY=0;
  bar.addEventListener('mousedown',(e)=>{
    if(e.button!==0) return;
    dragging=true; startX=e.clientX; startY=e.clientY;
    const rect = winEl.getBoundingClientRect(); origX=rect.left; origY=rect.top;
    winEl.style.transition='none'; focusWindow(winEl);
    document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onUp);
  });
  function onMove(e){ if(!dragging) return; winEl.style.left = (origX + (e.clientX-startX))+'px'; winEl.style.top = (origY + (e.clientY-startY))+'px'; }
  function onUp(){ dragging=false; winEl.style.transition=''; document.removeEventListener('mousemove',onMove); document.removeEventListener('mouseup',onUp); }
}

/* resize */
function makeResizable(winEl){
  const resizer = winEl.querySelector('.resizer');
  let resizing=false, startX=0, startY=0, startW=0, startH=0;
  resizer.addEventListener('mousedown',(e)=>{
    if(e.button!==0) return;
    resizing=true; startX=e.clientX; startY=e.clientY;
    const rect = winEl.getBoundingClientRect(); startW=rect.width; startH=rect.height;
    winEl.style.transition='none'; focusWindow(winEl);
    document.addEventListener('mousemove', onMove); document.addEventListener('mouseup', onUp);
  });
  function onMove(e){ if(!resizing) return; winEl.style.width = Math.max(320, startW + (e.clientX-startX))+'px'; winEl.style.height = Math.max(200, startH + (e.clientY-startY))+'px'; }
  function onUp(){ resizing=false; winEl.style.transition=''; document.removeEventListener('mousemove',onMove); document.removeEventListener('mouseup',onUp); }
}

/* open apps by double click */
document.querySelectorAll('.icon').forEach(icon=>{
  icon.addEventListener('dblclick', ()=>{
    const app = icon.dataset.app; const title = icon.querySelector('span').textContent;
    createWindow(title, app);
  });
});

/* ================= START MENU - search / categories ================= */
const appsCatalog = [
  { id:'golf', title:'Zona Arcade', file:'golf.html', cat:'ocio', emoji:'üïπÔ∏è' },
  { id:'casino', title:'Casino', file:'prueba.html', cat:'ocio', emoji:'üé∞' },
  { id:'periodico', title:'Noticias', file:'periodico.html', cat:'noticias', emoji:'üì∞' },
  { id:'encuestas', title:'Encuestas', file:'e.html', cat:'noticias', emoji:'üìä' },
  { id:'partidos', title:'Partidos', file:'po.html', cat:'noticias', emoji:'üìú' },
  { id:'posts', title:'Posts PekeOS', file:'posts.html', cat:'noticias', emoji:'üìù' },
  { id:'blog', title:'Blog', file:'b.html', cat:'redes', emoji:'üí¨' },
  { id:'chat', title:'Whatsapp', file:'chat.html', cat:'redes', emoji:'‚úâÔ∏è' },
  { id:'admin', title:'Admin', file:'admin.html', cat:'admin', emoji:'‚öôÔ∏è' },
  { id:'estado', title:'Estado OS', file:'estado de la OS.html', cat:'admin', emoji:'üìä' },
  { id:'archivos', title:'Archivos', file:'archivos.html', cat:'admin', emoji:'üìÅ' },
  { id:'ajustes', title:'Ajustes', file:'ajustes.html', cat:'admin', emoji:'‚öôÔ∏è' }
];
const startMenu = document.getElementById('startMenu'), startList = document.getElementById('startList'), startSearch = document.getElementById('startSearch'), startCats = document.getElementById('startCats');

function populateStartList(filter='all', term=''){
  startList.innerHTML = '';
  const q = (term||'').trim().toLowerCase();
  appsCatalog.forEach(app=>{
    if(filter!=='all' && app.cat!==filter) return;
    if(q && !app.title.toLowerCase().includes(q)) return;
    const el = document.createElement('div'); el.className='start-item'; el.style.padding='8px'; el.style.display='flex'; el.style.gap='8px'; el.style.alignItems='center';
    el.innerHTML = `<div style="font-size:18px">${app.emoji}</div><div style="display:flex;flex-direction:column"><strong>${app.title}</strong><small style="color:#8fffe2">${app.file}</small></div>`;
    el.addEventListener('click', ()=>{ createWindow(app.title, app.file); startMenu.style.display='none'; });
    startList.appendChild(el);
  });
}
startCats.querySelectorAll('.cat').forEach(c=> c.addEventListener('click', ()=> { startCats.querySelectorAll('.cat').forEach(x=>x.style.opacity='0.7'); c.style.opacity='1'; populateStartList(c.dataset.filter); }));
startSearch.addEventListener('input', ()=> populateStartList('all', startSearch.value));
document.getElementById('startBtn').addEventListener('click',(e)=>{ e.stopPropagation(); startMenu.style.display = startMenu.style.display==='flex'?'none':'flex'; populateStartList('all'); });
document.addEventListener('click',(e)=>{ if(!startMenu.contains(e.target) && !document.getElementById('startBtn').contains(e.target)) startMenu.style.display='none'; });

/* keyboard Win opens menu */
window.addEventListener('keydown',(e)=>{ if(e.key==='Meta') { startMenu.style.display = startMenu.style.display==='flex'?'none':'flex'; e.preventDefault(); } });

/* contextmenu on taskbar: restore minimized windows */
document.getElementById('taskbar').addEventListener('contextmenu',(e)=>{ e.preventDefault(); openWindows.forEach((v,k)=>{ if(v.minimized) restoreWindow(k); }); });

/* applySettings: function called by ajustes.html */
window.applySettings = function(settings){
  try{
    if(settings.accent) {
      document.documentElement.style.setProperty('--neon', settings.accent);
      document.documentElement.style.setProperty('--accent', settings.accent);
    }
    if(settings.bg){
      document.getElementById('desktop').style.backgroundImage = `url('${settings.bg}')`;
      document.getElementById('desktop').style.backgroundSize = 'cover';
      document.getElementById('desktop').style.backgroundPosition = 'center';
    } else {
      document.getElementById('desktop').style.backgroundImage = '';
    }
    if(settings.winOpacity !== undefined){
      document.documentElement.style.setProperty('--win-opacity', settings.winOpacity);
      // apply to existing windows
      document.querySelectorAll('.win').forEach(w => w.style.opacity = settings.winOpacity);
    }
    // save to localStorage
    localStorage.setItem('pekeos_theme_v1', JSON.stringify(settings));
  }catch(e){
    console.warn('applySettings error',e);
  }
};

/* on load, apply saved theme */
(function applySavedTheme(){
  try{
    const raw = localStorage.getItem('pekeos_theme_v1');
    if(raw) { window.applySettings(JSON.parse(raw)); }
  }catch(e){}
})();

</script>
</body>
</html>
