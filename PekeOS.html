<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PekeOS</title>

<style>
/* ============================
      VARIABLES DEL SISTEMA
============================ */
:root{
  --main-color: #00ffd0;
  --bg: #111;
  --taskbar-bg: #222;
  --window-opacity: 1;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}

body,html{
  width:100%;height:100%;overflow:hidden;
  background:var(--bg);
}

/* ============================
      ESCRITORIO
============================ */
#desktop{
  position:relative;
  width:100%;height:100%;
  background:var(--bg);
  background-size:cover;
  background-position:center;
}

/* ============================
      ICONOS
============================ */
.icons .icon{
  width:70px;text-align:center;cursor:pointer;position:absolute;
}

.icon .thumb{
  width:64px;height:64px;background:#222;border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  font-size:26px;color:var(--main-color);
  border:2px solid var(--main-color);
}

.icon span{margin-top:6px;display:block;color:var(--main-color);}

/* ============================
      TASKBAR
============================ */
.taskbar{
  position:fixed;bottom:0;left:0;right:0;
  height:42px;background:var(--taskbar-bg);
  border-top:3px solid var(--main-color);
  display:flex;align-items:center;justify-content:space-between;
  padding:4px 10px;z-index:50;
}
#clock{color:var(--main-color);}

/* ============================
      VENTANAS
============================ */
.win{
  position:absolute;width:520px;height:360px;
  background:#000000cc;
  border:2px solid var(--main-color);
  border-radius:8px;
  backdrop-filter:blur(6px);
  box-shadow:0 0 20px #000;
  display:flex;flex-direction:column;
}

.titlebar{
  background:#00000088;
  height:28px;display:flex;align-items:center;
  padding:0 8px;cursor:grab;color:white;
  border-bottom:1px solid #555;
}

.controls{margin-left:auto;display:flex;gap:6px;}
.btn{
  width:22px;height:22px;background:#222;
  border:1px solid #444;color:white;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;border-radius:4px;
}
.btn:hover{background:#333;}

.content{
  flex:1;background:#000;overflow:hidden;
}
.content iframe{
  width:100%;height:100%;border:0;
}

/* Start Menu (opcional) */
.startmenu{
  position:fixed;bottom:45px;left:10px;
  width:220px;background:#111;border:2px solid var(--main-color);
  display:none;flex-direction:column;padding:6px;
}

.start-item{
  padding:6px;color:white;cursor:pointer;border-radius:4px;
}
.start-item:hover{background:#333;}

</style>
</head>
<body>

<!-- ============================
      ESCRITORIO
============================ -->
<div id="desktop">

<div class="icons">

  <!-- ARCHIVOS -->
  <div class="icon" style="top:20px;left:20px;" data-app="archivos.html">
    <div class="thumb">üìÅ</div><span>Archivos</span>
  </div>

  <!-- AJUSTES -->
  <div class="icon" style="top:110px;left:20px;" data-app="ajustes.html">
    <div class="thumb">‚öôÔ∏è</div><span>Ajustes</span>
  </div>

</div>

</div>

<!-- ============================
      TASKBAR
============================ -->
<div class="taskbar">
  <div id="startBtn" style="cursor:pointer;color:var(--main-color);font-size:18px;">‚ò∞</div>
  <div id="clock"></div>
</div>

<!-- Start Menu -->
<div class="startmenu" id="startMenu">
  <div class="start-item" data-open="archivos.html">üìÇ Archivos</div>
  <div class="start-item" data-open="ajustes.html">‚öôÔ∏è Ajustes</div>
</div>

<!-- ============================
      PLANTILLA VENTANA
============================ -->
<template id="winTpl">
  <div class="win">
    <div class="titlebar"><span class="title">Ventana</span>
      <div class="controls">
        <div class="btn" data-action="min">‚àí</div>
        <div class="btn" data-action="max">‚¨ú</div>
        <div class="btn" data-action="close">√ó</div>
      </div>
    </div>
    <div class="content"></div>
  </div>
</template>

<script>
/* ============================
      RELOJ
============================ */
function updateClock(){
  const d = new Date();
  document.getElementById("clock").innerText =
    d.getHours().toString().padStart(2,"0")+":"+
    d.getMinutes().toString().padStart(2,"0");
}
setInterval(updateClock,1000); updateClock();

/* ============================
      START MENU
============================ */
const startBtn = document.getElementById("startBtn");
const startMenu = document.getElementById("startMenu");

startBtn.onclick = ()=>{
  startMenu.style.display = startMenu.style.display === "flex" ? "none" : "flex";
};

document.addEventListener("click",(e)=>{
  if(!startMenu.contains(e.target) && e.target!==startBtn){
    startMenu.style.display="none";
  }
});

/* ============================
      CREAR VENTANAS
============================ */
const tpl = document.getElementById("winTpl");

function createWindow(title, src){
  const win = tpl.content.firstElementChild.cloneNode(true);
  win.querySelector(".title").textContent = title;

  const iframe = document.createElement("iframe");
  iframe.src = src;
  win.querySelector(".content").appendChild(iframe);

  win.style.left = "200px";
  win.style.top = "120px";

  document.body.appendChild(win);

  makeDraggable(win);
  attachControls(win);

  return win;
}

document.querySelectorAll(".icon").forEach(icon=>{
  icon.ondblclick = ()=>{
    createWindow(icon.querySelector("span").textContent, icon.dataset.app);
  };
});

document.querySelectorAll(".start-item").forEach(item=>{
  item.onclick = ()=>{
    createWindow(item.textContent.trim(), item.dataset.open);
    startMenu.style.display="none";
  };
});

/* ============================
      DRAG
============================ */
function makeDraggable(win){
  const bar = win.querySelector(".titlebar");
  let drag=false, ox, oy, sx, sy;

  bar.addEventListener("mousedown",(e)=>{
    drag=true;
    ox=e.clientX; oy=e.clientY;
    sx=parseInt(win.style.left)||0;
    sy=parseInt(win.style.top)||0;

    document.onmousemove = move;
    document.onmouseup = stop;
  });

  function move(e){
    if(!drag) return;
    win.style.left = sx + (e.clientX-ox) + "px";
    win.style.top  = sy + (e.clientY-oy) + "px";
  }
  function stop(){
    drag=false;
    document.onmousemove=null;
    document.onmouseup=null;
  }
}

/* ============================
      CONTROLES
============================ */
function attachControls(win){
  win.querySelectorAll(".btn").forEach(btn=>{
    const a = btn.dataset.action;

    btn.onclick = ()=>{
      if(a==="close") win.remove();
      if(a==="min") win.style.display="none";
      if(a==="max"){
        if(win.dataset.max==="1"){
          win.dataset.max="0";
          win.style.width="520px";
          win.style.height="360px";
        } else{
          win.dataset.max="1";
          win.style.left="0";
          win.style.top="0";
          win.style.width=window.innerWidth+"px";
          win.style.height=(window.innerHeight-45)+"px";
        }
      }
    };
  });
}

/* ============================
      SISTEMA DE AJUSTES NUEVO
============================ */
function aplicarAjustes(){
  const settings = JSON.parse(localStorage.getItem("pekeos_settings")||"{}");

  // Fondo
  if(settings.wallpaper){
    const d = document.getElementById("desktop");
    d.style.backgroundImage = `url(${settings.wallpaper})`;
  }

  // Tema
  if(settings.theme){
    if(settings.theme==="dark"){
      document.documentElement.style.setProperty("--main-color","#00ffd0");
      document.documentElement.style.setProperty("--bg","#111");
      document.documentElement.style.setProperty("--taskbar-bg","#222");
    }
    if(settings.theme==="light"){
      document.documentElement.style.setProperty("--main-color","#0066ff");
      document.documentElement.style.setProperty("--bg","#e5e5e5");
      document.documentElement.style.setProperty("--taskbar-bg","#fff");
    }
  }

  // Opacidad ventanas
  if(settings.opacity){
    document.documentElement.style.setProperty("--window-opacity", settings.opacity);
    document.querySelectorAll(".win").forEach(w=>{
      w.style.background = `rgba(0,0,0,${settings.opacity})`;
    });
  }
}

// Ejecutar al iniciar
aplicarAjustes();

// Escuchar cambios desde ajustes.html
window.addEventListener("storage",(e)=>{
  if(e.key==="pekeos_update"){
    aplicarAjustes();
  }
});
</script>

</body>
</html>
