<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PekeOS - Prototype (Windows95 Halloween)</title>
  <style>
*{box-sizing:border-box;font-family: 'MS Sans Serif', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
html,body{height:100%;margin:0;background:#111;color:#fff}


body{
background: radial-gradient(circle at 10% 10%, #2b0e0e 0%, #0b0406 40%), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="%23ff6f00" stop-opacity="0.12"/><stop offset="1" stop-color="%23000000" stop-opacity="0"/></linearGradient></defs><rect width="100%" height="100%" fill="black"/><circle cx="700" cy="80" r="60" fill="%23ffd27f"/><g opacity="0.08"><rect x="0" y="0" width="100%" height="100%" fill="url(%23g)"/></g></svg>') center/cover no-repeat;
overflow:hidden;
}


.taskbar{position:fixed;left:0;right:0;bottom:0;height:42px;background:#222;border-top:3px solid #444;display:flex;align-items:center;padding:4px 6px;gap:8px;color:#fff}
.start-btn{display:flex;align-items:center;gap:6px;padding:6px 10px;background:#333;border:2px solid #555;box-shadow:inset 1px 1px 0 rgba(255,255,255,.1);cursor:pointer;color:#fff}
.start-btn img{width:22px;height:22px}
.tray{margin-left:auto;display:flex;gap:8px;align-items:center;color:#fff}
.clock{background:#333;padding:4px 8px;border:2px solid #555;color:#fff}


.desktop{position:relative;height:calc(100% - 42px);padding:16px}
.icons{display:flex;flex-wrap:wrap;gap:14px}
.icon{width:70px;text-align:center;cursor:pointer}
.icon .thumb{width:64px;height:64px;border:2px solid #666;background:#000;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
.icon span{display:block;margin-top:6px;color:#ffe9b6}


.win{position:absolute;width:520px;background:#000;border:2px solid #ff6f00;box-shadow:6px 6px 0 rgba(0,0,0,.8);display:flex;flex-direction:column;color:#fff}
.titlebar{height:28px;background:linear-gradient(#111,#333);color:#fff;display:flex;align-items:center;padding:0 6px;gap:8px;user-select:none}
.titlebar .title{flex:1;font-size:13px}
.titlebar .controls{display:flex;gap:6px}
.btn{width:20px;height:20px;border:2px solid #111;background:#222;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer}
.content{padding:10px;background:#000;flex:1;overflow:auto;color:#fff}


.start-menu{position:fixed;left:8px;bottom:50px;width:240px;background:#000;border:2px solid #ff6f00;padding:8px;box-shadow:6px 6px 0 rgba(0,0,0,.8);display:none;color:#fff}
.start-menu h3{margin:4px 0 10px;color:#fff}
.start-menu button{display:block;width:100%;padding:6px;margin-bottom:6px;text-align:left;background:#222;color:#fff;border:1px solid #444;cursor:pointer}


.arcade-iframe{width:100%;height:420px;border:2px solid #ff6f00}
.newspaper{display:flex;gap:12px}
.paper{background:#111;color:#fff;padding:10px;border-radius:4px;flex:1;min-height:300px;border:1px solid #444}
.chat-log{height:300px;overflow:auto;background:#111;color:#fff;padding:8px;border-radius:4px;border:1px solid #444}
.chat-input{margin-top:8px;display:flex;gap:6px}
.chat-input input{flex:1;padding:6px;background:#000;color:#fff;border:1px solid #444}
.chat-input button{background:#222;color:#fff;border:1px solid #444;padding:6px;cursor:pointer}


.file-list{max-height:260px;overflow:auto;background:#111;padding:8px;border-radius:4px;color:#fff;border:1px solid #444}
.file-item{padding:6px;border-bottom:1px dashed #444;cursor:pointer}


.pumpkin{width:22px;height:22px;background:orange;border-radius:50%;display:inline-block;vertical-align:middle;margin-right:6px}
.h1{color:#ffb86b}


.hidden{display:none}
button,input,select,textarea{font-family:inherit}


@media (max-width:700px){.win{width:92%!important}}
</style>
  </style>
</head>
<body>
  <div class="desktop">
    <div class="icons">
      <div class="icon" data-app="arcade"><div class="thumb">A</div><span>Zona Arcade</span></div>
      <div class="icon" data-app="newspaper"><div class="thumb">N</div><span>Peri√≥dicos</span></div>
      <div class="icon" data-app="chat"><div class="thumb">C</div><span>Chat</span></div>
      <div class="icon" data-app="files"><div class="thumb">F</div><span>Archivos</span></div>
      <div class="icon" data-app="settings"><div class="thumb">S</div><span>Ajustes</span></div>
    </div>
  </div>

  <div class="taskbar">
    <div class="start-btn" id="startBtn"><div class="pumpkin" title="Halloween"></div><strong>PekeOS</strong></div>
    <div id="taskButtons"></div>
    <div class="tray">
      <div class="clock" id="clock">00:00</div>
    </div>
  </div>

  <div class="start-menu" id="startMenu">
    <h3>Inicio</h3>
    <button data-launch="arcade">üéÆ Zona Arcade</button>
    <button data-launch="newspaper">üì∞ Peri√≥dicos</button>
    <button data-launch="chat">üí¨ Chat</button>
    <button data-launch="files">üóÇÔ∏è Archivos</button>
    <button data-launch="settings">‚öôÔ∏è Ajustes</button>
    <hr>
    <button id="signOut">Cerrar sesi√≥n (limpiar)</button>
  </div>

  <!-- Templates for windows (cloned) -->
  <template id="winTpl">
    <div class="win" data-wid="">
      <div class="titlebar"><div class="title">Ventana</div>
        <div class="controls">
          <div class="btn" data-action="min">_</div>
          <div class="btn" data-action="max">‚¨ú</div>
          <div class="btn" data-action="close">X</div>
        </div>
      </div>
      <div class="content">Contenido</div>
    </div>
  </template>

  <script>
    // Simple window manager for PekeOS prototype
    const desktop = document.querySelector('.desktop');
    const tpl = document.getElementById('winTpl');
    const taskButtons = document.getElementById('taskButtons');
    const startBtn = document.getElementById('startBtn');
    const startMenu = document.getElementById('startMenu');
    const clockEl = document.getElementById('clock');

    let zIndex = 10; // stacking
    let windows = {}; // wid -> element

    function nowTime(){
      const d=new Date();
      return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }
    clockEl.textContent = nowTime();
    setInterval(()=>clockEl.textContent = nowTime(), 30*1000);

    // Helper: create window
    function createWindow({title='Ventana', contentEl=null, id=null, x=60,y=60,w=520,h=360}){
      const node = tpl.content.firstElementChild.cloneNode(true);
      const wid = id || 'w_'+Date.now();
      node.dataset.wid = wid;
      node.style.left = x + 'px';
      node.style.top = y + 'px';
      node.style.width = w + 'px';
      node.style.height = h + 'px';
      node.querySelector('.title').textContent = title;
      const content = node.querySelector('.content');
      content.innerHTML = '';
      if(contentEl) content.appendChild(contentEl);

      makeDraggable(node);
      makeResizable(node);
      attachControls(node);
      document.body.appendChild(node);
      focusWindow(node);

      windows[wid] = node;
      addTaskButton(wid,title);
      saveState();
      return node;
    }

    function focusWindow(node){
      node.style.zIndex = ++zIndex;
      node.classList.remove('minimized');
    }

    function addTaskButton(wid,title){
      const btn = document.createElement('button');
      btn.textContent = title;
      btn.dataset.wid = wid;
      btn.onclick = ()=>{
        const w = windows[wid];
        if(!w) return;
        if(w.classList.contains('minimized')){
          w.classList.remove('minimized');
          w.style.display='flex';
        }
        focusWindow(w);
      };
      taskButtons.appendChild(btn);
    }

    function removeTaskButton(wid){
      const b = taskButtons.querySelector('[data-wid="'+wid+'"]');
      if(b) b.remove();
    }

    function attachControls(node){
      const wid=node.dataset.wid;
      node.querySelectorAll('.btn').forEach(b=>{
        b.addEventListener('click',()=>{
          const a=b.dataset.action;
          if(a==='close'){
            node.remove(); delete windows[wid]; removeTaskButton(wid); saveState();
          }else if(a==='min'){
            node.classList.add('minimized'); node.style.display='none'; saveState();
          }else if(a==='max'){
            if(node.dataset.maxed==='1'){
              node.style.left=node.dataset.prevLeft; node.style.top=node.dataset.prevTop; node.style.width=node.dataset.prevWidth; node.style.height=node.dataset.prevHeight; node.dataset.maxed='0';
            }else{
              node.dataset.prevLeft=node.style.left; node.dataset.prevTop=node.style.top; node.dataset.prevWidth=node.style.width; node.dataset.prevHeight=node.style.height;
              node.style.left='6px'; node.style.top='6px'; node.style.width=(window.innerWidth-12)+'px'; node.style.height=(window.innerHeight-72)+'px'; node.dataset.maxed='1';
            }
            saveState();
          }
        });
      });

      node.addEventListener('mousedown',()=>focusWindow(node));
    }

    // Draggable (titlebar)
    function makeDraggable(el){
      const title = el.querySelector('.titlebar');
      let ox,oy,dx,dy,drag=false;
      title.addEventListener('mousedown', (e)=>{
        drag=true; ox=e.clientX; oy=e.clientY; dx=parseInt(el.style.left)||0; dy=parseInt(el.style.top)||0; focusWindow(el);
        document.addEventListener('mousemove',move);
        document.addEventListener('mouseup',up);
      });
      function move(e){
        if(!drag) return;
        el.style.left = (dx + (e.clientX-ox)) + 'px';
        el.style.top  = (dy + (e.clientY-oy)) + 'px';
      }
      function up(){drag=false; document.removeEventListener('mousemove',move); document.removeEventListener('mouseup',up); saveState();}
    }

    // Resizable using bottom-right corner
    function makeResizable(el){
      const grip = document.createElement('div');
      grip.style.width='12px'; grip.style.height='12px'; grip.style.position='absolute'; grip.style.right='2px'; grip.style.bottom='2px'; grip.style.cursor='nwse-resize'; grip.style.background='transparent';
      el.appendChild(grip);
      let startX,startY,startW,startH,resizing=false;
      grip.addEventListener('mousedown',(e)=>{e.stopPropagation();resizing=true;startX=e.clientX;startY=e.clientY;startW=el.offsetWidth;startH=el.offsetHeight;document.addEventListener('mousemove',resize);document.addEventListener('mouseup',stop);});
      function resize(e){ if(!resizing) return; el.style.width = Math.max(220, startW + (e.clientX-startX)) + 'px'; el.style.height = Math.max(120, startH + (e.clientY-startY)) + 'px'; }
      function stop(){resizing=false;document.removeEventListener('mousemove',resize);document.removeEventListener('mouseup',stop);saveState();}
    }

    // Start menu
    startBtn.addEventListener('click',()=>{ startMenu.style.display = startMenu.style.display==='block'?'none':'block'; });
    document.addEventListener('click',(e)=>{ if(!startMenu.contains(e.target) && !startBtn.contains(e.target)) startMenu.style.display='none'; });

    // Launchers
    document.querySelectorAll('[data-app]').forEach(el=>el.addEventListener('dblclick', ()=>launchApp(el.dataset.app)));
    document.querySelectorAll('#startMenu button[data-launch]').forEach(b=>b.addEventListener('click',()=>{startMenu.style.display='none'; launchApp(b.dataset.launch)}));

    document.getElementById('signOut').addEventListener('click',()=>{ if(confirm('Limpiar datos de PekeOS? Esto cerrar√° la sesi√≥n local.')){localStorage.removeItem('peke_state'); location.reload();}});

    function launchApp(name){
      if(name==='arcade'){
        const el = document.createElement('div');
        el.innerHTML = '<div style="display:flex;align-items:center;gap:8px"><div class="pumpkin"></div><h1 class="h1">Zona Arcade</h1></div><p>Aqu√≠ puedes incrustar tus juegos. Ejemplo: juego simple embebido abajo (placeholder).</p>';
        const iframe = document.createElement('iframe'); iframe.className='arcade-iframe'; iframe.srcdoc = '<!doctype html><html><body style="margin:0;display:flex;align-items:center;justify-content:center;background:#111;color:#fff"><h2>Juego Placeholder</h2></body></html>';
        el.appendChild(iframe);
        createWindow({title:'Zona Arcade', contentEl:el, w:760,h:520,x:80,y:40});
      }
      if(name==='newspaper'){
        const el = document.createElement('div');
        el.innerHTML = '<div class="newspaper"><div class="paper"><h2>Peri√≥dico - Peke</h2><p>Edici√≥n especial Halloween. Noticias, mini-cr√≥nicas y anuncios de la comunidad.</p><p>‚Äî ¬°Gran torneo arcade este s√°bado!</p></div><div class="paper"><h3>Peri√≥dico Amigo</h3><p>Versi√≥n p√∫blica del peri√≥dico de tu amigo (simulada). Puedes pegar el contenido real aqu√≠ si lo deseas.</p></div></div>';
        createWindow({title:'Peri√≥dicos', contentEl:el, w:760,h:420,x:120,y:80});
      }
      if(name==='chat'){
        const el = document.createElement('div');
        el.innerHTML = '<div class="chat-log" id="chatLog"></div><div class="chat-input"><input id="chatMsg" placeholder="Escribe mensaje..." /><button id="sendMsg">Enviar</button></div>';
        createWindow({title:'Chat del Sistema', contentEl:el, w:420,h:380,x:200,y:120});
        initChat();
      }
      if(name==='files'){
        const el = document.createElement('div');
        el.innerHTML = '<div style="display:flex;gap:10px"><div style="flex:1"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><strong>Archivos</strong><div><button id="newFile">Nuevo</button></div></div><div class="file-list" id="fileList"></div></div><div style="flex:2"><div id="editorHolder"></div></div></div>';
        createWindow({title:'Explorador de Archivos', contentEl:el, w:760,h:460,x:100,y:70});
        initFiles();
      }
      if(name==='settings'){
        const el = document.createElement('div');
        el.innerHTML = '<h3>Ajustes</h3><label>Tema: <select id="themeSel"><option value="halloween">Halloween (por defecto)</option><option value="classic">Classic</option></select></label><div style="margin-top:8px"><button id="saveSettings">Guardar</button></div><p style="margin-top:8px;color:#ffd">Tip: puedes arrastrar las ventanas con la barra superior. Doble click en iconos para abrir.</p>';
        createWindow({title:'Ajustes', contentEl:el, w:420,h:260,x:260,y:140});
        document.getElementById('themeSel').value = localStorage.getItem('peke_theme') || 'halloween';
        document.getElementById('saveSettings').addEventListener('click', ()=>{localStorage.setItem('peke_theme', document.getElementById('themeSel').value); applyTheme(); alert('Ajustes guardados');});
      }
    }

    // Chat implementation (local only)
    function initChat(){
      const log = document.getElementById('chatLog');
      const input = document.getElementById('chatMsg');
      const send = document.getElementById('sendMsg');
      const key = 'peke_chat';
      function render(){
        const arr = JSON.parse(localStorage.getItem(key)||'[]');
        log.innerHTML = arr.map(m=>'<div style="padding:6px;border-bottom:1px dashed #ddd"><strong>'+escapeHtml(m.u)+'</strong>: '+escapeHtml(m.t)+'</div>').join('');
        log.scrollTop = log.scrollHeight;
      }
      send.onclick = ()=>{ const v=input.value.trim(); if(!v) return; const arr=JSON.parse(localStorage.getItem(key)||'[]'); arr.push({u:'Usuario',t:v,ts:Date.now()}); localStorage.setItem(key,JSON.stringify(arr)); input.value=''; render(); }
      render();
    }

    // Files implementation
    function initFiles(){
      const list = document.getElementById('fileList');
      const holder = document.getElementById('editorHolder');
      const key='peke_files';
      function renderList(){
        const files = JSON.parse(localStorage.getItem(key)||'[]');
        list.innerHTML = files.map((f,i)=>'<div class="file-item" data-i="'+i+'">'+escapeHtml(f.name)+'</div>').join('');
        list.querySelectorAll('.file-item').forEach(el=>el.addEventListener('click',()=>openFile(el.dataset.i)));
      }
      function openFile(i){ const files=JSON.parse(localStorage.getItem(key)||'[]'); const f=files[i]; holder.innerHTML = '<div style="display:flex;flex-direction:column;height:100%"><div style="display:flex;justify-content:space-between;align-items:center"><strong>'+escapeHtml(f.name)+'</strong><div><button id="saveFile">Guardar</button></div></div><textarea id="fileEditor" style="flex:1;margin-top:6px;padding:8px">'+escapeHtml(f.content)+'</textarea></div>';
        document.getElementById('saveFile').addEventListener('click',()=>{ const files=JSON.parse(localStorage.getItem(key)||'[]'); files[i].content = document.getElementById('fileEditor').value; localStorage.setItem(key,JSON.stringify(files)); alert('Guardado'); renderList(); saveState(); });
      }
      document.getElementById('newFile').addEventListener('click', ()=>{ const name = prompt('Nombre del archivo:','nota.txt'); if(!name) return; const files=JSON.parse(localStorage.getItem(key)||'[]'); files.push({name,content:''}); localStorage.setItem(key,JSON.stringify(files)); renderList(); saveState(); });
      renderList();
    }

    // Minimal persistence: save windows' position & files & theme
    function saveState(){
      const state = {wins:[],theme:localStorage.getItem('peke_theme')||'halloween'};
      for(const wid in windows){ const w = windows[wid]; state.wins.push({id:wid,left:w.style.left,top:w.style.top,width:w.style.width,height:w.style.height,display:(w.style.display||'flex')}); }
      localStorage.setItem('peke_state', JSON.stringify(state));
    }
    function restoreState(){
      try{
        const state = JSON.parse(localStorage.getItem('peke_state')||'null');
        if(!state) return;
        if(state.theme) localStorage.setItem('peke_theme', state.theme);
        state.wins.forEach(w=>{
          // We'll recreate simple windows with same dims (content not restored)
          const el = document.createElement('div'); el.innerHTML='<div class="titlebar"><div class="title">Restored</div><div class="controls"><div class="btn" data-action="min">_</div><div class="btn" data-action="max">‚¨ú</div><div class="btn" data-action="close">X</div></div></div><div class="content">Ventana restaurada (contenido temporal)</div>';
          const wrapper = tpl.content.firstElementChild.cloneNode(true);
          wrapper.dataset.wid = w.id; wrapper.style.left = w.left; wrapper.style.top = w.top; wrapper.style.width = w.width; wrapper.style.height = w.height; wrapper.querySelector('.title').textContent = 'Ventana restaurada'; wrapper.querySelector('.content').innerHTML = 'Contenido restaurado (temporal)';
          makeDraggable(wrapper); makeResizable(wrapper); attachControls(wrapper); document.body.appendChild(wrapper); windows[w.id]=wrapper; addTaskButton(w.id,'Ventana restaurada');
        });
      }catch(e){console.warn('restore failed',e)}
    }

    function applyTheme(){
      const t = localStorage.getItem('peke_theme') || 'halloween';
      if(t==='halloween'){
        document.body.style.background = "radial-gradient(circle at 10% 10%, #2b0e0e 0%, #0b0406 40%), url('data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'800\' height=\'600\'><rect width=\'100%\' height=\'100%\' fill=\'black\'/><circle cx=\'700\' cy=\'80\' r=\'60\' fill=\'%23ffd27f\'/></svg>') center/cover no-repeat";
      }else{
        document.body.style.background = 'linear-gradient(#8ba6ff,#eaf0ff)';
      }
    }

    function escapeHtml(s){ return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // Initial restore
    applyTheme(); restoreState();

    // Simple demo: open desktop icons with double-click
    document.querySelectorAll('.icon').forEach(ic=>ic.addEventListener('dblclick', ()=>launchApp(ic.dataset.app)));

    // Right-click disabled on desktop to avoid menu troubles
    desktop.addEventListener('contextmenu', (e)=>{ e.preventDefault(); });

    // Accessibility: open an About window on load
    createWindow({title:'Bienvenido a PekeOS', contentEl:(()=>{const d=document.createElement('div'); d.innerHTML='<h2 class="h1">PekeOS</h2><p>Bienvenido. Doble clic en iconos para abrir apps. Tema: Halloween (por ahora).</p>'; return d})(), x:120,y:80,w:480,h:240});

    // Save before unload
    window.addEventListener('beforeunload', saveState);
  </script>
</body>
</html>
