<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PekeOS ‚Äî Ne√≥n (Taskbar & Ventanas)</title>
<style>
/* ================== RESET ================== */
:root{
  --accent: #00ffd0;
  --bg-1: linear-gradient(180deg,#05060a 0%, #07121b 100%);
  --taskbar-bg: rgba(10,12,14,0.35);
  --win-opacity: 1;
}
* { box-sizing: border-box; margin:0; padding:0; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
html,body { height:100%; width:100%; background:var(--bg-1); color:#cfeff0; overflow:hidden; }

/* ================== WALLPAPER (falso) ================== */
#desktop {
  position:relative; width:100%; height:100%;
  background:
    radial-gradient(800px 300px at 10% 20%, rgba(0,255,208,0.03), transparent 8%),
    radial-gradient(600px 200px at 90% 80%, rgba(0,155,255,0.02), transparent 6%),
    url('') center/cover no-repeat;
  padding:18px;
  transition:background 300ms;
}

/* ================== ICONOS DEL ESCRITORIO ================== */
.icons { position:absolute; inset:0; }
.icon {
  width:88px; text-align:center; cursor:pointer; position:absolute; user-select:none;
  transition: transform .14s ease, box-shadow .14s;
}
.icon:hover { transform: translateY(-6px) scale(1.06); }
.icon .thumb {
  width:68px; height:68px; border-radius:14px;
  display:flex; align-items:center; justify-content:center; font-size:34px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(0,255,208,0.08);
  box-shadow: 0 6px 20px rgba(0,0,0,0.6), 0 0 14px rgba(0,255,208,0.04);
  color:var(--accent);
  text-shadow:0 0 8px rgba(0,255,208,0.25);
}
.icon span { display:block; margin-top:8px; color:var(--accent); font-size:12px; text-shadow:0 0 6px rgba(0,0,0,0.6); }

/* ================== TASKBAR (Ne√≥n) ================== */
.taskbar {
  position:fixed; left:12px; right:12px; bottom:12px; height:56px;
  display:flex; align-items:center; gap:12px; padding:8px;
  background:var(--taskbar-bg); backdrop-filter: blur(8px) saturate(120%);
  border-radius:14px; border:1px solid rgba(0,255,208,0.08);
  box-shadow: 0 10px 40px rgba(2,8,12,0.6), 0 0 30px rgba(0,255,208,0.03);
  z-index:1000;
}

/* Start button */
.start-btn {
  width:44px; height:44px; display:flex; align-items:center; justify-content:center;
  background:linear-gradient(180deg, rgba(0,255,208,0.06), rgba(0,255,208,0.03));
  border-radius:10px; cursor:pointer; border:1px solid rgba(0,255,208,0.12);
  transition:transform .15s;
}
.start-btn:hover { transform:scale(1.06); }
.start-btn img { width:30px; height:30px; filter: drop-shadow(0 6px 10px rgba(0,255,208,0.08)); }

/* Task apps area */
.task-apps { display:flex; gap:8px; align-items:center; padding-left:8px; flex:1; }

/* Task button */
.task-btn {
  display:flex; gap:8px; align-items:center; padding:6px 10px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:10px; border:1px solid rgba(0,255,208,0.06); color:#bfffee; cursor:pointer;
  box-shadow: 0 4px 18px rgba(0,0,0,0.6);
}
.task-btn .label { font-size:13px; color:#b6fff4; }
.task-btn.active {
  outline: 2px solid rgba(0,255,208,0.18);
  box-shadow:0 8px 40px rgba(0,255,208,0.06), 0 2px 10px rgba(0,0,0,0.6) inset;
}

/* Clock */
.clock {
  min-width:72px; text-align:right; color:var(--accent); font-weight:600; font-size:14px;
}

/* ================== START MENU (panel) ================== */
#startMenu {
  position:fixed; left:20px; bottom:82px; width:320px; max-width:calc(100% - 40px);
  background:linear-gradient(180deg, rgba(10,12,14,0.9), rgba(6,8,10,0.85));
  border-radius:12px; padding:12px; z-index:1200;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  border:1px solid rgba(0,255,208,0.06);
  display:none; flex-direction:column; gap:10px;
  backdrop-filter: blur(6px);
}

/* Search */
.start-search {
  display:flex; gap:8px; align-items:center;
  background:rgba(255,255,255,0.02); border-radius:8px; padding:8px;
  border:1px solid rgba(255,255,255,0.02);
}
.start-search input{
  flex:1; background:transparent; border:0; color:#cfeff0; outline:none; font-size:14px;
}

/* Categories */
.start-cats { display:flex; gap:8px; flex-wrap:wrap; }
.cat { padding:8px 10px; border-radius:8px; background:rgba(0,255,208,0.03); color:#9fffe9; font-weight:600; cursor:pointer; border:1px solid rgba(0,255,208,0.04); }

/* Apps list */
.start-list { display:flex; flex-direction:column; gap:6px; max-height:260px; overflow:auto; padding-right:6px; }
.start-item {
  display:flex; gap:10px; align-items:center; padding:8px; border-radius:8px;
  cursor:pointer; color:#bfffee; border:1px solid transparent;
}
.start-item:hover { background:rgba(0,255,208,0.03); border-color:rgba(0,255,208,0.04); }

/* ================== VENTANAS ================== */
.win {
  position:absolute; width:640px; height:420px; background:linear-gradient(180deg, rgba(6,8,10,0.96), rgba(8,10,12,0.96));
  border-radius:12px; border:1px solid rgba(0,255,208,0.06);
  box-shadow: 0 30px 80px rgba(2,10,16,0.6), 0 0 40px rgba(0,255,208,0.02);
  overflow:hidden; display:flex; flex-direction:column; transition:transform .18s ease, opacity .18s;
}

/* titlebar */
.titlebar {
  height:44px; display:flex; align-items:center; gap:10px; padding:8px 12px;
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-bottom:1px solid rgba(255,255,255,0.02);
  user-select:none;
}
.titlebar .title { color:#e6fff9; font-weight:700; font-size:14px; flex:1; text-shadow:0 0 6px rgba(0,255,208,0.06); }
.controls { display:flex; gap:8px; align-items:center; }

/* control buttons */
.win-btn {
  width:30px; height:30px; border-radius:8px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; border:1px solid rgba(255,255,255,0.02);
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
.win-btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,0.6); }

/* content (iframe) */
.win .content { flex:1; background:#000; display:flex; }
.win .content iframe { width:100%; height:100%; border:0; }

/* resizers (esquinas) */
.resizer {
  position:absolute; width:14px; height:14px; right:0; bottom:0; cursor:se-resize; z-index:60;
  background:linear-gradient(135deg, rgba(255,255,255,0.02), transparent);
}
.win.maxed { border-radius:6px !important; }

/* small helpers */
.hidden { display:none !important; }

/* responsive */
@media (max-width:720px){
  .win { width:92%; height:70%; left:4% !important; top:12% !important; }
  .taskbar { left:8px; right:8px; bottom:8px; padding:6px; }
}
  #bootScreen {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, #0a0f14 0%, #020507 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999999;
  animation: fadeOut 1s ease forwards;
  animation-delay: 2.7s; /* Duraci√≥n total */
}

.boot-logo {
  text-align: center;
  color: #00ffd0;
  text-shadow: 0 0 10px #00ffd0aa;
  animation: fadeIn 0.8s ease;
}

.boot-logo img {
  width: 120px;
  filter: drop-shadow(0 0 12px #00ffd088);
  margin-bottom: 20px;
}

.boot-logo h1 {
  font-size: 32px;
  margin: 0;
}

.boot-logo p {
  opacity: 0.8;
  margin-top: 6px;
}

/* Loader */
.loader {
  margin: 26px auto 0;
  width: 60px;
  height: 6px;
  background: rgba(0,255,208,0.2);
  border-radius: 6px;
  overflow: hidden;
  position: relative;
}
.loader::before{
  content:"";
  position:absolute;
  left:-40px; top:0;
  width:40px; height:100%;
  background:#00ffd0;
  border-radius:6px;
  animation: loadingBar 1.2s infinite ease-in-out;
}

/* Animaciones */
@keyframes loadingBar {
  0% { left:-40px; }
  50% { left:100%; }
  100% { left:100%; }
}
@keyframes fadeOut {
  to { opacity:0; visibility:hidden; }
}
@keyframes fadeIn {
  from { opacity:0; transform:scale(0.95); }
  to { opacity:1; transform:scale(1); }
}
</style>
</head>
<body>

  <div id="bootScreen">
  <div class="boot-logo">
    <img src="PekeOSmini.png" alt="PekeOS">
    <h1>PekeOS</h1>
    <p>Cargando sistema...</p>
    <div class="loader"></div>
  </div>
</div>
  
  <div id="desktop">
    <div class="icons">
      <!-- Tus iconos originales (mantenidos) -->
      <div class="icon" data-app="golf.html" style="top:10px; left:10px;"><div class="thumb">üïπÔ∏è</div><span>Zona Arcade</span></div>
      <div class="icon" data-app="prueba.html" style="top:100px; left:10px;"><div class="thumb">üé∞</div><span>Casino</span></div>

      <div class="icon" data-app="periodico.html" style="top:10px; right:10px;"><div class="thumb">üì∞</div><span>Noticias</span></div>
      <div class="icon" data-app="e.html" style="top:100px; right:10px;"><div class="thumb">üó≥Ô∏è</div><span>Encuestas</span></div>
      <div class="icon" data-app="po.html" style="top:190px; right:10px;"><div class="thumb">üìú</div><span>Partidos</span></div>
      <div class="icon" data-app="posts.html" style="top:280px; right:10px;"><div class="thumb">üìù</div><span>Posts PekeOS</span></div>

      <div class="icon" data-app="b.html" style="bottom:150px; left:10px;"><div class="thumb">üí¨</div><span>Blog</span></div>
      <div class="icon" data-app="chat.html" style="bottom:150px; left:110px;"><div class="thumb">‚úâÔ∏è</div><span>Pekemessages</span></div>
      
      <div class="icon" data-app="admin.html" style="bottom:150px; right:10px;"><div class="thumb">‚öôÔ∏è</div><span>Admin</span></div>
      <div class="icon" data-app="Pekeapuntes.html" style="bottom:240px; left:10px;"><div class="thumb">‚úèÔ∏è</div><span>Apuntes</span></div>
    </div>
  </div>

  <!-- TASKBAR -->
  <div class="taskbar" id="taskbar">
    <div class="start-btn" id="startBtn" title="Inicio">
      <img src="PekeOSmini.png" alt="PekeOS">
    </div>

    <div class="task-apps" id="taskApps"></div>

    <div class="clock" id="clock">00:00</div>
  </div>

  <!-- START MENU -->
  <div id="startMenu" role="dialog" aria-label="Menu inicio">
    <div class="start-search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.9"><path d="M21 21l-4.35-4.35" stroke="#9ef7ea" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="#9ef7ea" stroke-width="1.6"></circle></svg>
      <input id="startSearch" placeholder="Buscar apps y ajustes..." />
    </div>

    <div class="start-cats" id="startCats">
      <div class="cat" data-filter="all">Todo</div>
      <div class="cat" data-filter="ocio">Ocio</div>
      <div class="cat" data-filter="noticias">Noticias</div>
      <div class="cat" data-filter="redes">Redes</div>
      <div class="cat" data-filter="admin">Admin</div>
    </div>

    <div class="start-list" id="startList">
      <!-- Items generados por JS -->
    </div>
  </div>

  <!-- TEMPLATE VENTANA -->
  <template id="winTpl">
    <div class="win" data-winid="">
      <div class="titlebar">
        <div class="title">Ventana</div>
        <div class="controls">
          <div class="win-btn" data-action="min" title="Minimizar">‚îÄ</div>
          <div class="win-btn" data-action="max" title="Maximizar">‚ñ¢</div>
          <div class="win-btn" data-action="close" title="Cerrar">‚úï</div>
        </div>
      </div>
      <div class="content"></div>
      <div class="resizer"></div>
    </div>
  </template>

<script>

  // El bootScreen se elimina del DOM tras la animaci√≥n
setTimeout(()=> {
  const boot = document.getElementById("bootScreen");
  if(boot) boot.remove();
}, 3500);
  
/* ================== Reloj ================== */
function updateClock(){
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  document.getElementById('clock').textContent = `${h}:${m}`;
}
setInterval(updateClock,1000);
updateClock();

/* ================== Gestor de ventanas ================== */
const winTpl = document.getElementById('winTpl');
const taskAppsEl = document.getElementById('taskApps');
let zIndexCounter = 200;
let winCounter = 0;
const openWindows = new Map(); // winId -> {winEl, taskBtn, state}

/* Crear ventana (title, src) */
function createWindow(title='Ventana', src=null, opts={}){
  const node = winTpl.content.firstElementChild.cloneNode(true);
  const id = 'win_'+(++winCounter);
  node.dataset.winid = id;
  node.querySelector('.title').textContent = title;

  // contenido (iframe) si hay src
  if(src){
    const iframe = document.createElement('iframe');
    iframe.src = src;
    iframe.style.background = 'white';
    node.querySelector('.content').appendChild(iframe);
  } else {
    // placeholder
    const c = node.querySelector('.content');
    c.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;color:#9fffe3;width:100%">Contenido vac√≠o</div>';
  }

  // posicion aleatoria peque√±a para cascada
  node.style.left = (120 + Math.random()*140) + 'px';
  node.style.top = (80 + Math.random()*90) + 'px';
  node.style.zIndex = ++zIndexCounter;
  node.style.opacity = getComputedStyle(document.documentElement).getPropertyValue('--win-opacity') || 1;

  document.body.appendChild(node);
  makeDraggable(node);
  makeResizable(node);
  attachWindowControls(node);

  // crear bot√≥n en taskbar
  const taskBtn = document.createElement('div');
  taskBtn.className = 'task-btn';
  taskBtn.innerHTML = `<div class="label">${title}</div>`;
  taskAppsEl.appendChild(taskBtn);

  taskBtn.addEventListener('click', ()=>{
    // toggle minimize / restore
    const info = openWindows.get(id);
    if(!info) return;
    if(info.minimized){
      restoreWindow(id);
    } else {
      minimizeWindow(id);
    }
  });

  // enfocar al crear
  focusWindow(node);

  openWindows.set(id, { winEl: node, taskBtn, minimized:false, maxed:false });
  return id;
}

/* Focus (llevar al frente) */
function focusWindow(winEl){
  zIndexCounter++;
  winEl.style.zIndex = zIndexCounter;
  // marca activa en taskbar
  const id = winEl.dataset.winid;
  openWindows.forEach((v,k)=>{
    if(v.taskBtn) v.taskBtn.classList.toggle('active', k === id);
  });
}

/* Minimizar */
function minimizeWindow(id){
  const info = openWindows.get(id); if(!info) return;
  info.winEl.style.display = 'none';
  info.minimized = true;
  info.taskBtn.classList.remove('active');
}

/* Restaurar */
function restoreWindow(id){
  const info = openWindows.get(id); if(!info) return;
  info.winEl.style.display = 'flex';
  info.minimized = false;
  focusWindow(info.winEl);
}

/* Maximizar toggle */
function toggleMaximize(id){
  const info = openWindows.get(id); if(!info) return;
  const win = info.winEl;
  if(info.maxed){
    // restaurar
    win.classList.remove('maxed');
    // recuperar tama√±o previo si guardado
    if(win._prevRect){
      win.style.left = win._prevRect.left + 'px';
      win.style.top = win._prevRect.top + 'px';
      win.style.width = win._prevRect.width + 'px';
      win.style.height = win._prevRect.height + 'px';
    } else {
      win.style.width = '640px';
      win.style.height = '420px';
    }
    info.maxed = false;
  } else {
    // guardar rect
    win._prevRect = {
      left: parseInt(win.style.left)||win.getBoundingClientRect().left,
      top: parseInt(win.style.top)||win.getBoundingClientRect().top,
      width: win.getBoundingClientRect().width,
      height: win.getBoundingClientRect().height
    };
    win.style.left = '6px';
    win.style.top = '6px';
    win.style.width = (window.innerWidth - 12) + 'px';
    win.style.height = (window.innerHeight - 90) + 'px';
    win.classList.add('maxed');
    info.maxed = true;
  }
  focusWindow(info.winEl);
}

/* Cerrar */
function closeWindow(id){
  const info = openWindows.get(id); if(!info) return;
  info.winEl.remove();
  info.taskBtn.remove();
  openWindows.delete(id);
}

/* Attach controls */
function attachWindowControls(winEl){
  const id = winEl.dataset.winid;
  // focus on mousedown
  winEl.addEventListener('mousedown', ()=> focusWindow(winEl));

  // botones
  winEl.querySelectorAll('.win-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const a = btn.dataset.action;
      if(a === 'min') minimizeWindow(id);
      if(a === 'max') toggleMaximize(id);
      if(a === 'close') closeWindow(id);
    });
  });

  // doble click titlebar -> maximize
  const titlebar = winEl.querySelector('.titlebar');
  titlebar.addEventListener('dblclick', ()=> toggleMaximize(id));
}

/* ================== Drag (arrastrar ventana) ================== */
function makeDraggable(winEl){
  const bar = winEl.querySelector('.titlebar');
  let dragging=false, startX=0, startY=0, origX=0, origY=0;

  bar.addEventListener('mousedown', (e)=>{
    if(e.button !== 0) return;
    dragging = true;
    startX = e.clientX;
    startY = e.clientY;
    const rect = winEl.getBoundingClientRect();
    origX = rect.left; origY = rect.top;
    winEl.style.transition = 'none';
    focusWindow(winEl);
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  });

  function onMove(e){
    if(!dragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    winEl.style.left = (origX + dx) + 'px';
    winEl.style.top = (origY + dy) + 'px';
  }
  function onUp(){
    dragging = false;
    winEl.style.transition = '';
    document.removeEventListener('mousemove', onMove);
    document.removeEventListener('mouseup', onUp);
  }
}

/* ================== Resize (redimensionar) ================== */
function makeResizable(winEl){
  const resizer = winEl.querySelector('.resizer');
  let resizing=false, startX=0, startY=0, startW=0, startH=0;
  resizer.addEventListener('mousedown', (e)=>{
    if(e.button !== 0) return;
    resizing = true;
    startX = e.clientX; startY = e.clientY;
    const rect = winEl.getBoundingClientRect();
    startW = rect.width; startH = rect.height;
    winEl.style.transition = 'none';
    focusWindow(winEl);
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  });
  function onMove(e){
    if(!resizing) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    const newW = Math.max(320, startW + dx);
    const newH = Math.max(200, startH + dy);
    winEl.style.width = newW + 'px';
    winEl.style.height = newH + 'px';
  }
  function onUp(){
    resizing = false;
    winEl.style.transition = '';
    document.removeEventListener('mousemove', onMove);
    document.removeEventListener('mouseup', onUp);
  }
}

/* ================== Abrir apps haciendo dobleclick en iconos ================== */
document.querySelectorAll('.icon').forEach(icon=>{
  icon.addEventListener('dblclick', ()=>{
    const app = icon.dataset.app;
    const title = icon.querySelector('span').textContent;
    createWindow(title, app);
  });
});

/* ================== START MENU / BUSCADOR ================== */
const startBtn = document.getElementById('startBtn');
const startMenu = document.getElementById('startMenu');
const startList = document.getElementById('startList');
const startSearch = document.getElementById('startSearch');
const startCats = document.getElementById('startCats');

startBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  startMenu.style.display = startMenu.style.display === 'flex' ? 'none' : 'flex';
  startSearch.value = '';
  populateStartList('all');
});

// click fuera cierra
document.addEventListener('click', (e)=>{
  if(!startMenu.contains(e.target) && !startBtn.contains(e.target)){
    startMenu.style.display = 'none';
  }
});

/* Lista de apps (con files correctos) */
const appsCatalog = [
  { id:'golf', title:'Zona Arcade', cat:'ocio', emoji:'üïπÔ∏è', file:'golf.html' },
  { id:'casino', title:'Casino', cat:'ocio', emoji:'üé∞', file:'prueba.html' },
  { id:'periodico', title:'Noticias', cat:'noticias', emoji:'üì∞', file:'periodico.html' },
  { id:'encuestas', title:'Encuestas', cat:'noticias', emoji:'üìä', file:'e.html' },
  { id:'partidos', title:'Partidos', cat:'noticias', emoji:'üìú', file:'po.html' },
  { id:'posts', title:'Posts PekeOS', cat:'noticias', emoji:'üìù', file:'posts.html' },
  { id:'blog', title:'Blog', cat:'redes', emoji:'üí¨', file:'b.html' },
  { id:'chat', title:'Whatsapp', cat:'redes', emoji:'‚úâÔ∏è', file:'chat.html' },
  { id:'Apuntes', title:'Apuntes', cat:'redes', emoji:'‚úèÔ∏è', file:'Pekeapuntes.html'},
  { id:'admin', title:'Admin', cat:'admin', emoji:'‚öôÔ∏è', file:'admin.html' },
  { id:'estado', title:'Estado de la OS', cat:'admin', emoji:'üìä', file:'estado.html' },
  { id:'archivos', title:'Archivos', cat:'admin', emoji:'üìÅ', file:'archivos.html' },
  { id:'ajustes', title:'Ajustes', cat:'admin', emoji:'‚öôÔ∏è', file:'ajustes.html' }
];

function populateStartList(filter='all', searchTerm=''){
  startList.innerHTML = '';
  const term = (searchTerm||'').trim().toLowerCase();
  appsCatalog.forEach(app=>{
    if(filter !== 'all' && app.cat !== filter) return;
    if(term && !(app.title.toLowerCase().includes(term) || app.emoji.includes(term))) return;
    const el = document.createElement('div');
    el.className = 'start-item';
    el.innerHTML = `<div style="font-size:20px">${app.emoji}</div><div style="display:flex;flex-direction:column"><div style="font-weight:700">${app.title}</div><div style="font-size:12px;color:#8fffe2">${app.file}</div></div>`;
    el.addEventListener('click', ()=>{
      createWindow(app.title, app.file);
      startMenu.style.display = 'none';
    });
    startList.appendChild(el);
  });
}

/* categorias */
startCats.querySelectorAll('.cat').forEach(c=>{
  c.addEventListener('click', ()=>{
    startCats.querySelectorAll('.cat').forEach(x=>x.style.opacity= (x===c? '1':'0.7'));
    populateStartList(c.dataset.filter);
  });
});

/* buscar */
startSearch.addEventListener('input', (e)=>{
  populateStartList('all', e.target.value);
});

/* inicial */
populateStartList('all');

/* ================== Manejo teclado: Win (tecla meta) abre menu ================== */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Meta' || e.key === 'ContextMenu') {
    startMenu.style.display = startMenu.style.display === 'flex' ? 'none' : 'flex';
    e.preventDefault();
  }
});

/* ================== Manejo foco: al click en escritorio se desactiva active en taskbar ================== */
document.getElementById('desktop').addEventListener('mousedown', ()=>{
  openWindows.forEach(v=>{
    if(v.taskBtn) v.taskBtn.classList.remove('active');
  });
});

/* ================== Utilidades adicionales: restaurar todas las ventanas minimizadas al hacer click derecho en taskbar ================== */
document.getElementById('taskbar').addEventListener('contextmenu', (e)=>{
  e.preventDefault();
  openWindows.forEach((v,k)=>{
    if(v.minimized) restoreWindow(k);
  });
});

/* ================== SETTINGS (load & watch) ================== */
const SETTINGS_KEY = 'pekeos_settings';
function defaultSettings(){ return { accent:'#00ffd0', wallpaper:null, opacity:1 }; }

function loadSettings(){
  try{
    const raw = localStorage.getItem(SETTINGS_KEY);
    if(!raw) return defaultSettings();
    const s = JSON.parse(raw);
    return Object.assign(defaultSettings(), s);
  }catch(e){ return defaultSettings(); }
}

/* Aplicar ajustes al sistema - funci√≥n p√∫blica que ajustes.html llama */
function aplicarAjustes(){
  const s = loadSettings();

  // wallpaper
  const desk = document.getElementById('desktop');
  if(s.wallpaper){
    desk.style.backgroundImage = `url(${s.wallpaper})`;
    desk.style.backgroundSize='cover';
    desk.style.backgroundPosition='center';
  } else {
    desk.style.backgroundImage='';
    desk.style.background = getComputedStyle(document.documentElement).getPropertyValue('--bg-1') || 'linear-gradient(180deg,#05060a 0%, #07121b 100%)';
  }

  // accent: actualiza variables y elementos clave
  if(s.accent){
    document.documentElement.style.setProperty('--accent', s.accent);

    // icon labels & thumbs
    document.querySelectorAll('.icon span').forEach(el=> el.style.color = s.accent);
    document.querySelectorAll('.icon .thumb').forEach(el=> el.style.color = s.accent);

    // clock color
    document.querySelectorAll('.clock').forEach(el=> el.style.color = s.accent);

    // task buttons active outline
    document.querySelectorAll('.task-btn').forEach(el=>{
      el.style.borderColor = 'transparent';
      // keep label readable
      const lbl = el.querySelector('.label');
      if(lbl) lbl.style.color = s.accent;
    });

    // start menu accents
    document.querySelectorAll('#startMenu .cat').forEach(el=> el.style.background = 'rgba(0,0,0,0)'); // keep default, cats style already uses accent via CSS
  }

  // opacity windows
  if(s.opacity !== undefined){
    document.documentElement.style.setProperty('--win-opacity', s.opacity);
    document.querySelectorAll('.win').forEach(w=>{
      w.style.opacity = s.opacity;
      // border color match accent
      w.style.borderColor = s.accent || getComputedStyle(document.documentElement).getPropertyValue('--accent');
    });
  }
}

// ejecutar al inicio
window.addEventListener('load', ()=> {
  aplicarAjustes();
});

/* escuchar cambios desde ajustes.html u otras ventanas */
window.addEventListener('storage', (e)=>{
  if(e.key === 'pekeos_update'){
    aplicarAjustes();
  }
});

/* ================== Exponer createWindow y aplicarAjustes al parent (global) ================== */
window.createWindow = createWindow;
window.aplicarAjustes = aplicarAjustes;

/* ================== FIN ================== */
</script>
</body>
</html>
