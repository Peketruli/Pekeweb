<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Casino 3D ‚Äî Ruleta, Slots y Blackjack</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
html,body{height:100%;margin:0;background:#030612;color:#fff;font-family:Arial,Helvetica,sans-serif;overflow:hidden}
#wrap{position:relative;height:100vh;overflow:hidden}
canvas{display:block}

.hud{position:absolute;right:12px;top:12px;z-index:40;max-width:380px}
.panel{background:rgba(0,0,0,0.7);padding:12px;border-radius:10px;margin-bottom:10px}
.info-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0;font-size:13px}
#prompt{position:absolute;left:50%;transform:translateX(-50%);bottom:92px;background:rgba(0,0,0,0.7);padding:8px 12px;border-radius:8px;display:none;z-index:45}
#interaction-panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:420px;background:rgba(8,10,12,0.96);border-radius:10px;box-shadow:0 10px 40px rgba(0,0,0,0.7);color:#ddd;padding:16px;z-index:50;display:none}
#interaction-panel h3{margin-top:0;}
.btn{background:#d95d00;color:white;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;margin-top:8px}
.card{display:inline-block;background:#111;padding:6px 8px;border-radius:6px;border:1px solid #333;margin-right:4px}
.log-entry{margin:2px 0;font-size:12px}
#minimap{position:absolute;left:12px;top:12px;width:120px;height:120px;background:rgba(255,255,255,0.02);border-radius:8px;z-index:30}
</style>
</head>
<body>
<div id="wrap">
  <div id="minimap"></div>
  <div class="hud">
    <div class="panel">
      <h3>Casino 3D</h3>
      <div class="info-row"><span>Saldo</span><strong id="balance">1000</strong></div>
      <div class="info-row"><span>Apuesta</span><strong id="bet">0</strong></div>
      <div style="font-size:13px;margin-top:6px">Controles: <strong>W A S D</strong> moverse ¬∑ <strong>Flechas</strong> girar c√°mara ¬∑ <strong>E</strong> interactuar</div>
    </div>
    <div class="panel">
      <h4>Historial</h4>
      <div id="log" style="max-height:120px;overflow:auto;font-size:12px;background:rgba(255,255,255,0.02);padding:6px;border-radius:6px"></div>
    </div>
  </div>
  <div id="prompt">[E] Interactuar</div>
  <div id="interaction-panel">
    <h3 id="panel-title">Juego</h3>
    <div id="panel-content"></div>
    <button class="btn" onclick="closePanel()">Cerrar</button>
  </div>
</div>

<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script>
// ==================== CONFIGURACI√ìN GENERAL ====================
let balance = 1000;
let currentBet = 0;

// ==================== BLACKJACK ====================
let playerHands = [];
let dealerHand = [];
let currentHandIndex = 0;
let canDouble = false;
let canSplit = false;

// ==================== UTILIDADES ====================
function createDeck() {
    const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
    const values = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    const deck = [];
    for(const s of suits){
        for(const v of values){
            deck.push({value:v,suit:s});
        }
    }
    return deck.sort(()=>Math.random()-0.5);
}

function handValue(hand){
    let sum = 0, aces = 0;
    for(const c of hand){
        if(c.value==='A'){ sum+=11; aces++; }
        else if(['J','Q','K'].includes(c.value)){ sum+=10; }
        else sum+=parseInt(c.value);
    }
    while(sum>21 && aces>0){ sum-=10; aces--; }
    return sum;
}

function displayHand(hand){
    return hand.map(c=>c.value+c.suit).join(' ');
}

// ==================== HUD ====================
function updateHUD(){
    document.getElementById('balance').textContent = balance;
    document.getElementById('bet').textContent = currentBet;
}

function addLog(msg){
    const log=document.getElementById("log");
    const div=document.createElement("div");
    div.className='log-entry';
    div.textContent=msg;
    log.prepend(div);
}

// ==================== PANEL INTERACCI√ìN ====================
const panel=document.getElementById("interaction-panel");
const panelTitle=document.getElementById("panel-title");
const panelContent=document.getElementById("panel-content");
const prompt=document.getElementById("prompt");

function closePanel(){ panel.style.display='none'; }

// ==================== BLACKJACK FUNCIONES ====================
let deck = [];
function openBlackjackUI(){
    if(balance<=0){ addLog("Saldo insuficiente para jugar Blackjack"); return; }
    panelTitle.textContent='Blackjack';
    panelContent.innerHTML = `
        <div>Saldo: ${balance}</div>
        <input type="number" id="bj-bet" placeholder="Apuesta" min="1" max="${balance}" style="width:80px"/>
        <button class="btn" onclick="startBlackjack()">Iniciar Mano</button>
        <div id="bj-info" style="margin-top:8px;"></div>
    `;
    panel.style.display='block';
}

function startBlackjack(){
    const betInput = document.getElementById('bj-bet');
    const bet = parseInt(betInput.value);
    if(isNaN(bet) || bet<=0 || bet>balance){ addLog("Apuesta inv√°lida"); return; }
    currentBet = bet; balance -= bet; updateHUD();
    addLog(`Apuesta Blackjack: ${bet}$`);

    deck = createDeck();
    playerHands = [ [deck.pop(), deck.pop()] ];
    dealerHand = [deck.pop(), deck.pop()];
    currentHandIndex = 0;
    canDouble = true;
    canSplit = (playerHands[0][0].value === playerHands[0][1].value);
    showBlackjackState();
}

function showBlackjackState(){
    const info = document.getElementById('bj-info');
    const hand = playerHands[currentHandIndex];
    let html = `<div>Mano: ${displayHand(hand)} (Valor: ${handValue(hand)})</div>`;
    html += `<div>Dealer: ${dealerHand[0].value+dealerHand[0].suit} ??</div>`;
    html += `<button class="btn" onclick="hit()">Pedir Carta</button>`;
    html += `<button class="btn" onclick="stand()">Plantarse</button>`;
    if(canDouble) html += `<button class="btn" onclick="doubleBet()">Doblar</button>`;
    if(canSplit) html += `<button class="btn" onclick="splitHand()">Dividir</button>`;
    info.innerHTML = html;
}

function hit(){
    const hand = playerHands[currentHandIndex];
    hand.push(deck.pop());
    canDouble = false; canSplit = false;
    if(handValue(hand)>21){
        addLog(`Mano ${currentHandIndex+1} se pas√≥ (${handValue(hand)})`);
        nextHandOrDealer();
    } else showBlackjackState();
}

function stand(){
    nextHandOrDealer();
}

function doubleBet(){
    if(balance<currentBet){ addLog("Saldo insuficiente para doblar"); return; }
    balance -= currentBet; currentBet*=2; updateHUD();
    hit(); // Pedir solo una carta
}

function splitHand(){
    const hand = playerHands[0];
    if(hand.length!==2 || hand[0].value!==hand[1].value || balance<currentBet){ addLog("No se puede dividir"); return; }
    balance -= currentBet; updateHUD();
    playerHands = [ [hand[0], deck.pop()], [hand[1], deck.pop()] ];
    currentHandIndex=0; canDouble=false; canSplit=false;
    showBlackjackState();
}

function nextHandOrDealer(){
    if(currentHandIndex<playerHands.length-1){
        currentHandIndex++;
        showBlackjackState();
    } else playDealer();
}

function playDealer(){
    let dealerVal = handValue(dealerHand);
    while(dealerVal<17){
        dealerHand.push(deck.pop());
        dealerVal = handValue(dealerHand);
    }
    addLog(`Dealer: ${displayHand(dealerHand)} (Valor: ${dealerVal})`);
    evaluateHands();
}

function evaluateHands(){
    const dealerVal = handValue(dealerHand);
    playerHands.forEach((hand,i)=>{
        const val = handValue(hand);
        if(val>21) addLog(`Mano ${i+1}: Perdida`);
        else if(dealerVal>21 || val>dealerVal){
            addLog(`Mano ${i+1}: Ganaste!`);
            balance += currentBet*2;
        } else if(val===dealerVal){
            addLog(`Mano ${i+1}: Empate`);
            balance += currentBet;
        } else addLog(`Mano ${i+1}: Perdida`);
    });
    currentBet=0;
    updateHUD();
    panelContent.querySelector('#bj-info').innerHTML += `<div><button class="btn" onclick="openBlackjackUI()">Nueva Mano</button></div>`;
}

// ==================== RULETA ====================
const wheelNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,
                      23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const anglePerNumber = (Math.PI*2)/wheelNumbers.length;
let wheelRotation = 0;
let rouletteBet = [];
function openRouletteUI(){
    if(balance<=0){ addLog("Saldo insuficiente para Ruleta"); return; }
    panelTitle.textContent='Ruleta';
    panelContent.innerHTML = `
        <div>Saldo: ${balance}</div>
        <input type="number" id="roulette-bet" placeholder="Apuesta" min="1" max="${balance}" style="width:80px"/>
        <input type="text" id="roulette-numbers" placeholder="N√∫meros (ej: 0,7,32)" style="width:120px"/>
        <button class="btn" onclick="spinRoulette()">Girar Ruleta</button>
    `;
    panel.style.display='block';
}

function spinRoulette(){
    const betAmount = parseInt(document.getElementById('roulette-bet').value);
    const numbersInput = document.getElementById('roulette-numbers').value;
    if(isNaN(betAmount) || betAmount<=0 || betAmount>balance){ addLog("Apuesta inv√°lida"); return; }
    const nums = numbersInput.split(',').map(x=>parseInt(x.trim())).filter(x=>wheelNumbers.includes(x));
    if(nums.length===0){ addLog("Debe seleccionar al menos un n√∫mero v√°lido"); return; }

    balance -= betAmount; updateHUD(); rouletteBet = nums;
    const chosenIndex = Math.floor(Math.random()*wheelNumbers.length);
    const chosenNumber = wheelNumbers[chosenIndex];
    addLog(`Ruleta girando...`);

    // Animaci√≥n simplificada
    wheelRotation += 4*Math.PI + chosenIndex*anglePerNumber;

    setTimeout(()=>{
        addLog(`Ruleta: sali√≥ ${chosenNumber}`);
        if(nums.includes(chosenNumber)){
            const payout = betAmount*wheelNumbers.length/nums.length;
            addLog(`Ganaste ${payout}$`);
            balance += payout;
        } else addLog(`Perdiste ${betAmount}$`);
        updateHUD();
    }, 2000);
}

// ==================== TRAGAPERRAS ====================
const slotSymbols = ['üçí','‚≠ê','7','üçã','üîî','üçâ'];
function openSlotsUI(){
    if(balance<=0){ addLog("Saldo insuficiente para Tragaperras"); return; }
    panelTitle.textContent='Tragaperras';
    panelContent.innerHTML = `
        <div>Saldo: ${balance}</div>
        <input type="number" id="slot-bet" placeholder="Apuesta" min="1" max="${balance}" style="width:80px"/>
        <button class="btn" onclick="spinSlots()">Girar</button>
    `;
    panel.style.display='block';
}

function spinSlots(){
    const bet = parseInt(document.getElementById('slot-bet').value);
    if(isNaN(bet) || bet<=0 || bet>balance){ addLog("Apuesta inv√°lida"); return; }
    balance -= bet; updateHUD();

    const results = [];
    for(let i=0;i<3;i++){
        const sym = slotSymbols[Math.floor(Math.random()*slotSymbols.length)];
        results.push(sym);
    }
    addLog(`Tragaperras: ${results.join(' | ')}`);
    const counts = {};
    results.forEach(s=>counts[s]=(counts[s]||0)+1);

    let win = 0;
    for(const s in counts){
        if(counts[s]===3) win = bet*5;
        else if(counts[s]===2) win = bet*2;
    }

    if(win>0){ addLog(`Ganaste ${win}$`); balance += win; }
    else addLog(`Perdiste ${bet}$`);
    updateHUD();
}

// ==================== ZONAS DE INTERACCI√ìN ====================
const zones=[
    {x:0,z:0,label:'Ruleta',action:openRouletteUI},
    {x:-10,z:-5,label:'Blackjack',action:openBlackjackUI},
    {x:10,z:-5,label:'Tragaperras',action:openSlotsUI}
];

let playerPos = {x:0,z:0};
let currentZone = null;
function detectZones(){
    currentZone=null;
    for(const z of zones){
        const dx = playerPos.x - z.x;
        const dz = playerPos.z - z.z;
        if(Math.sqrt(dx*dx + dz*dz)<3){
            currentZone = z;
            prompt.style.display='block';
            prompt.textContent = '[E] '+z.label;
            return;
        }
    }
    prompt.style.display='none';
}

document.addEventListener("keydown",e=>{
    if(e.key.toLowerCase()==='e' && currentZone) currentZone.action();
    if(e.key==='Escape') closePanel();
});

// ==================== INICIAL ====================
updateHUD();
</script>
</body>
</html>
