<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Casino 3D â€” Ruleta, Slots y Blackjack</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
html, body { height:100%; margin:0; background:#030612; color:#fff; font-family:Inter, Arial, Helvetica, sans-serif; overflow:hidden; }
#wrap { position:relative; height:100vh; overflow:hidden; }
canvas { display:block; }

.hud { position:absolute; right:12px; top:12px; z-index:40; max-width:380px; }
.panel { background:rgba(0,0,0,0.7); padding:12px; border-radius:10px; margin-bottom:10px; }
.info-row { display:flex; justify-content:space-between; align-items:center; margin:6px 0; font-size:13px; }
#prompt { position:absolute; left:50%; transform:translateX(-50%); bottom:92px; background:rgba(0,0,0,0.7); padding:8px 12px; border-radius:8px; display:none; z-index:45; }
#interaction-panel { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:420px; background:rgba(8,10,12,0.96); border-radius:10px; box-shadow:0 10px 40px rgba(0,0,0,0.7); color:#ddd; padding:16px; z-index:50; display:none; }
#interaction-panel h3 { margin-top:0; }
.btn { background:#d95d00; color:white; padding:8px 10px; border-radius:8px; border:none; cursor:pointer; margin-top:8px; }
.card { display:inline-block; background:#111; padding:6px 8px; border-radius:6px; border:1px solid #333; margin-right:4px; }
.log-entry { margin:2px 0; font-size:12px; }
#minimap { position:absolute; left:12px; top:12px; width:120px; height:120px; background:rgba(255,255,255,0.02); border-radius:8px; z-index:30; }
</style>
</head>
<body>
<div id="wrap">
  <div id="minimap"></div>
  <div class="hud">
    <div class="panel">
      <h3>Casino 3D</h3>
      <div class="info-row"><span>Saldo</span><strong id="balance">1000</strong></div>
      <div class="info-row"><span>Apuesta</span><strong id="bet">0</strong></div>
      <div style="font-size:13px;margin-top:6px">Controles: <strong>W A S D</strong> moverse Â· <strong>Flechas</strong> girar cÃ¡mara Â· <strong>E</strong> interactuar</div>
    </div>
    <div class="panel">
      <h4>Historial</h4>
      <div id="log" style="max-height:120px;overflow:auto;font-size:12px;background:rgba(255,255,255,0.02);padding:6px;border-radius:6px"></div>
    </div>
  </div>
  <div id="prompt">[E] Interactuar</div>

  <div id="interaction-panel">
    <h3 id="panel-title">Juego</h3>
    <div id="panel-content"></div>
    <button class="btn" onclick="closePanel()">Cerrar</button>
  </div>
</div>

<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script>
// ==================== SETUP GENERAL ====================
const wrap = document.getElementById('wrap');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x041018);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(wrap.clientWidth, wrap.clientHeight);
wrap.appendChild(renderer.domElement);

const camera = new THREE.PerspectiveCamera(72, wrap.clientWidth/wrap.clientHeight, 0.1, 1000);
camera.position.set(0,1.7,12);

let playerPos = new THREE.Vector3(0,0,12);
let yaw = 0, pitch = 0;

// LUCES
scene.add(new THREE.AmbientLight(0xffffff,0.35));
const dir = new THREE.DirectionalLight(0xffffff,0.9);
dir.position.set(8,20,10); scene.add(dir);
const bulb = new THREE.PointLight(0xfff3d6,0.9,200); bulb.position.set(0,20,0); scene.add(bulb);

// SUELO + HABITACIÃ“N
const floor = new THREE.Mesh(new THREE.PlaneGeometry(90,90), new THREE.MeshStandardMaterial({color:0x091217, roughness:0.95}));
floor.rotation.x=-Math.PI/2; scene.add(floor);
function wall(w,h,d,x,y,z,rotY){ const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshStandardMaterial({color:0x071018})); m.position.set(x,y,z); if(rotY)m.rotation.y=rotY; scene.add(m); return m; }
wall(50,10,2,0,5,-40); wall(2,10,50,-24,5,0); wall(2,10,50,24,5,0); wall(50,10,2,0,5,40);

const rug = new THREE.Mesh(new THREE.CircleGeometry(14,32), new THREE.MeshStandardMaterial({color:0x183430}));
rug.rotation.x=-Math.PI/2; rug.position.y=0.01; scene.add(rug);

// ==================== RECURSOS DEL CASINO ====================
// RULETA
const wheelRadius=6;
const pockets=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const pocketCount=pockets.length;
const anglePerPocket=(Math.PI*2)/pocketCount;

function createWheelCanvas(size=1024){
  const c=document.createElement('canvas'); c.width=c.height=size;
  const ctx=c.getContext('2d'); const cx=size/2, cy=size/2, r=size*0.45;
  ctx.fillStyle='#072b22'; ctx.fillRect(0,0,size,size);
  for(let i=0;i<pocketCount;i++){
    const a0=i*anglePerPocket-Math.PI/2; const a1=(i+1)*anglePerPocket-Math.PI/2;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,a0,a1); ctx.closePath();
    ctx.fillStyle=(pockets[i]===0)?'#1b8b41':((i%2===0)?'#b71c1c':'#000'); ctx.fill();
    const mid=a0+(a1-a0)/2; ctx.save();
    ctx.translate(cx+Math.cos(mid)*r*0.66, cy+Math.sin(mid)*r*0.66); ctx.rotate(mid+Math.PI/2);
    ctx.fillStyle='#fff'; ctx.font=`${Math.floor(size*0.04)}px sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(pockets[i],0,0); ctx.restore();
  }
  ctx.beginPath(); ctx.fillStyle='#111'; ctx.arc(cx,cy,r*0.45,0,Math.PI*2); ctx.fill();
  return c;
}
const wheelTex=new THREE.CanvasTexture(createWheelCanvas()); wheelTex.anisotropy=renderer.capabilities.getMaxAnisotropy();
const wheelMesh=new THREE.Mesh(new THREE.CylinderGeometry(wheelRadius,wheelRadius,1.4,128), new THREE.MeshStandardMaterial({map:wheelTex}));
wheelMesh.position.y=0.7; scene.add(wheelMesh);

// BLACKJACK
const bjTable=new THREE.Mesh(new THREE.BoxGeometry(12,0.8,5), new THREE.MeshStandardMaterial({color:0x1b4f2a}));
bjTable.position.set(-14,0.4,-6); scene.add(bjTable);

// TRAGAPERRAS
const slotBody=new THREE.Mesh(new THREE.BoxGeometry(3,6,2), new THREE.MeshStandardMaterial({color:0x8a0f05}));
slotBody.position.set(14,3,-6); scene.add(slotBody);

const symbols=['ðŸ’','â­','7','ðŸ‹','ðŸ””','ðŸ‰'];
const reelCanvases=[], reelTexes=[], reelPlanes=[];
for(let i=0;i<3;i++){
  const c=document.createElement('canvas'); c.width=128;c.height=192;
  const ctx=c.getContext('2d'); ctx.fillStyle='#070707'; ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle='#fff'; ctx.font='64px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(symbols[Math.floor(Math.random()*symbols.length)],c.width/2,c.height/2);
  reelCanvases.push(c);
  const t=new THREE.CanvasTexture(c); reelTexes.push(t);
  const p=new THREE.Mesh(new THREE.PlaneGeometry(1,1.5), new THREE.MeshBasicMaterial({map:t}));
  p.position.set(14+(i-1)*1.1,4,-5.1); scene.add(p); reelPlanes.push(p);
}

// ZONAS DE INTERACCIÃ“N
const zones = [
  {x:-14,z:-6,label:"Blackjack",action:openBlackjackUI},
  {x:14,z:-6,label:"Tragaperras",action:openSlotsUI},
  {x:0,z:0,label:"Ruleta",action:openRouletteUI} // Ajusta posiciÃ³n
];

const colliders=[
  {x:-14,z:-6,radius:3},{x:14,z:-6,radius:3},{x:0,z:0,radius:6}
];

const keys={w:false,a:false,s:false,d:false,ArrowLeft:false,ArrowRight:false,ArrowUp:false,ArrowDown:false};
const speed=5.2;
window.addEventListener("keydown",e=>{ if(e.key in keys) keys[e.key]=true; });
window.addEventListener("keyup",e=>{ if(e.key in keys) keys[e.key]=false; });

// ==========================
// PANEL DE INTERACCIÃ“N
// ==========================
const panel=document.getElementById("interaction-panel");
const panelTitle=document.getElementById("panel-title");
const panelContent=document.getElementById("panel-content");
function openBlackjackUI(){
  panelTitle.textContent="Blackjack";
  panelContent.innerHTML=`<div class="bj-cards">Tus cartas: <span class="card">Aâ™ </span> <span class="card">9â™¦</span></div>
  <button class="btn" onclick="playBlackjack()">Jugar Mano</button>`;
  panel.style.display="block";
}
function openSlotsUI(){
  panelTitle.textContent="Tragaperras";
  panelContent.innerHTML=`<button class="btn" onclick="spinSlots()">Girar</button>`;
  panel.style.display="block";
}
function openRouletteUI(){
  panelTitle.textContent="Ruleta";
  panelContent.innerHTML=`<button class="btn" onclick="spinRoulette()">Girar Ruleta</button>`;
  panel.style.display="block";
}
function closePanel(){ panel.style.display="none"; }

// ==========================
// JUEGOS
// ==========================
function playBlackjack(){
  const win=Math.random()<0.5;
  addLog(`Blackjack: ${win?"Ganaste!":"Perdiste!"}`);
}
function spinSlots(){
  for(let i=0;i<3;i++){
    const sym=symbols[Math.floor(Math.random()*symbols.length)];
    const ctx=reelCanvases[i].getContext("2d");
    ctx.fillStyle='#070707'; ctx.fillRect(0,0,reelCanvases[i].width,reelCanvases[i].height);
    ctx.fillStyle='#fff'; ctx.font='64px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(sym,reelCanvases[i].width/2,reelCanvases[i].height/2);
    reelTexes[i].needsUpdate=true;
  }
  addLog("Tragaperras girada!");
}
function spinRoulette(){
  const chosenIndex=Math.floor(Math.random()*pockets.length);
  const chosenNumber=pockets[chosenIndex];
  const startRotation=wheelMesh.rotation.y;
  const spins=5; const endRotation=startRotation+spins*Math.PI*2+chosenIndex*anglePerPocket;
  const duration=2000; const startTime=performance.now();
  function animateSpin(now){
    const t=(now-startTime)/duration;
    if(t<1){ const ease=1-Math.pow(1-t,3); wheelMesh.rotation.y=startRotation+(endRotation-startRotation)*ease;
      requestAnimationFrame(animateSpin);
    }else{ wheelMesh.rotation.y=endRotation; addLog(`Ruleta: saliÃ³ el ${chosenNumber}`); }
  }
  requestAnimationFrame(animateSpin);
}
function addLog(msg){ const log=document.getElementById("log"); const div=document.createElement("div"); div.textContent=msg; div.className="log-entry"; log.prepend(div); }

// ==========================
// MOVIMIENTO Y COLISIONES
// ==========================
function computeDelta(dt){
  const rotSpeed=1.4*dt;
  if(keys.ArrowLeft) yaw+=rotSpeed; if(keys.ArrowRight) yaw-=rotSpeed;
  if(keys.ArrowUp) pitch+=rotSpeed*0.5; if(keys.ArrowDown) pitch-=rotSpeed*0.5;
  pitch=Math.max(-1.2,Math.min(1.2,pitch));
  const e=new THREE.Euler(pitch,yaw,0,"YXZ");
  const q=new THREE.Quaternion().setFromEuler(e);
  const forward=new THREE.Vector3(0,0,-1).applyQuaternion(q); forward.y=0; forward.normalize();
  const right=new THREE.Vector3(1,0,0).applyQuaternion(q); right.y=0; right.normalize();
  let mf=0,mr=0; if(keys.w) mf+=1; if(keys.s) mf-=1; if(keys.a) mr-=1; if(keys.d) mr+=1;
  const len=Math.hypot(mf,mr); if(len>0){ mf/=len; mr/=len; }
  const delta=new THREE.Vector3(); delta.addScaledVector(forward,mf*speed*dt); delta.addScaledVector(right,mr*speed*dt);
  return delta;
}
function checkCollision(pos){
  for(const c of colliders){
    const dx=pos.x-c.x, dz=pos.z-c.z, dist=Math.sqrt(dx*dx+dz*dz);
    if(dist<c.radius) return true;
  }
  return false;
}

// ==========================
// DETECTAR ZONAS DE INTERACCIÃ“N
// ==========================
let currentZone=null;
function detectZones(){
  currentZone=null; let eye=playerPos.clone(); eye.y=camera.position.y;
  for(const z of zones){
    const dx=eye.x-z.x, dz=eye.z-z.z, dist=Math.sqrt(dx*dx+dz*dz);
    if(dist<3){ currentZone=z; prompt.textContent=`[E] ${z.label}`; prompt.style.display="block"; return; }
  }
  prompt.style.display="none";
}
document.addEventListener("keydown",(e)=>{
  if(e.key.toLowerCase()==="e" && currentZone) currentZone.action();
  if(e.key==="Escape") closePanel();
});

// ==================== ANIMACIÃ“N ====================
let lastTime=0;
function animate(ts){
  requestAnimationFrame(animate);
  const dt=(ts-lastTime)*0.001; lastTime=ts;
  detectZones();
  const delta=computeDelta(dt); const next=playerPos.clone().add(delta);
  if(!checkCollision(next)) playerPos.copy(next);
  camera.position.copy(playerPos); camera.position.y=1.7; camera.rotation.set(pitch,yaw,0,"YXZ");
  renderer.render(scene,camera);
}
requestAnimationFrame(animate);

// Responsive
window.addEventListener("resize",()=>{ camera.aspect=wrap.clientWidth/wrap.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(wrap.clientWidth,wrap.clientHeight); });
</script>
</body>
</html>
