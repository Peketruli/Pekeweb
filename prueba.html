<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Casino Deluxe — Pasillo y Sala</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:Arial, Helvetica, sans-serif; }
#hint { position:absolute; left:12px; top:12px; z-index:5;
       background:rgba(255,255,255,0.06); color:#fff;
       padding:8px 10px; border-radius:8px; font-size:13px; }
</style>
</head>
<body>
<div id="hint">W A S D para moverse, ratón para mirar, E para abrir la puerta</div>
<script>
// -------------------- Escena y cámara --------------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xefeae4);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 200);
camera.position.set(0, 1.7, -12);

// -------------------- Renderer --------------------
const renderer = new THREE.WebGLRenderer({ antialias:false });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(1, window.devicePixelRatio));
document.body.appendChild(renderer.domElement);

// -------------------- Luces --------------------
scene.add(new THREE.AmbientLight(0xffffff,0.7));
const sun = new THREE.DirectionalLight(0xfff2cc,0.5);
sun.position.set(40,50,40);
scene.add(sun);

// -------------------- Materiales --------------------
const carpetMat = new THREE.MeshBasicMaterial({color:0x7d0a0a});
const wallMatSoft = new THREE.MeshBasicMaterial({ color: 0xccc0b3 }); // gris/beige suave
const woodMat = new THREE.MeshBasicMaterial({color:0x5a3719});
const greenMat = new THREE.MeshBasicMaterial({color:0x0b5b35});
const redMat = new THREE.MeshBasicMaterial({color:0xb20d0d});
const blackMat = new THREE.MeshBasicMaterial({color:0x111111});

// -------------------- Función paredes --------------------
function wall(x,y,z,sx,sy,sz, mat=wallMatSoft){
  const w = new THREE.Mesh(new THREE.BoxGeometry(sx,sy,sz), mat);
  w.position.set(x,y,z);
  scene.add(w);
}

// -------------------- PASILLO --------------------
const corridorLength = 20; 
const corridorWidth = 18;
const corridorHeight = 14;

// Suelo
const floor = new THREE.Mesh(new THREE.PlaneGeometry(corridorWidth, corridorLength), carpetMat);
floor.rotation.x = -Math.PI/2;
floor.position.z = -corridorLength/2;
scene.add(floor);

// Techo
const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(corridorWidth, corridorLength), woodMat);
ceiling.rotation.x = Math.PI/2;
ceiling.position.y = corridorHeight + 2;
ceiling.position.z = -corridorLength/2;
scene.add(ceiling);

// Paredes laterales
wall(-corridorWidth/2, corridorHeight/2, -corridorLength/2, 1, corridorHeight, corridorLength);
wall(corridorWidth/2, corridorHeight/2, -corridorLength/2, 1, corridorHeight, corridorLength);

// -------------------- Puerta interactiva --------------------
const doorMat = new THREE.MeshBasicMaterial({color:0x8a5a2b});
const doorLeft = new THREE.Mesh(new THREE.BoxGeometry(1.2,3.8,0.15), doorMat);
doorLeft.position.set(-0.6,1.9,-corridorLength);
scene.add(doorLeft);
const doorRight = new THREE.Mesh(new THREE.BoxGeometry(1.2,3.8,0.15), doorMat);
doorRight.position.set(0.6,1.9,-corridorLength);
scene.add(doorRight);

// -------------------- SALA --------------------
const roomSize = 30;
const roomZ = 0; 

// Suelo sala
const roomFloor = new THREE.Mesh(new THREE.PlaneGeometry(roomSize, roomSize), carpetMat);
roomFloor.rotation.x = -Math.PI/2;
roomFloor.position.z = roomZ + roomSize/2;
scene.add(roomFloor);

// Techo sala
const roomCeiling = new THREE.Mesh(new THREE.PlaneGeometry(roomSize, roomSize), woodMat);
roomCeiling.rotation.x = Math.PI/2;
roomCeiling.position.y = corridorHeight + 2;
roomCeiling.position.z = roomZ + roomSize/2;
scene.add(roomCeiling);

// Paredes sala
wall(-roomSize/2, corridorHeight/2, roomZ + roomSize/2, 1, corridorHeight, roomSize);
wall(roomSize/2, corridorHeight/2, roomZ + roomSize/2, 1, corridorHeight, roomSize);
wall(0, corridorHeight/2, roomZ + roomSize, roomSize, corridorHeight, 1);

// -------------------- MESA BLACKJACK --------------------
const tableGroup = new THREE.Group();
const tableTop = new THREE.Mesh(new THREE.CylinderGeometry(3,3,0.3,24), greenMat);
tableTop.position.set(6,1.05,roomZ+15);
tableGroup.add(tableTop);
const rim = new THREE.Mesh(new THREE.TorusGeometry(3.2,0.25,8,32), woodMat);
rim.rotation.x = Math.PI/2;
rim.position.set(6,1.2,roomZ+15);
tableGroup.add(rim);
scene.add(tableGroup);

// -------------------- RULETA 3D VISUAL --------------------
const wheelGroup = new THREE.Group();
const stand = new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.8,1,16), woodMat);
stand.position.set(-6,0.75,roomZ+10);
wheelGroup.add(stand);
const base = new THREE.Mesh(new THREE.CylinderGeometry(1.5,1.5,0.2,24), woodMat);
base.position.set(-6,0.1,roomZ+10);
wheelGroup.add(base);

// Crear plato de la ruleta con segmentos rojo y negro
const wheelRadius = 1.8;
const wheelSegments = 18;
const wheelPlate = new THREE.Group();
for(let i=0;i<wheelSegments;i++){
  const angle = (i/wheelSegments)*Math.PI*2;
  const geom = new THREE.CylinderGeometry(wheelRadius, wheelRadius, 0.06, 32, 1, true, angle, Math.PI*2/wheelSegments);
  const mat = (i%2===0)? redMat : blackMat;
  const seg = new THREE.Mesh(geom, mat);
  seg.rotation.x = Math.PI/2;
  seg.position.y = 1.2;
  seg.position.x = -6;
  seg.position.z = roomZ+10;
  wheelPlate.add(seg);
}
// Centro y borde
const rimWheel = new THREE.Mesh(new THREE.TorusGeometry(wheelRadius+0.1,0.1,8,32), woodMat);
rimWheel.rotation.x = Math.PI/2;
rimWheel.position.set(-6,1.2,roomZ+10);
wheelPlate.add(rimWheel);
const center = new THREE.Mesh(new THREE.CylinderGeometry(0.12,0.12,0.06,16), woodMat);
center.position.set(-6,1.23,roomZ+10);
wheelPlate.add(center);

wheelGroup.add(wheelPlate);
wheelGroup.userData.wheelPlate = wheelPlate;
scene.add(wheelGroup);

// -------------------- Movimiento --------------------
let yaw=0,pitch=0; const keys={}; const sens=0.002;
window.addEventListener('mousemove',e=>{
  yaw-=e.movementX*sens;
  pitch-=e.movementY*sens;
  pitch=Math.max(-Math.PI/2+0.05, Math.min(Math.PI/2-0.05, pitch));
});
window.addEventListener('keydown',e=>{keys[e.code]=true;});
window.addEventListener('keyup',e=>{keys[e.code]=false;});

function move(dt){
  camera.rotation.set(pitch,yaw,0,"ZYX");
  const forward=new THREE.Vector3(); camera.getWorldDirection(forward); forward.y=0; forward.normalize();
  const right=new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0)).negate();
  let dir=new THREE.Vector3();
  if(keys['KeyW']) dir.add(forward);
  if(keys['KeyS']) dir.addScaledVector(forward,-1);
  if(keys['KeyA']) dir.add(right);
  if(keys['KeyD']) dir.addScaledVector(right,-1);
  if(dir.lengthSq()>0) dir.normalize();
  camera.position.addScaledVector(dir,dt*8);
  if(camera.position.y<1.6) camera.position.y=1.7;
}

// -------------------- Puerta interactiva --------------------
window.addEventListener('keydown',e=>{
  if(e.key.toLowerCase()==='e'){
    const d=camera.position.distanceTo(new THREE.Vector3(0,2,-corridorLength));
    if(d<3.5) window.location.href='h.html';
  }
});

// -------------------- Animación --------------------
function animate(){
  requestAnimationFrame(animate);
  move(0.016);
  wheelGroup.userData.wheelPlate.rotation.y += 0.04;
  renderer.render(scene,camera);
}
animate();

// -------------------- Resize --------------------
window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
