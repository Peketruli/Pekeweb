<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Casino 3D - Ruleta y Mesas</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<style>
body { margin:0; overflow:hidden; background:#000; font-family:Arial, Helvetica, sans-serif; }
#hint { position:absolute; left:12px; top:12px; z-index:5; background:rgba(0,0,0,0.6); color:#fff; padding:8px 10px; border-radius:8px; font-size:13px; }
#credits { position:absolute; right:12px; top:12px; z-index:5; background:rgba(0,0,0,0.45); color:#ddd; padding:6px 8px; border-radius:6px; font-size:12px; }
</style>
</head>
<body>
<div id="hint">ðŸŽ° Mover: W A S D â€” Mirar: ratÃ³n</div>
<div id="credits">Casino clÃ¡sico â€” texturas libres (online)</div>

<script>
// ---------- Escena ----------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x202020); // gris oscuro para que todo se vea
scene.fog = new THREE.FogExp2(0x202020,0.02);

const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 1.7, 10);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
document.body.appendChild(renderer.domElement);

// ---------- IluminaciÃ³n ----------
scene.add(new THREE.AmbientLight(0xffffff,0.4)); // mÃ¡s fuerte que antes
const dirLight = new THREE.DirectionalLight(0xfff0c0,0.7);
dirLight.position.set(10,20,10); dirLight.castShadow=true; scene.add(dirLight);
const spot = new THREE.SpotLight(0xffe6c2,1,50,Math.PI/6,0.3);
spot.position.set(0,10,5); spot.castShadow=true; scene.add(spot);
const accent = new THREE.PointLight(0xffd8a8,0.8,15);
accent.position.set(0,5,5); scene.add(accent);

// ---------- Suelo ----------
const loader = new THREE.TextureLoader();
const floorTex = loader.load('https://cdn.pixabay.com/photo/2016/11/21/15/55/pattern-1846866_1280.jpg');
floorTex.wrapS=floorTex.wrapT=THREE.RepeatWrapping;
floorTex.repeat.set(8,8);
const floorMat = new THREE.MeshStandardMaterial({ map: floorTex, roughness:0.9, metalness:0.02 });
const floor = new THREE.Mesh(new THREE.PlaneGeometry(80,80), floorMat);
floor.rotation.x=-Math.PI/2; floor.receiveShadow=true; scene.add(floor);

// ---------- Paredes ----------
const wallMat = new THREE.MeshStandardMaterial({ color:0x3a2b20, roughness:1 });
const backWall = new THREE.Mesh(new THREE.BoxGeometry(40,8,0.8), wallMat);
backWall.position.set(0,4,-30); scene.add(backWall);
const frontWall = backWall.clone(); frontWall.position.set(0,4,30); scene.add(frontWall);
const leftWall = new THREE.Mesh(new THREE.BoxGeometry(0.8,8,60), wallMat); leftWall.position.set(-20,4,0); scene.add(leftWall);
const rightWall = leftWall.clone(); rightWall.position.set(20,4,0); scene.add(rightWall);

// ---------- Mesa Blackjack ----------
function createGreenFeltTexture(){
  const c=document.createElement('canvas'); c.width=c.height=512;
  const ctx=c.getContext('2d'); ctx.fillStyle='#0b5b35'; ctx.fillRect(0,0,512,512);
  for(let i=0;i<30000;i++){ const x=Math.random()*512,y=Math.random()*512,a=Math.random()*30; ctx.fillStyle=`rgba(0,0,0,${a/255})`; ctx.fillRect(x,y,1,1);}
  const tex=new THREE.CanvasTexture(c); return tex;
}
const feltTex = createGreenFeltTexture();

const tableTop = new THREE.Mesh(new THREE.CylinderGeometry(4.2,4.2,0.4,32), new THREE.MeshStandardMaterial({ map: feltTex, roughness:0.8 }));
tableTop.position.set(0,0.6,6); tableTop.castShadow=true; tableTop.receiveShadow=true; scene.add(tableTop);

const rim = new THREE.Mesh(new THREE.TorusGeometry(4.35,0.25,16,100), new THREE.MeshStandardMaterial({ color:0x4a2b12 }));
rim.rotation.x=Math.PI/2; rim.position.set(0,0.9,6); rim.castShadow=true; scene.add(rim);

// -------------------- Ruleta horizontal --------------------
const rouletteGroup = new THREE.Group();

// Base de la ruleta
const wheelBase = new THREE.Mesh(
  new THREE.CylinderGeometry(2.2, 2.2, 0.4, 48),
  new THREE.MeshStandardMaterial({ color: 0x2f1608, metalness: 0.6, roughness: 0.4 })
);
wheelBase.castShadow = true;
wheelBase.receiveShadow = true;
wheelBase.position.y = 0.2; // altura sobre el suelo
wheelBase.rotation.x = 0;    // base horizontal
rouletteGroup.add(wheelBase);

// Plato de la ruleta (canvas)
const wheelCanvas = document.createElement('canvas');
wheelCanvas.width = wheelCanvas.height = 1024;
drawRouletteWheel(wheelCanvas);
const wheelTex = new THREE.CanvasTexture(wheelCanvas);

const wheelPlate = new THREE.Mesh(
  new THREE.CylinderGeometry(1.9, 1.9, 0.08, 64),
  new THREE.MeshStandardMaterial({ map: wheelTex })
);
wheelPlate.position.y = 0.42; // justo encima de la base
wheelPlate.rotation.x = 0;    // horizontal
rouletteGroup.add(wheelPlate);

// Borde de madera
const rimMesh = new THREE.Mesh(
  new THREE.TorusGeometry(2.4, 0.18, 16, 100),
  new THREE.MeshStandardMaterial({ map: rouletteWood, metalness: 0.3, roughness: 0.6 })
);
rimMesh.rotation.x = Math.PI / 2; // torus horizontal sobre el plato
rimMesh.position.y = 0.5;
rouletteGroup.add(rimMesh);

// PosiciÃ³n final en la escena
rouletteGroup.position.set(-10, 0, 8);
rouletteGroup.castShadow = true;
scene.add(rouletteGroup);

// ---------- Movimiento cÃ¡mara ----------
let yaw=0, pitch=0; const sens=0.0026;
window.addEventListener('mousemove',e=>{ yaw-=(e.movementX||0)*sens; pitch-=(e.movementY||0)*sens; const maxP=Math.PI/2-0.05; pitch=Math.max(-maxP,Math.min(maxP,pitch)); });
const keys={}; window.addEventListener('keydown',e=>keys[e.code]=true); window.addEventListener('keyup',e=>keys[e.code]=false);
const velocity=new THREE.Vector3(); const accel=20,damping=8;
const forward=new THREE.Vector3(); const right=new THREE.Vector3(); const up=new THREE.Vector3(0,1,0);
const clock=new THREE.Clock();

function updateMovement(dt){
  camera.rotation.set(pitch,yaw,0,"ZYX"); camera.updateMatrixWorld();
  camera.getWorldDirection(forward); forward.y=0; forward.normalize();
  right.copy(forward).cross(up).negate();
  let mx=0,mz=0; if(keys['KeyW']) mz+=1; if(keys['KeyS']) mz-=1; if(keys['KeyD']) mx-=1; if(keys['KeyA']) mx+=1;
  const dir=new THREE.Vector3(); dir.addScaledVector(forward,mz); dir.addScaledVector(right,mx); if(dir.lengthSq()>0) dir.normalize();
  velocity.addScaledVector(dir,accel*dt); velocity.multiplyScalar(1/(1+damping*dt));
  camera.position.addScaledVector(velocity,dt);
}

// ---------- AnimaciÃ³n ----------
function animate(){
  requestAnimationFrame(animate);
  const dt=Math.min(clock.getDelta(),0.05);
  updateMovement(dt);
  wheelGroup.rotation.y+=0.02;
  renderer.render(scene,camera);
}
animate();

// ---------- Resize ----------
window.addEventListener('resize',()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight); });

</script>
</body>
</html>
