<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Casino 3D â€” Ruleta, Slots y Blackjack</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
html,body{height:100%;margin:0;background:#030612;color:#fff;font-family:Arial,Helvetica,sans-serif;overflow:hidden}
#wrap{position:relative;height:100vh;overflow:hidden}
canvas{display:block}

.hud{position:absolute;right:12px;top:12px;z-index:40;max-width:380px}
.panel{background:rgba(0,0,0,0.7);padding:12px;border-radius:10px;margin-bottom:10px}
.info-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0;font-size:13px}
#prompt{position:absolute;left:50%;transform:translateX(-50%);bottom:92px;background:rgba(0,0,0,0.7);padding:8px 12px;border-radius:8px;display:none;z-index:45}
#interaction-panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:420px;background:rgba(8,10,12,0.96);border-radius:10px;box-shadow:0 10px 40px rgba(0,0,0,0.7);color:#ddd;padding:16px;z-index:50;display:none}
#interaction-panel h3{margin-top:0;}
.btn{background:#d95d00;color:white;padding:8px 10px;border-radius:8px;border:none;cursor:pointer;margin-top:8px}
.card{display:inline-block;background:#111;padding:6px 8px;border-radius:6px;border:1px solid #333;margin-right:4px}
.log-entry{margin:2px 0;font-size:12px}
#minimap{position:absolute;left:12px;top:12px;width:120px;height:120px;background:rgba(255,255,255,0.02);border-radius:8px;z-index:30}
</style>
</head>
<body>
<div id="wrap">
  <div id="minimap"></div>
  <div class="hud">
    <div class="panel">
      <h3>Casino 3D</h3>
      <div class="info-row"><span>Saldo</span><strong id="balance">1000</strong></div>
      <div class="info-row"><span>Apuesta</span><strong id="bet">0</strong></div>
      <div style="font-size:13px;margin-top:6px">Controles: <strong>W A S D</strong> moverse Â· <strong>Flechas</strong> girar cÃ¡mara Â· <strong>E</strong> interactuar</div>
    </div>
    <div class="panel">
      <h4>Historial</h4>
      <div id="log" style="max-height:120px;overflow:auto;font-size:12px;background:rgba(255,255,255,0.02);padding:6px;border-radius:6px"></div>
    </div>
  </div>
  <div id="prompt">[E] Interactuar</div>
  <div id="interaction-panel">
    <h3 id="panel-title">Juego</h3>
    <div id="panel-content"></div>
    <button class="btn" onclick="closePanel()">Cerrar</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script>
// ==================== ELEMENTOS ====================
const wrap = document.getElementById('wrap');
const balanceEl = document.getElementById('balance');
const betEl = document.getElementById('bet');
const logEl = document.getElementById('log');
const prompt = document.getElementById('prompt');
const panel = document.getElementById('interaction-panel');
const panelTitle = document.getElementById('panel-title');
const panelContent = document.getElementById('panel-content');

// ==================== ESTADO ====================
let balance = 1000;
let currentBet = 0;

// ==================== HUD ====================
function updateHUD(){ balanceEl.textContent=balance; betEl.textContent=currentBet; }
function addLog(msg){ const div=document.createElement('div'); div.className='log-entry'; div.textContent=msg; logEl.prepend(div); }
updateHUD();
function closePanel(){ panel.style.display='none'; }

// ==================== ESCENA THREE ====================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x041018);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(wrap.clientWidth, wrap.clientHeight);
wrap.appendChild(renderer.domElement);

const camera = new THREE.PerspectiveCamera(72, wrap.clientWidth/wrap.clientHeight, 0.1, 1000);
camera.position.set(0,1.7,15);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(10,20,10); scene.add(dirLight);

// Suelo y paredes
const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshStandardMaterial({color:0x091217, roughness:0.95}));
floor.rotation.x=-Math.PI/2; scene.add(floor);
function wall(w,h,d,x,y,z,rotY){ const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d), new THREE.MeshStandardMaterial({color:0x071018})); m.position.set(x,y,z); if(rotY)m.rotation.y=rotY; scene.add(m);}
wall(50,10,2,0,5,-25); wall(50,10,2,0,5,25); wall(2,10,50,-25,5,0); wall(2,10,50,25,5,0);

// ==================== OBJETOS ====================
// Ruleta
const wheelRadius = 4;
const wheelNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,
                      23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const anglePerNumber = (Math.PI*2)/wheelNumbers.length;

function createWheelCanvas(size=512){
  const c=document.createElement('canvas'); c.width=c.height=size;
  const ctx=c.getContext('2d'); const cx=size/2, cy=size/2, r=size*0.45;
  ctx.fillStyle='#072b22'; ctx.fillRect(0,0,size,size);
  for(let i=0;i<wheelNumbers.length;i++){
    const a0=i*anglePerNumber-Math.PI/2, a1=(i+1)*anglePerNumber-Math.PI/2;
    ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r,a0,a1); ctx.closePath();
    ctx.fillStyle=(wheelNumbers[i]===0)?'#1b8b41':((i%2===0)?'#b71c1c':'#000'); ctx.fill();
    const mid=a0+(a1-a0)/2; ctx.save();
    ctx.translate(cx+Math.cos(mid)*r*0.66,cy+Math.sin(mid)*r*0.66);
    ctx.rotate(mid+Math.PI/2); ctx.fillStyle='#fff'; ctx.font=`${Math.floor(size*0.04)}px sans-serif`;
    ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(wheelNumbers[i],0,0); ctx.restore();
  }
  ctx.beginPath(); ctx.fillStyle='#111'; ctx.arc(cx,cy,r*0.45,0,Math.PI*2); ctx.fill();
  return c;
}
const wheelTex=new THREE.CanvasTexture(createWheelCanvas());
const wheelMesh=new THREE.Mesh(new THREE.CylinderGeometry(wheelRadius,wheelRadius,1.4,64), new THREE.MeshStandardMaterial({map:wheelTex}));
wheelMesh.position.set(0,0.7,0); scene.add(wheelMesh);

// Blackjack table
const bjTable = new THREE.Mesh(new THREE.BoxGeometry(6,0.8,3), new THREE.MeshStandardMaterial({color:0x1b4f2a}));
bjTable.position.set(-10,0.4,-5); scene.add(bjTable);

// Slots
const slotBody = new THREE.Mesh(new THREE.BoxGeometry(2,4,1.5), new THREE.MeshStandardMaterial({color:0x8a0f05}));
slotBody.position.set(10,2,-5); scene.add(slotBody);
const slotSymbols = ['ðŸ’','â­','7','ðŸ‹','ðŸ””','ðŸ‰'];
const reelCanvases=[], reelTexes=[];
for(let i=0;i<3;i++){
  const c=document.createElement('canvas'); c.width=128; c.height=192;
  const ctx=c.getContext('2d'); ctx.fillStyle='#070707'; ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle='#fff'; ctx.font='64px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(slotSymbols[Math.floor(Math.random()*slotSymbols.length)],64,96);
  reelCanvases.push(c); reelTexes.push(new THREE.CanvasTexture(c));
}

// ==================== ZONAS DE INTERACCIÃ“N ====================
const zones=[
  {x:0,z:0,label:'Ruleta',action:openRouletteUI},
  {x:-10,z:-5,label:'Blackjack',action:openBlackjackUI},
  {x:10,z:-5,label:'Tragaperras',action:openSlotsUI}
];

let playerPos = new THREE.Vector3(0,0,15);
let currentZone = null;
function detectZones(){
  currentZone = null;
  for(const z of zones){
    const dx = playerPos.x - z.x, dz = playerPos.z - z.z;
    if(Math.sqrt(dx*dx+dz*dz)<3){ currentZone=z; prompt.style.display='block'; prompt.textContent='[E] '+z.label; return; }
  }
  prompt.style.display='none';
}

// ==================== MOVIMIENTO ====================
const keys={w:false,a:false,s:false,d:false,ArrowLeft:false,ArrowRight:false,ArrowUp:false,ArrowDown:false};
window.addEventListener("keydown",e=>{ if(e.key in keys) keys[e.key]=true; });
window.addEventListener("keyup",e=>{ if(e.key in keys) keys[e.key]=false; });
const speed=5;
function computeDelta(dt){
  const rotSpeed=1.5*dt;
  if(keys.ArrowLeft) yaw+=rotSpeed; if(keys.ArrowRight) yaw-=rotSpeed;
  if(keys.ArrowUp) pitch+=rotSpeed*0.5; if(keys.ArrowDown) pitch-=rotSpeed*0.5;
  pitch=Math.max(-1.2,Math.min(1.2,pitch));
  const e=new THREE.Euler(pitch,yaw,0,'YXZ'); const q=new THREE.Quaternion().setFromEuler(e);
  const forward=new THREE.Vector3(0,0,-1).applyQuaternion(q); forward.y=0; forward.normalize();
  const right=new THREE.Vector3(1,0,0).applyQuaternion(q); right.y=0; right.normalize();
  let mf=0,mr=0; if(keys.w) mf+=1; if(keys.s) mf-=1; if(keys.a) mr-=1; if(keys.d) mr+=1;
  const len=Math.hypot(mf,mr); if(len>0){ mf/=len; mr/=len; }
  const delta=new THREE.Vector3(); delta.addScaledVector(forward,mf*speed*dt); delta.addScaledVector(right,mr*speed*dt);
  return delta;
}

// ==================== EVENTOS ====================
document.addEventListener("keydown",(e)=>{
  if(e.key.toLowerCase()==='e' && currentZone) currentZone.action();
  if(e.key==='Escape') closePanel();
});

// ==================== BLACKJACK LÃ“GICA ====================
let deck = [];
let playerHands = [], dealerHand = [], currentHandIndex = 0, canDouble=false, canSplit=false;

function createDeck(){
    const suits = ['â™ ','â™¥','â™¦','â™£'], values=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    const d = [];
    for(const s of suits) for(const v of values) d.push({value:v,suit:s});
    return d.sort(()=>Math.random()-0.5);
}

function displayHand(hand){ return hand.map(c=>c.value+c.suit).join(' '); }

function openBlackjackUI(){
    if(balance<=0){ addLog("Saldo insuficiente para jugar Blackjack"); return; }
    panelTitle.textContent='Blackjack';
    panelContent.innerHTML = `<div>Saldo: ${balance}</div>
        <input type="number" id="bj-bet" placeholder="Apuesta" min="1" max="${balance}" style="width:80px"/>
        <button class="btn" onclick="startBlackjack()">Iniciar Mano</button>
        <div id="bj-info" style="margin-top:8px;"></div>`;
    panel.style.display='block';
}

function startBlackjack(){
    const betInput = document.getElementById('bj-bet');
    const bet = parseInt(betInput.value);
    if(isNaN(bet) || bet<=0 || bet>balance){ addLog("Apuesta invÃ¡lida"); return; }
    currentBet = bet; balance -= bet; updateHUD();
    addLog(`Apuesta Blackjack: ${bet}$`);
    deck = createDeck();
    playerHands = [ [deck.pop(), deck.pop()] ];
    dealerHand = [deck.pop(), deck.pop()];
    currentHandIndex = 0;
    canDouble = true;
    canSplit = (playerHands[0][0].value === playerHands[0][1].value);
    showBlackjackState();
}

function showBlackjackState(){
    const info = document.getElementById('bj-info');
    const hand = playerHands[currentHandIndex];
    let html = `<div>Mano: ${displayHand(hand)} (Valor: ${handValue(hand)})</div>`;
    html += `<div>Dealer: ${dealerHand[0].value+dealerHand[0].suit} ??</div>`;
    html += `<button class="btn" onclick="hit()">Pedir Carta</button>`;
    html += `<button class="btn" onclick="stand()">Plantarse</button>`;
    if(canDouble) html += `<button class="btn" onclick="doubleBet()">Doblar</button>`;
    if(canSplit) html += `<button class="btn" onclick="splitHand()">Dividir</button>`;
    info.innerHTML = html;
}

function hit(){ const hand = playerHands[currentHandIndex]; hand.push(deck.pop()); canDouble=false; canSplit=false;
    if(handValue(hand)>21){ addLog(`Mano ${currentHandIndex+1} se pasÃ³ (${handValue(hand)})`); nextHandOrDealer(); } 
    else showBlackjackState(); }
function stand(){ nextHandOrDealer(); }
function doubleBet(){ if(balance<currentBet){ addLog("Saldo insuficiente para doblar"); return; } balance-=currentBet; currentBet*=2; updateHUD(); hit(); }
function splitHand(){ if(playerHands[0].length!==2 || playerHands[0][0].value!==playerHands[0][1].value || balance<currentBet){ addLog("No se puede dividir"); return; }
balance-=currentBet; updateHUD(); playerHands=[ [playerHands[0][0], deck.pop()], [playerHands[0][1], deck.pop()] ]; currentHandIndex=0; canDouble=false; canSplit=false; showBlackjackState(); }
function nextHandOrDealer(){ if(currentHandIndex<playerHands.length-1){ currentHandIndex++; showBlackjackState(); } else playDealer(); }
function playDealer(){ let dealerVal=handValue(dealerHand); while(dealerVal<17){ dealerHand.push(deck.pop()); dealerVal=handValue(dealerHand); }
addLog(`Dealer: ${displayHand(dealerHand)} (Valor: ${dealerVal})`); evaluateHands(); }
function evaluateHands(){ const dealerVal=handValue(dealerHand);
playerHands.forEach((hand,i)=>{ const val=handValue(hand); if(val>21) addLog(`Mano ${i+1}: Perdida`);
else if(dealerVal>21 || val>dealerVal){ addLog(`Mano ${i+1}: Ganaste!`); balance+=currentBet*2; }
else if(val===dealerVal){ addLog(`Mano ${i+1}: Empate`); balance+=currentBet; } else addLog(`Mano ${i+1}: Perdida`); });
currentBet=0; updateHUD(); panelContent.querySelector('#bj-info').innerHTML += `<div><button class="btn" onclick="openBlackjackUI()">Nueva Mano</button></div>`; }

// ==================== RULETA ====================
function openRouletteUI(){ if(balance<=0){ addLog("Saldo insuficiente para Ruleta"); return; }
panelTitle.textContent='Ruleta';
panelContent.innerHTML = `<div>Saldo: ${balance}</div>
<input type="number" id="roulette-bet" placeholder="Apuesta" min="1" max="${balance}" style="width:80px"/>
<input type="text" id="roulette-numbers" placeholder="NÃºmeros (ej: 0,7,32)" style="width:120px"/>
<button class="btn" onclick="spinRoulette()">Girar Ruleta</button>`; panel.style.display='block'; }
function spinRoulette(){ const betAmount=parseInt(document.getElementById('roulette-bet').value);
const numbersInput=document.getElementById('roulette-numbers').value;
if(isNaN(betAmount)||betAmount<=0||betAmount>balance){ addLog("Apuesta invÃ¡lida"); return; }
const nums=numbersInput.split(',').map(x=>parseInt(x.trim())).filter(x=>wheelNumbers.includes(x));
if(nums.length===0){ addLog("Debe seleccionar al menos un nÃºmero vÃ¡lido"); return; }
balance-=betAmount; updateHUD(); const chosenIndex=Math.floor(Math.random()*wheelNumbers.length);
const chosenNumber=wheelNumbers[chosenIndex]; addLog(`Ruleta girando...`);
setTimeout(()=>{ addLog(`Ruleta: saliÃ³ ${chosenNumber}`); if(nums.includes(chosenNumber)){ const payout=betAmount*wheelNumbers.length/nums.length; addLog(`Ganaste ${payout}$`); balance+=payout; } 
else addLog(`Perdiste ${betAmount}$`); updateHUD(); },2000); }

// ==================== TRAGAPERRAS ====================
function openSlotsUI(){ if(balance<=0){ addLog("Saldo insuficiente para Tragaperras"); return; }
panelTitle.textContent='Tragaperras';
panelContent.innerHTML = `<div>Saldo: ${balance}</div>
<input type="number" id="slot-bet" placeholder="Apuesta" min="1" max="${balance}" style="width:80px"/>
<button class="btn" onclick="spinSlots()">Girar</button>`; panel.style.display='block'; }
function spinSlots(){ const bet=parseInt(document.getElementById('slot-bet').value);
if(isNaN(bet)||bet<=0||bet>balance){ addLog("Apuesta invÃ¡lida"); return; }
balance-=bet; updateHUD(); panel.style.display='none';
const results=[]; for(let i=0;i<3;i++){ const sym=slotSymbols[Math.floor(Math.random()*slotSymbols.length)]; results.push(sym); }
const counts={}; results.forEach(s=>counts[s]=(counts[s]||0)+1);
let win=0; for(const s in counts){ if(counts[s]===3) win=bet*5; else if(counts[s]===2) win=bet*2; }
if(win>0){ balance+=win; addLog(`Tragaperras: ganaste $${win}!`); } else addLog('Tragaperras: perdiste'); updateHUD(); }

// ==================== ANIMACIÃ“N ====================
let lastTime=0, yaw=0, pitch=0;
function animate(ts){
  requestAnimationFrame(animate);
  const dt=(ts-lastTime)*0.001; lastTime=ts;
  detectZones();
  const delta=computeDelta(dt); playerPos.add(delta);
  camera.position.copy(playerPos); camera.position.y=1.7; camera.rotation.set(pitch,yaw,0,'YXZ');
  renderer.render(scene,camera);
}
requestAnimationFrame(animate);

// ==================== RESIZE ====================
window.addEventListener("resize",()=>{ camera.aspect=wrap.clientWidth/wrap.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(wrap.clientWidth,wrap.clientHeight); });

</script>
</body>
</html>
