<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Casino Deluxe — Optimizado</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<style>
  body { margin:0; overflow:hidden; background:#111; font-family:Arial, Helvetica, sans-serif; }
  #hint {
    position:absolute; left:12px; top:12px; z-index:5;
    background:rgba(255,255,255,0.06); color:#fff;
    padding:8px 10px; border-radius:8px; font-size:13px;
  }
</style>
</head>
<body>
<div id="hint">W A S D para moverse, ratón para mirar, E para abrir la puerta</div>
<script>
// -------------------- Escena --------------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xefeae4);

// -------------------- Cámara --------------------
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 150);
camera.position.set(0, 1.7, -12); // spawn en pasillo

// -------------------- Renderer --------------------
const renderer = new THREE.WebGLRenderer({ antialias:false });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(1, window.devicePixelRatio));
document.body.appendChild(renderer.domElement);

// -------------------- Luces --------------------
const ambient = new THREE.AmbientLight(0xffffff,0.75);
scene.add(ambient);
const sun = new THREE.DirectionalLight(0xfff2cc,0.6);
sun.position.set(40,50,40);
scene.add(sun);

// -------------------- Materiales --------------------
const carpetMat = new THREE.MeshBasicMaterial({color:0x7d0a0a});
const marbleMat = new THREE.MeshBasicMaterial({color:0xf0ebe6});
const woodMat = new THREE.MeshBasicMaterial({color:0x5a3719});
const greenMat = new THREE.MeshBasicMaterial({color:0x0b5b35});
const redMat = new THREE.MeshBasicMaterial({color:0xb20d0d});
const blackMat = new THREE.MeshBasicMaterial({color:0x111});

// -------------------- Suelo y techo --------------------
const floor = new THREE.Mesh(new THREE.PlaneGeometry(60,40), carpetMat);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

const ceiling = new THREE.Mesh(new THREE.PlaneGeometry(60,40), woodMat);
ceiling.rotation.x = Math.PI/2;
ceiling.position.y = 16;
scene.add(ceiling);

// -------------------- Paredes --------------------
function wall(x,y,z,sx,sy,sz){
  const w = new THREE.Mesh(new THREE.BoxGeometry(sx,sy,sz), marbleMat);
  w.position.set(x,y,z);
  scene.add(w);
}
// lateral
wall(-9,6,-8,1,14,32);
wall(9,6,-8,1,14,32);
// fondo y frente
wall(0,6,-28,60,14,1); // puerta detrás
wall(0,6,20,60,14,1);

// -------------------- Puerta interactiva --------------------
const doorMat = new THREE.MeshBasicMaterial({color:0x8a5a2b});
const doorLeft = new THREE.Mesh(new THREE.BoxGeometry(1.2,3.8,0.15), doorMat);
doorLeft.position.set(-0.6,1.9,-28);
scene.add(doorLeft);
const doorRight = new THREE.Mesh(new THREE.BoxGeometry(1.2,3.8,0.15), doorMat);
doorRight.position.set(0.6,1.9,-28);
scene.add(doorRight);

// -------------------- Mesa Blackjack --------------------
const tableGroup = new THREE.Group();
const tableTop = new THREE.Mesh(new THREE.CylinderGeometry(3,3,0.3,24), greenMat);
tableTop.position.set(6,1.05,10);
tableGroup.add(tableTop);
const rim = new THREE.Mesh(new THREE.TorusGeometry(3.2,0.25,8,32), woodMat);
rim.rotation.x = Math.PI/2;
rim.position.set(6,1.2,10);
tableGroup.add(rim);
scene.add(tableGroup);

// -------------------- Ruleta 3D básica --------------------
const wheelGroup = new THREE.Group();

// base y pedestal
const stand = new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.8,1,16), woodMat);
stand.position.set(-6,0.75,8);
wheelGroup.add(stand);
const base = new THREE.Mesh(new THREE.CylinderGeometry(1.5,1.5,0.2,24), woodMat);
base.position.set(-6,0.1,8);
wheelGroup.add(base);

// plato giratorio
const wheelPlate = new THREE.Mesh(new THREE.CylinderGeometry(1.8,1.8,0.06,48), greenMat);
wheelPlate.position.set(-6,1.2,8);
wheelGroup.add(wheelPlate);
wheelGroup.userData.wheelPlate = wheelPlate;

// rim decorativo
const rimWheel = new THREE.Mesh(new THREE.TorusGeometry(1.9,0.1,8,32), redMat);
rimWheel.rotation.x = Math.PI/2;
rimWheel.position.set(-6,1.2,8);
wheelGroup.add(rimWheel);

scene.add(wheelGroup);

// -------------------- Movimiento --------------------
let yaw=0,pitch=0;
const sens=0.002;
const keys={};

window.addEventListener('mousemove',e=>{
  yaw-=e.movementX*sens;
  pitch-=e.movementY*sens;
  pitch=Math.max(-Math.PI/2+0.05,Math.min(Math.PI/2-0.05,pitch));
});
window.addEventListener('keydown',e=>{keys[e.code]=true;});
window.addEventListener('keyup',e=>{keys[e.code]=false;});

function move(dt){
  camera.rotation.set(pitch,yaw,0,"ZYX");
  const forward=new THREE.Vector3();
  camera.getWorldDirection(forward); forward.y=0; forward.normalize();
  const right=new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0)).negate();
  let dir=new THREE.Vector3();
  if(keys['KeyW']) dir.add(forward);
  if(keys['KeyS']) dir.addScaledVector(forward,-1);
  if(keys['KeyA']) dir.add(right);
  if(keys['KeyD']) dir.addScaledVector(right,-1);
  if(dir.lengthSq()>0) dir.normalize();
  camera.position.addScaledVector(dir,dt*8);
  if(camera.position.y<1.6) camera.position.y=1.7;
}

// -------------------- Puerta interactiva con E --------------------
window.addEventListener('keydown',e=>{
  if(e.key.toLowerCase()==='e'){
    const d=camera.position.distanceTo(new THREE.Vector3(0,2,-28));
    if(d<3.5){
      window.location.href='h.html';
    }
  }
});

// -------------------- Animación --------------------
function animate(){
  requestAnimationFrame(animate);
  const dt=0.016;
  move(dt);
  // solo gira el plato de la ruleta
  wheelGroup.userData.wheelPlate.rotation.y+=0.04;
  renderer.render(scene,camera);
}
animate();

// -------------------- Resize --------------------
window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
