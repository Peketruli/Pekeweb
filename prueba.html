<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Casino 3D - Paso 2 Movimiento</title>
<style>
  html, body { margin:0; overflow:hidden; background:#111; }
  #instrucciones {
    position:absolute; top:0; left:0; right:0; bottom:0;
    display:flex; align-items:center; justify-content:center;
    background:rgba(0,0,0,0.8); color:white; font-family:sans-serif;
    text-align:center; cursor:pointer; font-size:22px;
  }
</style>
</head>
<body>
<div id="instrucciones">Haz clic para entrar al casino (usa W, A, S, D, Shift, Espacio)</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/PointerLockControls.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x223355);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 2, 5);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Luces
const ambient = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambient);
const dir = new THREE.DirectionalLight(0xffffff, 1);
dir.position.set(5,10,5);
scene.add(dir);

// Suelo
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(50,50),
  new THREE.MeshStandardMaterial({color:0x808080})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// Cubo
const cube = new THREE.Mesh(
  new THREE.BoxGeometry(1,1,1),
  new THREE.MeshStandardMaterial({color:0x00aaff})
);
cube.position.set(0,0.5,0);
scene.add(cube);

// Esfera
const sphere = new THREE.Mesh(
  new THREE.SphereGeometry(0.5,32,16),
  new THREE.MeshStandardMaterial({color:0xffaa00})
);
sphere.position.set(2,0.5,-3);
scene.add(sphere);

// Controles de movimiento
const controls = new THREE.PointerLockControls(camera, document.body);
document.getElementById('instrucciones').addEventListener('click', () => {
  controls.lock();
});
controls.addEventListener('lock', () => {
  document.getElementById('instrucciones').style.display = 'none';
});
controls.addEventListener('unlock', () => {
  document.getElementById('instrucciones').style.display = '';
});
scene.add(controls.getObject());

// Movimiento
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
let canJump=false;
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();

const onKeyDown = function(event){
  switch(event.code){
    case 'ArrowUp':
    case 'KeyW': moveForward = true; break;
    case 'ArrowLeft':
    case 'KeyA': moveLeft = true; break;
    case 'ArrowDown':
    case 'KeyS': moveBackward = true; break;
    case 'ArrowRight':
    case 'KeyD': moveRight = true; break;
    case 'Space':
      if (canJump === true) velocity.y += 5;
      canJump = false;
      break;
  }
};
const onKeyUp = function(event){
  switch(event.code){
    case 'ArrowUp':
    case 'KeyW': moveForward = false; break;
    case 'ArrowLeft':
    case 'KeyA': moveLeft = false; break;
    case 'ArrowDown':
    case 'KeyS': moveBackward = false; break;
    case 'ArrowRight':
    case 'KeyD': moveRight = false; break;
  }
};
document.addEventListener('keydown', onKeyDown);
document.addEventListener('keyup', onKeyUp);

// FÃ­sica simple
const clock = new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);

  const delta = clock.getDelta();
  velocity.x -= velocity.x * 10.0 * delta;
  velocity.z -= velocity.z * 10.0 * delta;
  velocity.y -= 9.8 * 5.0 * delta; // gravedad

  direction.z = Number(moveForward) - Number(moveBackward);
  direction.x = Number(moveRight) - Number(moveLeft);
  direction.normalize();

  const speed = (event?.shiftKey) ? 600.0 : 400.0; // Shift para correr
  if (moveForward || moveBackward) velocity.z -= direction.z * speed * delta;
  if (moveLeft || moveRight) velocity.x -= direction.x * speed * delta;

  controls.moveRight(-velocity.x * delta);
  controls.moveForward(-velocity.z * delta);
  controls.getObject().position.y += (velocity.y * delta);

  if (controls.getObject().position.y < 2){
    velocity.y = 0;
    controls.getObject().position.y = 2;
    canJump = true;
  }

  cube.rotation.y += 0.02;
  renderer.render(scene, camera);
}
animate();

window.addEventListener('resize', ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
