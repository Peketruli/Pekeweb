<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Casino 3D — Básico</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
html, body {height:100%; margin:0; background:#030612; color:#fff; font-family:Arial, Helvetica, sans-serif; overflow:hidden;}
#wrap {position:relative; width:100%; height:100vh;}
canvas {display:block;}
.hud {position:absolute; top:12px; right:12px; max-width:300px; z-index:10;}
.panel {background:rgba(0,0,0,0.7); padding:10px; border-radius:8px; margin-bottom:10px;}
.info-row {display:flex; justify-content:space-between; margin:4px 0;}
#prompt {position:absolute; bottom:80px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); padding:6px 10px; border-radius:6px; display:none; z-index:20;}
#interaction-panel {position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:350px; background:rgba(8,10,12,0.95); padding:16px; border-radius:10px; display:none; z-index:30;}
.btn {background:#d95d00; color:white; padding:6px 10px; border:none; border-radius:6px; cursor:pointer; margin-top:6px;}
</style>
</head>
<body>
<div id="wrap">
  <div class="hud">
    <div class="panel">
      <div class="info-row"><span>Saldo</span><strong id="balance">1000</strong></div>
      <div class="info-row"><span>Apuesta</span><strong id="bet">0</strong></div>
    </div>
  </div>
  <div id="prompt">[E] Interactuar</div>
  <div id="interaction-panel">
    <h3 id="panel-title">Juego</h3>
    <div id="panel-content"></div>
    <button class="btn" onclick="closePanel()">Cerrar</button>
  </div>
</div>

<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script>
// ==================== CONFIG ====================
const wrap = document.getElementById('wrap');
const balanceEl = document.getElementById('balance');
const betEl = document.getElementById('bet');
const logEl = document.getElementById('log');
const prompt = document.getElementById('prompt');
const panel = document.getElementById('interaction-panel');
const panelTitle = document.getElementById('panel-title');
const panelContent = document.getElementById('panel-content');

let balance = 1000;
let currentBet = 0;

function updateHUD(){
  balanceEl.textContent = balance;
  betEl.textContent = currentBet;
}

function addLog(msg){
  console.log(msg); // por ahora log simple
}

updateHUD();

// ==================== THREE SCENE ====================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x041018);
const camera = new THREE.PerspectiveCamera(75, wrap.clientWidth/wrap.clientHeight, 0.1, 1000);
camera.position.set(0,1.7,10);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(wrap.clientWidth, wrap.clientHeight);
wrap.appendChild(renderer.domElement);

// luces
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(10,20,10);
scene.add(dirLight);

// suelo
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(50,50),
  new THREE.MeshStandardMaterial({color:0x091217})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// paredes simples
function addWall(x,y,z,w,h,d){
  const wall = new THREE.Mesh(
    new THREE.BoxGeometry(w,h,d),
    new THREE.MeshStandardMaterial({color:0x071018})
  );
  wall.position.set(x,y,z);
  scene.add(wall);
}
addWall(0,5,-25,50,10,2);
addWall(0,5,25,50,10,2);
addWall(-25,5,0,2,10,50);
addWall(25,5,0,2,10,50);

// ==================== PLAYER ====================
let playerPos = new THREE.Vector3(0,0,10);
let yaw = 0, pitch = 0;

// ==================== ZONAS ====================
const zones = [
  {x:0,z:0,label:'Ruleta', action:()=>openPanel('Ruleta')},
  {x:-10,z:-5,label:'Blackjack', action:()=>openPanel('Blackjack')},
  {x:10,z:-5,label:'Tragaperras', action:()=>openPanel('Tragaperras')}
];

let currentZone = null;
function detectZones(){
  if(!playerPos) return;
  currentZone = null;
  for(const z of zones){
    const dx = playerPos.x - z.x;
    const dz = playerPos.z - z.z;
    if(Math.sqrt(dx*dx+dz*dz) < 3){
      currentZone = z;
      prompt.style.display = 'block';
      prompt.textContent = '[E] ' + z.label;
      return;
    }
  }
  prompt.style.display = 'none';
}

// ==================== PANEL ====================
function openPanel(game){
  panelTitle.textContent = game;
  panelContent.innerHTML = `<p>Panel de ${game} (prototipo)</p>`;
  panel.style.display = 'block';
}
function closePanel(){ panel.style.display = 'none'; }

// ==================== CONTROLS ====================
const keys={w:false,a:false,s:false,d:false,ArrowLeft:false,ArrowRight:false,ArrowUp:false,ArrowDown:false};
window.addEventListener('keydown',e=>{ if(e.key in keys) keys[e.key]=true; });
window.addEventListener('keyup',e=>{ if(e.key in keys) keys[e.key]=false; });

// ==================== ANIMATION ====================
const speed = 5;
function computeDelta(dt){
  const rotSpeed = 1.5*dt;
  if(keys.ArrowLeft) yaw += rotSpeed;
  if(keys.ArrowRight) yaw -= rotSpeed;
  if(keys.ArrowUp) pitch += rotSpeed*0.5;
  if(keys.ArrowDown) pitch -= rotSpeed*0.5;
  pitch = Math.max(-1.2, Math.min(1.2, pitch));

  const e = new THREE.Euler(pitch,yaw,0,'YXZ');
  const q = new THREE.Quaternion().setFromEuler(e);

  const forward = new THREE.Vector3(0,0,-1).applyQuaternion(q); forward.y=0; forward.normalize();
  const right = new THREE.Vector3(1,0,0).applyQuaternion(q); right.y=0; right.normalize();

  let mf=0, mr=0;
  if(keys.w) mf+=1;
  if(keys.s) mf-=1;
  if(keys.a) mr-=1;
  if(keys.d) mr+=1;

  const len = Math.hypot(mf,mr);
  if(len>0){ mf/=len; mr/=len; }

  const delta = new THREE.Vector3();
  delta.addScaledVector(forward, mf*speed*dt);
  delta.addScaledVector(right, mr*speed*dt);
  return delta;
}

document.addEventListener('keydown',(e)=>{
  if(e.key.toLowerCase()==='e' && currentZone) currentZone.action();
  if(e.key==='Escape') panel.style.display='none';
});

let lastTime = 0;
function animate(ts){
  requestAnimationFrame(animate);
  const dt = (ts-lastTime)*0.001; lastTime = ts;

  detectZones();
  playerPos.add(computeDelta(dt));

  camera.position.copy(playerPos);
  camera.position.y = 1.7;
  camera.rotation.set(pitch,yaw,0,'YXZ');

  renderer.render(scene,camera);
}
requestAnimationFrame(animate);

// ==================== RESIZE ====================
window.addEventListener('resize', ()=>{
  camera.aspect = wrap.clientWidth / wrap.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(wrap.clientWidth, wrap.clientHeight);
});
</script>
</body>
</html>
