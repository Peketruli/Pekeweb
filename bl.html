<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kenketa</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
:root {
  --neon-orange: #ff6f00;
  --neon-purple: #b517ff;
  --neon-green: #00ff9d;
}

/* Fondo con gradiente y animaci√≥n ligera */
body {
  background: radial-gradient(circle at 20% 20%, #1a001a, #000000 90%);
  color: white;
  font-family: 'Poppins', Arial, sans-serif;
  text-align: center;
  padding: 30px;
  overflow-x: hidden;
  position: relative;
}

/* Bot√≥n volver */
button.auth-button {
  background: linear-gradient(90deg, var(--neon-purple), var(--neon-orange));
  border-radius: 10px;
  color: white;
  padding: 10px 18px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  margin-bottom: 20px;
  text-shadow: 0 0 6px #000;
  box-shadow: 0 0 15px var(--neon-purple);
  transition: transform 0.2s, box-shadow 0.3s;
}

button.auth-button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px var(--neon-orange);
}

h1 {
  font-size: 2.4em;
  color: var(--neon-orange);
  text-shadow: 0 0 12px var(--neon-orange), 0 0 25px var(--neon-purple);
  margin-bottom: 20px;
}

#pekePuntos {
  font-size: 2em;
  margin-bottom: 20px;
  text-shadow: 0 0 6px var(--neon-green);
}

/* Apuesta */
#bet-container {
  margin-bottom: 20px;
}

input[type="number"] {
  padding: 6px;
  width: 140px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
  text-align: center;
}

/* Botones de juego */
button#place-bet-button, #hit-button, #stand-button, #reset-button {
  padding: 12px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: transform 0.2s, box-shadow 0.3s;
}

#place-bet-button {
  background: linear-gradient(90deg, var(--neon-green), var(--neon-purple));
  color: black;
  box-shadow: 0 0 15px var(--neon-green);
}
#hit-button { background: var(--neon-green); color: black; box-shadow: 0 0 15px var(--neon-green);}
#stand-button { background: var(--neon-orange); color: black; box-shadow: 0 0 15px var(--neon-orange);}
#reset-button { background: var(--neon-purple); color: white; box-shadow: 0 0 15px var(--neon-purple); }

button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px var(--neon-orange);
}

/* Contenedor de juego */
#game-container {
  background-color: rgba(20,0,20,0.85);
  border-radius: 20px;
  padding: 25px;
  margin: 0 auto;
  max-width: 650px;
  box-shadow: 0 0 30px var(--neon-purple);
  border: 2px solid var(--neon-orange);
}

/* Manos del jugador y dealer */
#player-hand, #dealer-hand {
  display: flex;
  justify-content: center;
  margin: 20px 0;
  min-height: 90px;
}

#player-points, #dealer-points {
  color: var(--neon-orange);
  font-weight: bold;
  margin-bottom: 10px;
  text-shadow: 0 0 6px var(--neon-orange);
}

/* Cartas */
.card {
  width: 60px;
  height: 90px;
  border-radius: 12px;
  background-color: white;
  color: black;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 5px;
  font-weight: bold;
  font-size: 1.3em;
  box-shadow: 0 0 8px rgba(0,0,0,0.6), 0 0 6px var(--neon-green);
  transition: transform 0.2s, box-shadow 0.3s;
}

.card.hidden {
  background-color: #222;
  color: #222;
  box-shadow: 0 0 10px var(--neon-orange);
}

/* Mensaje de juego */
#game-message {
  margin-top: 20px;
  font-size: 20px;
  min-height: 24px;
  color: var(--neon-orange);
  font-weight: bold;
  text-shadow: 0 0 8px var(--neon-orange), 0 0 12px var(--neon-purple);
}
</style>
</head>
<body>
<button class="auth-button" onclick="window.location.href='cliytjfkjyrfhd.html'">üèöÔ∏èVolver</button>
<h1>üé∞ Blackjack üé∞</h1>
<div id="pekePuntos">PekePuntos: 0</div>

<div id="bet-container">
    <label for="bet-amount">Apuesta: </label>
    <input type="number" id="bet-amount" min="1" placeholder="Ingresa tus PekePuntos">
    <button id="place-bet-button">Apostar</button>
</div>

<div id="game-container">
    <div id="dealer-hand"></div>
    <div id="dealer-points"></div>
    <div id="player-hand"></div>
    <div id="player-points"></div>
    <div id="game-message"></div>
</div>

<button id="hit-button" disabled>Pedir</button>
<button id="stand-button" disabled>Plantarse</button>
<button id="reset-button" style="display:none; margin-top:15px; background:#007bff; color:white;">üîÑ Reiniciar</button>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let playerHand = [];
let dealerHand = [];
let hideDealer = true;
let currentBet = 0;
let currentUser = null;
let deck = [];

// --- Cargar PekePuntos y verificar baneo ---
async function loadPekePuntos() {
    currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if(!currentUser) {
        alert("Debes iniciar sesi√≥n para jugar.");
        window.location.href = "login.html";
        return;
    }

    // ‚úÖ Verificar si est√° baneado
    const { data, error } = await supabase
        .from("usuarios")
        .select("pekepuntos, banned")
        .eq("id", currentUser.id)
        .single();

    if(error) { 
        console.error(error); 
        return; 
    }

    // ‚ö° Aqu√≠ estaba el error: usabas `baneado` en vez de `banned`
    if(data && data.banned === true){
        alert("Has sido baneado y no puedes acceder al juego.");
        document.getElementById("place-bet-button").disabled = true;
        document.getElementById("hit-button").disabled = true;
        document.getElementById("stand-button").disabled = true;
        return;
    }

    currentUser.pekepuntos = data.pekepuntos;
    document.getElementById("pekePuntos").textContent = `PekePuntos: ${currentUser.pekepuntos}`;
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
}

// --- Actualizar puntos seg√∫n resultado ---
async function updatePoints(result) {
    if(result === "win") currentUser.pekepuntos += currentBet * 2;
    else if(result === "tie") currentUser.pekepuntos += currentBet;
    document.getElementById("pekePuntos").textContent = `PekePuntos: ${currentUser.pekepuntos}`;
    const { error } = await supabase.from("usuarios").update({ pekepuntos: currentUser.pekepuntos }).eq("id", currentUser.id);
    if(error) console.error("Error al actualizar Pekepuntos:", error);
    localStorage.setItem("currentUser", JSON.stringify(currentUser));
    currentBet = 0;
    document.getElementById("bet-amount").disabled = false;
    document.getElementById("place-bet-button").disabled = false;
    document.getElementById("bet-amount").value = '';
}

// --- Baraja y valor de cartas ---
function createDeck(){
    const suits = ["‚ô•","‚ô¶","‚ô£","‚ô†"];
    const values = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    let deck = [];
    for(let s of suits){ for(let v of values){ deck.push({suit:s,value:v}); } }
    return deck.sort(()=> Math.random()-0.5);
}
function cardValue(card){ 
    if(["J","Q","K"].includes(card.value)) return 10; 
    if(card.value==="A") return 11; 
    return parseInt(card.value); 
}
function handValue(hand){ 
    let val=hand.reduce((acc,c)=>acc+cardValue(c),0); 
    let aces=hand.filter(c=>c.value==="A").length; 
    while(val>21 && aces>0){ val-=10; aces--; } 
    return val; 
}

// --- Mostrar cartas ---
function renderHand(containerId, hand, hideSecond=false) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    hand.forEach((card, index) => {
        const cardDiv = document.createElement('div');
        cardDiv.classList.add('card');
        if(hideSecond && index === 1) cardDiv.classList.add('hidden');
        cardDiv.textContent = cardDiv.classList.contains('hidden') ? '??' : card.value + card.suit;
        container.appendChild(cardDiv);
    });
}

// --- Actualizar UI y puntos ---
function updateUI(){
    renderHand('player-hand', playerHand);
    renderHand('dealer-hand', dealerHand, hideDealer);

    const playerPoints = handValue(playerHand);
    document.getElementById('player-points').textContent = `Suma: ${playerPoints}`;

    const dealerPoints = hideDealer ? '?' : handValue(dealerHand);
    document.getElementById('dealer-points').textContent = `Suma: ${dealerPoints}`;
}

// --- Finalizar juego ---
function endGame(msg){
    hideDealer=false; 
    updateUI();
    document.getElementById("game-message").textContent = msg;
    document.getElementById("hit-button").disabled=true;
    document.getElementById("stand-button").disabled=true;

    if(msg.includes("Ganaste")) updatePoints("win");
    else if(msg.includes("Pierdes") || msg.includes("perdiste") || msg.includes("Crupier gana")) updatePoints("lose");
    else if(msg.includes("Empate")) updatePoints("tie");

    document.getElementById("reset-button").style.display = "inline-block";
}

// --- Reiniciar ---
document.getElementById("reset-button").addEventListener("click", ()=>{
    playerHand = [];
    dealerHand = [];
    hideDealer = true;
    deck = [];
    currentBet = 0;

    document.getElementById("player-hand").innerHTML = "";
    document.getElementById("dealer-hand").innerHTML = "";
    document.getElementById("player-points").textContent = "";
    document.getElementById("dealer-points").textContent = "";
    document.getElementById("game-message").textContent = "";

    document.getElementById("bet-amount").disabled = false;
    document.getElementById("place-bet-button").disabled = false;
    document.getElementById("bet-amount").value = "";

    document.getElementById("reset-button").style.display = "none";
});

// --- Iniciar juego ---
function startGame(){
    deck = createDeck();
    playerHand=[deck.pop(),deck.pop()];
    dealerHand=[deck.pop(),deck.pop()];
    hideDealer=true;
    updateUI();
    document.getElementById("hit-button").disabled=false;
    document.getElementById("stand-button").disabled=false;
    document.getElementById("game-message").textContent="";
}

// --- Eventos ---
document.getElementById("place-bet-button").addEventListener("click", async ()=>{
    const bet=parseInt(document.getElementById("bet-amount").value);
    if(isNaN(bet) || bet<=0){ alert("Introduce una cantidad v√°lida."); return; }
    if(bet>currentUser.pekepuntos){ alert("No tienes suficientes PekePuntos."); return; }

    currentBet=bet;
    currentUser.pekepuntos -= currentBet;
    document.getElementById("pekePuntos").textContent = `PekePuntos: ${currentUser.pekepuntos}`;

    const { error } = await supabase.from("usuarios").update({ pekepuntos: currentUser.pekepuntos }).eq("id", currentUser.id);
    if(error){ alert("Error al registrar la apuesta."); return; }

    localStorage.setItem("currentUser", JSON.stringify(currentUser));
    document.getElementById("game-message").textContent=`Apuesta colocada: ${currentBet} PekePuntos`;
    document.getElementById("bet-amount").disabled=true;
    document.getElementById("place-bet-button").disabled=true;
    startGame();
});

document.getElementById("hit-button").addEventListener("click",()=>{
    playerHand.push(deck.pop()); updateUI();
    if(handValue(playerHand)>21) endGame("¬°Perdiste! Te pasaste.");
});

document.getElementById("stand-button").addEventListener("click",()=>{
    hideDealer=false; updateUI();
    while(handValue(dealerHand)<17){ dealerHand.push(deck.pop()); updateUI(); }
    const pVal=handValue(playerHand), dVal=handValue(dealerHand);
    if(dVal>21 || pVal>dVal) endGame("¬°Ganaste!");
    else if(pVal<dVal) endGame("Crupier gana. Pierdes.");
    else endGame("Empate.");
});

// --- Inicializar ---
loadPekePuntos();
</script>
</body>
</html>
