<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CSGO 2D ‚Äî H√≠brido Dust2-Inferno-Office</title>
<style>
  body { margin:0; overflow:hidden; background:#222; }
  canvas { display:block; background:#1a1a1a; }
  #hud {
    position: absolute; top:10px; left:10px;
    color:white; font-family:Arial; font-size:16px;
    background:rgba(0,0,0,0.4); padding:10px; border-radius:8px;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const hud = document.getElementById("hud");

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// --- Teclado y rat√≥n ---
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);
const mouse = {x:0,y:0,clicked:false};
canvas.addEventListener("mousemove", e=>{
  const r=canvas.getBoundingClientRect();
  mouse.x=e.clientX-r.left; mouse.y=e.clientY-r.top;
});
canvas.addEventListener("mousedown", ()=>mouse.clicked=true);
canvas.addEventListener("mouseup", ()=>mouse.clicked=false);

// --- Jugador ---
const player = {x:200,y:200,size:20,speed:3,color:"#0ff",bullets:[],reload:0,hp:10,weapon:0};

// --- Armas ---
const weapons=[
  {name:"Pistola",damage:1,rate:15,speed:7},
  {name:"Rifle",damage:2,rate:8,speed:10},
  {name:"Escopeta",damage:3,rate:30,speed:6}
];

// --- Enemigos ---
let enemies=[];
let round=1;
function spawnEnemies(){
  enemies=[];
  for(let i=0;i<3+round;i++){
    enemies.push({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height,
      size:20,speed:2,color:"red",bullets:[],reload:0,alive:true,hp:3+round
    });
  }
}
spawnEnemies();

// --- Paredes (Mapa h√≠brido Dust2 + Inferno + Office) ---
const walls=[
  // Bordes
  {x:0,y:0,w:canvas.width,h:20},
  {x:0,y:canvas.height-20,w:canvas.width,h:20},
  {x:0,y:0,w:20,h:canvas.height},
  {x:canvas.width-20,y:0,w:20,h:canvas.height},

  // Zona Dust2 (arena)
  {x:100,y:100,w:300,h:20},
  {x:380,y:100,w:20,h:200},
  {x:200,y:300,w:200,h:20},

  // Zona Inferno (ciudad naranja)
  {x:600,y:150,w:20,h:300},
  {x:620,y:150,w:250,h:20},
  {x:850,y:150,w:20,h:200},
  {x:620,y:350,w:250,h:20},

  // Zona Office (interior gris)
  {x:300,y:450,w:300,h:20},
  {x:300,y:450,w:20,h:150},
  {x:580,y:450,w:20,h:150},
  {x:300,y:580,w:300,h:20},

  // Coberturas destructibles
  {x:500,y:300,w:40,h:40,destructible:true,hp:3},
  {x:700,y:400,w:40,h:40,destructible:true,hp:3}
];

// --- Bombas ---
let bomb=null;
let bombTimer=0;
let roundTimer=60*30; // 30 segundos de ronda
let winsPlayer=0, winsEnemy=0;

function plantBomb(x,y){
  bomb={x,y,active:true,defusing:false,defused:false};
  bombTimer=60*10; // 10 segundos hasta explotar
}

function defuseBomb(){
  if(bomb && bomb.active && !bomb.defused){
    bomb.defusing=true;
    setTimeout(()=>{
      bomb.defused=true;
      bomb.active=false;
      winsPlayer++;
      spawnNextRound();
    },4000);
  }
}

// --- Funciones de juego ---
function shoot(shooter,tx,ty){
  const dx=tx-shooter.x,dy=ty-shooter.y,dist=Math.hypot(dx,dy);
  shooter.bullets.push({
    x:shooter.x,y:shooter.y,
    vx:(dx/dist)*weapons[shooter.weapon].speed,
    vy:(dy/dist)*weapons[shooter.weapon].speed,
    size:5,damage:weapons[shooter.weapon].damage
  });
}

function collideRectCircle(r,c){
  const cx=Math.max(r.x,Math.min(c.x,r.x+r.w));
  const cy=Math.max(r.y,Math.min(c.y,r.y+r.h));
  const dx=c.x-cx,dy=c.y-cy;
  return dx*dx+dy*dy < c.size*c.size;
}

function moveEntity(e,dx,dy){
  e.x+=dx;
  if(walls.some(w=>collideRectCircle(w,e))) e.x-=dx;
  e.y+=dy;
  if(walls.some(w=>collideRectCircle(w,e))) e.y-=dy;
}

function spawnNextRound(){
  bomb=null; bombTimer=0; roundTimer=60*30;
  round++; spawnEnemies();
  player.hp=10;
}

// --- Bucle principal ---
function update(){
  // Movimiento
  let dx=0,dy=0;
  if(keys["w"]) dy-=player.speed;
  if(keys["s"]) dy+=player.speed;
  if(keys["a"]) dx-=player.speed;
  if(keys["d"]) dx+=player.speed;
  moveEntity(player,dx,dy);

  if(keys["1"]) player.weapon=0;
  if(keys["2"]) player.weapon=1;
  if(keys["3"]) player.weapon=2;

  if(mouse.clicked && player.reload<=0){
    shoot(player,mouse.x,mouse.y);
    player.reload=weapons[player.weapon].rate;
  }
  if(player.reload>0) player.reload--;

  // Plantar bomba con "E"
  if(keys["e"] && !bomb){
    plantBomb(player.x,player.y);
  }
  // Desactivar bomba con "f"
  if(keys["f"]){
    defuseBomb();
  }

  // Enemigos
  enemies.forEach(e=>{
    if(!e.alive) return;
    const dx=player.x-e.x,dy=player.y-e.y,dist=Math.hypot(dx,dy);
    moveEntity(e,(dx/dist)*e.speed,(dy/dist)*e.speed);
    if(e.reload<=0 && dist<300){
      shoot(e,player.x,player.y);
      e.reload=60;
    }
    if(e.reload>0)e.reload--;
  });

  // Balas
  [player,...enemies].forEach(s=>{
    s.bullets.forEach((b,i)=>{
      b.x+=b.vx;b.y+=b.vy;
      for(let w of walls){
        if(collideRectCircle(w,b)){
          if(w.destructible){w.hp-=b.damage;if(w.hp<=0)walls.splice(walls.indexOf(w),1);}
          s.bullets.splice(i,1);return;
        }
      }
      if(s===player){
        enemies.forEach(e=>{
          if(e.alive && Math.hypot(e.x-b.x,e.y-b.y)<e.size){
            e.hp-=b.damage; s.bullets.splice(i,1);
            if(e.hp<=0) e.alive=false;
          }
        });
      }else{
        if(Math.hypot(player.x-b.x,player.y-b.y)<player.size){
          player.hp-=b.damage; s.bullets.splice(i,1);
          if(player.hp<=0){winsEnemy++;spawnNextRound();}
        }
      }
    });
  });

  // Bomba
  if(bomb && bomb.active && !bomb.defused){
    bombTimer--;
    if(bombTimer<=0){
      winsEnemy++;
      bomb.active=false;
      spawnNextRound();
    }
  }

  roundTimer--;
  if(roundTimer<=0){
    winsEnemy++;
    spawnNextRound();
  }

  draw();
  requestAnimationFrame(update);
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Fondo
  const grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  grad.addColorStop(0,"#403020");
  grad.addColorStop(1,"#1b1b1b");
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Paredes
  walls.forEach(w=>{
    ctx.fillStyle=w.destructible?"#a60":"#555";
    ctx.fillRect(w.x,w.y,w.w,w.h);
  });

  // Bomba
  if(bomb && bomb.active){
    ctx.fillStyle = bomb.defusing?"#0f0":"#ff0";
    ctx.beginPath();
    ctx.arc(bomb.x,bomb.y,10,0,Math.PI*2);
    ctx.fill();
  }

  // Jugador
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
  ctx.fill();

  // Enemigos
  enemies.forEach(e=>{
    if(!e.alive)return;
    ctx.fillStyle=e.color;
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.size,0,Math.PI*2);
    ctx.fill();
  });

  // Balas
  [player,...enemies].forEach(s=>{
    s.bullets.forEach(b=>{
      ctx.fillStyle="yellow";
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.size,0,Math.PI*2);
      ctx.fill();
    });
  });

  // HUD
  hud.innerHTML=`‚ù§Ô∏è Vida: ${player.hp} | üî´ ${weapons[player.weapon].name} | üí£ ${bomb?"Plantada":"Sin bomba"} | üïí ${Math.floor(roundTimer/60)}s | Ronda ${round}<br>Victorias: T√∫ ${winsPlayer} ‚Äî Enemigos ${winsEnemy}`;
}

update();
</script>
</body>
</html>
