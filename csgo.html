<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prototipo 2D v9 - Tu Mapa Completo</title>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #111;
            overflow: hidden; 
        }
        canvas {
            display: block;
            background-color: #111; 
            margin: 0 auto; 
        }
    </style>
</head>
<body>
    
    <canvas id="gameCanvas"></canvas>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- TAMAÑO DEL MUNDO ---
        const world = {
            width: 3000,
            height: 2000
        };

        const mapData = {
            wallSize: 20,
            padding: 40,
            playerSize: 20
        };

        // --- CÁMARA ---
        let camera = {
            x: 0,
            y: 0,
        };

        // --- 2. EL MAPA (¡TU DISEÑO!) ---
        
        // ¡Tu array de paredes!
        const walls = [
            { x: 1696, y: 1311, width: 85, height: 632 },
            { x: 1682, y: 1, width: 99, height: 579 },
            { x: 1658, y: 774, width: 578, height: 381 },
            { x: 1885, y: 429, width: 350, height: 355 },
            { x: 1954, y: 1367, width: 328, height: 231 },
            { x: 1841, y: 107, width: 395, height: 119 },
            { x: 1402, y: 532, width: 135, height: 463 },
            { x: 899, y: 209, width: 496, height: 337 },
            { x: 881, y: 204, width: 523, height: 423 },
            { x: 839, y: 119, width: 59, height: 507 },
            { x: -1, y: 2, width: 345, height: 617 },
            { x: 542, y: 293, width: 31, height: 22 },
            { x: 571, y: 204, width: 33, height: 21 },
            { x: 609, y: 268, width: 34, height: 23 },
            { x: 493, y: 181, width: 19, height: 166 },
            { x: 512, y: 347, width: 133, height: 24 },
            { x: 494, y: 348, width: 356, height: 276 },
            { x: 493, y: 340, width: 19, height: 15 },
            { x: 491, y: 9, width: 26, height: 50 },
            { x: 491, y: 3, width: 25, height: 9 },
            { x: 594, y: 142, width: 24, height: 12 },
            { x: 656, y: 182, width: 66, height: 35 },
            { x: 761, y: 106, width: 21, height: 189 },
            { x: 1, y: 3, width: 1520, height: 9 },
            { x: 1522, y: 5, width: 1453, height: 6 },
            { x: 2978, y: 7, width: 10, height: 3 },
            { x: 2972, y: 5, width: 17, height: 6 },
            { x: 2980, y: 9, width: 5, height: 728 },
            { x: 2983, y: 738, width: 3, height: 610 },
            { x: 2981, y: 739, width: 4, height: 615 },
            { x: 2981, y: 1353, width: 3, height: 627 },
            { x: 1465, y: 1943, width: 1520, height: 35 },
            { x: -2, y: 1943, width: 1469, height: 35 },
            { x: 0, y: 1225, width: 12, height: 720 },
            { x: 4, y: 661, width: 8, height: 566 },
            { x: 2, y: 604, width: 9, height: 59 },
            { x: 1353, y: 1259, width: 200, height: 108 },
            { x: 1159, y: 1035, width: 135, height: 123 },
            { x: 1339, y: 1367, width: 67, height: 433 },
            { x: 533, y: 1479, width: 115, height: 332 },
            { x: 815, y: 1333, width: 355, height: 107 },
            { x: 535, y: 1129, width: 143, height: 100 },
            { x: 767, y: 826, width: 217, height: 236 },
            { x: 1137, y: 692, width: 73, height: 55 },
            { x: 501, y: 715, width: 58, height: 68 },
            { x: 142, y: 1606, width: 405, height: 205 },
            { x: 834, y: 1603, width: 40, height: 31 },
            { x: 940, y: 1547, width: 260, height: 63 },
            { x: 1115, y: 1662, width: 28, height: 76 },
            { x: 943, y: 1706, width: 8, height: 31 },
            { x: 875, y: 1767, width: 43, height: 29 },
            { x: 898, y: 1656, width: 43, height: 15 },
            { x: 1046, y: 1812, width: 40, height: 29 },
            { x: 838, y: 1873, width: 33, height: 21 },
            { x: 989, y: 1840, width: 94, height: 105 },
            { x: 1190, y: 1783, width: 66, height: 36 },
        ];

        // ¡Tu array de zonas!
        const zones = [
            { x: 52, y: 969, width: 180, height: 236, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' },
            { x: 2528, y: 976, width: 276, height: 243, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' },
            { x: 545, y: 195, width: 130, height: 114, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' },
            { x: 814, y: 1572, width: 396, height: 317, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' },
        ];

        // --- 3. EL JUGADOR ---
        let player = {
            // ¡Spawn en el centro de tu 'Spawn AT'!
            x: 142,  // (52 + 180 / 2)
            y: 1087, // (969 + 236 / 2)
            size: mapData.playerSize,
            color: 'cyan', 
            speed: 4,
            angle: 0,
            health: 100
        };

        // --- 4. ALMACENES Y ESTADO ---
        let bullets = [];
        let keys = {};
        let mouse = { x: 0, y: 0 }; 

        // --- 5. SEGUIMIENTO DE EVENTOS ---
        window.addEventListener('mousemove', (e) => { 
            mouse.x = e.clientX + camera.x;
            mouse.y = e.clientY + camera.y;
        });
        window.addEventListener('keydown', (e) => { keys[e.key] = true; });
        window.addEventListener('keyup', (e) => { delete keys[e.key]; });
        window.addEventListener('mousedown', (e) => {
            const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
            const bullet = {
                x: player.x,
                y: player.y,
                size: 5, 
                color: 'yellow',
                speed: 10,
                angle: angle 
            };
            bullets.push(bullet);
        });

        // --- 6. FUNCIÓN DE COLISIÓN ---
        function checkCollision(obj, wall) {
            const objLeft = obj.x - obj.size / 2;
            const objRight = obj.x + obj.size / 2;
            const objTop = obj.y - obj.size / 2;
            const objBottom = obj.y + obj.size / 2;
            const wallLeft = wall.x;
            const wallRight = wall.x + wall.width;
            const wallTop = wall.y;
            const wallBottom = wall.y + wall.height;
            return (
                objRight > wallLeft &&
                objLeft < wallRight &&
                objBottom > wallTop &&
                objTop < wallBottom
            );
        }

        // --- 7. FUNCIÓN DE ACTUALIZACIÓN (Lógica) ---
        function update() {
            // Lógica del Jugador
            const oldX = player.x;
            const oldY = player.y;
            if (keys['a'] || keys['A']) { player.x -= player.speed; }
            if (keys['d'] || keys['D']) { player.x += player.speed; }
            for (const wall of walls) {
                if (checkCollision(player, wall)) {
                    player.x = oldX; 
                    break; 
                }
            }
            if (keys['w'] || keys['W']) { player.y -= player.speed; }
            if (keys['s'] || keys['S']) { player.y += player.speed; }
            for (const wall of walls) {
                if (checkCollision(player, wall)) {
                    player.y = oldY; 
                    break;
                }
            }
            player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);

            // Lógica de Balas
            for (let i = bullets.length - 1; i >= 0; i--) {
                let bullet = bullets[i];
                bullet.x += Math.cos(bullet.angle) * bullet.speed;
                bullet.y += Math.sin(bullet.angle) * bullet.speed;
                let bulletHit = false;
                for (const wall of walls) {
                    if (checkCollision(bullet, wall)) {
                        bullets.splice(i, 1); 
                        bulletHit = true;
                        break; 
                    }
                }
                if (bulletHit) continue; 
                if (bullet.x < 0 || bullet.x > world.width || bullet.y < 0 || bullet.y > world.height) {
                    bullets.splice(i, 1);
                }
            }
            
            // Lógica de la Cámara
            camera.x = player.x - canvas.width / 2;
            camera.y = player.y - canvas.height / 2;
            if (camera.x < 0) camera.x = 0;
            if (camera.y < 0) camera.y = 0;
            if (camera.x + canvas.width > world.width) camera.x = world.width - canvas.width;
            if (camera.y + canvas.height > world.height) camera.y = world.height - canvas.height;
        }

        // --- 8. FUNCIÓN DE DIBUJADO (Gráficos) ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(-camera.x, -camera.y);

            // Dibujar el "Suelo" del mundo
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, world.width, world.height);

            // Dibujar Zonas (¡Ahora sí se ven!)
            for (const zone of zones) {
                ctx.fillStyle = zone.color;
                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(zone.name, zone.x + zone.width / 2, zone.y + zone.height / 2);
            }

            // Dibujar Paredes
            ctx.fillStyle = '#999';
            for (const wall of walls) {
                ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            }

            // Dibujar Balas
            for (const bullet of bullets) {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2); 
                ctx.fill();
            }

            // Dibujar Jugador
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.angle);
            ctx.fillStyle = player.color;
            ctx.fillRect(-player.size / 2, -player.size / 2, player.size, player.size);
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(player.size, 0);
            ctx.stroke();
            ctx.restore(); 
            
            ctx.restore(); // Restaura la cámara

            // Dibujar HUD
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.fillText(`Vida: ${player.health}`, 20, 30);
        }

        // --- 9. EL BUCLE DEL JUEGO ---
        function gameLoop() {
            update(); // Lógica
            draw();   // Gráficos
            requestAnimationFrame(gameLoop);
        }

        gameLoop(); // ¡Empezar!
    </script>
</body>
</html>
