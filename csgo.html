<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CSGO 2D - Prototipo 5v5 Bots (Minimal)</title>
    
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        #game-container {
            border: 2px solid #555;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
        }
        /* Estilo para los botones que se renderizarán en el DOM (Menú) */
        .menu-button {
            width: 250px;
            padding: 15px;
            margin: 10px;
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            background-color: #2c3e50;
            border: 2px solid #3498db;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        .menu-button:hover {
            background-color: #34495e;
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div id="game-container">
        </div>

    <script>
        //==============================================================
        // CONSTANTES GLOBALES Y ESTRUCTURAS DE DATOS
        //==============================================================
        const GAME_WIDTH = 1200;
        const GAME_HEIGHT = 800;
        const PLAYER_SPEED = 300;
        const BULLET_SPEED = 800;
        const FIRE_RATE = 150; 
        
        let players = {}; 
        const TEAM_CT_COLOR = 0x3498db;
        const TEAM_T_COLOR = 0xe74c3c;

        //==============================================================
        // CLASE: ENTIDAD BOT (VACIADA PARA ESTA PRUEBA)
        //==============================================================
        // Esta clase es innecesaria en la versión MÍNIMA, pero la dejamos como placeholder.
        class BotEntity extends Phaser.GameObjects.Rectangle {
             constructor(scene, x, y, team, playerID) {
                 super(scene, x, y, 32, 32, 0x000000); 
                 scene.add.existing(this);
             }
             randomMovement() {}
             preUpdate() {}
             destroy() {}
        }


        //==============================================================
        // CLASE ESCENA: MENU PRINCIPAL
        //==============================================================
        class MainMenu extends Phaser.Scene {
            constructor() {
                super('MainMenu');
            }

            create() {
                this.cameras.main.setBackgroundColor('#2c3e50');

                this.add.text(GAME_WIDTH / 2, 150, 'CS:GO 2D', {
                    fontSize: '64px',
                    fill: '#ecf0f1',
                    fontFamily: 'Arial Black'
                }).setOrigin(0.5);

                const container = document.getElementById('game-container');
                const canvas = this.game.canvas;
                
                const addButton = (text, yOffset, sceneKey) => {
                    let button = document.createElement('button');
                    button.textContent = text;
                    button.className = 'menu-button';
                    
                    button.style.position = 'absolute';
                    button.style.left = (canvas.offsetLeft + GAME_WIDTH / 2 - 125) + 'px';
                    button.style.top = (canvas.offsetTop + GAME_HEIGHT / 2 + yOffset) + 'px';
                    
                    button.onclick = () => {
                        // Limpiar los botones DOM antes de cambiar de escena
                        if (onlineButton.parentNode === container) container.removeChild(onlineButton);
                        if (offlineButton.parentNode === container) container.removeChild(offlineButton);
                        this.scene.start(sceneKey); 
                    };

                    container.appendChild(button);
                    return button;
                };

                const onlineButton = addButton('JUGAR ONLINE (5v5)', -50, 'LoadingScene');
                const offlineButton = addButton('PRACTICA / OFFLINE', 50, 'GameScene');

                this.onlineButton = onlineButton;
                this.offlineButton = offlineButton;
            }

            shutdown() {
                 const container = document.getElementById('game-container');
                 if (this.onlineButton && this.onlineButton.parentNode === container) container.removeChild(this.onlineButton);
                 if (this.offlineButton && this.offlineButton.parentNode === container) container.removeChild(this.offlineButton);
            }
        }

        //==============================================================
        // CLASE ESCENA: CARGA (ONLINE)
        //==============================================================
        class LoadingScene extends Phaser.Scene {
            constructor() {
                super('LoadingScene');
            }

            create() {
                this.cameras.main.setBackgroundColor('#1c2a35');
                
                this.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2 - 50, 'BUSCANDO PARTIDA...', {
                    fontSize: '32px',
                    fill: '#f39c12',
                    fontFamily: 'Arial'
                }).setOrigin(0.5);

                const workingText = this.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2 + 50, 'Trabajando...', {
                    fontSize: '48px',
                    fill: '#ecf0f1',
                    fontFamily: 'Arial Black'
                }).setOrigin(0.5);

                let dots = 0;
                this.time.addEvent({
                    delay: 500,
                    callback: () => {
                        dots = (dots + 1) % 4;
                        let text = 'Trabajando' + '.'.repeat(dots);
                        workingText.setText(text);
                    },
                    loop: true
                });

                this.time.delayedCall(3000, () => {
                    this.scene.start('MainMenu'); 
                });
            }
        }

        //==============================================================
        // CLASE ESCENA: JUEGO PRINCIPAL (VERSIÓN MÍNIMA - DEPURACIÓN)
        //==============================================================
        class GameScene extends Phaser.Scene {
            constructor() {
                super('GameScene');
                // Mantener las variables para evitar errores de referencia en el código global
                this.player = null;
                this.keys = null;
                this.bullets = null;
                this.lastShotTime = 0;
            }

            create() {
                // 1. Cambiar color de fondo (debería ser visible)
                this.cameras.main.setBackgroundColor('#004d40'); // Color Verde oscuro

                // 2. Mostrar mensaje de confirmación
                this.add.text(GAME_WIDTH / 2, GAME_HEIGHT / 2, '¡CARGA EXITOSA!', {
                    fontSize: '64px',
                    fill: '#e0f2f1',
                    fontFamily: 'Arial Black'
                }).setOrigin(0.5);

                console.log("GameScene loaded successfully.");
                
                // 3. Volver al menú después de 3 segundos
                this.time.delayedCall(3000, () => {
                    this.scene.start('MainMenu'); 
                });
            }

            // Funciones vacías para evitar errores si el código intenta llamarlas
            update(time, delta) {}
            handleMovement() {}
            handleAiming() {}
            handleShoot(pointer) {}
            setupControls() {}
            setupBullets() {}
            setupCamera() {}
            createMap() {}
            createBotsAndPlayer() {}
            setupCollisions() {}
            bulletHitWall(bullet, wall) {}
            bulletHitPlayer(bullet, victim) {}
            killBot(bot) {}
            respawnBot(bot) {}
        }


        //==============================================================
        // INICIALIZACIÓN DE PHASER
        //==============================================================
        const gameConfig = {
            type: Phaser.AUTO,
            width: GAME_WIDTH,
            height: GAME_HEIGHT,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 } 
                }
            },
            scene: [MainMenu, LoadingScene, GameScene], 
            parent: 'game-container'
        };

        const game = new Phaser.Game(gameConfig);
    </script>
</body>
</html>
