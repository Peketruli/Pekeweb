<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>CSGO 2D â€” Bomb Mission</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  html, body { margin:0; padding:0; overflow:hidden; background:#1b1b1b; }
  canvas { display:block; background:#3f3c3a; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const TILE = 40;
const mapCols = 50, mapRows = 30;

// 0 libre, 1 muro
const map = [];
for(let y=0;y<mapRows;y++){
  const row=[];
  for(let x=0;x<mapCols;x++){
    if(y===0||x===0||y===mapRows-1||x===mapCols-1) row.push(1);
    else row.push(0);
  }
  map.push(row);
}

// Sitios A y B
const siteA = {x: TILE*42, y: TILE*20, w: TILE*3, h: TILE*3};
const siteB = {x: TILE*8, y: TILE*8, w: TILE*3, h: TILE*3};

// Jugadores
const player = {x:TILE*25, y:TILE*15, size:15, speed:3, team:"CT"};

function spawnBots(team,count,zone){
  const bots=[];
  for(let i=0;i<count;i++){
    bots.push({
      team,
      x: zone.x + Math.random()*zone.w,
      y: zone.y + Math.random()*zone.h,
      size:15,
      speed: team==="T"?1.3:1.1,
      target: null,
      hasBomb: team==="T" && i===0, // primer terrorista tiene la bomba
      planted: false
    });
  }
  return bots;
}

const Tspawn={x:TILE*5,y:TILE*5,w:TILE*4,h:TILE*4};
const CTspawn={x:TILE*40,y:TILE*22,w:TILE*4,h:TILE*4};

const terrorists=spawnBots("T",5,Tspawn);
const counterT=spawnBots("CT",5,CTspawn);

let bomb = {x:0,y:0,planted:false,timer:0};

// Controles
const keys={};
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;

// Actualizar jugador
function updatePlayer(){
  if(keys["w"]) player.y-=player.speed;
  if(keys["s"]) player.y+=player.speed;
  if(keys["a"]) player.x-=player.speed;
  if(keys["d"]) player.x+=player.speed;
}

// Movimiento IA
function updateAI(bots){
  for(const b of bots){
    if(b.team==="T"){
      // objetivo: moverse a site A o B
      if(!b.target){
        b.target = Math.random()<0.5?siteA:siteB;
      }
      const dx = b.target.x - b.x;
      const dy = b.target.y - b.y;
      const dist = Math.hypot(dx,dy);
      if(dist>5){
        b.x += (dx/dist)*b.speed;
        b.y += (dy/dist)*b.speed;
      }else if(b.hasBomb && !bomb.planted){
        // plantar bomba
        bomb={x:b.x,y:b.y,planted:true,timer:500};
        b.hasBomb=false;
        console.log("ðŸ’£ Bomba plantada!");
      }
    } else {
      // los CT patrullan cerca de A o B
      if(!b.target){
        b.target = Math.random()<0.5?siteA:siteB;
      }
      const dx = b.target.x - b.x;
      const dy = b.target.y - b.y;
      const dist = Math.hypot(dx,dy);
      if(dist>30){
        b.x += (dx/dist)*b.speed;
        b.y += (dy/dist)*b.speed;
      }
    }
  }
}

// Dibujo
function drawMap(){
  for(let y=0;y<mapRows;y++){
    for(let x=0;x<mapCols;x++){
      ctx.fillStyle = map[y][x]===1?"#252525":"#6b665b";
      ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
    }
  }
  // sitios A y B
  ctx.fillStyle="rgba(255,0,0,0.2)";
  ctx.fillRect(siteA.x,siteA.y,siteA.w,siteA.h);
  ctx.fillStyle="rgba(0,0,255,0.2)";
  ctx.fillRect(siteB.x,siteB.y,siteB.w,siteB.h);
}

function drawEntities(){
  // jugador
  ctx.fillStyle="deepskyblue";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
  ctx.fill();

  for(const t of terrorists){
    ctx.fillStyle=t.hasBomb?"orange":"red";
    ctx.beginPath();
    ctx.arc(t.x,t.y,t.size,0,Math.PI*2);
    ctx.fill();
  }
  for(const ct of counterT){
    ctx.fillStyle="cyan";
    ctx.beginPath();
    ctx.arc(ct.x,ct.y,ct.size,0,Math.PI*2);
    ctx.fill();
  }

  // bomba
  if(bomb.planted){
    ctx.fillStyle="yellow";
    ctx.beginPath();
    ctx.arc(bomb.x,bomb.y,10,0,Math.PI*2);
    ctx.fill();
  }
}

// HUD
function drawHUD(){
  ctx.fillStyle="#fff";
  ctx.font="20px Arial";
  if(bomb.planted){
    bomb.timer--;
    ctx.fillText("ðŸ’£ Bomba plantada ("+Math.ceil(bomb.timer/60)+"s)",20,30);
    if(bomb.timer<=0){
      ctx.fillText("ðŸ’¥ Â¡Terroristas ganan!",20,60);
    }
  } else {
    ctx.fillText("CTs defendiendo los sitios",20,30);
  }
}

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMap();
  updatePlayer();
  updateAI(terrorists);
  updateAI(counterT);
  drawEntities();
  drawHUD();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
