<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CSGO 2D — Disparos y combate</title>
<style>
  html,body{height:100%;margin:0;background:#0b0f14;color:#fff;font-family:Inter,Arial,sans-serif;}
  canvas{display:block;cursor:crosshair}
  #hud{position:fixed;left:12px;top:12px;background:rgba(0,0,0,0.5);padding:8px;border-radius:8px}
  #tips{position:fixed;right:12px;top:12px;background:rgba(0,0,0,0.45);padding:8px;border-radius:8px;font-size:13px}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hud">Cargando mapa...</div>
<div id="tips">WASD mover • Click disparar • Esc pausar</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');
let W = innerWidth, H = innerHeight;
function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
addEventListener('resize', resize); resize();

const TILE = 48;
const MAP_GRID = [
  "#############################################",
  "#T............#####..........#..............#",
  "#T..................#........#..............#",
  "###########...#.....#####....#..............#",
  "#.............#.........#....#..............#",
  "#......#####..#.........#...................#",
  "#......####...#######.........##............#",
  "#......###.........#########.......###......#",
  "#......####............#.....#..............#",
  "#......######..........#.....#..............#",
  "#......##########...####.....#..............#",
  "#......######................#..............#",
  "#...............##..####.....#####.......####",
  "#...............##....##....................#",
  "#...............###...##....................#",
  "#...............####..##..............B.....#",
  "#...............####........................#",
  "#.........##########..##....................#",
  "######.................#....................#",
  "#....#.................#....................#",
  "#..A...................#....................#",
  "###....................#....................#",
  "#......................#....................#",
  "#......................#...................C#",
  "#..........................................C#",
  "#############################################"
];

const MAP_W = MAP_GRID[0].length * TILE;
const MAP_H = MAP_GRID.length * TILE;

function findTile(ch){
  for(let y=0;y<MAP_GRID.length;y++)
    for(let x=0;x<MAP_GRID[y].length;x++)
      if(MAP_GRID[y][x]===ch)
        return {x:x*TILE+TILE/2,y:y*TILE+TILE/2};
  return null;
}

const walls = [];
for(let y=0;y<MAP_GRID.length;y++)
  for(let x=0;x<MAP_GRID[y].length;x++)
    if(MAP_GRID[y][x]==="#")
      walls.push({x:x*TILE,y:y*TILE,w:TILE,h:TILE});

const spawnT = findTile('T');
const spawnCT = findTile('C');
const siteApos = findTile('A');
const siteBpos = findTile('B');

class Entity {
  constructor(x,y,team,name,color){
    this.x=x; this.y=y;
    this.size=10;
    this.team=team;
    this.name=name;
    this.color=color;
    this.hp=100;
    this.alive=true;
    this.speed=team==='T'?1.4:1.2;
    this.hasBomb=false;
  }
  draw(ctx){
    if(!this.alive) return;
    ctx.fillStyle=this.color;
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="#fff";
    ctx.font="10px Arial";
    ctx.textAlign="center";
    ctx.fillText(this.name,this.x,this.y+20);
  }
}

const player = new Entity(spawnCT.x,spawnCT.y,'CT','Tú','#3fe8d0');
player.speed = 3;
const allies=[], enemies=[];
for(let i=0;i<4;i++)allies.push(new Entity(spawnCT.x+Math.random()*60-30,spawnCT.y+Math.random()*60-30,'CT',['Alpha','Bravo','Charlie','Delta'][i],'#66d1ff'));
for(let i=0;i<5;i++){
  const e=new Entity(spawnT.x+Math.random()*60-30,spawnT.y+Math.random()*60-30,'T','T-'+(i+1),'#ff8a7a');
  if(i===0)e.hasBomb=true;
  enemies.push(e);
}

const bullets=[];
let mouseX=0,mouseY=0;
addEventListener('mousemove',e=>{
  const rect=canvas.getBoundingClientRect();
  mouseX=e.clientX-rect.left;
  mouseY=e.clientY-rect.top;
});
addEventListener('mousedown',e=>{
  shoot();
});

function shoot(){
  if(!player.alive)return;
  const worldMouseX = mouseX + camX;
  const worldMouseY = mouseY + camY;
  const dx = worldMouseX - player.x;
  const dy = worldMouseY - player.y;
  const len = Math.hypot(dx,dy);
  const dirX = dx/len;
  const dirY = dy/len;
  bullets.push({x:player.x,y:player.y,vx:dirX*8,vy:dirY*8,life:90,team:'CT'});
}

function collidesAt(px,py,r){
  for(const w of walls)
    if(px+r>w.x && px-r<w.x+w.w && py+r>w.y && py-r<w.y+w.h)
      return true;
  return false;
}

let camX=0,camY=0;
function updateCamera(){
  camX = player.x - W/2;
  camY = player.y - H/2;
  camX = Math.max(0,Math.min(camX,MAP_W-W));
  camY = Math.max(0,Math.min(camY,MAP_H-H));
}

const keys={};
addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

function update(){
  let mvx=0,mvy=0;
  if(keys['w'])mvy-=player.speed;
  if(keys['s'])mvy+=player.speed;
  if(keys['a'])mvx-=player.speed;
  if(keys['d'])mvx+=player.speed;
  if(mvx&&mvy){mvx*=Math.SQRT1_2;mvy*=Math.SQRT1_2;}
  const nx=player.x+mvx,ny=player.y+mvy;
  if(!collidesAt(nx,player.y,player.size))player.x=nx;
  if(!collidesAt(player.x,ny,player.size))player.y=ny;

  for(const b of bullets){
    b.x+=b.vx; b.y+=b.vy; b.life--;
    for(const e of enemies){
      if(e.alive && Math.hypot(e.x-b.x,e.y-b.y)<e.size){
        e.hp-=34;
        b.life=0;
        if(e.hp<=0)e.alive=false;
      }
    }
  }
  for(let i=bullets.length-1;i>=0;i--){
    if(bullets[i].life<=0)bullets.splice(i,1);
  }

  updateCamera();
  draw();
  requestAnimationFrame(update);
}

function draw(){
  ctx.fillStyle='#111';
  ctx.fillRect(0,0,W,H);
  ctx.save();
  ctx.translate(-camX,-camY);
  for(let y=0;y<MAP_GRID.length;y++){
    for(let x=0;x<MAP_GRID[y].length;x++){
      const c=MAP_GRID[y][x];
      ctx.fillStyle=c==="#"?"#333":(c==="A"||c==="B"?"#3a3a2f":"#1e1e1e");
      ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
    }
  }
  for(const e of enemies)e.draw(ctx);
  for(const a of allies)a.draw(ctx);
  player.draw(ctx);
  for(const b of bullets){
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(b.x,b.y,3,0,Math.PI*2);
    ctx.fill();
  }
  ctx.restore();
}

requestAnimationFrame(update);
</script>
</body>
</html>
