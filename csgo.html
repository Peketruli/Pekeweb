<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prototipo 2D (Todo en Uno)</title>
    
    <style>
        /* Quitamos márgenes y ponemos un fondo oscuro */
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            /* Ocultamos el scroll para que el juego ocupe todo */
            overflow: hidden; 
        }

        /* El lienzo del juego */
        canvas {
            display: block;
            background-color: #000; /* Fondo negro para el juego */
            margin: 0 auto; /* Centrado (aunque ocupará todo) */
        }
    </style>
</head>
<body>
    
    <canvas id="gameCanvas"></canvas>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---

        // Obtenemos el "lienzo" (canvas) del HTML
        const canvas = document.getElementById('gameCanvas');
        // Obtenemos el "contexto" 2D, que es la herramienta para dibujar
        const ctx = canvas.getContext('2d');

        // Hacemos que el lienzo ocupe toda la ventana
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- 2. EL JUGADOR ---

        let player = {
            x: canvas.width / 2,  // Posición inicial X (centro)
            y: canvas.height / 2, // Posición inicial Y (centro)
            size: 20,             // Tamaño (20 píxeles)
            color: 'blue',        // Color
            speed: 4,             // Velocidad de movimiento
            angle: 0              // Ángulo al que mira (en radianes)
        };

        // --- 3. ALMACENES (Arrays) ---

        let bullets = []; // Un array para guardar todas las balas
        let keys = {};    // Un objeto para guardar qué teclas están pulsadas

        // --- 4. SEGUIMIENTO DE RATÓN Y TECLADO ---

        let mouse = {
            x: 0,
            y: 0
        };

        // Cuando el ratón se mueve, guardamos su posición
        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        // Cuando pulsamos una tecla, la guardamos
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        // Cuando soltamos una tecla, la borramos
        window.addEventListener('keyup', (e) => {
            delete keys[e.key];
        });

        // Cuando hacemos clic, disparamos
        window.addEventListener('mousedown', (e) => {
            // Creamos una nueva bala
            const bullet = {
                x: player.x,
                y: player.y,
                size: 5,
                color: 'yellow',
                speed: 10,
                // La bala debe salir en la dirección que mira el jugador
                angle: player.angle 
            };
            // Añadimos la bala al array
            bullets.push(bullet);
        });


        // --- 5. FUNCIÓN DE ACTUALIZACIÓN (Lógica) ---

        function update() {
            // --- Mover jugador ---
            if (keys['w'] || keys['W']) {
                player.y -= player.speed;
            }
            if (keys['s'] || keys['S']) {
                player.y += player.speed;
            }
            if (keys['a'] || keys['A']) {
                player.x -= player.speed;
            }
            if (keys['d'] || keys['D']) {
                player.x += player.speed;
            }

            // --- Apuntar jugador ---
            // Calculamos el ángulo entre el jugador y el ratón
            player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);

            // --- Mover balas ---
            for (let i = bullets.length - 1; i >= 0; i--) {
                let bullet = bullets[i];
                
                // Movemos la bala usando trigonometría (coseno para X, seno para Y)
                bullet.x += Math.cos(bullet.angle) * bullet.speed;
                bullet.y += Math.sin(bullet.angle) * bullet.speed;

                // Opcional: Borrar balas si salen de la pantalla
                if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                    bullets.splice(i, 1);
                }
            }
        }

        // --- 6. FUNCIÓN DE DIBUJADO (Gráficos) ---

        function draw() {
            // Limpiamos el lienzo en cada frame
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // --- Dibujar jugador ---
            // Guardamos el estado del canvas (para poder rotarlo)
            ctx.save();
            // Movemos el punto de origen (0,0) al centro del jugador
            ctx.translate(player.x, player.y);
            // Rotamos el canvas según el ángulo del jugador
            ctx.rotate(player.angle);
            
            // Dibujamos el cuerpo del jugador (un cuadrado)
            ctx.fillStyle = player.color;
            ctx.fillRect(-player.size / 2, -player.size / 2, player.size, player.size);
            
            // Dibujamos el "cañón" (una línea para saber dónde apunta)
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, 0); // Desde el centro
            ctx.lineTo(player.size, 0); // Hacia adelante
            ctx.stroke();

            // Restauramos el canvas a su estado original
            ctx.restore();


            // --- Dibujar balas ---
            for (const bullet of bullets) {
                ctx.fillStyle = bullet.color;
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.size / 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- 7. EL BUCLE DEL JUEGO ---

        // Esta función se llama a sí misma unas 60 veces por segundo
        function gameLoop() {
            update(); // Actualiza la lógica
            draw();   // Dibuja los gráficos
            requestAnimationFrame(gameLoop); // Pide al navegador que vuelva a llamar a gameLoop
        }

        // ¡Empezamos el juego!
        gameLoop();
    </script>
</body>
</html>
