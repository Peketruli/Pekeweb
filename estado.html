<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Estado de la OS - PekeOS</title>
<style>
:root{
  --bg:#04060a; --card:#0b0f12; --neon:#00ffd0; --muted:#89fff0;
}
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
body{margin:0;background:linear-gradient(180deg,#03040a,#07131a);color:var(--muted);padding:16px;}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.h1{font-size:20px;font-weight:700;color:#e6fff9}
.toolbar{display:flex;gap:8px;align-items:center}
.btn{background:transparent;border:1px solid rgba(0,255,208,0.06);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:10px;padding:12px;border:1px solid rgba(0,255,208,0.04)}
.small{height:120px}
.large{grid-column:span 2; min-height:260px}
.stat{display:flex;align-items:center;gap:12px}
.stat .k{font-size:28px;font-weight:800;color:#e8fff8}
.stat small{display:block;color:#8fffe2}
.proc-list{max-height:220px;overflow:auto;margin-top:8px}
.proc{display:flex;justify-content:space-between;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.02);margin-bottom:6px}
.log-box{height:120px;overflow:auto;background:#030406;padding:8px;border-radius:6px;border:1px solid rgba(0,255,208,0.03);font-size:12px;color:#9ef7ea}
.widget{cursor:grab}
.widget.dragging{opacity:.6;transform:scale(.98)}
.controls small{color:#8fffe2}
.footer{margin-top:12px;color:#8fffe2;font-size:13px}
.toggle{display:inline-flex;gap:6px;align-items:center}
.badge{background:rgba(0,255,208,0.08);padding:6px 8px;border-radius:8px;color:var(--neon);font-weight:700}
.canvas{width:100%;height:100%;display:block}
.empty{opacity:.6;color:#6fffe0}
</style>
</head>
<body>
  <div class="header">
    <div>
      <div class="h1">üìä Estado de la OS ‚Äî Panel Avanzado</div>
      <div style="font-size:12px;color:#9ef7ea;margin-top:4px">Monitoreo en tiempo real ‚Ä¢ Widgets modulares ‚Ä¢ Logs</div>
    </div>
    <div class="toolbar">
      <div class="btn" id="addWidgetBtn">‚ûï A√±adir widget</div>
      <div class="btn" id="exportBtn">üì§ Exportar estado</div>
      <div class="btn" id="clearLogs">üßπ Limpiar logs</div>
    </div>
  </div>

  <div class="grid" id="grid">
    <div class="card small widget" data-widget="cpu" draggable="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>CPU</strong><div style="font-size:12px;color:#8fffe2">Uso instant√°neo y hist√≥rico</div></div>
        <div class="badge" id="cpuPct">0%</div>
      </div>
      <canvas id="cpuChart" class="canvas" style="height:70px;margin-top:8px"></canvas>
    </div>

    <div class="card small widget" data-widget="ram" draggable="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Memoria RAM</strong><div style="font-size:12px;color:#8fffe2">Uso y disponibilidad</div></div>
        <div class="badge" id="ramPct">0%</div>
      </div>
      <canvas id="ramChart" class="canvas" style="height:70px;margin-top:8px"></canvas>
    </div>

    <div class="card small widget" data-widget="disk" draggable="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Almacenamiento</strong><div style="font-size:12px;color:#8fffe2">Simulado</div></div>
        <div class="badge" id="diskPct">0%</div>
      </div>
      <div style="height:70px;margin-top:8px;display:flex;align-items:center">
        <div style="width:100%;height:10px;background:#020408;border-radius:999px;overflow:hidden">
          <div id="diskBar" style="height:100%;width:0%;background:linear-gradient(90deg,#00ffd0,#00a79c)"></div>
        </div>
      </div>
    </div>

    <div class="card large widget" data-widget="processes" draggable="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Procesos</strong><div style="font-size:12px;color:#8fffe2">Lista de procesos simulados</div></div>
        <div style="display:flex;gap:8px">
          <div class="btn" id="spawnProc">‚ûï Crear proceso</div>
          <div class="btn" id="killAll">üíÄ Matar todo</div>
        </div>
      </div>
      <div class="proc-list" id="procList"></div>
    </div>

    <div class="card small widget" data-widget="logs" draggable="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Logs</strong><div style="font-size:12px;color:#8fffe2">Eventos recientes</div></div>
        <div style="font-size:12px;color:#8fffe2" id="logCount">0</div>
      </div>
      <div class="log-box" id="logBox"></div>
    </div>
  </div>

  <div class="footer">
    <span class="empty">Arrastra los widgets para reorganizarlos. Puedes a√±adir y quitar widgets. Datos simulados para demostraci√≥n.</span>
  </div>

<script>
/* ---------- Simulaci√≥n y datos ---------- */
let cpuHistory = Array.from({length:80},()=>20+Math.random()*20);
let ramHistory = Array.from({length:80},()=>30+Math.random()*30);
let diskUsage = 40 + Math.random()*30;
const logs = [];
const processes = new Map();
let procCounter=0;

/* ---------- Utils ---------- */
function pushLog(s){
  const time = new Date().toLocaleTimeString();
  logs.unshift(`[${time}] ${s}`);
  if(logs.length>200) logs.pop();
  renderLogs();
}
function randSpike(base, v){ return Math.max(2, Math.min(98, base + (Math.random()-0.4)*v + (Math.random()>0.95? (Math.random()*30):0))); }

/* ---------- Charts (canvas simple) ---------- */
function drawLine(canvas, data, color){
  const ctx = canvas.getContext('2d');
  const w = canvas.width = canvas.offsetWidth*devicePixelRatio;
  const h = canvas.height = canvas.offsetHeight*devicePixelRatio;
  ctx.clearRect(0,0,w,h);
  ctx.lineWidth = 2*devicePixelRatio;
  ctx.strokeStyle = color;
  ctx.beginPath();
  for(let i=0;i<data.length;i++){
    const x = (i/(data.length-1))*w;
    const y = h - (data[i]/100)*h;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  }
  ctx.stroke();
  // gradient fill
  const g = ctx.createLinearGradient(0,0,0,h);
  g.addColorStop(0, color+'33'); g.addColorStop(1, 'transparent');
  ctx.fillStyle = g;
  ctx.lineTo(w,h); ctx.lineTo(0,h); ctx.closePath();
  ctx.fill();
}

/* ---------- Renderizaciones ---------- */
function renderAll(){
  // update history
  cpuHistory.push(randSpike(cpuHistory[cpuHistory.length-1]||25, 12));
  cpuHistory.shift();
  ramHistory.push(randSpike(ramHistory[ramHistory.length-1]||40, 10));
  ramHistory.shift();
  diskUsage = Math.min(95, diskUsage + (Math.random()-0.4)*1.2);

  document.getElementById('cpuPct').textContent = Math.round(cpuHistory[cpuHistory.length-1]) + '%';
  document.getElementById('ramPct').textContent = Math.round(ramHistory[ramHistory.length-1]) + '%';
  document.getElementById('diskPct').textContent = Math.round(diskUsage) + '%';
  document.getElementById('diskBar').style.width = Math.round(diskUsage)+'%';

  drawLine(document.getElementById('cpuChart'), cpuHistory, '#00ffd0');
  drawLine(document.getElementById('ramChart'), ramHistory, '#7ef7d8');
  renderProcesses();
}
setInterval(renderAll, 900);
renderAll();

/* ---------- Logs ---------- */
function renderLogs(){
  const box = document.getElementById('logBox');
  box.innerHTML = logs.slice(0,200).map(l=>`<div>${l}</div>`).join('');
  document.getElementById('logCount').textContent = logs.length;
}
document.getElementById('clearLogs').addEventListener('click', ()=>{
  logs.length=0; renderLogs(); pushLog('Logs limpiados por el usuario');
});

/* ---------- Procesos simulados ---------- */
function renderProcesses(){
  const list = document.getElementById('procList');
  const arr = Array.from(processes.values()).sort((a,b)=>b.cpu-a.cpu);
  list.innerHTML = arr.map(p => `
    <div class="proc">
      <div style="display:flex;flex-direction:column">
        <strong style="color:#eafff7">${p.name}</strong>
        <small style="color:#9ef7ea">${p.cmd}</small>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div style="min-width:60px;text-align:right">${p.cpu}%</div>
        <div><button class="btn kill" data-id="${p.id}">üó°Ô∏è</button></div>
      </div>
    </div>
  `).join('');
  // attach kill handlers
  list.querySelectorAll('.btn.kill').forEach(b=>{
    b.addEventListener('click', ()=> {
      const id = b.dataset.id;
      const p = processes.get(id);
      if(p){ processes.delete(id); pushLog(`Proceso ${p.name} (pid ${id}) terminado`); renderProcesses(); }
    });
  });
}

document.getElementById('spawnProc').addEventListener('click', ()=>{
  const id = 'p'+(++procCounter);
  const names = ['peke-sync','peke-net','render','updater','daemon','worker','svc'];
  const name = names[Math.floor(Math.random()*names.length)] + '-' + Math.floor(Math.random()*999);
  processes.set(id,{id,name,cmd:'/usr/bin/'+name,cpu:Math.round(1+Math.random()*25)});
  pushLog(`Proceso ${name} (pid ${id}) creado`);
  renderProcesses();
});

document.getElementById('killAll').addEventListener('click', ()=>{
  processes.clear(); pushLog('Todos los procesos terminados'); renderProcesses();
});

/* ---------- A√±adir widget din√°mico ---------- */
const widgetCatalog = ['cpu','ram','disk','processes','logs'];
document.getElementById('addWidgetBtn').addEventListener('click', ()=>{
  // cycle create a minimal widget: small stat
  const id = widgetCatalog[Math.floor(Math.random()*widgetCatalog.length)];
  const el = document.createElement('div');
  el.className = 'card small widget';
  el.draggable = true;
  el.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>Nuevo</strong><div style="font-size:12px;color:#8fffe2">${id}</div></div><div class="badge">--</div></div><div style="height:60px"></div>`;
  document.getElementById('grid').appendChild(el);
  pushLog(`Widget ${id} a√±adido`);
  attachDragWidget(el);
});

/* ---------- Drag & drop reordering de widgets ---------- */
const grid = document.getElementById('grid');
let dragSrc = null;
function attachDragWidget(w){
  w.addEventListener('dragstart', e=>{
    dragSrc = w; w.classList.add('dragging');
  });
  w.addEventListener('dragend', e=>{ w.classList.remove('dragging'); dragSrc=null; });
  w.addEventListener('dragover', e=>e.preventDefault());
  w.addEventListener('drop', e=>{
    e.preventDefault();
    if(!dragSrc || dragSrc===w) return;
    const children = Array.from(grid.children);
    const from = children.indexOf(dragSrc);
    const to = children.indexOf(w);
    if(from<0||to<0) return;
    grid.removeChild(dragSrc);
    grid.insertBefore(dragSrc, to>from? w.nextSibling : w);
    pushLog('Widgets reorganizados');
  });
}
document.querySelectorAll('.widget').forEach(attachDragWidget);

/* ---------- Export estado JSON ---------- */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const state = {
    cpuHistory, ramHistory, diskUsage, logs:logs.slice(0,200), procs:Array.from(processes.values())
  };
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='pekeos-state.json'; a.click(); URL.revokeObjectURL(url);
  pushLog('Estado exportado (JSON)');
});

/* ---------- Inicio demo: populate procesos y logs ---------- */
for(let i=0;i<5;i++){ document.getElementById('spawnProc').click(); }
pushLog('Monitor iniciado');
pushLog('Sensores virtuales activos');
</script>
</body>
</html>
