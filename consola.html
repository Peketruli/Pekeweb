<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consola de Actividades</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #111;
    color: #fff;
    padding: 20px;
}
h1 {
    color: #ff6f00;
    text-shadow: 0 0 8px #ff6f00;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
th, td {
    padding: 10px;
    border: 1px solid #444;
}
th {
    background-color: #222;
}
tr:nth-child(even) {
    background-color: #1a1a1a;
}
</style>
</head>
<body>
<h1>ðŸ“œ Registro de Actividades</h1>
<table>
<thead>
<tr>
<th>Usuario</th>
<th>AcciÃ³n</th>
<th>Detalle</th>
<th>Fecha</th>
</tr>
</thead>
<tbody id="logBody">
<tr><td colspan="4" style="color:#aaa;">Cargando...</td></tr>
</tbody>
</table>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

async function loadActividad() {
    const { data, error } = await supabase
        .from("actividad")
        .select("id, user_id, accion, detalle, fecha, usuarios(username)")
        .order("fecha", { ascending: false });

    const tbody = document.getElementById("logBody");
    if (error) {
        tbody.innerHTML = `<tr><td colspan="4" style="color:red;">Error cargando actividades: ${error.message}</td></tr>`;
        console.error(error);
        return;
    }

    if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="4" style="color:#aaa;">No hay actividades registradas.</td></tr>`;
        return;
    }

    tbody.innerHTML = "";
    data.forEach(act => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${act.usuarios?.username || "Desconocido"}</td>
            <td>${act.accion}</td>
            <td>${act.detalle}</td>
            <td>${new Date(act.fecha).toLocaleString()}</td>
        `;
        tbody.appendChild(tr);
    });
}

// Recargar cada 5 segundos
loadActividad();
setInterval(loadActividad, 5000);
</script>
</body>
</html>
