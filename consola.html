<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Consola de Actividad</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
  body { background-color: #000; color: #0f0; font-family: "Courier New", monospace; padding: 20px; white-space: pre-wrap; overflow-y: scroll; }
  h1 { color: #0f0; text-shadow: 0 0 10px #0f0; }
  .error { color: red; text-align: center; font-size: 24px; margin-top: 100px; }
</style>
</head>
<body>
<h1>Consola de Actividad</h1>
<div id="output"></div>

<script>
// ðŸ”§ CONFIGURACIÃ“N SUPABASE
const supabaseUrl = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const supabaseKey = "TU_SUPABASE_PUBLIC_KEY"; // reemplaza con tu clave
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// ðŸ”‘ CLAVE SECRETA PARA PEKETRULI
const claveSecreta = "yo_soy_peketruli"; // cambia esto a cualquier frase secreta que solo tÃº sepas

// âœ… ACCESO SIMPLIFICADO
const acceso = prompt("Introduce la clave para abrir la consola:");
if(acceso !== claveSecreta){
  document.body.innerHTML = "<h1 class='error'>Casi pero no, vuelve cuando seas admin ðŸ˜Ž</h1>";
} else {
  iniciarConsola();
}

// ðŸš€ FUNCIONES DE CONSOLA
async function iniciarConsola(){
  log("ðŸŸ¢ Bienvenido, Peketruli. Consola conectada a Supabase...\n");

  const { data, error } = await supabase
    .from("actividad")
    .select("*")
    .order("fecha", { ascending: true });

  if(error) log("âŒ Error al cargar actividad: " + error.message);
  else if(!data || data.length === 0) log("Sin registros anteriores.\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n");
  else {
    data.forEach(row => {
      const hora = new Date(row.fecha).toLocaleTimeString();
      log(`[${hora}] ${row.usuario} ${row.accion}`);
    });
    log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n");
  }

  supabase
    .channel("actividad_changes")
    .on("postgres_changes", { event: "INSERT", schema: "public", table: "actividad" }, payload => {
      const nuevo = payload.new;
      const hora = new Date(nuevo.fecha).toLocaleTimeString();
      log(`[${hora}] ${nuevo.usuario} ${nuevo.accion}`);
    })
    .subscribe();
}

// Registrar actividad
window.registrarActividad = async function(accion){
  const usuario = "Peketruli"; // siempre Peketruli para tu consola
  const { error } = await supabase.from("actividad").insert([{ usuario, accion, fecha: new Date().toISOString() }]);
  if(error) console.error("Error al registrar actividad:", error.message);
}

// Mostrar mensajes
function log(msg){
  const output = document.getElementById("output");
  output.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
  output.scrollTop = output.scrollHeight;
}
</script>
</body>
</html>
