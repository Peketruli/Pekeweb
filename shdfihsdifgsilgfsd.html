<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poker Online</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #2c2c2c, #1a1a1a);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h1 { text-align: center; margin-top: 20px; }

#loginContainer, #lobbyContainer, #gameContainer {
    display: none;
    margin-top: 30px;
}

button {
    padding: 10px 20px;
    margin: 5px;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    background-color: #ff6f61;
    color: #fff;
    font-weight: bold;
    transition: all 0.3s;
}
button:hover { background-color: #ff4b3e; }

.cards {
    display: flex;
    justify-content: center;
    margin: 10px;
}

.card {
    width: 60px;
    height: 90px;
    margin: 0 5px;
    background-color: #fff;
    color: #000;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 20px;
    transform: translateY(-100px);
    opacity: 0;
    transition: all 0.5s;
}

.card.show {
    transform: translateY(0);
    opacity: 1;
}

#players {
    display: flex;
    justify-content: center;
    margin: 20px;
}

.player {
    background: #333;
    padding: 10px;
    margin: 0 10px;
    border-radius: 8px;
    min-width: 120px;
    text-align: center;
}

#controls {
    margin-top: 20px;
}

#pozo {
    margin: 20px;
    font-size: 18px;
    font-weight: bold;
}

#fichasContainer button {
    background-color: #4CAF50;
}
</style>
</head>
<body>

<h1>Poker Online</h1>

<div id="loginContainer">
    <input type="text" id="username" placeholder="Nombre de usuario">
    <button id="btnLogin">Entrar</button>
</div>

<div id="lobbyContainer">
    <h2>Sala Lobby</h2>
    <button id="btnCrearSala">Crear Sala</button>
    <div id="salaList"></div>
</div>

<div id="gameContainer">
    <h2>Juego</h2>
    <div id="players"></div>
    <div class="cards" id="comunitarias"></div>
    <div id="pozo">Pozo: 0</div>
    <div id="controls">
        <div id="fichasContainer">
            <button onclick="apostarFicha(1)">Apostar 1</button>
            <button onclick="apostarFicha(5)">Apostar 5</button>
            <button onclick="apostarFicha(25)">Apostar 25</button>
            <button onclick="apostarFicha(100)">Apostar 100</button>
        </div>
        <button onclick="pasarTurno()">Pasar</button>
        <button onclick="fold()">Fold</button>
    </div>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

const SUPABASE_URL = 'TU_SUPABASE_URL';
const SUPABASE_KEY = 'TU_SUPABASE_ANON_KEY';
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let username = '';
let salaActual = null;
let gameState = null;

// --- LOGIN ---
document.getElementById('loginContainer').style.display = 'block';
document.getElementById('btnLogin').addEventListener('click', async () => {
    username = document.getElementById('username').value.trim();
    if(!username) return alert('Escribe un nombre');
    localStorage.setItem('username', username);
    await cargarLobby();
});

// --- LOBBY ---
async function cargarLobby(){
    document.getElementById('loginContainer').style.display = 'none';
    document.getElementById('lobbyContainer').style.display = 'block';
    const { data: salas } = await supabase.from('room').select('*');
    mostrarSalas(salas);
}

function mostrarSalas(salas){
    const salaList = document.getElementById('salaList');
    salaList.innerHTML = '';
    salas.forEach(s => {
        let btn = document.createElement('button');
        btn.textContent = `Sala ${s.id} (${s.players.length}/4)`;
        btn.disabled = s.players.length >=4;
        btn.onclick = () => unirSala(s.id);
        salaList.appendChild(btn);
    });
}

document.getElementById('btnCrearSala').addEventListener('click', async ()=>{
    const { data, error } = await supabase.from('room').insert([{ players: [username], game_state: {}, pozo: 0 }]).select().single();
    if(error) return alert('Error al crear sala');
    unirSala(data.id);
});

async function unirSala(id){
    const { data: sala } = await supabase.from('room').select('*').eq('id', id).single();
    if(sala.players.length>=4) return alert('Sala llena');
    const jugadores = [...sala.players, username];
    await supabase.from('room').update({ players: jugadores }).eq('id', id);
    salaActual = id;
    document.getElementById('lobbyContainer').style.display = 'none';
    document.getElementById('gameContainer').style.display = 'block';
    iniciarGameLoop();
}

// --- GAME LOOP ---
function iniciarGameLoop(){
    setInterval(async ()=>{
        if(!salaActual) return;
        const { data } = await supabase.from('room').select('*').eq('id', salaActual).single();
        gameState = data;
        dibujarJuego();
    }, 1000);
}

// --- DIBUJAR JUEGO ---
function dibujarJuego(){
    // Jugadores
    const playersDiv = document.getElementById('players');
    playersDiv.innerHTML = '';
    gameState.players.forEach(p=>{
        let div = document.createElement('div');
        div.className = 'player';
        div.innerHTML = `<strong>${p}</strong>`;
        playersDiv.appendChild(div);
    });

    // Cartas comunitarias
    const comDiv = document.getElementById('comunitarias');
    comDiv.innerHTML = '';
    if(gameState.game_state.comunitarias){
        gameState.game_state.comunitarias.forEach(c => {
            let card = document.createElement('div');
            card.className = 'card';
            card.textContent = c;
            comDiv.appendChild(card);
            setTimeout(()=> card.classList.add('show'), 100);
        });
    }

    document.getElementById('pozo').textContent = `Pozo: ${gameState.pozo}`;
}

// --- ACCIONES ---
async function apostarFicha(valor){
    if(!gameState) return;
    // Verificar fichas en DB si quieres
    const pozo = gameState.pozo + valor;
    await supabase.from('room').update({
        pozo
    }).eq('id', salaActual);
}

async function pasarTurno(){
    // Implementar logica de turnos
    alert('Pasar turno (a implementar l√≥gica de turnos)');
}

async function fold(){
    alert('Fold (marcar jugador como retirado, implementar)');
}
</script>

</body>
  </html>
