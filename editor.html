<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editor de Mapas v2 (con Zonas)</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #111;
            color: white;
        }

        /* --- Interfaz Fija --- */
        .fixed-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 10;
        }

        #exportButton {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            background-color: #4CAF50; /* Verde */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
        }
        #exportButton:hover {
            background-color: #45a049;
        }
        
        #drawModeLabel {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        #drawModeSelect {
            width: 100%;
            padding: 5px;
            font-size: 14px;
        }

        canvas {
            display: block;
            background-color: #333; /* El suelo del mapa */
            border: 2px solid #555; 
        }
    </style>
</head>
<body>

    <div class="fixed-ui">
        <button id="exportButton">Generar Código</button>
        
        <label id="drawModeLabel" for="drawModeSelect">Modo de Dibujo:</label>
        <select id="drawModeSelect">
            <option value="wall">Pared (Gris)</option>
            <option value="spawn_at">Spawn AT (Azul)</option>
            <option value="spawn_t">Spawn T (Rojo)</option>
            <option value="site_a">Sitio A (Naranja)</option>
            <option value="site_b">Sitio B (Naranja)</option>
        </select>
        <p style="font-size: 12px; margin-top: 10px;">¡Arrastra para dibujar!<br>Usa el scroll para moverte.</p>
    </div>

    <canvas id="mapCanvas"></canvas>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        const exportButton = document.getElementById('exportButton');
        const drawModeSelect = document.getElementById('drawModeSelect');

        canvas.width = 3000;
        canvas.height = 2000;

        // --- 2. ALMACÉN Y ESTADO ---
        
        // ¡¡¡ PEGA TU CÓDIGO DE PAREDES AQUÍ DENTRO !!!
        let walls = [];
        
        // Las zonas se guardarán aquí
        let zones = [];
        
        let currentDrawMode = 'wall'; // Modo inicial
        let isDrawing = false;
        let startX = 0, startY = 0, currentX = 0, currentY = 0;
        
        // --- 3. EVENTOS ---

        // Actualizar el modo de dibujo
        drawModeSelect.addEventListener('change', (e) => {
            currentDrawMode = e.target.value;
        });

        // Empezar a dibujar
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            startX = e.offsetX;
            startY = e.offsetY;
        });

        // Moverse mientras dibuja
        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            currentX = e.offsetX;
            currentY = e.offsetY;
        });

        // Soltar el clic y guardar
        canvas.addEventListener('mouseup', (e) => {
            if (!isDrawing) return;
            isDrawing = false;
            
            const rect = {
                x: Math.min(startX, currentX),
                y: Math.min(startY, currentY),
                width: Math.abs(startX - currentX),
                height: Math.abs(startY - currentY)
            };

            if (rect.width === 0 || rect.height === 0) return; // Evitar clics

            // --- Lógica para guardar en el array correcto ---
            switch (currentDrawMode) {
                case 'wall':
                    walls.push(rect);
                    break;
                case 'spawn_at':
                    zones.push({ ...rect, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' });
                    break;
                case 'spawn_t':
                    zones.push({ ...rect, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' });
                    break;
                case 'site_a':
                    zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' });
                    break;
                case 'site_b':
                    zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' });
                    break;
            }
        });

        // --- 4. BOTÓN DE EXPORTAR ---
        exportButton.addEventListener('click', () => {
            let output = "const walls = [\n";
            for (const wall of walls) {
                output += `    { x: ${wall.x}, y: ${wall.y}, width: ${wall.width}, height: ${wall.height} },\n`;
            }
            output += "];\n\n";

            output += "const zones = [\n";
            for (const zone of zones) {
                // Quitamos el color del objeto al exportar, solo guardamos los datos
                output += `    { x: ${zone.x}, y: ${zone.y}, width: ${zone.width}, height: ${zone.height}, color: '${zone.color}', name: '${zone.name}' },\n`;
            }
            output += "];\n";

            // Abrir en ventana emergente
            const newWindow = window.open("", "Código del Mapa");
            newWindow.document.title = "Copia tu Código de Mapa (walls y zones)";
            newWindow.document.write("<h3>¡Copia este código y pégalo en tu juego!</h3>");
            newWindow.document.write("<pre>" + output + "</pre>");
            newWindow.document.close();
        });

        // --- 5. BUCLE DE DIBUJADO (Gráficos) ---
        function drawLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar todas las PAREDES
            ctx.fillStyle = '#999';
            for (const wall of walls) {
                ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            }

            // Dibujar todas las ZONAS
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            for (const zone of zones) {
                ctx.fillStyle = zone.color;
                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                ctx.fillStyle = 'white'; // Texto
                ctx.fillText(zone.name, zone.x + zone.width / 2, zone.y + zone.height / 2);
            }

            // Dibujar el "fantasma"
            if (isDrawing) {
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = 'white';
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };
                ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
                ctx.setLineDash([]);
            }

            requestAnimationFrame(drawLoop);
        }

        drawLoop();
    </script>
</body>
</html>
