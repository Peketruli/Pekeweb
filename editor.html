<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editor de Mapas v4 (Rutas CT)</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #111;
            color: white;
        }
        .fixed-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 10;
        }
        #exportButton {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
        }
        #exportButton:hover { background-color: #45a049; }
        #drawModeLabel { font-weight: bold; display: block; margin-bottom: 5px; }
        #drawModeSelect { width: 100%; padding: 5px; font-size: 14px; }
        canvas {
            display: block;
            background-color: #333;
            border: 2px solid #555; 
        }
    </style>
</head>
<body>

    <div class="fixed-ui">
        <button id="exportButton">Generar Código</button>
        
        <label id="drawModeLabel" for="drawModeSelect">Modo de Dibujo:</label>
        <select id="drawModeSelect">
            <option value="wall">Pared (Gris)</option>
            <option value="spawn_at">Spawn AT (Azul)</option>
            <option value="spawn_t">Spawn T (Rojo)</option>
            <option value="site_a">Sitio A (Naranja)</option>
            <option value="site_b">Sitio B (Naranja)</option>
            <optgroup label="IA Enemiga (Terrorista)">
                <option value="path_T_A_1">Ruta T - A1 (Amarillo)</option>
                <option value="path_T_A_2">Ruta T - A2 (Amarillo claro)</option>
                <option value="path_T_B_1">Ruta T - B1 (Rojo claro)</option>
                <option value="path_T_B_2">Ruta T - B2 (Naranja)</option>
            </optgroup>
            <optgroup label="IA Aliada (Anti-Terrorista)">
                <option value="path_CT_A_1">Ruta CT - A1 (Cian)</option>
                <option value="path_CT_A_2">Ruta CT - A2 (Azul claro)</option>
                <option value="path_CT_B_1">Ruta CT - B1 (Verde claro)</option>
                <option value="path_CT_B_2">Ruta CT - B2 (Lima)</option>
                <option value="path_CT_MID_1">Ruta CT - Medio (Blanco)</option>
            </optgroup>
        </select>
        <p style="font-size: 12px; margin-top: 10px;">
            <b>Rectángulos:</b> Arrastra<br>
            <b>Caminos de IA:</b> Haz clic en orden
        </p>
    </div>

    <canvas id="mapCanvas"></canvas>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        const exportButton = document.getElementById('exportButton');
        const drawModeSelect = document.getElementById('drawModeSelect');

        canvas.width = 3000;
        canvas.height = 2000;

        // --- 2. ALMACÉN Y ESTADO ---
        
        // ¡¡¡ PEGA TU CÓDIGO DE PAREDES AQUÍ DENTRO !!!
        let walls = [];
        
        // ¡¡¡ PEGA TU CÓDIGO DE ZONAS AQUÍ DENTRO !!!
        let zones = [];
        
        // ¡¡¡ PEGA TU OBJETO "paths" COMPLETO AQUÍ !!!
        let paths = {
            path_T_A_1: [],
            path_T_A_2: [],
            path_T_B_1: [],
            path_T_B_2: [],
            path_CT_A_1: [],
            path_CT_A_2: [],
            path_CT_B_1: [],
            path_CT_B_2: [],
            path_CT_MID_1: []
        };
        
        // Colores para dibujar los caminos
        const pathColors = {
            path_T_A_1: "yellow",
            path_T_A_2: "#FFFFE0", // Amarillo claro
            path_T_B_1: "#FFCCCB", // Rojo claro
            path_T_B_2: "orange",
            path_CT_A_1: "cyan",
            path_CT_A_2: "#ADD8E6", // Azul claro
            path_CT_B_1: "#90EE90", // Verde claro
            path_CT_B_2: "#00FF00", // Lima
            path_CT_MID_1: "white"
        };
        
        let currentDrawMode = 'wall';
        let isDrawing = false; // Para rectángulos
        let startX = 0, startY = 0, currentX = 0, currentY = 0;
        
        // --- 3. EVENTOS ---
        drawModeSelect.addEventListener('change', (e) => {
            currentDrawMode = e.target.value;
        });

        canvas.addEventListener('mousedown', (e) => {
            startX = e.offsetX;
            startY = e.offsetY;
            
            if (currentDrawMode.startsWith('path_')) {
                if (!paths[currentDrawMode]) {
                    paths[currentDrawMode] = [];
                }
                paths[currentDrawMode].push({ x: startX, y: startY });
                isDrawing = false; 
            } else {
                isDrawing = true;
                currentX = startX;
                currentY = startY;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            currentX = e.offsetX;
            currentY = e.offsetY;
        });

        canvas.addEventListener('mouseup', (e) => {
            if (isDrawing) {
                isDrawing = false;
                
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };

                if (rect.width === 0 || rect.height === 0) return;

                switch (currentDrawMode) {
                    case 'wall':
                        walls.push(rect);
                        break;
                    case 'spawn_at':
                        zones.push({ ...rect, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' });
                        break;
                    case 'spawn_t':
                        zones.push({ ...rect, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' });
                        break;
                    case 'site_a':
                        zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' });
                        break;
                    case 'site_b':
                        zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' });
                        break;
                }
            }
        });

        // --- 4. BOTÓN DE EXPORTAR ---
        exportButton.addEventListener('click', () => {
            for (const key in pathColors) {
                if (!paths[key]) {
                    paths[key] = [];
                }
            }
            
            let output = "// === ARRAY DE PAREDES ===\n";
            output += "const walls = [\n";
            for (const wall of walls) {
                output += `    { x: ${wall.x}, y: ${wall.y}, width: ${wall.width}, height: ${wall.height} },\n`;
            }
            output += "];\n\n";

            output += "// === ARRAY DE ZONAS ===\n";
            output += "const zones = [\n";
            for (const zone of zones) {
                output += `    { x: ${zone.x}, y: ${zone.y}, width: ${zone.width}, height: ${zone.height}, color: '${zone.color}', name: '${zone.name}' },\n`;
            }
            output += "];\n\n";
            
            output += "// === OBJETO DE CAMINOS IA (T y CT) ===\n";
            output += "const paths = {\n";
            for (const pathName in paths) {
                if (pathColors[pathName]) {
                    output += `    ${pathName}: [\n`;
                    for (const point of paths[pathName]) {
                        output += `        { x: ${point.x}, y: ${point.y} },\n`;
                    }
                    output += `    ],\n`;
                }
            }
            output += "};\n";

            const newWindow = window.open("", "Código del Mapa");
            newWindow.document.title = "Copia tu Código de Mapa (walls, zones y paths)";
            newWindow.document.write("<h3>¡Copia este código y pégalo en tu juego!</h3>");
            newWindow.document.write("<pre>" + output + "</pre>");
            newWindow.document.close();
        });

        // --- 5. BUCLE DE DIBUJADO ---
        function drawLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar Zonas
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            for (const zone of zones) {
                ctx.fillStyle = zone.color;
                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                ctx.fillStyle = 'white';
                ctx.fillText(zone.name, zone.x + zone.width / 2, zone.y + zone.height / 2);
            }

            // Dibujar Paredes
            ctx.fillStyle = '#999';
            for (const wall of walls) {
                ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            }
            
            // Dibujar Caminos de IA
            for (const pathName in paths) {
                const path = paths[pathName];
                if (!path || path.length === 0) continue;
                
                const color = pathColors[pathName] || 'white';
                
                // Dibujar líneas
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(path[0].x, path[0].y);
                for (let i = 1; i < path.length; i++) {
                    ctx.lineTo(path[i].x, path[i].y);
                }
                ctx.stroke();
                
                // Dibujar puntos
                ctx.fillStyle = color;
                for (const point of path) {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 5, 0, Math.PI * 2); // Círculo de 5px
                    ctx.fill();
                }
            }

            // Dibujar "fantasma"
            if (isDrawing) {
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = 'white';
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };
                ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
                ctx.setLineDash([]);
            }

            requestAnimationFrame(drawLoop);
        }

        drawLoop();
    </script>
</body>
</html>
