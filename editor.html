<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editor de Mapas v5 (Borrar + Rotación)</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #111;
            color: white;
        }
        .fixed-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 10;
        }
        #exportButton {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
        }
        #exportButton:hover { background-color: #45a049; }
        #drawModeLabel { font-weight: bold; display: block; margin-bottom: 5px; }
        #drawModeSelect { width: 100%; padding: 5px; font-size: 14px; }
        canvas {
            display: block;
            background-color: #333;
            border: 2px solid #555; 
        }
    </style>
</head>
<body>

    <div class="fixed-ui">
        <button id="exportButton">Generar Código</button>
        
        <label id="drawModeLabel" for="drawModeSelect">Modo de Dibujo:</label>
        <select id="drawModeSelect">
            <option value="wall">Pared (Gris)</option>
            <option value="spawn_at">Spawn AT (Azul)</option>
            <option value="spawn_t">Spawn T (Rojo)</option>
            <option value="site_a">Sitio A (Naranja)</option>
            <option value="site_b">Sitio B (Naranja)</option>
            <optgroup label="IA Enemiga (Terrorista)">
                <option value="path_T_A_1">Ruta T - A1 (Amarillo)</option>
                <option value="path_T_A_2">Ruta T - A2 (Amarillo claro)</option>
                <option value="path_T_B_1">Ruta T - B1 (Rojo claro)</option>
                <option value="path_T_B_2">Ruta T - B2 (Naranja)</option>
            </optgroup>
            <optgroup label="IA Aliada (Defensa)">
                <option value="path_CT_A_1">Ruta CT - A1 (Cian)</option>
                <option value="path_CT_A_2">Ruta CT - A2 (Azul claro)</option>
                <option value="path_CT_B_1">Ruta CT - B1 (Verde claro)</option>
                <option value="path_CT_B_2">Ruta CT - B2 (Lima)</option>
                <option value="path_CT_MID_1">Ruta CT - Medio (Blanco)</option>
            </optgroup>
            <optgroup label="IA Aliada (Rotación)">
                <option value="path_CT_Rotate_B_to_A">Rotar B -> A (Magenta)</option>
                <option value="path_CT_Rotate_A_to_B">Rotar A -> B (Morado)</option>
            </optgroup>
        </select>
        <p style="font-size: 12px; margin-top: 10px;">
            <b>Clic Izq:</b> Dibujar<br>
            <b>Clic Der:</b> Borrar
        </p>
    </div>

    <canvas id="mapCanvas"></canvas>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        const exportButton = document.getElementById('exportButton');
        const drawModeSelect = document.getElementById('drawModeSelect');

        canvas.width = 3000;
        canvas.height = 2000;

        // --- 2. ALMACÉN Y ESTADO ---
        
       const walls = [ { x: 1696, y: 1311, width: 85, height: 632 }, { x: 1682, y: 1, width: 99, height: 579 }, { x: 1658, y: 774, width: 578, height: 381 }, { x: 1885, y: 429, width: 350, height: 355 }, { x: 1954, y: 1367, width: 328, height: 231 }, { x: 1841, y: 107, width: 395, height: 119 }, { x: 1402, y: 532, width: 135, height: 463 }, { x: 899, y: 209, width: 496, height: 337 }, { x: 881, y: 204, width: 523, height: 423 }, { x: 839, y: 119, width: 59, height: 507 }, { x: -1, y: 2, width: 345, height: 617 }, { x: 542, y: 293, width: 31, height: 22 }, { x: 571, y: 204, width: 33, height: 21 }, { x: 609, y: 268, width: 34, height: 23 }, { x: 493, y: 181, width: 19, height: 166 }, { x: 512, y: 347, width: 133, height: 24 }, { x: 494, y: 348, width: 356, height: 276 }, { x: 493, y: 340, width: 19, height: 15 }, { x: 491, y: 9, width: 26, height: 50 }, { x: 491, y: 3, width: 25, height: 9 }, { x: 594, y: 142, width: 24, height: 12 }, { x: 656, y: 182, width: 66, height: 35 }, { x: 761, y: 106, width: 21, height: 189 }, { x: 1, y: 3, width: 1520, height: 9 }, { x: 1522, y: 5, width: 1453, height: 6 }, { x: 2978, y: 7, width: 10, height: 3 }, { x: 2972, y: 5, width: 17, height: 6 }, { x: 2980, y: 9, width: 5, height: 728 }, { x: 2983, y: 738, width: 3, height: 610 }, { x: 2981, y: 739, width: 4, height: 615 }, { x: 2981, y: 1353, width: 3, height: 627 }, { x: 1465, y: 1943, width: 1520, height: 35 }, { x: -2, y: 1943, width: 1469, height: 35 }, { x: 0, y: 1225, width: 12, height: 720 }, { x: 4, y: 661, width: 8, height: 566 }, { x: 2, y: 604, width: 9, height: 59 }, { x: 1353, y: 1259, width: 200, height: 108 }, { x: 1159, y: 1035, width: 135, height: 123 }, { x: 1339, y: 1367, width: 67, height: 433 }, { x: 533, y: 1479, width: 115, height: 332 }, { x: 815, y: 1333, width: 355, height: 107 }, { x: 535, y: 1129, width: 143, height: 100 }, { x: 767, y: 826, width: 217, height: 236 }, { x: 1137, y: 692, width: 73, height: 55 }, { x: 501, y: 715, width: 58, height: 68 }, { x: 142, y: 1606, width: 405, height: 205 }, { x: 834, y: 1603, width: 40, height: 31 }, { x: 940, y: 1547, width: 260, height: 63 }, { x: 1115, y: 1662, width: 28, height: 76 }, { x: 943, y: 1706, width: 8, height: 31 }, { x: 875, y: 1767, width: 43, height: 29 }, { x: 898, y: 1656, width: 43, height: 15 }, { x: 1046, y: 1812, width: 40, height: 29 }, { x: 838, y: 1873, width: 33, height: 21 }, { x: 989, y: 1840, width: 94, height: 105 }, { x: 1190, y: 1783, width: 66, height: 36 } ];
        const zones = [ { x: 52, y: 969, width: 180, height: 236, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' }, { x: 2528, y: 976, width: 276, height: 243, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' }, { x: 545, y: 195, width: 130, height: 114, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' }, { x: 814, y: 1572, width: 396, height: 317, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' } ];
        const paths = {
            path_T_A_1: [ { x: 2648, y: 1020 }, { x: 2395, y: 317 }, { x: 2074, y: 280 }, { x: 1905, y: 275 }, { x: 1858, y: 300 }, { x: 1829, y: 383 }, { x: 1832, y: 533 }, { x: 1820, y: 611 }, { x: 1799, y: 663 }, { x: 1751, y: 690 }, { x: 1678, y: 681 }, { x: 1634, y: 650 }, { x: 1622, y: 583 }, { x: 1590, y: 512 }, { x: 1563, y: 441 }, { x: 1539, y: 384 }, { x: 1522, y: 297 }, { x: 1513, y: 279 }, { x: 1495, y: 222 }, { x: 1492, y: 200 }, { x: 1460, y: 169 }, { x: 1403, y: 139 }, { x: 1347, y: 138 }, { x: 1295, y: 135 }, { x: 1223, y: 118 }, { x: 1190, y: 111 }, { x: 1147, y: 98 }, { x: 1098, y: 74 }, { x: 929, y: 70 }, { x: 887, y: 70 }, { x: 860, y: 78 }, { x: 842, y: 85 }, { x: 833, y: 92 }, { x: 823, y: 106 }, { x: 812, y: 133 }, { x: 808, y: 160 }, { x: 809, y: 168 }, { x: 808, y: 184 }, { x: 805, y: 243 }, { x: 807, y: 250 }, { x: 809, y: 289 }, { x: 809, y: 292 }, { x: 806, y: 301 }, { x: 798, y: 308 }, { x: 790, y: 315 }, { x: 788, y: 316 }, { x: 775, y: 318 }, { x: 762, y: 321 }, { x: 748, y: 319 }, { x: 736, y: 320 }, { x: 717, y: 313 }, { x: 708, y: 305 }, { x: 695, y: 292 }, { x: 691, y: 287 }, { x: 689, y: 283 }, { x: 681, y: 272 }, { x: 676, y: 265 }, { x: 667, y: 248 }, { x: 659, y: 245 }, { x: 658, y: 245 } ],
            path_T_A_2: [ { x: 2638, y: 1089 }, { x: 2572, y: 1120 }, { x: 2536, y: 1141 }, { x: 2486, y: 1167 }, { x: 2398, y: 1196 }, { x: 2296, y: 1226 }, { x: 2219, y: 1227 }, { x: 2142, y: 1224 }, { x: 2046, y: 1225 }, { x: 1984, y: 1225 }, { x: 1907, y: 1228 }, { x: 1814, y: 1234 }, { x: 1714, y: 1211 }, { x: 1683, y: 1207 }, { x: 1657, y: 1204 }, { x: 1624, y: 1187 }, { x: 1624, y: 1160 }, { x: 1608, y: 1124 }, { x: 1605, y: 1087 }, { x: 1605, y: 1062 }, { x: 1602, y: 1028 }, { x: 1603, y: 992 }, { x: 1604, y: 988 }, { x: 1625, y: 247 }, { x: 1539, y: 183 }, { x: 1481, y: 85 }, { x: 1175, y: 79 }, { x: 1101, y: 79 }, { x: 889, y: 67 }, { x: 858, y: 80 }, { x: 820, y: 77 }, { x: 791, y: 78 }, { x: 770, y: 81 }, { x: 739, y: 90 }, { x: 721, y: 94 }, { x: 709, y: 102 }, { x: 690, y: 114 }, { x: 680, y: 121 }, { x: 676, y: 124 }, { x: 666, y: 131 }, { x: 662, y: 142 }, { x: 656, y: 153 }, { x: 653, y: 162 }, { x: 651, y: 165 }, { x: 644, y: 171 }, { x: 638, y: 178 }, { x: 637, y: 181 }, { x: 632, y: 196 }, { x: 632, y: 198 }, { x: 630, y: 212 }, { x: 630, y: 221 }, { x: 632, y: 226 } ],
            path_T_B_1: [ { x: 2646, y: 1102 }, { x: 2592, y: 1121 }, { x: 2548, y: 1136 }, { x: 2492, y: 1145 }, { x: 2399, y: 1167 }, { x: 2334, y: 1179 }, { x: 2288, y: 1187 }, { x: 2190, y: 1193 }, { x: 2126, y: 1204 }, { x: 2002, y: 1221 }, { x: 1944, y: 1235 }, { x: 1889, y: 1241 }, { x: 1787, y: 1248 }, { x: 1770, y: 1253 }, { x: 1744, y: 1259 }, { x: 1730, y: 1265 }, { x: 1706, y: 1273 }, { x: 1679, y: 1279 }, { x: 1665, y: 1289 }, { x: 1647, y: 1322 }, { x: 1630, y: 1358 }, { x: 1618, y: 1401 }, { x: 1606, y: 1437 }, { x: 1584, y: 1631 }, { x: 1584, y: 1635 }, { x: 1574, y: 1675 }, { x: 1559, y: 1725 }, { x: 1538, y: 1804 }, { x: 1508, y: 1834 }, { x: 1474, y: 1854 }, { x: 1438, y: 1870 }, { x: 1386, y: 1880 }, { x: 1351, y: 1883 }, { x: 1309, y: 1886 }, { x: 1273, y: 1883 }, { x: 1230, y: 1879 }, { x: 1159, y: 1830 }, { x: 1159, y: 1832 }, { x: 1133, y: 1826 }, { x: 1118, y: 1813 }, { x: 1102, y: 1793 }, { x: 1076, y: 1769 }, { x: 1059, y: 1753 }, { x: 1049, y: 1747 }, { x: 1045, y: 1746 }, { x: 1034, y: 1739 }, { x: 1024, y: 1734 } ],
            path_T_B_2: [ { x: 2622, y: 1111 }, { x: 2603, y: 1116 }, { x: 2547, y: 1132 }, { x: 2500, y: 1144 }, { x: 2440, y: 1165 }, { x: 2382, y: 1184 }, { x: 2336, y: 1194 }, { x: 2241, y: 1210 }, { x: 2153, y: 1213 }, { x: 2040, y: 1213 }, { x: 1973, y: 1218 }, { x: 1907, y: 1220 }, { x: 1798, y: 1220 }, { x: 1590, y: 1228 }, { x: 1517, y: 1228 }, { x: 1496, y: 1230 }, { x: 1436, y: 1208 }, { x: 1420, y: 1210 }, { x: 1277, y: 1222 }, { x: 1284, y: 1247 }, { x: 1287, y: 1277 }, { x: 1279, y: 1294 }, { x: 1265, y: 1326 }, { x: 1254, y: 1366 }, { x: 1256, y: 1396 }, { x: 1257, y: 1415 }, { x: 1256, y: 1434 }, { x: 1254, y: 1491 }, { x: 1257, y: 1501 }, { x: 1262, y: 1580 }, { x: 1259, y: 1590 }, { x: 1234, y: 1640 }, { x: 1226, y: 1651 }, { x: 1197, y: 1639 }, { x: 1162, y: 1635 }, { x: 1133, y: 1639 }, { x: 1104, y: 1648 }, { x: 1075, y: 1654 }, { x: 1039, y: 1669 }, { x: 1028, y: 1693 } ],
            path_CT_A_1: [ { x: 196, y: 1000 }, { x: 321, y: 749 }, { x: 407, y: 658 }, { x: 408, y: 523 }, { x: 408, y: 200 }, { x: 426, y: 152 }, { x: 476, y: 126 }, { x: 517, y: 128 }, { x: 534, y: 152 }, { x: 543, y: 184 }, { x: 545, y: 228 }, { x: 573, y: 252 }, ],
            path_CT_A_2: [ ],
            path_CT_B_1: [ { x: 199, y: 1179 }, { x: 259, y: 1222 }, { x: 360, y: 1275 }, { x: 543, y: 1319 }, { x: 660, y: 1392 }, { x: 721, y: 1448 }, { x: 767, y: 1634 }, { x: 809, y: 1706 }, { x: 854, y: 1712 }, { x: 888, y: 1700 }, { x: 920, y: 1689 }, { x: 956, y: 1684 }, { x: 997, y: 1696 }, ],
            path_CT_B_2: [ { x: 131, y: 1162 }, { x: 128, y: 1255 }, { x: 88, y: 1459 }, { x: 60, y: 1600 }, { x: 68, y: 1732 }, { x: 86, y: 1834 }, { x: 144, y: 1868 }, { x: 388, y: 1876 }, { x: 652, y: 1873 }, { x: 756, y: 1834 }, { x: 829, y: 1755 }, { x: 891, y: 1708 }, { x: 921, y: 1688 }, { x: 970, y: 1688 }, { x: 999, y: 1699 }, ],
            path_CT_MID_1: [ { x: 161, y: 1086 }, { x: 261, y: 1076 }, { x: 467, y: 1054 }, { x: 746, y: 1068 }, { x: 948, y: 1138 }, { x: 1196, y: 1240 }, { x: 1387, y: 1164 }, ],
        };
        
        // Colores para dibujar los caminos
        const pathColors = {
            path_T_A_1: "yellow",
            path_T_A_2: "#FFFFE0", // Amarillo claro
            path_T_B_1: "#FFCCCB", // Rojo claro
            path_T_B_2: "orange",
            path_CT_A_1: "cyan",
            path_CT_A_2: "#ADD8E6", // Azul claro
            path_CT_B_1: "#90EE90", // Verde claro
            path_CT_B_2: "#00FF00", // Lima
            path_CT_MID_1: "white",
            path_CT_Rotate_B_to_A: "#FF00FF", // Magenta
            path_CT_Rotate_A_to_B: "#800080"  // Morado
        };
        
        let currentDrawMode = 'wall';
        let isDrawing = false; // Para rectángulos
        let startX = 0, startY = 0, currentX = 0, currentY = 0;

        // --- 3. FUNCIONES DE AYUDA (NUEVO) ---
        function isPointInsideRect(px, py, rect) {
            return px > rect.x && px < rect.x + rect.width && py > rect.y && py < rect.y + rect.height;
        }

        function findClosestPoint(px, py, path) {
            let closestIndex = -1;
            let minDist = Infinity;
            for (let i = 0; i < path.length; i++) {
                const dist = Math.hypot(px - path[i].x, py - path[i].y);
                if (dist < 20 && dist < minDist) { // 20px de 'snap'
                    minDist = dist;
                    closestIndex = i;
                }
            }
            return closestIndex;
        }
        
        // --- 4. EVENTOS ---
        drawModeSelect.addEventListener('change', (e) => {
            currentDrawMode = e.target.value;
        });

        canvas.addEventListener('mousedown', (e) => {
            if (e.button !== 0) return; // Solo clic izquierdo
            
            startX = e.offsetX;
            startY = e.offsetY;
            
            if (currentDrawMode.startsWith('path_')) {
                if (!paths[currentDrawMode]) {
                    paths[currentDrawMode] = [];
                }
                paths[currentDrawMode].push({ x: startX, y: startY });
                isDrawing = false; 
            } else {
                isDrawing = true;
                currentX = startX;
                currentY = startY;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            currentX = e.offsetX;
            currentY = e.offsetY;
        });

        canvas.addEventListener('mouseup', (e) => {
            if (e.button !== 0) return; // Solo clic izquierdo
            if (isDrawing) {
                isDrawing = false;
                
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };

                if (rect.width === 0 || rect.height === 0) return;

                switch (currentDrawMode) {
                    case 'wall':
                        walls.push(rect);
                        break;
                    case 'spawn_at':
                        zones.push({ ...rect, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' });
                        break;
                    case 'spawn_t':
                        zones.push({ ...rect, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' });
                        break;
                    case 'site_a':
                        zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' });
                        break;
                    case 'site_b':
                        zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' });
                        break;
                }
            }
        });

        // (NUEVO) Evento de Clic Derecho para Borrar
        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault(); // Prevenir que salga el menú
            
            const mouseX = e.offsetX;
            const mouseY = e.offsetY;

            if (currentDrawMode.startsWith('path_')) {
                // Borrar un punto de una ruta
                const path = paths[currentDrawMode];
                if (path) {
                    const pointIndex = findClosestPoint(mouseX, mouseY, path);
                    if (pointIndex > -1) {
                        path.splice(pointIndex, 1); // Borra el punto
                    }
                }
            } else if (currentDrawMode === 'wall') {
                // Borrar una pared
                for (let i = walls.length - 1; i >= 0; i--) {
                    if (isPointInsideRect(mouseX, mouseY, walls[i])) {
                        walls.splice(i, 1); // Borra la pared
                        break; // Borra solo una a la vez
                    }
                }
            } else {
                // Borrar una zona
                for (let i = zones.length - 1; i >= 0; i--) {
                    if (isPointInsideRect(mouseX, mouseY, zones[i])) {
                        zones.splice(i, 1); // Borra la zona
                        break; 
                    }
                }
            }
        });

        // --- 5. BOTÓN DE EXPORTAR ---
        exportButton.addEventListener('click', () => {
            for (const key in pathColors) {
                if (!paths[key]) {
                    paths[key] = [];
                }
            }
            
            let output = "// === ARRAY DE PAREDES ===\n";
            output += "const walls = [\n";
            for (const wall of walls) {
                output += `    { x: ${wall.x}, y: ${wall.y}, width: ${wall.width}, height: ${wall.height} },\n`;
            }
            output += "];\n\n";

            output += "// === ARRAY DE ZONAS ===\n";
            output += "const zones = [\n";
            for (const zone of zones) {
                output += `    { x: ${zone.x}, y: ${zone.y}, width: ${zone.width}, height: ${zone.height}, color: '${zone.color}', name: '${zone.name}' },\n`;
            }
            output += "];\n\n";
            
            output += "// === OBJETO DE CAMINOS IA (T, CT y Rotación) ===\n";
            output += "const paths = {\n";
            for (const pathName in paths) {
                if (pathColors[pathName]) {
                    output += `    ${pathName}: [\n`;
                    for (const point of paths[pathName]) {
                        output += `        { x: ${point.x}, y: ${point.y} },\n`;
                    }
                    output += `    ],\n`;
                }
            }
            output += "};\n";

            const newWindow = window.open("", "Código del Mapa");
            newWindow.document.title = "Copia tu Código de Mapa (walls, zones y paths)";
            newWindow.document.write("<h3>¡Copia este código y pégalo en tu juego!</h3>");
            newWindow.document.write("<pre>" + output + "</pre>");
            newWindow.document.close();
        });

        // --- 6. BUCLE DE DIBUJADO ---
        function drawLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar Zonas
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            for (const zone of zones) {
                ctx.fillStyle = zone.color;
                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                ctx.fillStyle = 'white';
                ctx.fillText(zone.name, zone.x + zone.width / 2, zone.y + zone.height / 2);
            }

            // Dibujar Paredes
            ctx.fillStyle = '#999';
            for (const wall of walls) {
                ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            }
            
            // Dibujar Caminos de IA
            for (const pathName in paths) {
                const path = paths[pathName];
                if (!path || path.length === 0) continue;
                
                const color = pathColors[pathName] || 'white';
                
                // Dibujar líneas
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(path[0].x, path[0].y);
                for (let i = 1; i < path.length; i++) {
                    ctx.lineTo(path[i].x, path[i].y);
                }
                ctx.stroke();
                
                // Dibujar puntos
                ctx.fillStyle = color;
                for (const point of path) {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 5, 0, Math.PI * 2); // Círculo de 5px
                    ctx.fill();
                }
            }

            // Dibujar "fantasma"
            if (isDrawing) {
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = 'white';
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };
                ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
                ctx.setLineDash([]);
            }

            requestAnimationFrame(drawLoop);
        }

        drawLoop();
    </script>
</body>
</html>
