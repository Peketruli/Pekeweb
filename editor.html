<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Editor de Mapas v3 (con Puntos de Ruta)</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #111;
            color: white;
        }
        .fixed-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 10;
        }
        #exportButton {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 15px;
        }
        #exportButton:hover { background-color: #45a049; }
        #drawModeLabel { font-weight: bold; display: block; margin-bottom: 5px; }
        #drawModeSelect { width: 100%; padding: 5px; font-size: 14px; }
        canvas {
            display: block;
            background-color: #333;
            border: 2px solid #555; 
        }
    </style>
</head>
<body>

    <div class="fixed-ui">
        <button id="exportButton">Generar Código</button>
        
        <label id="drawModeLabel" for="drawModeSelect">Modo de Dibujo:</label>
        <select id="drawModeSelect">
            <option value="wall">Pared (Gris)</option>
            <option value="spawn_at">Spawn AT (Azul)</option>
            <option value="spawn_t">Spawn T (Rojo)</option>
            <option value="site_a">Sitio A (Naranja)</option>
            <option value="site_b">Sitio B (Naranja)</option>
            <optgroup label="Caminos de IA (Bots)">
                <option value="path_A_1">Camino A - Ruta 1 (Amarillo)</option>
                <option value="path_A_2">Camino A - Ruta 2 (Amarillo claro)</option>
                <option value="path_B_1">Camino B - Ruta 1 (Cian)</option>
                <option value="path_B_2">Camino B - Ruta 2 (Azul claro)</option>
            </optgroup>
        </select>
        <p style="font-size: 12px; margin-top: 10px;">
            <b>Rectángulos:</b> Arrastra<br>
            <b>Caminos de IA:</b> Haz clic en orden
        </p>
    </div>

    <canvas id="mapCanvas"></canvas>

    <script>
        // --- 1. CONFIGURACIÓN INICIAL ---
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        const exportButton = document.getElementById('exportButton');
        const drawModeSelect = document.getElementById('drawModeSelect');

        canvas.width = 3000;
        canvas.height = 2000;

        // --- 2. ALMACÉN Y ESTADO ---
        
       // --- 2. EL MAPA (Tu diseño) ---
        const walls = [ /* Tu array de paredes de 48 líneas va aquí... */ { x: 1696, y: 1311, width: 85, height: 632 }, { x: 1682, y: 1, width: 99, height: 579 }, { x: 1658, y: 774, width: 578, height: 381 }, { x: 1885, y: 429, width: 350, height: 355 }, { x: 1954, y: 1367, width: 328, height: 231 }, { x: 1841, y: 107, width: 395, height: 119 }, { x: 1402, y: 532, width: 135, height: 463 }, { x: 899, y: 209, width: 496, height: 337 }, { x: 881, y: 204, width: 523, height: 423 }, { x: 839, y: 119, width: 59, height: 507 }, { x: -1, y: 2, width: 345, height: 617 }, { x: 542, y: 293, width: 31, height: 22 }, { x: 571, y: 204, width: 33, height: 21 }, { x: 609, y: 268, width: 34, height: 23 }, { x: 493, y: 181, width: 19, height: 166 }, { x: 512, y: 347, width: 133, height: 24 }, { x: 494, y: 348, width: 356, height: 276 }, { x: 493, y: 340, width: 19, height: 15 }, { x: 491, y: 9, width: 26, height: 50 }, { x: 491, y: 3, width: 25, height: 9 }, { x: 594, y: 142, width: 24, height: 12 }, { x: 656, y: 182, width: 66, height: 35 }, { x: 761, y: 106, width: 21, height: 189 }, { x: 1, y: 3, width: 1520, height: 9 }, { x: 1522, y: 5, width: 1453, height: 6 }, { x: 2978, y: 7, width: 10, height: 3 }, { x: 2972, y: 5, width: 17, height: 6 }, { x: 2980, y: 9, width: 5, height: 728 }, { x: 2983, y: 738, width: 3, height: 610 }, { x: 2981, y: 739, width: 4, height: 615 }, { x: 2981, y: 1353, width: 3, height: 627 }, { x: 1465, y: 1943, width: 1520, height: 35 }, { x: -2, y: 1943, width: 1469, height: 35 }, { x: 0, y: 1225, width: 12, height: 720 }, { x: 4, y: 661, width: 8, height: 566 }, { x: 2, y: 604, width: 9, height: 59 }, { x: 1353, y: 1259, width: 200, height: 108 }, { x: 1159, y: 1035, width: 135, height: 123 }, { x: 1339, y: 1367, width: 67, height: 433 }, { x: 533, y: 1479, width: 115, height: 332 }, { x: 815, y: 1333, width: 355, height: 107 }, { x: 535, y: 1129, width: 143, height: 100 }, { x: 767, y: 826, width: 217, height: 236 }, { x: 1137, y: 692, width: 73, height: 55 }, { x: 501, y: 715, width: 58, height: 68 }, { x: 142, y: 1606, width: 405, height: 205 }, { x: 834, y: 1603, width: 40, height: 31 }, { x: 940, y: 1547, width: 260, height: 63 }, { x: 1115, y: 1662, width: 28, height: 76 }, { x: 943, y: 1706, width: 8, height: 31 }, { x: 875, y: 1767, width: 43, height: 29 }, { x: 898, y: 1656, width: 43, height: 15 }, { x: 1046, y: 1812, width: 40, height: 29 }, { x: 838, y: 1873, width: 33, height: 21 }, { x: 989, y: 1840, width: 94, height: 105 }, { x: 1190, y: 1783, width: 66, height: 36 } ];
        const zones = [ { x: 52, y: 969, width: 180, height: 236, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' }, { x: 2528, y: 976, width: 276, height: 243, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' }, { x: 545, y: 195, width: 130, height: 114, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' }, { x: 814, y: 1572, width: 396, height: 317, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' } ];

        
        // (NUEVO) Objeto para guardar los caminos de la IA
        let paths = {
            path_A_1: [],
            path_A_2: [],
            path_B_1: [],
            path_B_2: []
        };
        
        // Colores para dibujar los caminos
        const pathColors = {
            path_A_1: "yellow",
            path_A_2: "#FFFFE0", // Amarillo claro
            path_B_1: "cyan",
            path_B_2: "#ADD8E6"  // Azul claro
        };
        
        let currentDrawMode = 'wall';
        let isDrawing = false; // Para rectángulos
        let startX = 0, startY = 0, currentX = 0, currentY = 0;
        
        // --- 3. EVENTOS ---
        drawModeSelect.addEventListener('change', (e) => {
            currentDrawMode = e.target.value;
        });

        // (¡ACTUALIZADO!)
        canvas.addEventListener('mousedown', (e) => {
            startX = e.offsetX;
            startY = e.offsetY;

            // Si es un modo de "camino", solo añadimos un punto.
            if (currentDrawMode.startsWith('path_')) {
                paths[currentDrawMode].push({ x: startX, y: startY });
                isDrawing = false; // No activar el modo de arrastre
            } else {
                // Si es pared o zona, activamos el modo de arrastre
                isDrawing = true;
                currentX = startX;
                currentY = startY;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            // Solo actualiza si estamos arrastrando (pared/zona)
            if (!isDrawing) return;
            currentX = e.offsetX;
            currentY = e.offsetY;
        });

        // (¡ACTUALIZADO!)
        canvas.addEventListener('mouseup', (e) => {
            // Si estábamos dibujando un rectángulo (pared/zona)
            if (isDrawing) {
                isDrawing = false;
                
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };

                if (rect.width === 0 || rect.height === 0) return;

                switch (currentDrawMode) {
                    case 'wall':
                        walls.push(rect);
                        break;
                    case 'spawn_at':
                        zones.push({ ...rect, color: 'rgba(0, 150, 255, 0.5)', name: 'Spawn AT' });
                        break;
                    case 'spawn_t':
                        zones.push({ ...rect, color: 'rgba(255, 100, 0, 0.5)', name: 'Spawn T' });
                        break;
                    case 'site_a':
                        zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio A' });
                        break;
                    case 'site_b':
                        zones.push({ ...rect, color: 'rgba(255, 69, 0, 0.5)', name: 'Sitio B' });
                        break;
                }
            }
            // Si era un modo "path", no hacemos nada al soltar,
            // ya que el punto se añadió en 'mousedown'.
        });

        // --- 4. BOTÓN DE EXPORTAR (¡ACTUALIZADO!) ---
        exportButton.addEventListener('click', () => {
            let output = "// === ARRAY DE PAREDES ===\n";
            output += "const walls = [\n";
            for (const wall of walls) {
                output += `    { x: ${wall.x}, y: ${wall.y}, width: ${wall.width}, height: ${wall.height} },\n`;
            }
            output += "];\n\n";

            output += "// === ARRAY DE ZONAS ===\n";
            output += "const zones = [\n";
            for (const zone of zones) {
                output += `    { x: ${zone.x}, y: ${zone.y}, width: ${zone.width}, height: ${zone.height}, color: '${zone.color}', name: '${zone.name}' },\n`;
            }
            output += "];\n\n";
            
            output += "// === OBJETO DE CAMINOS IA ===\n";
            output += "const paths = {\n";
            for (const pathName in paths) {
                output += `    ${pathName}: [\n`;
                for (const point of paths[pathName]) {
                    output += `        { x: ${point.x}, y: ${point.y} },\n`;
                }
                output += `    ],\n`;
            }
            output += "};\n";

            // Abrir en ventana emergente
            const newWindow = window.open("", "Código del Mapa");
            newWindow.document.title = "Copia tu Código de Mapa (walls, zones y paths)";
            newWindow.document.write("<h3>¡Copia este código y pégalo en tu juego!</h3>");
            newWindow.document.write("<pre>" + output + "</pre>");
            newWindow.document.close();
        });

        // --- 5. BUCLE DE DIBUJADO (¡ACTUALIZADO!) ---
        function drawLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar Zonas
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            for (const zone of zones) {
                ctx.fillStyle = zone.color;
                ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                ctx.fillStyle = 'white';
                ctx.fillText(zone.name, zone.x + zone.width / 2, zone.y + zone.height / 2);
            }

            // Dibujar Paredes
            ctx.fillStyle = '#999';
            for (const wall of walls) {
                ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            }
            
            // (NUEVO) Dibujar Caminos de IA
            for (const pathName in paths) {
                const path = paths[pathName];
                if (path.length === 0) continue;
                
                const color = pathColors[pathName] || 'white';
                
                // Dibujar líneas
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(path[0].x, path[0].y);
                for (let i = 1; i < path.length; i++) {
                    ctx.lineTo(path[i].x, path[i].y);
                }
                ctx.stroke();
                
                // Dibujar puntos
                ctx.fillStyle = color;
                for (const point of path) {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 5, 0, Math.PI * 2); // Círculo de 5px
                    ctx.fill();
                }
            }

            // Dibujar el "fantasma" de pared/zona
            if (isDrawing) {
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = 'white';
                const rect = {
                    x: Math.min(startX, currentX),
                    y: Math.min(startY, currentY),
                    width: Math.abs(startX - currentX),
                    height: Math.abs(startY - currentY)
                };
                ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
                ctx.setLineDash([]);
            }

            requestAnimationFrame(drawLoop);
        }

        drawLoop();
    </script>
</body>
</html>
