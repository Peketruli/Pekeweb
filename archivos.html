<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Archivos - PekeOS</title>
<style>
:root{--bg:#02040a;--neon:#00ffd0;--muted:#9df7ea}
*{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
body{margin:0;background:linear-gradient(180deg,#03040a,#06121a);color:var(--muted);padding:14px}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.h1{font-weight:700;font-size:18px}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:transparent;border:1px solid rgba(0,255,208,0.06);padding:8px;border-radius:8px;cursor:pointer;color:var(--muted)}
.layout{display:flex;gap:12px;margin-top:12px;height:calc(100vh - 120px)}
.sidebar{width:220px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:10px;border-radius:10px;border:1px solid rgba(0,255,208,0.04)}
.main{flex:1;display:flex;flex-direction:column;gap:10px}
.path{font-size:13px;color:#9ef7ea;margin-bottom:6px}
.toolbar{display:flex;gap:8px;align-items:center}
.view{flex:1;background:#02040a;padding:12px;border-radius:10px;border:1px solid rgba(0,255,208,0.03);display:flex;flex-direction:column}
.grid{display:grid;grid-template-columns:repeat(auto-fill,120px);gap:12px;align-content:flex-start;overflow:auto;padding:6px}
.item{width:120px;text-align:center;padding:8px;border-radius:8px;border:1px solid transparent;cursor:pointer}
.item:hover{background:rgba(0,255,208,0.03);border-color:rgba(0,255,208,0.04)}
.icon{height:68px;display:flex;align-items:center;justify-content:center;font-size:34px;border-radius:10px}
.preview{width:360px;background:#010306;border-radius:8px;padding:10px;border:1px solid rgba(0,255,208,0.03)}
.preview img{max-width:100%;border-radius:6px}
.list-row{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed rgba(255,255,255,0.02)}
.small{font-size:12px;color:#9ef7ea}
.input{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);background:transparent;color:var(--muted)}
.search{width:100%}
.footer{margin-top:8px;color:#8fffe2;font-size:12px}
.dropzone{border:2px dashed rgba(0,255,208,0.04);padding:8px;border-radius:8px;text-align:center;color:#9ef7ea}
</style>
</head>
<body>

  <div class="header">
    <div>
      <div class="h1">ğŸ“ Explorador de Archivos</div>
      <div style="font-size:12px;color:#9ef7ea">Sistema virtual â€¢ Vista lista/cuadrÃ­cula â€¢ PrevisualizaciÃ³n inteligente</div>
    </div>
    <div class="controls">
      <input id="searchInput" class="input search" placeholder="Buscar archivos..." />
      <button class="btn" id="newFile">ğŸ“„ Nuevo</button>
      <button class="btn" id="newFolder">ğŸ“ Nueva Carpeta</button>
      <button class="btn" id="toggleView">ğŸ” Cambiar vista</button>
      <button class="btn" id="saveFS">ğŸ’¾ Guardar</button>
    </div>
  </div>

  <div class="layout">
    <div class="sidebar">
      <div style="font-weight:700;margin-bottom:8px">Favoritos</div>
      <div id="favList"></div>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.02);margin:10px 0">
      <div style="font-weight:700;margin-bottom:8px">Acciones</div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button class="btn" id="importBtn">ğŸ“¥ Importar (simulado)</button>
        <button class="btn" id="exportBtn">ğŸ“¤ Exportar FS</button>
        <button class="btn" id="loadBtn">ğŸ“‚ Cargar FS</button>
      </div>
    </div>

    <div class="main">
      <div class="path" id="pathBar">/</div>
      <div class="view">
        <div id="contentArea" style="display:flex;gap:12px;align-items:flex-start">
          <div style="flex:1">
            <div id="gridArea" class="grid"></div>
            <div id="listArea" style="display:none"></div>
          </div>
          <div class="preview" id="preview">
            <div style="font-weight:700">PrevisualizaciÃ³n</div>
            <div id="previewContent" style="margin-top:8px;color:#9ef7ea">Selecciona un archivo para ver su contenido.</div>
          </div>
        </div>
      </div>
      <div class="footer">Tip: arrastra y suelta archivos en la zona para simular upload.</div>
    </div>
  </div>

<script>
/* ---------- Virtual File System (nivel 3) ---------- */
let FS = {
  name:'root', type:'folder', children: [
    {name:'Documentos', type:'folder', children:[
      {name:'Bienvenida.txt', type:'file', mime:'text', content:'Bienvenido a PekeOS. Este es un archivo de prueba.'}
    ]},
    {name:'Imagenes', type:'folder', children:[
      {name:'paisaje.png', type:'file', mime:'image', content:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA...'} // placeholder
    ]},
    {name:'Musica', type:'folder', children:[]}
  ]
};
const lstack = ['/']; // ruta stack
let viewMode = 'grid'; // grid or list
const gridArea = document.getElementById('gridArea');
const listArea = document.getElementById('listArea');
const previewContent = document.getElementById('previewContent');
const pathBar = document.getElementById('pathBar');

/* ---------- Helpers ---------- */
function getFolderByPath(pathArr){
  let node = FS;
  for(let i=1;i<pathArr.length;i++){
    const p = pathArr[i];
    node = (node.children||[]).find(x=>x.name===p && x.type==='folder');
    if(!node) return null;
  }
  return node;
}
function currentFolder(){ return getFolderByPath(lstack) || FS; }
function formatSize(n){ return n+' bytes'; }

/* ---------- Render ---------- */
function renderFS(){
  const folder = currentFolder();
  pathBar.textContent = lstack.join('/') || '/';
  const items = folder.children || [];
  // grid
  gridArea.innerHTML = items.map(it=>`
    <div class="item" data-name="${it.name}">
      <div class="icon">${it.type==='folder'?'ğŸ“': (it.mime==='image'?'ğŸ–¼ï¸': it.mime==='audio'?'ğŸµ':'ğŸ“„')}</div>
      <div style="margin-top:6px;font-weight:700">${it.name}</div>
      <div class="small">${it.type==='folder' ? 'Carpeta' : (it.mime||'archivo')}</div>
    </div>
  `).join('');
  // list
  listArea.innerHTML = items.map(it=>`
    <div class="list-row" data-name="${it.name}">
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:30px">${it.type==='folder'?'ğŸ“': (it.mime==='image'?'ğŸ–¼ï¸':it.mime==='audio'?'ğŸµ':'ğŸ“„')}</div>
        <div>${it.name}</div>
      </div>
      <div class="small">${it.type==='folder' ? '-' : (it.content? (it.content.length+' chars') : '-')}</div>
    </div>
  `).join('');
  attachItemHandlers();
  renderFavorites();
}

/* ---------- Handlers de items ---------- */
function attachItemHandlers(){
  document.querySelectorAll('#gridArea .item').forEach(el=>{
    el.ondblclick = ()=> {
      const name = el.dataset.name;
      const folder = currentFolder();
      const it = folder.children.find(x=>x.name===name);
      if(!it) return;
      if(it.type==='folder'){ lstack.push(name); renderFS(); }
      else openPreview(it);
    };
    el.onclick = ()=> {
      document.querySelectorAll('#gridArea .item').forEach(x=>x.style.outline='none');
      el.style.outline='2px solid rgba(0,255,208,0.12)';
      const name = el.dataset.name;
      const folder = currentFolder();
      const it = folder.children.find(x=>x.name===name);
      openPreview(it);
    };
    // dragstart (simulaciÃ³n)
    el.draggable = true;
    el.ondragstart = (e)=> { e.dataTransfer.setData('text/name', el.dataset.name); };
  });

  document.querySelectorAll('.list-row').forEach(el=>{
    el.ondblclick = ()=> {
      const name = el.dataset.name;
      const folder = currentFolder();
      const it = folder.children.find(x=>x.name===name);
      if(it.type==='folder'){ lstack.push(name); renderFS(); }
      else openPreview(it);
    };
    el.onclick = ()=> {
      document.querySelectorAll('.list-row').forEach(x=>x.style.background='transparent');
      el.style.background='rgba(0,255,208,0.03)';
      const name = el.dataset.name;
      const folder = currentFolder();
      const it = folder.children.find(x=>x.name===name);
      openPreview(it);
    };
  });
}

/* ---------- Preview inteligente ---------- */
function openPreview(it){
  if(!it) return;
  if(it.type==='folder'){
    previewContent.innerHTML = `<div style="font-weight:700">${it.name}</div><div class="small">Carpeta</div>`;
    return;
  }
  if(it.mime==='image'){
    previewContent.innerHTML = `<div style="font-weight:700">${it.name}</div><img src="${it.content}" alt="${it.name}">`;
  } else if(it.mime==='audio'){
    previewContent.innerHTML = `<div style="font-weight:700">${it.name}</div><audio controls src="${it.content}"></audio>`;
  } else { // text
    const txt = it.content || '';
    previewContent.innerHTML = `<div style="font-weight:700">${it.name}</div><pre style="white-space:pre-wrap;margin-top:8px;color:#bfffee">${txt}</pre>`;
  }
}

/* ---------- Crear / Eliminar / Renombrar ---------- */
document.getElementById('newFile').addEventListener('click', ()=>{
  const name = prompt('Nombre del nuevo archivo (ej: nota.txt)');
  if(!name) return;
  const folder = currentFolder();
  folder.children.push({name, type:'file', mime:'text', content:'Archivo creado en PekeOS'});
  pushLog(`Archivo ${name} creado`);
  renderFS();
});
document.getElementById('newFolder').addEventListener('click', ()=>{
  const name = prompt('Nombre de la carpeta');
  if(!name) return;
  const folder = currentFolder();
  folder.children.push({name, type:'folder', children:[]});
  pushLog(`Carpeta ${name} creada`);
  renderFS();
});

/* ---------- NavegaciÃ³n ---------- */
pathBar.addEventListener('click', ()=>{
  if(lstack.length>1){ lstack.pop(); renderFS(); }
});
document.getElementById('toggleView').addEventListener('click', ()=>{
  viewMode = viewMode==='grid' ? 'list' : 'grid';
  gridArea.style.display = viewMode==='grid' ? 'grid' : 'none';
  listArea.style.display = viewMode==='list' ? 'block' : 'none';
});

/* ---------- Buscar ---------- */
document.getElementById('searchInput').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  const folder = currentFolder();
  const items = folder.children || [];
  if(!q){ renderFS(); return; }
  const filtered = items.filter(it => it.name.toLowerCase().includes(q));
  gridArea.innerHTML = filtered.map(it=>`<div class="item" data-name="${it.name}"><div class="icon">${it.type==='folder'?'ğŸ“': (it.mime==='image'?'ğŸ–¼ï¸':it.mime==='audio'?'ğŸµ':'ğŸ“„')}</div><div style="margin-top:6px;font-weight:700">${it.name}</div></div>`).join('');
  attachItemHandlers();
});

/* ---------- Favorites ---------- */
const favList = document.getElementById('favList');
function renderFavorites(){
  const favs = []; // recalc favorites: any item with name starting with '*'
  function walk(n,path){
    (n.children||[]).forEach(c=>{
      if(c.name.startsWith('*')) favs.push({name:c.name,path:path+'/'+c.name});
      if(c.type==='folder') walk(c, path+'/'+c.name);
    });
  }
  walk(FS,'');
  favList.innerHTML = favs.length? favs.map(f=>`<div class="small">${f.path}</div>`).join('') : '<div class="small">No hay favoritos</div>';
}

/* ---------- Import / Export FS ---------- */
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = JSON.stringify(FS,null,2);
  const blob = new Blob([data],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='pekeos-fs.json'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('loadBtn').addEventListener('click', ()=>{
  const txt = prompt('Pega JSON del FS para cargar (simulado)');
  try{
    if(!txt) return;
    FS = JSON.parse(txt);
    lstack.length=1; // root
    renderFS(); pushLog('FS cargado desde JSON');
  }catch(e){ alert('JSON invÃ¡lido'); }
});

/* ---------- Simular import (drag-n-drop) ---------- */
document.getElementById('gridArea').addEventListener('dragover',(e)=>{ e.preventDefault(); });
document.getElementById('gridArea').addEventListener('drop',(e)=>{
  e.preventDefault();
  const name = e.dataTransfer.getData('text/name') || ('import_'+Date.now()+'.txt');
  const folder = currentFolder();
  folder.children.push({name, type:'file', mime:'text', content:'Contenido importado (simulado)'});
  pushLog(`Elemento "${name}" importado a ${pathBar.textContent}`);
  renderFS();
});

/* ---------- small log function ---------- */
const logStore = [];
function pushLog(s){ logStore.unshift(`[${new Date().toLocaleTimeString()}] ${s}`); if(logStore.length>80) logStore.pop(); }

/* ---------- Save FS (localStorage) ---------- */
document.getElementById('saveFS').addEventListener('click', ()=>{
  localStorage.setItem('pekeos_fs_v3', JSON.stringify(FS));
  pushLog('FS guardado en localStorage');
  alert('FS guardado');
});
document.getElementById('importBtn').addEventListener('click', ()=>{
  // simular importar imagen y crear un fichero image con data uri (placeholder)
  const folder = currentFolder();
  folder.children.push({name:'imported.txt', type:'file', mime:'text', content:'Archivo importado desde simulaciÃ³n.'});
  pushLog('Import simulado completado');
  renderFS();
});

/* ---------- Init: try load saved FS ---------- */
(function init(){
  const saved = localStorage.getItem('pekeos_fs_v3');
  if(saved){
    try{ FS = JSON.parse(saved); pushLog('FS recuperado de localStorage'); }catch(e){}
  }
  renderFS();
})();
</script>
</body>
</html>
