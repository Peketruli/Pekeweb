
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ajustes</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: white;
        margin: 0;
        padding: 20px;
    }

    h1 {
        margin-top: 0;
    }

    .section {
        margin-bottom: 25px;
        padding: 15px;
        background: #222;
        border: 1px solid #333;
        border-radius: 8px;
    }

    .preview-box {
        width: 100%;
        height: 150px;
        background-size: cover;
        background-position: center;
        border: 2px solid #555;
        border-radius: 8px;
        margin-top: 10px;
    }

    .btn {
        padding: 10px 15px;
        margin-right: 5px;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        font-weight: bold;
    }

    .apply {
        background: #00ffaa;
    }

    .reset {
        background: #ff4444;
        color: white;
    }

</style>
</head>
<body>

<h1>‚öôÔ∏è Ajustes de PekeOS</h1>

<div class="section">
    <h2>üé® Color principal</h2>
    <input type="color" id="accentColor">
</div>

<div class="section">
    <h2>ü™ü Opacidad de ventanas</h2>
    <input type="range" id="winOpacity" min="0.3" max="1" step="0.01">
    <span id="opVal"></span>
</div>

<div class="section">
    <h2>üñº Fondo de Pantalla</h2>

    <label>URL de imagen:</label>
    <input type="text" id="bgUrl" placeholder="https://ejemplo.com/fondo.jpg" style="width: 100%;">

    <br><br>

    <label>Subir imagen:</label>
    <input type="file" id="bgFile" accept="image/*">

    <div class="preview-box" id="preview"></div>
</div>

<div class="section">
    <button class="btn apply" id="applyBtn">Aplicar cambios</button>
    <button class="btn reset" id="resetBtn">Restaurar por defecto</button>
</div>

<script>
/* ------------------------------------------
   SISTEMA DE AJUSTES PEKEOS
------------------------------------------- */

// KEY en localStorage
const SETTINGS_KEY = "pekeos_settings";

// Elementos
const accentColor = document.getElementById("accentColor");
const winOpacity = document.getElementById("winOpacity");
const opVal = document.getElementById("opVal");
const bgUrl = document.getElementById("bgUrl");
const bgFile = document.getElementById("bgFile");
const preview = document.getElementById("preview");

const applyBtn = document.getElementById("applyBtn");
const resetBtn = document.getElementById("resetBtn");

// Valores por defecto
function defaultSettings(){
    return {
        accent: "#00ffd0",
        opacity: 1,
        wallpaper: null
    };
}

// Cargar ajustes existentes
let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "null");

if(!settings){
    settings = defaultSettings();
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
}

// Aplicar ajustes a los controles
accentColor.value = settings.accent;
winOpacity.value = settings.opacity;
opVal.textContent = winOpacity.value;
bgUrl.value = settings.wallpaper ? settings.wallpaper : "";

// Vista previa
if(settings.wallpaper){
    preview.style.backgroundImage = `url(${settings.wallpaper})`;
} else {
    preview.style.background = "#333";
}

// Actualizar preview desde URL
bgUrl.addEventListener("input", () => {
    preview.style.backgroundImage = `url(${bgUrl.value})`;
});

// Actualizar preview desde archivo
bgFile.addEventListener("change", () => {
    const file = bgFile.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e => {
            preview.style.backgroundImage = `url(${e.target.result})`;
            bgUrl.value = "";
        };
        reader.readAsDataURL(file);
    }
});

// Mostrar valor opacidad
winOpacity.addEventListener("input", ()=>{
    opVal.textContent = winOpacity.value;
});

// BOT√ìN APLICAR
applyBtn.addEventListener("click", ()=>{

    // Actualizar color y opacidad
    settings.accent = accentColor.value;
    settings.opacity = winOpacity.value;

    // Fondo desde URL
    if(bgUrl.value.trim() !== ""){
        settings.wallpaper = bgUrl.value.trim();
    }

    // Fondo desde archivo
    if(bgFile.files.length > 0){
        const reader = new FileReader();
        reader.onload = e=>{
            settings.wallpaper = e.target.result;
            saveAndApply();
        };
        reader.readAsDataURL(bgFile.files[0]);
        return;
    }

    saveAndApply();
});

// Guardar y aplicar
function saveAndApply(){
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));

    // Se√±al de actualizaci√≥n
    localStorage.setItem("pekeos_update", Date.now());

    // Aplicar en la PekeOS real
    try {
        if (parent.aplicarAjustes) parent.aplicarAjustes();
    } catch(e){}

    alert("Cambios aplicados correctamente ‚úî");
}

// BOT√ìN RESTAURAR
resetBtn.addEventListener("click", ()=>{

    settings = defaultSettings();

    // Reset de inputs
    accentColor.value = settings.accent;
    winOpacity.value = settings.opacity;
    opVal.textContent = settings.opacity;

    bgUrl.value = "";
    bgFile.value = "";
    preview.style.background = "#333";
    preview.style.backgroundImage = "";

    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
    localStorage.setItem("pekeos_update", Date.now());

    try {
        if(parent.aplicarAjustes) parent.aplicarAjustes();
    } catch (e){}

    alert("Ajustes restaurados ‚úî");
});

</script>

</body>
</html>
