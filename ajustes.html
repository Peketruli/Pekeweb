<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ajustes - PekeOS</title>

<script type="text/javascript">
    // Si esta p√°gina se abre sola (no dentro de PekeOS), te manda al escritorio
    if (window.self === window.top) {
        window.location.replace("PekeOS.html");
    }
</script>
<style>
    :root {
        --neon: #00ffd0;
        --muted: #9ef7ea;
        --bg-dark: #02040a;
        --panel-bg: rgba(255, 255, 255, 0.03);
        --border: rgba(0, 255, 208, 0.1);
    }

    body {
        font-family: 'Inter', system-ui, sans-serif;
        background: linear-gradient(180deg, #03040a, #07131a);
        color: var(--muted);
        margin: 0;
        padding: 20px;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* Header */
    .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 15px;
    }
    
    .title {
        font-size: 24px;
        font-weight: 800;
        color: #fff;
        text-shadow: 0 0 10px rgba(0, 255, 208, 0.3);
    }

    /* Contenedor con scroll */
    .scroll-container {
        flex: 1;
        overflow-y: auto;
        padding-right: 5px;
    }

    /* Secciones */
    .section {
        background: var(--panel-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        transition: 0.2s;
    }

    .section:hover {
        border-color: var(--neon);
        box-shadow: 0 0 15px rgba(0, 255, 208, 0.05);
    }

    h2 {
        margin-top: 0;
        font-size: 16px;
        color: #fff;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Controles */
    label {
        display: block;
        margin-bottom: 8px;
        font-size: 13px;
        color: var(--neon);
    }

    input[type="text"] {
        width: 100%;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 6px;
        color: white;
        margin-bottom: 10px;
        outline: none;
    }
    input[type="text"]:focus {
        border-color: var(--neon);
    }

    /* Slider personalizado */
    input[type="range"] {
        width: 100%;
        accent-color: var(--neon);
        cursor: pointer;
    }

    /* Color picker personalizado */
    .color-wrapper {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    input[type="color"] {
        -webkit-appearance: none;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        background: none;
        padding: 0; 
        overflow: hidden;
    }
    input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
    input[type="color"]::-webkit-color-swatch { border: 2px solid var(--neon); border-radius: 50%; }

    /* Preview Box */
    .preview-box {
        width: 100%;
        height: 180px;
        background-color: #000;
        background-size: cover;
        background-position: center;
        border: 2px dashed var(--border);
        border-radius: 8px;
        margin-top: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    
    /* Overlay simulando ventana en preview */
    .preview-window {
        width: 60%;
        height: 60%;
        background: rgba(0,0,0,0.8);
        border: 1px solid var(--neon);
        border-radius: 6px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--neon);
    }

    /* Botones */
    .actions {
        display: flex;
        gap: 10px;
        padding-top: 10px;
        border-top: 1px solid var(--border);
    }

    .btn {
        padding: 10px 20px;
        border: 1px solid var(--border);
        background: rgba(0, 255, 208, 0.05);
        color: #fff;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: 0.2s;
        flex: 1;
    }

    .btn:hover {
        background: var(--neon);
        color: #000;
        box-shadow: 0 0 15px var(--neon);
    }

    .btn.reset {
        border-color: #ff4444;
        color: #ffaaaa;
        background: rgba(255, 68, 68, 0.05);
    }
    .btn.reset:hover {
        background: #ff4444;
        color: white;
        box-shadow: 0 0 15px #ff4444;
    }

    .btn-header {
        padding: 8px 12px;
        background: transparent;
        border: 1px solid var(--border);
        color: var(--muted);
        border-radius: 6px;
        cursor: pointer;
    }
    .btn-header:hover { background: rgba(255,255,255,0.1); }
</style>
</head>
<body>

    <div class="header">
        <div>
            <div class="title">‚öôÔ∏è Ajustes</div>
            <div style="font-size:12px; opacity:0.7">Personaliza tu PekeOS</div>
        </div>
        <button class="btn-header" onclick="window.location.href='PekeOS.html'">üíª Escritorio</button>
    </div>

    <div class="scroll-container">
        <div class="section">
            <h2>üé® Acento de Color</h2>
            <div class="color-wrapper">
                <input type="color" id="accentColor">
                <div>
                    <div style="font-size:14px; font-weight:bold">Color Ne√≥n</div>
                    <div style="font-size:12px; opacity:0.6">Define el color de los bordes y botones.</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ü™ü Transparencia</h2>
            <label>Opacidad de las ventanas: <span id="opVal" style="color:#fff; font-weight:bold">1.0</span></label>
            <input type="range" id="winOpacity" min="0.3" max="1" step="0.01">
        </div>

        <div class="section">
            <h2>üñº Fondo de Pantalla</h2>
            
            <label>Opci√≥n 1: Enlace directo (URL)</label>
            <input type="text" id="bgUrl" placeholder="https://...">

            <label>Opci√≥n 2: Subir archivo</label>
            <input type="file" id="bgFile" accept="image/*" style="margin-bottom:10px; color:white">

            <div class="preview-box" id="preview">
                <div class="preview-window" id="previewWindow">
                    Vista Previa
                </div>
            </div>
        </div>
    </div>

    <div class="actions">
        <button class="btn" id="applyBtn">üíæ Guardar y Aplicar</button>
        <button class="btn reset" id="resetBtn">‚ôª Restaurar</button>
    </div>

<script>
/* ------------------------------------------
   SISTEMA DE AJUSTES PEKEOS
------------------------------------------- */

// KEY en localStorage
const SETTINGS_KEY = "pekeos_settings";

// Elementos DOM
const accentColor = document.getElementById("accentColor");
const winOpacity = document.getElementById("winOpacity");
const opVal = document.getElementById("opVal");
const bgUrl = document.getElementById("bgUrl");
const bgFile = document.getElementById("bgFile");
const preview = document.getElementById("preview");
const previewWindow = document.getElementById("previewWindow");

const applyBtn = document.getElementById("applyBtn");
const resetBtn = document.getElementById("resetBtn");

// 1. Valores por defecto
function defaultSettings(){
    return {
        accent: "#00ffd0",
        opacity: 1,
        wallpaper: null
    };
}

// 2. Cargar ajustes
let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "null");

if(!settings){
    settings = defaultSettings();
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
}

// 3. Renderizar valores en inputs
function renderUI(){
    accentColor.value = settings.accent || "#00ffd0";
    winOpacity.value = settings.opacity || 1;
    opVal.textContent = winOpacity.value;
    bgUrl.value = (settings.wallpaper && settings.wallpaper.startsWith('http')) ? settings.wallpaper : "";
    
    updatePreview(settings.wallpaper, settings.accent, settings.opacity);
}

// 4. Actualizar la caja de preview (sin guardar a√∫n)
function updatePreview(bg, color, opacity){
    // Fondo
    if(bg){
        preview.style.backgroundImage = `url(${bg})`;
        preview.style.backgroundColor = "transparent";
    } else {
        preview.style.backgroundImage = "none";
        preview.style.backgroundColor = "#111";
    }

    // Color de acento en la "mini ventana"
    document.documentElement.style.setProperty('--neon', color);
    
    // Opacidad en la "mini ventana" (solo el fondo, no el borde/texto para legibilidad)
    previewWindow.style.backgroundColor = `rgba(0,0,0, ${opacity * 0.9})`;
    previewWindow.style.borderColor = color;
    previewWindow.style.color = color;
}

// Inicializar
renderUI();

/* ----- LISTENERS "EN VIVO" (Solo visual) ----- */

accentColor.addEventListener("input", () => {
    updatePreview(
        preview.style.backgroundImage.slice(5,-2), // Hack para sacar la url actual del estilo
        accentColor.value, 
        winOpacity.value
    );
});

winOpacity.addEventListener("input", () => {
    opVal.textContent = winOpacity.value;
    updatePreview(
        preview.style.backgroundImage.slice(5,-2), 
        accentColor.value, 
        winOpacity.value
    );
});

bgUrl.addEventListener("input", () => {
    const url = bgUrl.value.trim();
    if(url) {
        preview.style.backgroundImage = `url(${url})`;
    }
});

bgFile.addEventListener("change", () => {
    const file = bgFile.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e => {
            preview.style.backgroundImage = `url(${e.target.result})`;
            // Limpiamos URL text para evitar confusi√≥n
            bgUrl.value = "";
        };
        reader.readAsDataURL(file);
    }
});

/* ----- GUARDAR Y APLICAR ----- */

applyBtn.addEventListener("click", () => {
    // 1. Recoger valores actuales
    settings.accent = accentColor.value;
    settings.opacity = winOpacity.value;

    // 2. Determinar wallpaper (Fichero > URL > Actual)
    // Si el usuario subi√≥ un fichero en este momento (est√° en el preview pero no en settings)
    const currentPreviewBg = preview.style.backgroundImage;
    
    // Extraemos la URL limpia del estilo css `url("...")`
    if(currentPreviewBg && currentPreviewBg !== "none"){
        // remove 'url("' and '")'
        let cleanUrl = currentPreviewBg.slice(4, -1).replace(/"/g, "");
        settings.wallpaper = cleanUrl;
    }

    saveAndApply();
});

function saveAndApply(){
    try {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
        
        // Notificar al sistema
        // M√©todo 1: Evento Storage (para otras pesta√±as)
        localStorage.setItem("pekeos_update", Date.now());

        // M√©todo 2: Llamada directa al padre si est√° en iframe
        if (window.parent && window.parent.aplicarAjustes) {
            window.parent.aplicarAjustes();
        }

        alert("‚úÖ Ajustes aplicados correctamente");
    } catch (e) {
        if(e.name === 'QuotaExceededError'){
            alert("‚ö†Ô∏è Error: La imagen es demasiado grande para guardarse. Intenta usar una URL en su lugar.");
        } else {
            console.error(e);
        }
    }
}

/* ----- RESTAURAR ----- */

resetBtn.addEventListener("click", () => {
    if(!confirm("¬øVolver a los valores de f√°brica?")) return;
    
    settings = defaultSettings();
    renderUI();
    saveAndApply();
});

</script>

</body>
</html>
