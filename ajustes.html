<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subir Imagen con Supabase</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 30px;
}
.container {
  background: white;
  max-width: 500px;
  margin: 0 auto;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
input[type="file"], input[type="text"], textarea {
  width: 100%;
  margin-top: 10px;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 5px;
  box-sizing: border-box;
}
button {
  margin-top: 15px;
  padding: 10px 15px;
  background: #0077ff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
button:hover { background: #0055aa; }
img {
  display: block;
  max-width: 200px;
  margin: 15px auto;
  border-radius: 10px;
}
</style>
</head>
<body>

<div class="container">
  <h2>üñº Subir Imagen y Guardar en Supabase</h2>
  <form id="uploadForm">
    <label>Nombre</label>
    <input type="text" id="title" placeholder="T√≠tulo o nombre" required>

    <label>Descripci√≥n</label>
    <textarea id="description" rows="3" placeholder="Escribe algo..."></textarea>

    <label>Seleccionar Imagen</label>
    <input type="file" id="foto" accept="image/*" required>

    <button type="submit">Subir Imagen</button>
  </form>

  <h3 id="status"></h3>
  <img id="preview" style="display:none;">
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

// üß© Configuraci√≥n Supabase (la misma que usas en Pol√≠tica)
const SUPABASE_URL = 'https://jdvwlfogkzrzovepzjqa.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI';
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

const form = document.getElementById("uploadForm");
const statusText = document.getElementById("status");
const preview = document.getElementById("preview");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  statusText.textContent = "‚è≥ Subiendo imagen...";
  
  const title = document.getElementById("title").value.trim();
  const description = document.getElementById("description").value.trim();
  const file = document.getElementById("foto").files[0];

  if(!file){ alert("Selecciona una imagen"); return; }

  // Crear un nombre √∫nico
  const fileExt = file.name.split('.').pop();
  const fileName = crypto.randomUUID() + '.' + fileExt;
  const filePath = `parties/logos/${fileName}`;

  // Subir a Supabase Storage
  const { error: uploadError } = await supabase.storage.from('logos').upload(filePath, file);
  if(uploadError){
    alert("‚ùå Error subiendo imagen: " + uploadError.message);
    statusText.textContent = "‚ùå Error subiendo imagen";
    return;
  }

  // Generar URL p√∫blica
  const { data: urlData } = supabase.storage.from("logos").getPublicUrl(filePath);
  const imageUrl = urlData.publicUrl;

  // Guardar en base de datos
  const { error: dbError } = await supabase
    .from('imagenes') // üëà crea esta tabla en tu DB
    .insert([{ title, description, image_path: filePath }]);

  if(dbError){
    alert("‚ùå Error guardando en DB: " + dbError.message);
    statusText.textContent = "‚ùå Error guardando en DB";
    return;
  }

  // Mostrar preview
  preview.src = imageUrl;
  preview.style.display = "block";
  statusText.textContent = "‚úÖ Imagen subida correctamente";
});
</script>
</body>
</html>
