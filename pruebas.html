<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PekeOS</title>
<style>
/* VARIABLES DIN√ÅMICAS (Ajustes aplica aqu√≠) */
:root {
    --accent: #00ffd0;
    --win-opacity: 0.95;
}

/* RESET */
* { margin:0; padding:0; box-sizing:border-box; user-select:none; }
html, body { width:100%; height:100%; overflow:hidden; font-family:Arial, sans-serif; background:black; }

/* ========== ANIMACI√ìN DE ARRANQUE (Opci√≥n B) ========== */
#boot {
    position:fixed; inset:0;
    background:#000;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    z-index:9999;
}

#bootLogo {
    width:32%;
    max-width:340px;
    opacity:0;
    transform:scale(0.8);
    filter: drop-shadow(0 0 20px var(--accent));
    animation: bootLogo 1.8s ease-out forwards;
}

@keyframes bootLogo {
    0% { opacity:0; transform:scale(0.7); }
    40% { opacity:1; transform:scale(1.25); }
    75% { transform:scale(0.95); }
    100% { transform:scale(1); }
}

#bootText {
    color:white; font-size:20px; margin-top:25px;
    opacity:0; animation: bootText 1s forwards 1.5s;
    filter: drop-shadow(0 0 8px var(--accent));
}

@keyframes bootText { to { opacity:1; } }

#bootBar {
    width:55%; max-width:420px; height:12px;
    border:2px solid var(--accent);
    border-radius:10px; margin-top:35px;
    opacity:0; animation: bootBarIn .6s forwards 2s;
    overflow:hidden;
}

@keyframes bootBarIn { to { opacity:1; } }

#bootFill {
    width:0; height:100%; background:var(--accent);
    box-shadow:0 0 15px var(--accent);
    animation: bootFill 2.2s forwards 2.3s;
}

@keyframes bootFill { to { width:100%; } }

/* ========== ESCRITORIO ========== */

#desktop {
    display:none;
    width:100%; height:100%;
    background:#111;
    background-size:cover;
    position:relative;
    padding:10px;
}

.icon {
    width:80px; text-align:center; cursor:pointer;
    position:absolute; transition:.2s;
}
.icon:hover { transform:scale(1.15); }

.icon .thumb {
    width:64px; height:64px;
    border-radius:10px;
    background:#000c;
    border:2px solid var(--accent);
    display:flex; justify-content:center; align-items:center;
    font-size:32px; color:var(--accent);
    text-shadow:0 0 8px var(--accent);
}

.icon span {
    margin-top:6px; display:block;
    font-size:13px; color:var(--accent);
}

/* TASKBAR */

.taskbar {
    position:fixed; bottom:0; left:0; right:0;
    height:42px;
    background:#222;
    border-top:3px solid var(--accent);
    display:flex; justify-content:space-between; align-items:center;
    padding:5px 15px;
    color:white; font-size:15px;
}

.start-btn img { width:32px; cursor:pointer; }

/* MENU INICIO */

#startMenu {
    position:fixed; bottom:45px; left:10px;
    width:230px;
    background:#111;
    border:2px solid var(--accent);
    padding:10px; border-radius:8px;
    display:none; flex-direction:column; gap:10px;
}

.start-item {
    background:#222;
    padding:8px; border-radius:6px;
    cursor:pointer; color:var(--accent);
    border:1px solid var(--accent);
    display:flex; align-items:center; gap:8px;
}
.start-item:hover { background:var(--accent); color:black; }

/* VENTANAS */

.win {
    position:absolute;
    width:520px; height:360px;
    background:#000000dd;
    border:2px solid var(--accent);
    border-radius:6px;
    box-shadow:0 0 20px #0008;
    display:flex; flex-direction:column;
    color:white;
    opacity:var(--win-opacity);
}

.titlebar {
    height:30px;
    background:#111;
    border-bottom:1px solid #444;
    display:flex; align-items:center;
    padding:0 8px;
}

.titlebar .title { flex:1; }

.controls { display:flex; gap:5px; }

.btn {
    width:22px; height:22px;
    background:#222;
    border-radius:4px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; font-size:13px;
}
.btn:hover { background:var(--accent); color:black; }

.content {
    flex:1; background:black; overflow:hidden;
}
.content iframe { width:100%; height:100%; border:0; }

</style>
</head>
<body>

<!-- ========== PANTALLA DE ARRANQUE ========== -->
<div id="boot">
    <img id="bootLogo" src="PekeOS.png">
    <div id="bootText">Iniciando PekeOS...</div>
    <div id="bootBar"><div id="bootFill"></div></div>
</div>

<!-- ========== ESCRITORIO ========== -->
<div id="desktop">

    <!-- ICONOS -->
    <div class="icon" data-app="golf.html" style="top:10px; left:10px">
        <div class="thumb">üéÆ</div><span>Zona Arcade</span>
    </div>

    <div class="icon" data-app="prueba.html" style="top:100px; left:10px">
        <div class="thumb">üé∞</div><span>Casino</span>
    </div>

    <div class="icon" data-app="periodico.html" style="top:10px; right:10px">
        <div class="thumb">üì∞</div><span>Noticias</span>
    </div>

    <div class="icon" data-app="ajustes.html" style="bottom:150px; right:10px">
        <div class="thumb">‚öôÔ∏è</div><span>Ajustes</span>
    </div>

</div>

<!-- ========== BARRA DE TAREAS ========== -->
<div class="taskbar">
    <div class="start-btn"><img src="PekeOSmini.png"></div>
    <div id="clock"></div>
</div>

<!-- ========== MENU INICIO ========== -->
<div id="startMenu">
    <div class="start-item" data-open="estado.html">üõ† Estado del sistema</div>
    <div class="start-item" data-open="archivos.html">üìÅ Archivos</div>
    <div class="start-item" data-open="ajustes.html">‚öôÔ∏è Ajustes</div>
</div>

<!-- PLANTILLA VENTANA -->
<template id="winTpl">
    <div class="win">
        <div class="titlebar">
            <div class="title">Ventana</div>
            <div class="controls">
                <div class="btn" data-action="min">_</div>
                <div class="btn" data-action="max">‚ñ¢</div>
                <div class="btn" data-action="close">X</div>
            </div>
        </div>
        <div class="content"></div>
    </div>
</template>

<script>
/* ========== ARRANQUE ========== */
window.addEventListener("load", ()=>{
    setTimeout(()=>{
        const b = document.getElementById("boot");
        b.style.transition="opacity 1s";
        b.style.opacity="0";

        setTimeout(()=> b.remove(), 1000);

        // Mostrar sistema
        document.getElementById("desktop").style.display="block";
    }, 4000);
});

/* ========== RELOJ ========== */
function updateClock(){
    const d = new Date();
    let h = d.getHours().toString().padStart(2,"0");
    let m = d.getMinutes().toString().padStart(2,"0");
    clock.textContent = `${h}:${m}`;
}
setInterval(updateClock, 1000);
updateClock();

/* ========== VENTANAS ========== */
const tpl = document.getElementById("winTpl");

function createWindow(title, src){
    const w = tpl.content.firstElementChild.cloneNode(true);
    w.querySelector(".title").textContent = title;

    const iframe = document.createElement("iframe");
    iframe.src = src;
    w.querySelector(".content").appendChild(iframe);

    w.style.left = (150 + Math.random()*150)+"px";
    w.style.top = (80 + Math.random()*120)+"px";

    document.body.appendChild(w);
    makeDrag(w);
    addControls(w);
}

function makeDrag(win){
    const bar = win.querySelector(".titlebar");
    let ox, oy, sx, sy, dragging=false;

    bar.onmousedown = e=>{
        dragging = true;
        ox = e.clientX; oy = e.clientY;
        sx = parseInt(win.style.left)||0;
        sy = parseInt(win.style.top)||0;

        document.onmousemove = move;
        document.onmouseup = stop;
    };

    function move(e){
        if(!dragging) return;
        win.style.left = sx + (e.clientX - ox) + "px";
        win.style.top  = sy + (e.clientY - oy) + "px";
    }

    function stop(){
        dragging=false;
        document.onmousemove=null;
        document.onmouseup=null;
    }
}

function addControls(win){
    win.querySelectorAll(".btn").forEach(btn=>{
        btn.onclick = ()=>{
            const a = btn.dataset.action;

            if(a==="close") win.remove();
            if(a==="min") win.style.display="none";

            if(a==="max"){
                if(win.dataset.maxed==="1"){
                    win.dataset.maxed="0";
                    win.style.width="520px";
                    win.style.height="360px";
                } else {
                    win.dataset.maxed="1";
                    win.style.width=window.innerWidth+"px";
                    win.style.height=(window.innerHeight-45)+"px";
                    win.style.left="0px";
                    win.style.top="0px";
                }
            }
        };
    });
}

/* ICONOS */
document.querySelectorAll(".icon").forEach(ic=>{
    ic.ondblclick = ()=>{
        createWindow(ic.querySelector("span").textContent, ic.dataset.app);
    };
});

/* MENU INICIO */
document.querySelector(".start-btn").onclick = ()=>{
    const m = document.getElementById("startMenu");
    m.style.display = m.style.display==="flex" ? "none" : "flex";
};

document.querySelectorAll(".start-item").forEach(s=>{
    s.onclick = ()=>{
        createWindow(s.textContent.trim(), s.dataset.open);
        document.getElementById("startMenu").style.display="none";
    };
});

/* ========== APLICAR AJUSTES DESDE ajustes.html ========== */
function aplicarAjustes(){
    const data = JSON.parse(localStorage.getItem("pekeos_settings") || "{}");

    // Color principal
    if(data.accent){
        document.documentElement.style.setProperty("--accent", data.accent);
    }

    // Fondo
    const desk = document.getElementById("desktop");
    desk.style.backgroundImage = data.wallpaper ? `url(${data.wallpaper})` : "none";

    // Opacidad ventanas
    if(data.opacity){
        document.documentElement.style.setProperty("--win-opacity", data.opacity);
        document.querySelectorAll(".win").forEach(w=> w.style.opacity=data.opacity);
    }
}
aplicarAjustes();

/* Detectar actualizaciones */
window.addEventListener("storage", e=>{
    if(e.key==="pekeos_update"){
        aplicarAjustes();
    }
});
</script>

</body>
</html>
