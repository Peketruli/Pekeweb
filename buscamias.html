<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Buscaminas</title>
<style>
  :root{
    --bg:#0b1220;
    --panel:#0f1724;
    --accent:#f6c11b;
    --card:#0b2130;
    --win:#12742a;
    --lose:#8b0f0f;
    --cell-size:44px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#071021,#0b1230);
    color:#e6eef6;
    padding:16px;
  }

  .container{
    width:100%;
    max-width:920px;
    background:linear-gradient(180deg,var(--panel), #071226);
    border-radius:12px;
    padding:18px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }
  .title {
    display:flex;
    gap:14px;
    align-items:center;
  }
  .logo {
    width:48px;height:48px;border-radius:8px;
    background:linear-gradient(180deg,#f8d27a,#f6b83b);
    color:#10202a; font-weight:900;
    display:flex;align-items:center;justify-content:center;font-size:20px;
    box-shadow:0 3px 8px rgba(0,0,0,0.4);
  }
  h1{font-size:20px;margin:0}
  .controls {
    display:flex;
    gap:10px;
    align-items:center;
  }
  .controls select, .controls button {
    background:transparent;
    border:1px solid rgba(255,255,255,0.09);
    padding:8px 12px;
    color:inherit;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
  }
  .controls button:hover, .controls select:hover{border-color:rgba(255,255,255,0.16)}

  .status {
    display:flex;
    gap:12px;
    align-items:center;
  }
  .counter {
    display:flex;
    gap:8px;
    align-items:center;
    background:var(--card);
    padding:6px 10px;
    border-radius:8px;
    font-weight:700;
    min-width:86px;
    justify-content:center;
  }
  .counter .num { font-variant-numeric: tabular-nums; font-size:18px; color:var(--accent) }

  .board-wrap{
    display:flex;
    justify-content:center;
    gap:16px;
    padding:10px;
  }

  #board {
    display:grid;
    gap:6px;
    padding:8px;
    background: rgba(255,255,255,0.02);
    border-radius:10px;
  }

  .cell{
    width:var(--cell-size);
    height:var(--cell-size);
    background:linear-gradient(180deg,#123544,#0b2b39);
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:18px;
    color:#dff3ff;
    user-select:none;
    box-shadow: 0 2px 0 rgba(0,0,0,0.6) inset;
    position:relative;
    transition: transform 0.06s ease, background 0.12s ease;
  }

  .cell.revealed{
    background: linear-gradient(180deg,#e8f6ff,#cfeefc);
    color:#07202a;
    box-shadow:none;
    cursor:default;
  }

  .cell.flagged::after{
    content:'üö©';
    position:absolute;
    top:2px; left:6px; font-size:16px;
  }

  .cell.mine::after{
    content:'üí£';
    font-size:18px;
  }

  /* numbers color */
  .n1 { color:#0b57c7; }
  .n2 { color:#127a2e; }
  .n3 { color:#b92b2b; }
  .n4 { color:#2b2bb9; }
  .n5 { color:#7b2b14; }
  .n6 { color:#0a6e6a; }
  .n7 { color:#222; }
  .n8 { color:#666; }

  /* small screens */
  @media (max-width:640px){
    :root{--cell-size:36px}
    .logo{width:40px;height:40px}
    h1{font-size:16px}
  }

  footer{
    text-align:center;
    font-size:13px;
    color:rgba(255,255,255,0.55);
    margin-top:6px;
  }
</style>
</head>
<body>
  <div class="container" role="application" aria-label="Buscaminas">
    <header>
      <div class="title">
        <div class="logo">BM</div>
          <button onclick="window.location.href='golf.html'">‚Üê Volver</button>
        <div>
          <h1>Buscaminas</h1>
          <div style="font-size:13px;color:rgba(255,255,255,0.6)">Primera jugada siempre segura ‚Ä¢ Marca con banderas</div>
        </div>
      </div>

      <div class="controls">
        <label for="difficulty">Dificultad</label>
        <select id="difficulty" aria-label="Seleccionar dificultad">
          <option value="beginner">Principiante (9√ó9 ¬∑ 10 minas)</option>
          <option value="intermediate" selected>Intermedio (16√ó16 ¬∑ 40 minas)</option>
          <option value="expert">Experto (16√ó30 ¬∑ 99 minas)</option>
          <option value="custom">Personalizado</option>
        </select>

        <div id="custom-controls" style="display:none; gap:8px;">
          <input id="custom-rows" type="number" min="5" max="40" value="16" style="width:64px;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:inherit">
          <input id="custom-cols" type="number" min="5" max="60" value="16" style="width:64px;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:inherit">
          <input id="custom-mines" type="number" min="1" value="40" style="width:80px;padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.08);color:inherit">
        </div>

        <button id="restart">Reiniciar</button>
      </div>
    </header>

    <div class="status" style="justify-content:center;">
      <div class="counter" title="Minas restantes">‚õ≥ <span id="mines-left" class="num">0</span></div>
      <div class="counter" title="Tiempo">‚è± <span id="timer" class="num">0</span></div>
    </div>

    <div class="board-wrap">
      <div id="board" role="grid" aria-label="Tablero de Buscaminas"></div>
    </div>

    <footer>Haz clic izquierdo para descubrir, clic derecho para marcar bandera (mant√©n pulsado en m√≥vil).</footer>
  </div>

<script>
/* ----- Buscaminas completo ----- */

/* Estado del juego */
let rows = 16, cols = 16, minesCount = 40;
let board = []; // array de celdas {r,c,mine,adj,revealed,flagged}
let started = false, finished = false, timerInterval = null, seconds = 0;
let firstClickSafe = true;

/* Elementos DOM */
const boardEl = document.getElementById('board');
const minesLeftEl = document.getElementById('mines-left');
const timerEl = document.getElementById('timer');
const restartBtn = document.getElementById('restart');
const difficulty = document.getElementById('difficulty');
const customControls = document.getElementById('custom-controls');
const customRows = document.getElementById('custom-rows');
const customCols = document.getElementById('custom-cols');
const customMines = document.getElementById('custom-mines');

/* Dificultad selector */
difficulty.addEventListener('change', () => {
  const val = difficulty.value;
  if (val === 'beginner') { rows=9; cols=9; minesCount=10; customControls.style.display='none'; }
  else if (val === 'intermediate'){ rows=16; cols=16; minesCount=40; customControls.style.display='none'; }
  else if (val === 'expert'){ rows=16; cols=30; minesCount=99; customControls.style.display='none'; }
  else { customControls.style.display='flex'; rows=parseInt(customRows.value)||10; cols=parseInt(customCols.value)||10; minesCount=parseInt(customMines.value)||10; }
  resetGame();
});

customRows.addEventListener('input', () => { rows = clamp(parseInt(customRows.value)||5,5,40); customRows.value = rows; if (difficulty.value==='custom') resetGame(); });
customCols.addEventListener('input', () => { cols = clamp(parseInt(customCols.value)||5,5,60); customCols.value = cols; if (difficulty.value==='custom') resetGame(); });
customMines.addEventListener('input', () => { minesCount = clamp(parseInt(customMines.value)||1,1, rows*cols-1); customMines.value = minesCount; if (difficulty.value==='custom') resetGame(); });

restartBtn.addEventListener('click', resetGame);

/* Utilidades */
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function idx(r,c){ return r*cols + c; }

/* Inicializar tablero vac√≠o */
function initBoard(){
  board = new Array(rows*cols);
  for (let r=0;r<rows;r++){
    for (let c=0;c<cols;c++){
      board[idx(r,c)] = { r, c, mine:false, adj:0, revealed:false, flagged:false };
    }
  }
  started=false; finished=false; seconds=0;
  clearInterval(timerInterval); timerEl.textContent='0';
  minesLeftEl.textContent = minesCount;
}

/* Plantar minas (primera jugada segura) */
function plantMines(safeR,safeC){
  // generar lista de posiciones excepto la segura y sus vecinos
  const forbidden = new Set();
  for (let dr=-1;dr<=1;dr++){
    for (let dc=-1;dc<=1;dc++){
      const rr = safeR+dr, cc = safeC+dc;
      if (rr>=0 && rr<rows && cc>=0 && cc<cols) forbidden.add(idx(rr,cc));
    }
  }
  let places = [];
  for (let i=0;i<rows*cols;i++) if (!forbidden.has(i)) places.push(i);
  // shuffle and take minesCount
  for (let i=places.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [places[i],places[j]]=[places[j],places[i]]; }
  for (let m=0;m<Math.min(minesCount, places.length); m++){
    board[places[m]].mine = true;
  }
  // compute adjacencies
  for (let r=0;r<rows;r++){
    for (let c=0;c<cols;c++){
      const b = board[idx(r,c)];
      if (b.mine){ b.adj = -1; continue; }
      let count=0;
      for (let dr=-1;dr<=1;dr++) for (let dc=-1;dc<=1;dc++){
        if (dr===0 && dc===0) continue;
        const rr=r+dr, cc=c+dc;
        if (rr>=0 && rr<rows && cc>=0 && cc<cols && board[idx(rr,cc)].mine) count++;
      }
      b.adj = count;
    }
  }
}

/* Construir DOM grilla */
function renderBoard(){
  boardEl.innerHTML = '';
  boardEl.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
  for (let i=0;i<board.length;i++){
    const cell = board[i];
    const el = document.createElement('div');
    el.className = 'cell';
    el.dataset.index = i;
    el.setAttribute('role','button');
    el.setAttribute('aria-label', `Celda ${cell.r+1},${cell.c+1}`);
    // pointer events for left click and right click + mobile long press
    el.addEventListener('click', (e)=> onReveal(e, cell));
    el.addEventListener('contextmenu', (e)=> { e.preventDefault(); onToggleFlag(e, cell); });
    // mobile long press
    let pressTimer = null;
    el.addEventListener('pointerdown', (e)=>{
      if (finished) return;
      if (e.pointerType === 'touch'){
        pressTimer = setTimeout(() => { onToggleFlag(e, cell); }, 500);
      }
    });
    el.addEventListener('pointerup', ()=> { if (pressTimer) clearTimeout(pressTimer); });
    el.addEventListener('pointercancel', ()=> { if (pressTimer) clearTimeout(pressTimer); });

    boardEl.appendChild(el);
  }
  updateUI();
}

/* Actualizar UI de celdas */
function updateUI(){
  for (let i=0;i<board.length;i++){
    const b = board[i];
    const el = boardEl.children[i];
    el.className = 'cell';
    if (b.revealed) el.classList.add('revealed');
    if (b.flagged) el.classList.add('flagged');
    el.textContent = '';
    el.title = '';
    if (b.revealed){
      if (b.mine){
        el.classList.add('mine');
        el.textContent = 'üí£';
      } else if (b.adj > 0){
        el.textContent = b.adj;
        el.classList.add('n'+b.adj);
      } else {
        el.textContent = '';
      }
    } else {
      // show nothing; if flagged, pseudo-content via ::after in CSS
    }
  }
  minesLeftEl.textContent = Math.max(0, minesCount - board.filter(x=>x.flagged).length);
  timerEl.textContent = seconds.toString();
}

/* Revelar celda (clic izquierdo) */
function onReveal(e, cell){
  if (finished) return;
  const index = idx(cell.r, cell.c);
  const b = board[index];
  if (b.revealed || b.flagged) return;
  if (!started){
    // primera jugada: plantar minas asegurando esta celda y vecinos libres
    plantMines(cell.r, cell.c);
    started = true;
    startTimer();
  }
  revealCell(cell.r, cell.c);
  updateUI();
  checkWinLoss();
}

/* Revelado recursivo (flood fill) */
function revealCell(r,c){
  const i = idx(r,c);
  const b = board[i];
  if (b.revealed || b.flagged) return;
  b.revealed = true;
  if (b.mine){
    // perder
    finishGame(false);
    return;
  }
  if (b.adj === 0){
    for (let dr=-1;dr<=1;dr++) for (let dc=-1;dc<=1;dc++){
      const rr=r+dr, cc=c+dc;
      if (rr>=0 && rr<rows && cc>=0 && cc<cols){
        if (!board[idx(rr,cc)].revealed) revealCell(rr,cc);
      }
    }
  }
}

/* Alternar bandera (clic derecho o pulsaci√≥n larga) */
function onToggleFlag(e, cell){
  if (finished) return;
  const i = idx(cell.r, cell.c);
  const b = board[i];
  if (b.revealed) return;
  b.flagged = !b.flagged;
  updateUI();
}

/* Timer */
function startTimer(){
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{ seconds++; timerEl.textContent = seconds; }, 1000);
}

/* Finalizar juego */
function finishGame(win){
  finished = true;
  clearInterval(timerInterval);
  // revelar todo
  for (const c of board){
    if (win){
      if (c.mine) c.flagged = true;
    } else {
      if (c.mine) c.revealed = true;
    }
  }
  updateUI();
  setTimeout(()=> {
    if (win) alert('üéâ ¬°Has ganado!'); else alert('üí• ¬°Has explotado! Fin de partida.');
  }, 80);
}

/* Comprobar victoria o derrota */
function checkWinLoss(){
  // si alguna mina revele -> perdida
  if (board.some(x => x.revealed && x.mine)) { finishGame(false); return; }
  // si todas las no-minas est√°n reveladas -> victoria
  const allSafeRevealed = board.filter(x=>!x.mine).every(x=>x.revealed);
  if (allSafeRevealed) { finishGame(true); return; }
}

/* Reiniciar juego */
function resetGame(){
  initBoard();
  renderBoard();
  updateUI();
}

/* Inicial */
function init(){
  // set defaults (intermediate)
  rows = 16; cols = 16; minesCount = 40;
  customRows.value = rows; customCols.value = cols; customMines.value = minesCount;
  initBoard();
  renderBoard();
}

/* Utilities: allow keyboard accessibility: space/enter reveal focused cell; F flag */
boardEl.addEventListener('keydown', (e)=>{
  const active = document.activeElement;
  if (!active || !active.dataset) return;
  const i = parseInt(active.dataset.index);
  if (isNaN(i)) return;
  const cell = board[i];
  if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onReveal(e, cell); }
  if (e.key.toLowerCase() === 'f') { e.preventDefault(); onToggleFlag(e, cell); }
});

/* Start */
init();
</script>
</body>
</html>
