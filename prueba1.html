<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vampire Survival - Beta</title>
<style>
  body { margin:0; background:#111; color:white; overflow:hidden; font-family:Arial, sans-serif; }
  canvas { display:block; background:#222; width:100vw; height:100vh; }

  #hud {
    position:fixed; top:10px; left:50%; transform:translateX(-50%);
    display:flex; gap:20px; align-items:center;
    font-size:18px; z-index:10;
  }
  #healthBarContainer, #xpBarContainer {
    width:200px; height:20px; background:#333; border:2px solid white; border-radius:5px; overflow:hidden;
  }
  #healthBar, #xpBar {
    height:100%; transition:width 0.2s;
  }
  #healthBar { background:red; }
  #xpBar { background:lime; }

  #weaponSelect {
    position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
    background:#222; border:2px solid white; padding:20px; z-index:20;
    text-align:center; display:none;
  }
  #weaponSelect button {
    margin:10px; padding:10px 20px; cursor:pointer;
    font-size:18px; background:#333; color:white; border:2px solid white;
  }
  #weaponSelect button:hover { background:#555; }
</style>
</head>
<body>

<div id="hud">
  <div id="healthBarContainer"><div id="healthBar"></div></div>
  <div id="xpBarContainer"><div id="xpBar"></div></div>
  <div id="score">Puntuación: 0</div>
  <div id="level">Nivel: 1</div>
</div>

<div id="weaponSelect">
  <h2>Elige tu arma inicial</h2>
  <button id="pistolBtn">Pistola</button>
  <button id="whipBtn">Látigo</button>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gamePaused = true;
let enemies = [];
let bullets = [];
let xpParticles = [];
let score = 0;
let playerXP = 0;
let playerLevel = 1;
let xpToNextLevel = 15;

let player = {
  x: canvas.width/2, y: canvas.height/2, size:30, speed:5,
  color:'cyan', health:100, maxHealth:100, weapon:null,
  lastAttack:0
};

// -------- HUD ----------
function updateHUD(){
  document.getElementById("score").textContent = "Puntuación: " + score;
  document.getElementById("level").textContent = "Nivel: " + playerLevel;
  document.getElementById("healthBar").style.width = (player.health/player.maxHealth*100)+"%";
  document.getElementById("xpBar").style.width = (playerXP/xpToNextLevel*100)+"%";
}

// -------- ENEMIGOS ---------
function spawnEnemy(){
  if(gamePaused) return;
  const edge = Math.floor(Math.random()*4);
  let x,y;
  if(edge===0){x=0; y=Math.random()*canvas.height;}
  else if(edge===1){x=canvas.width; y=Math.random()*canvas.height;}
  else if(edge===2){x=Math.random()*canvas.width; y=0;}
  else{x=Math.random()*canvas.width; y=canvas.height;}
  const health = Math.random()<0.8 ? 20 : 50; // los resistentes aparecen menos
  enemies.push({x,y,size:30,speed:2,health:health});
}
setInterval(spawnEnemy, 2000);

// -------- ARMAS ----------
function shootPistol(){
  if(gamePaused || player.weapon!=="pistol") return;
  const target = enemies[0];
  if(!target) return;
  const angle = Math.atan2(target.y - player.y, target.x - player.x);
  bullets.push({
    x:player.x, y:player.y,
    dx:Math.cos(angle)*8, dy:Math.sin(angle)*8,
    size:6, damage:20
  });
}

function attackWhip(){
  if(gamePaused || player.weapon!=="whip") return;
  // tajo semicírculo delante del jugador
  enemies.forEach(e=>{
    const dist = Math.hypot(e.x-player.x, e.y-player.y);
    if(dist < 80){ e.health -= 25; }
  });
  ctx.beginPath();
  ctx.arc(player.x, player.y, 80, 0, Math.PI, false);
  ctx.strokeStyle = 'orange';
  ctx.lineWidth = 5;
  ctx.stroke();
}

// -------- CICLO PRINCIPAL ----------
const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

function update(){
  if(gamePaused) return;

  if(keys['w']) player.y -= player.speed;
  if(keys['s']) player.y += player.speed;
  if(keys['a']) player.x -= player.speed;
  if(keys['d']) player.x += player.speed;

  player.x = Math.max(player.size, Math.min(canvas.width-player.size, player.x));
  player.y = Math.max(player.size, Math.min(canvas.height-player.size, player.y));

  bullets.forEach((b,bi)=>{
    b.x += b.dx; b.y += b.dy;
    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) bullets.splice(bi,1);
  });

  enemies.forEach((e,ei)=>{
    const angle = Math.atan2(player.y - e.y, player.x - e.x);
    e.x += Math.cos(angle)*e.speed;
    e.y += Math.sin(angle)*e.speed;

    bullets.forEach((b,bi)=>{
      const dist = Math.hypot(b.x - e.x, b.y - e.y);
      if(dist < e.size/2 + b.size){
        e.health -= b.damage;
        bullets.splice(bi,1);
      }
    });

    if(e.health <= 0){
      enemies.splice(ei,1);
      score++;
      playerXP += 3;
      updateHUD();
    }

    const distPlayer = Math.hypot(player.x - e.x, player.y - e.y);
    if(distPlayer < player.size/2 + e.size/2){
      player.health -= 10;
      updateHUD();
      if(player.health <= 0){
        alert("Has muerto. Puntuación: " + score);
        window.location.reload();
      }
    }
  });

  if(playerXP >= xpToNextLevel){
    playerXP -= xpToNextLevel;
    playerLevel++;
    xpToNextLevel = Math.floor(xpToNextLevel*1.5);
    updateHUD();
  }

  // Ataques automáticos
  const now = performance.now();
  if(player.weapon === "pistol" && now - player.lastAttack > 800){
    shootPistol();
    player.lastAttack = now;
  }
  if(player.weapon === "whip" && now - player.lastAttack > 2000){
    attackWhip();
    player.lastAttack = now;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=player.color;
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size/2,0,Math.PI*2);
  ctx.fill();

  bullets.forEach(b=>{
    ctx.fillStyle='yellow';
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.size,0,Math.PI*2);
    ctx.fill();
  });

  enemies.forEach(e=>{
    ctx.fillStyle='red';
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.size/2,0,Math.PI*2);
    ctx.fill();
  });
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

// -------- Selección de arma --------
document.getElementById("weaponSelect").style.display = "block";
document.getElementById("pistolBtn").onclick = () => startGame("pistol");
document.getElementById("whipBtn").onclick = () => startGame("whip");

function startGame(weapon){
  player.weapon = weapon;
  player.x = canvas.width/2;
  player.y = canvas.height/2;
  document.getElementById("weaponSelect").style.display = "none";
  gamePaused = false;
  player.lastAttack = performance.now();
  updateHUD();
}
</script>
</body>
</html>
