<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Arcade - Vampire Survival</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: sans-serif;
    background: #111;
    color: white;
  }
  #gameCanvas {
    display: none;
    background: radial-gradient(circle at center, #222 0%, #000 100%);
  }
  #menu {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    background: #111;
  }
  button {
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    border: none;
    border-radius: 10px;
    background: #3a3a3a;
    color: white;
    transition: 0.3s;
  }
  button:hover {
    background: #5a5a5a;
  }
  #upgradeMenu {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 18px;
  }
  #healthBar {
    width: 200px;
    height: 20px;
    background: #333;
    border-radius: 5px;
    margin-bottom: 5px;
    overflow: hidden;
  }
  #healthFill {
    height: 100%;
    width: 100%;
    background: limegreen;
    transition: width 0.2s linear, background 0.3s;
  }
</style>
</head>
<body>
  <div id="menu">
    <h1>游빁 Vampire Survival</h1>
    <button id="playBtn">Jugar</button>
    <button onclick="alert('Diccionario pr칩ximamente')">Diccionario</button>
    <button onclick="window.location.href='golf.html'">Volver a Golf</button>
  </div>

  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="hud">
    <div id="healthBar"><div id="healthFill"></div></div>
    <div id="xpDisplay">XP: 0 / 15</div>
    <div id="levelDisplay">Nivel: 1</div>
    <div id="scoreDisplay">Puntos: 0</div>
  </div>

  <div id="upgradeMenu"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const menu = document.getElementById('menu');
const upgradeMenu = document.getElementById('upgradeMenu');
const xpDisplay = document.getElementById('xpDisplay');
const levelDisplay = document.getElementById('levelDisplay');
const scoreDisplay = document.getElementById('scoreDisplay');
const healthFill = document.getElementById('healthFill');

let keys = {};
let player = { x: 400, y: 300, size: 20, speed: 3, hp: 5, maxHp: 5, xp: 0, level: 1, damage: 1 };
let bullets = [];
let enemies = [];
let orbs = [];
let score = 0;
let lastShot = 0;
let lastSlash = 0;
let difficultyTimer = 0;
let gamePaused = false;
let abilities = [];
let difficultyInterval = 45000;
let xpToNext = 15;
let meleeUnlocked = false;
let regenUnlocked = false;
let regenTimer = 0;

document.getElementById('playBtn').onclick = () => {
  menu.style.display = 'none';
  canvas.style.display = 'block';
  startGame();
};

function startGame() {
  window.requestAnimationFrame(update);
  spawnEnemy();
  setInterval(spawnEnemy, 2000);
}

function update(timestamp) {
  if (gamePaused) return requestAnimationFrame(update);

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Movimiento
  if (keys['w']) player.y -= player.speed;
  if (keys['s']) player.y += player.speed;
  if (keys['a']) player.x -= player.speed;
  if (keys['d']) player.x += player.speed;
  player.x = Math.max(0, Math.min(canvas.width, player.x));
  player.y = Math.max(0, Math.min(canvas.height, player.y));

  // Dibuja jugador
  ctx.fillStyle = 'cyan';
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
  ctx.fill();

  // Regeneraci칩n
  if (regenUnlocked) {
    regenTimer += 1/60;
    if (regenTimer > 1) {
      regenTimer = 0;
      if (player.hp < player.maxHp) player.hp = Math.min(player.maxHp, player.hp + 0.1);
    }
  }

  // Disparo autom치tico
  if (timestamp - lastShot > 2500) {
    shootNearestEnemy();
    lastShot = timestamp;
  }

  // Ataque melee autom치tico
  if (meleeUnlocked && timestamp - lastSlash > 2500) {
    meleeAttack();
    lastSlash = timestamp;
  }

  updateBullets();
  updateEnemies();
  updateOrbs();
  drawHUD();

  difficultyTimer += 16;
  if (difficultyTimer > difficultyInterval) {
    difficultyTimer = 0;
    difficultyInterval *= 0.98;
    enemies.forEach(e => e.hp += 0.5);
  }

  requestAnimationFrame(update);
}

function drawHUD() {
  const hpPct = (player.hp / player.maxHp) * 100;
  healthFill.style.width = hpPct + '%';
  healthFill.style.background = hpPct < 30 ? 'red' : hpPct < 60 ? 'orange' : 'limegreen';
  xpDisplay.textContent = `XP: ${Math.floor(player.xp)} / ${xpToNext}`;
  levelDisplay.textContent = `Nivel: ${player.level}`;
  scoreDisplay.textContent = `Puntos: ${score}`;
}

function shootNearestEnemy() {
  if (enemies.length === 0) return;
  const target = enemies.reduce((a, b) => 
    distance(a, player) < distance(b, player) ? a : b
  );
  const angle = Math.atan2(target.y - player.y, target.x - player.x);
  bullets.push({
    x: player.x, y: player.y, dx: Math.cos(angle) * 5, dy: Math.sin(angle) * 5
  });
}

function meleeAttack() {
  const range = 40;
  ctx.strokeStyle = 'yellow';
  ctx.beginPath();
  ctx.arc(player.x, player.y, range, 0, Math.PI * 2);
  ctx.stroke();
  enemies.forEach((e) => {
    if (distance(player, e) < range) e.hp -= player.damage + 1;
  });
}

function updateBullets() {
  ctx.fillStyle = 'white';
  bullets.forEach((b, i) => {
    b.x += b.dx;
    b.y += b.dy;
    ctx.fillRect(b.x, b.y, 4, 4);
    enemies.forEach((e, j) => {
      if (distance(b, e) < 15) {
        e.hp -= player.damage;
        bullets.splice(i, 1);
      }
    });
  });
}

function spawnEnemy() {
  const x = Math.random() < 0.5 ? 0 : canvas.width;
  const y = Math.random() * canvas.height;
  enemies.push({ x, y, size: 15, hp: 3, speed: 1.2 });
}

function updateEnemies() {
  enemies.forEach((e, i) => {
    const ang = Math.atan2(player.y - e.y, player.x - e.x);
    e.x += Math.cos(ang) * e.speed;
    e.y += Math.sin(ang) * e.speed;
    ctx.fillStyle = 'red';
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
    ctx.fill();

    if (distance(player, e) < e.size + player.size) {
      player.hp -= 0.02;
      if (player.hp <= 0) location.reload();
    }

    if (e.hp <= 0) {
      enemies.splice(i, 1);
      score++;
      orbs.push({ x: e.x, y: e.y, value: Math.floor(Math.random() * 5) + 1 });
    }
  });
}

function updateOrbs() {
  ctx.fillStyle = 'lime';
  orbs.forEach((o, i) => {
    ctx.beginPath();
    ctx.arc(o.x, o.y, 5, 0, Math.PI * 2);
    ctx.fill();
    if (distance(player, o) < 20) {
      player.xp += o.value;
      orbs.splice(i, 1);
      if (player.xp >= xpToNext) levelUp();
    }
  });
}

function levelUp() {
  player.level++;
  player.xp = 0;
  xpToNext *= 1.2;
  gamePaused = true;
  showUpgradeMenu();
}

function showUpgradeMenu() {
  upgradeMenu.style.display = 'flex';
  upgradeMenu.innerHTML = `<h2>Subes de Nivel</h2>`;
  const allUpgrades = [
    { name: 'Bala doble', action: () => player.damage++ },
    { name: 'Disparo r치pido', action: () => (lastShot -= 500) },
    { name: 'M치s velocidad', action: () => (player.speed += 0.5) },
    { name: 'M치s vida', action: () => (player.maxHp += 1, player.hp = player.maxHp) },
    { name: 'Espadazo', action: () => (meleeUnlocked = true) },
    { name: 'Espada fuerte', action: () => (player.damage += 1) },
    { name: 'Espada amplia', action: () => (player.size += 2) },
    { name: 'Regeneraci칩n', action: () => (regenUnlocked = true) },
  ];
  const choices = [];
  while (choices.length < 3) {
    const r = allUpgrades[Math.floor(Math.random() * allUpgrades.length)];
    if (!choices.includes(r)) choices.push(r);
  }
  choices.forEach((up) => {
    const btn = document.createElement('button');
    btn.textContent = up.name;
    btn.onclick = () => {
      up.action();
      upgradeMenu.style.display = 'none';
      gamePaused = false;
    };
    upgradeMenu.appendChild(btn);
  });
}

function distance(a, b) {
  return Math.hypot(a.x - b.x, a.y - b.y);
}

window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);
</script>
</body>
</html>
