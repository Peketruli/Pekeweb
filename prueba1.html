<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vampire Survival Arcade</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
  }

  #gameCanvas {
    display: block;
    background: radial-gradient(circle at center, #222 0%, #000 100%);
    width: 100vw;
    height: 100vh;
  }

  #hud {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    color: white;
    z-index: 10;
  }

  .bar {
    height: 10px;
    width: 200px;
    background: #444;
    border: 1px solid #222;
    margin: 5px auto;
    border-radius: 5px;
    overflow: hidden;
  }

  .bar-inner {
    height: 100%;
    background: limegreen;
    width: 100%;
  }

  #levelUpMenu, #weaponSelectMenu {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.9);
    padding: 20px;
    border: 2px solid #fff;
    border-radius: 10px;
    text-align: center;
    display: none;
    z-index: 20;
  }

  button {
    background: #222;
    color: #fff;
    border: 1px solid #555;
    padding: 10px 20px;
    margin: 5px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
  }

  button:hover {
    background: #555;
  }

  #deathMessage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: red;
    display: none;
    z-index: 15;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<div id="hud">
  <div>HP</div>
  <div class="bar"><div id="hpBar" class="bar-inner"></div></div>
  <div>XP</div>
  <div class="bar"><div id="xpBar" class="bar-inner" style="background: cyan; width: 0%;"></div></div>
  <div id="levelText">Nivel: 1</div>
</div>

<div id="weaponSelectMenu">
  <h2>Elige tu arma inicial</h2>
  <button onclick="selectWeapon('pistol')">ðŸ”« Pistola</button>
  <button onclick="selectWeapon('whip')">ðŸ§· LÃ¡tigo</button>
</div>

<div id="levelUpMenu">
  <h2>Â¡Has subido de nivel!</h2>
  <div id="upgradeOptions"></div>
</div>

<div id="deathMessage">ðŸ’€ Has muerto ðŸ’€<br><button onclick="restartGame()">Reintentar</button></div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player, enemies, bullets, xpParticles, level, xp, nextXP, isPaused, isDead, selectedWeapon;
let lastShot = 0;
let gameStart = false;

function initGame() {
  player = { x: canvas.width / 2, y: canvas.height / 2, size: 20, speed: 3, hp: 100, maxHp: 100 };
  enemies = [];
  bullets = [];
  xpParticles = [];
  level = 1;
  xp = 0;
  nextXP = 15;
  isPaused = false;
  isDead = false;
  selectedWeapon = null;
  document.getElementById("deathMessage").style.display = "none";
  document.getElementById("weaponSelectMenu").style.display = "block";
  updateBars();
}

function selectWeapon(weapon) {
  selectedWeapon = weapon;
  document.getElementById("weaponSelectMenu").style.display = "none";
  isPaused = false;
  gameStart = true;
}

function restartGame() {
  initGame();
}

function updateBars() {
  document.getElementById("hpBar").style.width = (player.hp / player.maxHp * 100) + "%";
  document.getElementById("xpBar").style.width = (xp / nextXP * 100) + "%";
  document.getElementById("levelText").textContent = "Nivel: " + level;
}

function spawnEnemy() {
  const side = Math.floor(Math.random() * 4);
  let x, y;
  if (side === 0) { x = 0; y = Math.random() * canvas.height; }
  else if (side === 1) { x = canvas.width; y = Math.random() * canvas.height; }
  else if (side === 2) { x = Math.random() * canvas.width; y = 0; }
  else { x = Math.random() * canvas.width; y = canvas.height; }
  enemies.push({ x, y, size: 15, speed: 1, hp: 10 });
}

function shoot() {
  const now = Date.now();
  if (now - lastShot < 1000) return;
  lastShot = now;
  if (selectedWeapon === "pistol") {
    bullets.push({ x: player.x, y: player.y, dx: 1, dy: 0, speed: 5 });
  }
}

function whipAttack() {
  enemies.forEach((e) => {
    if (Math.abs(e.x - player.x) < 100 && Math.abs(e.y - player.y) < 40) {
      e.hp -= 10;
    }
  });
}

function gainXP(amount) {
  xp += amount;
  if (xp >= nextXP) {
    xp -= nextXP;
    level++;
    nextXP = Math.floor(nextXP * 1.5);
    openLevelUpMenu();
  }
  updateBars();
}

function openLevelUpMenu() {
  isPaused = true;
  const menu = document.getElementById("levelUpMenu");
  const upgradesDiv = document.getElementById("upgradeOptions");
  upgradesDiv.innerHTML = "";
  for (let i = 0; i < 3; i++) {
    const btn = document.createElement("button");
    btn.textContent = "Mejora aleatoria #" + (i + 1);
    btn.onclick = () => { isPaused = false; menu.style.display = "none"; };
    upgradesDiv.appendChild(btn);
  }
  menu.style.display = "block";
}

function drawPlayer() {
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
  ctx.fillStyle = "white";
  ctx.fill();
}

function drawEnemies() {
  enemies.forEach((e) => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
    ctx.fillStyle = "red";
    ctx.fill();
  });
}

function updateGame() {
  if (!gameStart || isPaused || isDead) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (Math.random() < 0.02) spawnEnemy();

  enemies.forEach((e, i) => {
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist = Math.hypot(dx, dy);
    e.x += (dx / dist) * e.speed;
    e.y += (dy / dist) * e.speed;

    if (dist < e.size + player.size) {
      player.hp -= 0.5;
      if (player.hp <= 0 && !isDead) {
        isDead = true;
        document.getElementById("deathMessage").style.display = "block";
        gameStart = false;
      }
    }

    if (e.hp <= 0) {
      enemies.splice(i, 1);
      gainXP(Math.floor(Math.random() * 5) + 1);
    }
  });

  if (selectedWeapon === "pistol") shoot();
  if (selectedWeapon === "whip") whipAttack();

  bullets.forEach((b, i) => {
    b.x += b.dx * b.speed;
    b.y += b.dy * b.speed;
    enemies.forEach((e) => {
      const dist = Math.hypot(e.x - b.x, e.y - b.y);
      if (dist < e.size + 5) {
        e.hp -= 10;
        bullets.splice(i, 1);
      }
    });
  });

  drawPlayer();
  drawEnemies();
  bullets.forEach((b) => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
    ctx.fillStyle = "yellow";
    ctx.fill();
  });

  updateBars();
}

initGame();
setInterval(updateGame, 1000 / 60);
</script>
</body>
</html>
