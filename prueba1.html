<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vampire Survival â€” Corregido (VersiÃ³n estable)</title>
<style>
  :root{--hud-bg:rgba(0,0,0,0.45);--accent:#f39c12}
  html,body{height:100%;margin:0;background:#070707;color:#eee;font-family:Inter,Arial,sans-serif;overflow:hidden}
  canvas{display:block;background:linear-gradient(#111,#050505);width:100vw;height:100vh;position:absolute;top:0;left:0;z-index:1}
  #hud{position:fixed;top:10px;left:50%;transform:translateX(-50%);width:92vw;max-width:1100px;z-index:40;display:flex;gap:10px;align-items:center;}
  .box{background:var(--hud-bg);padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06)}
  .bars{flex:1;display:flex;flex-direction:column;gap:6px}
  .bar{height:18px;background:#222;border-radius:8px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.04)}
  .fill{height:100%;transition:width .18s linear}
  .hpFill{background:linear-gradient(90deg,#2ecc71,#27ae60)}
  .xpFill{background:linear-gradient(90deg,#f39c12,#e67e22)}
  #inv{display:flex;gap:8px;min-width:260px;flex-wrap:wrap}
  .slot{min-width:120px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px}
  .slot small{color:#bbb}
  .overlay{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#0f0f0f;padding:16px;border:2px solid #fff;border-radius:10px;z-index:60;display:none}
  .choices{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  button.choice{padding:10px;border-radius:8px;border:none;background:#222;color:#fff;cursor:pointer}
  button.choice:hover{background:#333}
  #mainMenu{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:80;background:linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6))}
  #menuBox{background:rgba(10,10,10,0.9);padding:22px;border-radius:12px;border:2px solid #fff;text-align:center}
  #menuBox button{margin:8px;padding:10px 16px;border-radius:8px;border:none;background:#222;color:#fff;cursor:pointer}
  #selector{display:flex;gap:12px;justify-content:center;margin-top:12px}
  .card{width:180px;padding:12px;border-radius:8px;background:#121212;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .card.selected{outline:3px solid rgba(243,156,18,0.16);box-shadow:0 4px 12px rgba(0,0,0,0.6)}
  #deathPanel{display:none;position:fixed;inset:0;align-items:center;justify-content:center;z-index:90}
  #deathInner{background:#120000;padding:18px;border-radius:10px;border:2px solid #c0392b;color:#fff;text-align:center}
  #debug{position:fixed;right:8px;bottom:8px;color:#999;font-size:12px;z-index:50}
</style>
</head>
<body>

<!-- MENÃš PRINCIPAL -->
<div id="mainMenu">
  <div id="menuBox">
    <h1>ðŸ§› Vampire Survival</h1>
    <div style="font-size:14px;margin-bottom:8px;color:#ccc">Elige tu arma inicial</div>
    <div id="selector">
      <div class="card selected" data-id="sword">
        <h3>Espada</h3>
        <small>Tajo corto, rÃ¡pido y visible</small>
      </div>
      <div class="card" data-id="whip">
        <h3>LÃ¡tigo</h3>
        <small>Golpe largo y de gran alcance</small>
      </div>
    </div>
    <div style="margin-top:12px">
      <button id="btnStart">Comenzar partida</button>
      <button id="btnDict">Diccionario</button>
      <button id="btnBack">Volver a Golf</button>
    </div>
  </div>
</div>

<canvas id="c"></canvas>

<div id="hud">
  <div class="box" style="min-width:200px">
    <div style="font-size:15px"><strong id="scoreText">Puntos: 0</strong></div>
    <div style="font-size:13px;color:#ccc">Nivel <span id="levelText">1</span></div>
  </div>
</div>

<div id="deathPanel">
  <div id="deathInner">
    <h2>Has muerto</h2>
    <div id="deathStats" style="margin-top:8px;color:#ddd"></div>
    <div style="margin-top:12px">
      <button id="btnRestart">Reiniciar</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

let player = {x:canvas.width/2,y:canvas.height/2,r:20,speed:4,hp:100,maxHp:100};
let enemies=[], projectiles=[], keys={}, dead=false, gamePaused=false, xp=0, level=1;
let initialChoice='sword';

const weaponsState={
  sword:{level:0,cooldown:600,last:0},
  whip:{level:0,cooldown:900,last:0}
};

// === INPUT ===
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;

// === FUNCIONES DE MOVIMIENTO Y DIBUJO ===
function movePlayer(){
  if(keys['w']||keys['ArrowUp'])player.y-=player.speed;
  if(keys['s']||keys['ArrowDown'])player.y+=player.speed;
  if(keys['a']||keys['ArrowLeft'])player.x-=player.speed;
  if(keys['d']||keys['ArrowRight'])player.x+=player.speed;
  player.x=Math.max(player.r,Math.min(canvas.width-player.r,player.x));
  player.y=Math.max(player.r,Math.min(canvas.height-player.r,player.y));
}

function spawnEnemy(){
  const s=Math.floor(Math.random()*4);
  let x,y;
  if(s===0){x=0;y=Math.random()*canvas.height}
  else if(s===1){x=canvas.width;y=Math.random()*canvas.height}
  else if(s===2){x=Math.random()*canvas.width;y=0}
  else {x=Math.random()*canvas.width;y=canvas.height}
  enemies.push({x,y,r:15,speed:1.5});
}

function drawPlayer(){
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.r,0,Math.PI*2);
  ctx.fillStyle='#3cf';
  ctx.fill();
}

function drawEnemies(){
  ctx.fillStyle='red';
  for(const e of enemies){
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fill();
  }
}

function updateEnemies(){
  for(const e of enemies){
    const dx=player.x-e.x, dy=player.y-e.y, d=Math.hypot(dx,dy);
    if(d>0){e.x+=(dx/d)*e.speed; e.y+=(dy/d)*e.speed;}
    if(d<player.r+e.r){player.hp-=0.2; if(player.hp<=0)dead=true;}
  }
}

// === ATAQUES ===
function attackMelee(){
  const now=Date.now();
  const w=weaponsState[initialChoice];
  if(!w||w.level<=0)return;
  if(now-w.last<w.cooldown)return;
  w.last=now;
  if(initialChoice==='sword'){
    projectiles.push({type:'slash',x:player.x,y:player.y,r:90,life:200,angle:Math.random()*Math.PI*2});
  }else if(initialChoice==='whip'){
    projectiles.push({type:'whip',x:player.x,y:player.y,r:160,life:200,angle:Math.random()*Math.PI*2});
  }
}

function drawProjectiles(){
  for(const p of projectiles){
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.angle);
    if(p.type==='slash'){
      ctx.beginPath();
      ctx.arc(0,0,p.r,0,Math.PI/2);
      ctx.strokeStyle='rgba(255,255,255,0.8)';
      ctx.lineWidth=8;
      ctx.stroke();
    }else if(p.type==='whip'){
      ctx.beginPath();
      ctx.arc(0,0,p.r,Math.PI/6,Math.PI/2);
      ctx.strokeStyle='rgba(255,200,100,0.9)';
      ctx.lineWidth=10;
      ctx.stroke();
    }
    ctx.restore();
  }
}

function updateProjectiles(){
  for(let i=projectiles.length-1;i>=0;i--){
    const p=projectiles[i];
    p.life-=16;
    if(p.life<=0){projectiles.splice(i,1);continue;}
    for(let j=enemies.length-1;j>=0;j--){
      const e=enemies[j];
      const dx=e.x-p.x,dy=e.y-p.y,dist=Math.hypot(dx,dy);
      if(dist<p.r+e.r){enemies.splice(j,1);}
    }
  }
}

function loop(){
  if(gamePaused||dead){
    if(dead){
      document.getElementById('deathPanel').style.display='flex';
    }
    requestAnimationFrame(loop);
    return;
  }
  ctx.clearRect(0,0,canvas.width,canvas.height);
  movePlayer();
  updateEnemies();
  updateProjectiles();
  drawPlayer();
  drawEnemies();
  drawProjectiles();
  attackMelee();
  if(Math.random()<0.02)spawnEnemy();
  requestAnimationFrame(loop);
}

loop();

// === MENÃš ===
document.getElementById('btnStart').onclick=()=>{
  for(const k in weaponsState)weaponsState[k].level=0;
  weaponsState[initialChoice].level=1;
  document.getElementById('mainMenu').style.display='none';
  document.getElementById('deathPanel').style.display='none';
  player.hp=player.maxHp;
  dead=false;
  gamePaused=false;
};

document.getElementById('btnDict').onclick=()=>alert('Diccionario de enemigos y armas en desarrollo');
document.getElementById('btnBack').onclick=()=>location.href='golf.html';
document.getElementById('btnRestart').onclick=()=>location.reload();

// selecciÃ³n de arma
document.querySelectorAll('.card').forEach(c=>{
  c.onclick=()=>{
    document.querySelectorAll('.card').forEach(x=>x.classList.remove('selected'));
    c.classList.add('selected');
    initialChoice=c.dataset.id;
  };
});
</script>
</body>
</html>
