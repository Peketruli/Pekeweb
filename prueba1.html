<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vampire Survival</title>
<style>
    body {
        margin: 0;
        background: #111;
        color: white;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }
    #gameCanvas {
        background: #222;
        display: block;
        margin: 0 auto;
    }
    #mainMenu, #levelMenu, #deathScreen {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }
    button {
        margin: 10px;
        padding: 10px 20px;
        font-size: 18px;
        cursor: pointer;
        border-radius: 10px;
        border: none;
        background: #444;
        color: white;
    }
    button:hover {
        background: #666;
    }
</style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<div id="mainMenu">
    <h1>Vampire Survival</h1>
    <p>Selecciona tu arma inicial:</p>
    <div>
        <button onclick="selectWeapon('pistol')">Pistola</button>
        <button onclick="selectWeapon('whip')">L치tigo</button>
    </div>
    <button onclick="startGame()">Iniciar Partida</button>
</div>

<div id="deathScreen" style="display:none;">
    <h2>Has muerto</h2>
    <button onclick="restartGame()">Volver al men칰</button>
</div>

<script>
// =============================
// VARIABLES GLOBALES
// =============================
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = {
    x: 400, y: 300,
    hp: 100,
    maxHp: 100,
    speed: 3,
    alive: true
};

let enemies = [];
let bullets = [];
let lastSpawn = 0;
let keys = {};
let selectedWeapon = "pistol";
let gameStarted = false;  // 游댳 NUEVO: evita l칩gica antes de empezar
let gameOver = false;

// =============================
// EVENTOS DE TECLADO
// =============================
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// =============================
// MEN칔 PRINCIPAL
// =============================
function selectWeapon(name) {
    selectedWeapon = name;
    console.log("Arma seleccionada:", name);
}

function startGame() {
    document.getElementById("mainMenu").style.display = "none";
    document.getElementById("deathScreen").style.display = "none";

    // 游댳 Reiniciar variables de estado
    player.hp = player.maxHp;
    player.alive = true;
    gameOver = false;
    gameStarted = true;

    enemies = [];
    bullets = [];
    lastSpawn = 0;

    loop(performance.now());
}

function restartGame() {
    gameStarted = false;
    gameOver = false;
    player.hp = player.maxHp;
    player.alive = true;
    document.getElementById("deathScreen").style.display = "none";
    document.getElementById("mainMenu").style.display = "flex";
}

// =============================
// ENEMIGOS Y ATAQUES
// =============================
function spawnEnemy() {
    enemies.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        hp: 10
    });
}

function shoot() {
    if (selectedWeapon === "pistol") {
        bullets.push({ x: player.x, y: player.y, dx: 4, dy: 0 });
    } else if (selectedWeapon === "whip") {
        // ataque corto tipo l치tigo
        enemies.forEach(e => {
            const dx = e.x - player.x;
            const dy = e.y - player.y;
            const dist = Math.hypot(dx, dy);
            if (dist < 80) e.hp -= 10;
        });
    }
}

// =============================
// LOOP PRINCIPAL
// =============================
function loop(timestamp) {
    if (!gameStarted) return; // 游댳 Evita l칩gica si no se ha iniciado a칰n
    if (gameOver) {
        document.getElementById("deathScreen").style.display = "flex";
        return;
    }

    const now = timestamp;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Movimiento jugador
    if (keys["w"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["a"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    // Spawning enemigos
    if (now - lastSpawn > 1500) {
        spawnEnemy();
        lastSpawn = now;
    }

    // Disparo autom치tico
    if (selectedWeapon === "pistol" && now % 30 < 1) shoot();

    // Actualizar balas
    bullets.forEach(b => {
        b.x += b.dx;
        b.y += b.dy;
    });

    // Dibujar jugador
    ctx.fillStyle = "lime";
    ctx.beginPath();
    ctx.arc(player.x, player.y, 10, 0, Math.PI * 2);
    ctx.fill();

    // Dibujar enemigos
    ctx.fillStyle = "red";
    enemies.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, 8, 0, Math.PI * 2);
        ctx.fill();

        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.hypot(dx, dy);

        if (dist < 20) {
            player.hp -= 0.2;
            if (player.hp <= 0) {
                gameOver = true;
                player.alive = false;
            }
        }
    });

    // Dibujar balas
    ctx.fillStyle = "yellow";
    bullets.forEach(b => {
        ctx.fillRect(b.x, b.y, 4, 2);
    });

    // Dibujar HUD
    ctx.fillStyle = "white";
    ctx.fillText(`HP: ${Math.round(player.hp)}`, 10, 20);

    requestAnimationFrame(loop);
}

// =============================
// INICIO DEL JUEGO
// =============================
window.onload = function() {
    gameStarted = false;
    gameOver = false;
    player.hp = player.maxHp;
    player.alive = true;
    document.getElementById("mainMenu").style.display = "flex";
};
</script>
</body>
</html>
