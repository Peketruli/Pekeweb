<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vampire Survival â€” Restaurado</title>
<style>
  :root{--hud-bg:rgba(0,0,0,0.45);--accent:#f39c12}
  html,body{height:100%;margin:0;background:#070707;color:#eee;font-family:Inter,Arial,sans-serif;overflow:hidden}
  canvas{display:block;background:linear-gradient(#111,#050505);width:100vw;height:100vh;position:absolute;top:0;left:0;z-index:1}
  #hud{position:fixed;top:10px;left:50%;transform:translateX(-50%);width:92vw;max-width:1100px;z-index:60;display:flex;gap:10px;align-items:center;}
  .box{background:var(--hud-bg);padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06)}
  .bars{flex:1;display:flex;flex-direction:column;gap:6px}
  .bar{height:18px;background:#222;border-radius:8px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,0.04)}
  .fill{height:100%;transition:width .18s linear}
  .hpFill{background:linear-gradient(90deg,#2ecc71,#27ae60)}
  .xpFill{background:linear-gradient(90deg,#f39c12,#e67e22)}
  #inv{display:flex;gap:8px;min-width:260px;flex-wrap:wrap}
  .slot{min-width:120px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:13px}
  .slot small{color:#bbb}
  .overlay{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#0f0f0f;padding:16px;border:2px solid #fff;border-radius:10px;z-index:80;display:none;min-width:260px}
  .choices{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  button.choice{padding:10px;border-radius:8px;border:none;background:#222;color:#fff;cursor:pointer}
  button.choice:hover{background:#333}
  #mainMenu{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:90;background:linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6))}
  #menuBox{background:rgba(10,10,10,0.95);padding:22px;border-radius:12px;border:2px solid #fff;text-align:center}
  #menuBox button{margin:8px;padding:10px 16px;border-radius:8px;border:none;background:#222;color:#fff;cursor:pointer}
  #selector{display:flex;gap:12px;justify-content:center;margin-top:12px}
  .card{width:180px;padding:12px;border-radius:8px;background:#121212;border:1px solid rgba(255,255,255,0.03);cursor:pointer;user-select:none}
  .card.selected{outline:3px solid rgba(243,156,18,0.16);box-shadow:0 4px 12px rgba(0,0,0,0.6)}
  #deathPanel{display:none;position:fixed;inset:0;align-items:center;justify-content:center;z-index:95}
  #deathInner{background:#120000;padding:18px;border-radius:10px;border:2px solid #c0392b;color:#fff;text-align:center}
  #debug{position:fixed;right:8px;bottom:8px;color:#999;font-size:12px;z-index:70}
  /* Ensure menu receives clicks above canvas */
  #mainMenu, #menuBox, .card, #menuBox button { pointer-events: auto; }
  /* Small responsive tweaks */
  @media (max-width:600px){ .card{width:140px} #menuBox h1{font-size:20px} }
</style>
</head>
<body>

<!-- Main menu / selector -->
<div id="mainMenu">
  <div id="menuBox">
    <h1>ðŸ§› Vampire Survival</h1>
    <div style="font-size:14px;margin-bottom:8px;color:#ccc">Elige tu arma inicial</div>
    <div id="selector">
      <div class="card selected" data-id="pistol">
        <h3>Pistola</h3><small>Disparo automÃ¡tico</small>
      </div>
      <div class="card" data-id="whip">
        <h3>LÃ¡tigo</h3><small>Tajo largo</small>
      </div>
      <div class="card" data-id="sword">
        <h3>Espada</h3><small>Tajo corto</small>
      </div>
    </div>
    <div style="margin-top:12px">
      <button id="btnStart">Comenzar partida</button>
      <button id="btnDict">Diccionario</button>
      <button id="btnBack">Volver a Golf</button>
    </div>
  </div>
</div>

<canvas id="c"></canvas>

<!-- HUD -->
<div id="hud">
  <div class="box" style="min-width:200px">
    <div style="font-size:15px"><strong id="scoreText">Puntos: 0</strong></div>
    <div style="font-size:13px;color:#ccc">Nivel <span id="levelText">1</span></div>
  </div>
  <div class="box bars">
    <div style="display:flex;align-items:center;gap:8px">
      <div style="width:70px">Vida</div>
      <div class="bar" style="flex:1"><div id="hpFill" class="fill hpFill" style="width:100%"></div></div>
      <div style="width:70px;text-align:right;font-size:13px" id="hpText">100/100</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <div style="width:70px">XP</div>
      <div class="bar" style="flex:1"><div id="xpFill" class="fill xpFill" style="width:0%"></div></div>
      <div style="width:70px;text-align:right;font-size:13px" id="xpText">0/15</div>
    </div>
  </div>
  <div id="inv" class="box"></div>
</div>

<!-- Level menu -->
<div id="levelMenu" class="overlay">
  <h2>Â¡Subiste de nivel!</h2>
  <div style="color:#ccc;font-size:13px">Elige una mejora o arma</div>
  <div id="levelChoices" class="choices"></div>
</div>

<!-- Death panel -->
<div id="deathPanel">
  <div id="deathInner">
    <h2>Has muerto</h2>
    <div id="deathStats" style="margin-top:8px;color:#ddd"></div>
    <div style="margin-top:12px">
      <button id="btnRestart">Reiniciar</button>
    </div>
  </div>
</div>

<div id="debug"></div>

<script>
// =================== CANVAS ===================
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// =================== VARIABLES ===================
let player = {
  x: canvas.width / 2,
  y: canvas.height / 2,
  radius: 20,
  speed: 4,
  hp: 100,
  maxHp: 100
};

let keys = {};
let gamePaused = true;
let dead = false;
let xp = 0;
let level = 1;
let enemies = [];
let projectiles = [];
let meleeArcs = [];
let angle = 0;

// =================== ARMAS ===================
const weaponsState = {
  sword: { level: 0, cooldown: 800, last: 0 },
  axe: { level: 0, cooldown: 1000, last: 0 },
  dagger: { level: 0, cooldown: 400, last: 0 },
  whip: { level: 0, cooldown: 900, last: 0 }
};

let initialChoice = 'sword'; // cambia con el menÃº

// =================== BOSS ===================
let boss = {
  x: canvas.width / 2,
  y: 150,
  radius: 40,
  hp: 500,
  maxHp: 500,
  alive: true
};

// =================== INPUT ===================
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// =================== FUNCIONES ===================
function movePlayer() {
  if (keys['w'] || keys['ArrowUp']) player.y -= player.speed;
  if (keys['s'] || keys['ArrowDown']) player.y += player.speed;
  if (keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
  if (keys['d'] || keys['ArrowRight']) player.x += player.speed;

  player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
  player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
}

function spawnEnemy() {
  const side = Math.floor(Math.random() * 4);
  let x, y;
  switch (side) {
    case 0: x = 0; y = Math.random() * canvas.height; break;
    case 1: x = canvas.width; y = Math.random() * canvas.height; break;
    case 2: x = Math.random() * canvas.width; y = 0; break;
    case 3: x = Math.random() * canvas.width; y = canvas.height; break;
  }
  enemies.push({ x, y, radius: 15, speed: 1.5, hp: 20 });
}

// =================== DIBUJOS ===================
function drawPlayer() {
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fillStyle = '#3cf';
  ctx.fill();
  ctx.closePath();
}

function drawEnemies() {
  ctx.fillStyle = 'red';
  for (const e of enemies) {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawBoss() {
  if (!boss.alive) return;
  ctx.beginPath();
  ctx.arc(boss.x, boss.y, boss.radius, 0, Math.PI * 2);
  ctx.fillStyle = 'purple';
  ctx.fill();

  // barra de vida del boss
  const barWidth = 200;
  const barHeight = 15;
  ctx.fillStyle = '#222';
  ctx.fillRect(boss.x - barWidth/2, boss.y - boss.radius - 25, barWidth, barHeight);
  ctx.fillStyle = 'red';
  ctx.fillRect(boss.x - barWidth/2, boss.y - boss.radius - 25, barWidth * (boss.hp / boss.maxHp), barHeight);
  ctx.strokeStyle = '#fff';
  ctx.strokeRect(boss.x - barWidth/2, boss.y - boss.radius - 25, barWidth, barHeight);
}

// =================== ENEMIGOS ===================
function updateEnemies() {
  for (const e of enemies) {
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist = Math.hypot(dx, dy);
    if (dist > 0) {
      e.x += (dx / dist) * e.speed;
      e.y += (dy / dist) * e.speed;
    }

    if (dist < player.radius + e.radius) {
      player.hp -= 0.2;
      if (player.hp <= 0) dead = true;
    }
  }

  // Boss colisiÃ³n con player
  if (boss.alive) {
    const dx = player.x - boss.x;
    const dy = player.y - boss.y;
    const dist = Math.hypot(dx, dy);
    if (dist < player.radius + boss.radius) {
      player.hp -= 0.5;
      if (player.hp <= 0) dead = true;
    }
  }
}

// =================== PROYECTILES ===================
function updateProjectiles() {
  const now = Date.now();
  for (let i = projectiles.length - 1; i >= 0; i--) {
    const p = projectiles[i];
    p.life -= 16;
    if (p.life <= 0) {
      projectiles.splice(i, 1);
      continue;
    }

    // Colisiones con enemigos
    for (let j = enemies.length - 1; j >= 0; j--) {
      const e = enemies[j];
      const dx = e.x - p.x;
      const dy = e.y - p.y;
      const dist = Math.hypot(dx, dy);
      if (dist < p.r + e.radius) {
        enemies.splice(j, 1);
        xp += 5;
      }
    }

    // Colisiones con boss
    if (boss.alive) {
      const dx = boss.x - p.x;
      const dy = boss.y - p.y;
      const dist = Math.hypot(dx, dy);
      if (dist < boss.radius + p.r) {
        boss.hp -= 10;
        projectiles.splice(i,1);
        if (boss.hp <= 0) boss.alive = false;
        break;
      }
    }
  }
}

// =================== MELEE VISIBLE ===================
function attackMelee() {
  const now = Date.now();
  const ws = weaponsState[initialChoice];
  if (!ws) return;

  if (now - ws.last > ws.cooldown && ws.level > 0) {
    ws.last = now;
    const range = 80;
    const duration = 200;
    const color = {
      sword: 'rgba(0,200,255,0.6)',
      axe: 'rgba(255,80,80,0.6)',
      dagger: 'rgba(255,255,100,0.7)',
      whip: 'rgba(180,0,255,0.6)'
    }[initialChoice] || 'rgba(255,255,255,0.6)';

    meleeArcs.push({
      x: player.x,
      y: player.y,
      r: range,
      life: duration,
      color: color
    });

    // daÃ±o a enemigos dentro del rango
    for (let j = enemies.length - 1; j >=0; j--) {
      const e = enemies[j];
      const dist = Math.hypot(e.x - player.x, e.y - player.y);
      if (dist < range + e.radius) {
        enemies.splice(j, 1);
        xp += 5;
      }
    }

    if (boss.alive) {
      const distBoss = Math.hypot(boss.x - player.x, boss.y - player.y);
      if (distBoss < range + boss.radius) {
        boss.hp -= 15;
        if (boss.hp <=0) boss.alive=false;
      }
    }
  }
}

function renderMeleeArcs(ctx) {
  for (let i = meleeArcs.length - 1; i >= 0; i--) {
    const arc = meleeArcs[i];
    arc.life -= 16;
    if (arc.life <=0) {
      meleeArcs.splice(i,1);
      continue;
    }
    ctx.beginPath();
    ctx.arc(arc.x, arc.y, arc.r, 0, Math.PI * 2);
    ctx.strokeStyle = arc.color;
    ctx.lineWidth = 8;
    ctx.stroke();
  }
}

// =================== HUD ===================
function drawHUD() {
  document.getElementById('hpFill').style.width = `${(player.hp/player.maxHp)*100}%`;
  document.getElementById('xpFill').style.width = `${Math.min(100,(xp/15)*100)}%`;
  document.getElementById('hpText').textContent = `${Math.floor(player.hp)}/${player.maxHp}`;
  document.getElementById('xpText').textContent = `${xp}/15`;
  document.getElementById('scoreText').textContent = `Puntos: ${xp}`;
  document.getElementById('levelText').textContent = `${level}`;
}

// =================== LOOP ===================
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (!gamePaused && !dead) {
    movePlayer();
    updateEnemies();
    updateProjectiles();
    attackMelee();
  }

  drawPlayer();
  drawEnemies();
  drawBoss();
  renderMeleeArcs(ctx);
  drawHUD();

  if (!gamePaused && Math.random()<0.02) spawnEnemy();

  requestAnimationFrame(loop);
}

loop();

// =================== MENÃš ===================
document.getElementById('btnStart').addEventListener('click', () => {
  for (const id in weaponsState) weaponsState[id].level = 0;
  weaponsState[initialChoice].level = 1;
  gamePaused = false;
  dead = false;
  player.hp = player.maxHp;
  enemies = [];
  projectiles = [];
  meleeArcs = [];
  boss.hp = boss.maxHp;
  boss.alive = true;
});

// Botones extra del menÃº
document.getElementById('btnDict').addEventListener('click', () => {
  alert('Diccionario en desarrollo...');
});
document.getElementById('btnBack').addEventListener('click', () => {
  location.href='golf.html';
});

// SelecciÃ³n de arma
document.querySelectorAll('#selector .card').forEach(card=>{
  card.addEventListener('click',()=>{
    initialChoice=card.dataset.id;
    document.querySelectorAll('#selector .card').forEach(c=>c.classList.remove('selected'));
    card.classList.add('selected');
  });
});
</script>
</body>
</html>
