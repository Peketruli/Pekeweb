<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vampire Survival â€” Estable</title>
<style>
:root {
  --hud-bg: rgba(0,0,0,0.45);
  --accent: #f39c12;
}

html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  background: #070707;
  color: #eee;
  font-family: Inter, Arial, sans-serif;
}

canvas {
  display: block;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(#111,#050505);
  z-index: 1;
  position: relative;
}

#hud {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 92vw;
  max-width: 1100px;
  z-index: 40;
  display: flex;
  gap: 10px;
  align-items: center;
}

.box {
  background: var(--hud-bg);
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.06);
}

.bars {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.bar {
  height: 18px;
  background: #222;
  border-radius: 8px;
  overflow: hidden;
  position: relative;
  border: 1px solid rgba(255,255,255,0.04);
}

.fill {
  height: 100%;
  transition: width .18s linear;
}

.hpFill {
  background: linear-gradient(90deg,#2ecc71,#27ae60);
}

.xpFill {
  background: linear-gradient(90deg,#f39c12,#e67e22);
}

#inv {
  display: flex;
  gap: 8px;
  min-width: 260px;
  flex-wrap: wrap;
}

.slot { min-width:120px; padding:6px; border-radius:8px; background: rgba(255,255,255,0.02); font-size:13px; }
.slot small { color:#bbb; }

.overlay {
  position: fixed;
  left:50%;
  top:50%;
  transform: translate(-50%, -50%);
  background:#0f0f0f;
  padding:16px;
  border:2px solid #fff;
  border-radius:10px;
  z-index:60;
  display:none;
}

.choices { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
button.choice { padding:10px; border-radius:8px; border:none; background:#222; color:#fff; cursor:pointer; }
button.choice:hover { background:#333; }

#mainMenu {
  position: fixed;
  inset: 0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
  background: rgba(0,0,0,0.6);
}

#menuBox {
  background: rgba(10,10,10,0.9);
  padding:22px;
  border-radius:12px;
  border:2px solid #fff;
  text-align:center;
}

#menuBox button { margin:8px; padding:10px 16px; border-radius:8px; border:none; background:#222; color:#fff; cursor:pointer; }

#selector { display:flex; gap:12px; justify-content:center; margin-top:12px; }
.card { width:180px; padding:12px; border-radius:8px; background:#121212; border:1px solid rgba(255,255,255,0.03); cursor:pointer; }
.card.selected { outline:3px solid rgba(243,156,18,0.16); box-shadow:0 4px 12px rgba(0,0,0,0.6); }

#deathPanel {
  display: none;
  position: fixed;
  inset: 0;
  align-items:center;
  justify-content:center;
  z-index:90;
}
#deathInner {
  background: #120000;
  padding:18px;
  border-radius:10px;
  border:2px solid #c0392b;
  color:#fff;
  text-align:center;
}
#debug {
  position:fixed;
  right:8px;
  bottom:8px;
  color:#999;
  font-size:12px;
  z-index:50;
}
</style>
</head>
<body>

<!-- MenÃº principal -->
<div id="mainMenu">
  <div id="menuBox">
    <h1>ðŸ§› Vampire Survival</h1>
    <div style="font-size:14px;margin-bottom:8px;color:#ccc">Elige tu arma inicial</div>
    <div id="selector">
      <div class="card selected" data-id="pistol" id="card-pistol"><h3>Pistola</h3><small>Disparo automÃ¡tico</small></div>
      <div class="card" data-id="whip" id="card-whip"><h3>LÃ¡tigo</h3><small>Tajo frontal</small></div>
    </div>
    <div style="margin-top:12px">
      <button id="btnStart">Comenzar partida</button>
      <button id="btnDict">Diccionario</button>
      <button id="btnBack">Volver a Golf</button>
    </div>
  </div>
</div>

<canvas id="gameCanvas"></canvas>

<!-- HUD -->
<div id="hud">
  <div class="box" style="min-width:200px">
    <div style="font-size:15px"><strong id="scoreText">Puntos: 0</strong></div>
    <div style="font-size:13px;color:#ccc">Nivel <span id="levelText">1</span></div>
  </div>
  <div class="box bars">
    <div style="display:flex;align-items:center;gap:8px">
      <div style="width:70px">Vida</div>
      <div class="bar" style="flex:1"><div id="hpFill" class="fill hpFill" style="width:100%"></div></div>
      <div style="width:70px;text-align:right;font-size:13px" id="hpText">100/100</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <div style="width:70px">XP</div>
      <div class="bar" style="flex:1"><div id="xpFill" class="fill xpFill" style="width:0%"></div></div>
      <div style="width:70px;text-align:right;font-size:13px" id="xpText">0/15</div>
    </div>
  </div>
  <div id="inv" class="box"></div>
</div>

<!-- Level menu -->
<div id="levelMenu" class="overlay">
  <h2>Â¡Subiste de nivel!</h2>
  <div style="color:#ccc;font-size:13px">Elige una mejora o arma</div>
  <div id="levelChoices" class="choices"></div>
</div>

<!-- Death panel -->
<div id="deathPanel">
  <div id="deathInner">
    <h2>Has muerto</h2>
    <div id="deathStats" style="margin-top:8px;color:#ddd"></div>
    <div style="margin-top:12px"><button id="btnRestart">Reiniciar</button></div>
  </div>
</div>

<div id="debug"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = {x:canvas.width/2, y:canvas.height/2, radius:20, speed:4, hp:100, maxHp:100};
let keys = {}, gamePaused=true, dead=false, xp=0, level=1;
let enemies=[], projectiles=[], pickups=[], angle=0, score=0;
let boss = null, bossTimer=0;
let initialChoice = 'pistol';

const weaponsState = { pistol:{level:1,cooldown:600,last:0}, whip:{level:0,cooldown:900,last:0} };

// Input
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);

// Funciones
function movePlayer(){
  if(keys['w']||keys['ArrowUp']) player.y -= player.speed;
  if(keys['s']||keys['ArrowDown']) player.y += player.speed;
  if(keys['a']||keys['ArrowLeft']) player.x -= player.speed;
  if(keys['d']||keys['ArrowRight']) player.x += player.speed;
  player.x = Math.max(player.radius, Math.min(canvas.width-player.radius,player.x));
  player.y = Math.max(player.radius, Math.min(canvas.height-player.radius,player.y));
}

function spawnEnemy(){
  const side=Math.floor(Math.random()*4);
  let x,y;
  switch(side){ case 0: x=0;y=Math.random()*canvas.height; break;
  case 1: x=canvas.width;y=Math.random()*canvas.height; break;
  case 2: x=Math.random()*canvas.width;y=0; break;
  case 3: x=Math.random()*canvas.width;y=canvas.height; break;}
  enemies.push({x,y,radius:15,speed:1.5,hp:10});
}

function spawnBoss(){
  boss = {x:canvas.width/2, y:canvas.height/4, radius:40, hp:500, maxHp:500, speed:1};
}

function drawPlayer(){
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.radius,0,Math.PI*2);
  ctx.fillStyle='#3cf';
  ctx.fill();
  ctx.closePath();
}

function drawEnemies(){
  ctx.fillStyle='red';
  for(const e of enemies){ ctx.beginPath(); ctx.arc(e.x,e.y,e.radius,0,Math.PI*2); ctx.fill(); }
}

function drawBoss(){
  if(!boss) return;
  ctx.fillStyle='purple';
  ctx.beginPath();
  ctx.arc(boss.x,boss.y,boss.radius,0,Math.PI*2);
  ctx.fill();
  // Boss HP bar
  ctx.fillStyle='red';
  ctx.fillRect(boss.x-boss.radius,boss.y-boss.radius-10, boss.radius*2*(boss.hp/boss.maxHp), 6);
}

function updateEnemies(){
  for(const e of enemies){
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist=Math.hypot(dx,dy);
    if(dist>0){ e.x += (dx/dist)*e.speed; e.y += (dy/dist)*e.speed; }
    if(dist<player.radius+e.radius){ player.hp-=0.2; if(player.hp<=0) dead=true; }
  }
}

function updateBoss(){
  if(!boss) return;
  const dx=player.x-boss.x;
  const dy=player.y-boss.y;
  const dist=Math.hypot(dx,dy);
  if(dist>0){ boss.x += (dx/dist)*boss.speed; boss.y += (dy/dist)*boss.speed; }
  if(dist<player.radius+boss.radius){ player.hp-=0.5; if(player.hp<=0) dead=true; }
}

function attackMelee(){
  const now=Date.now();
  const ws=weaponsState[initialChoice];
  if(!ws) return;
  if(now-ws.last>ws.cooldown&&ws.level>0){
    ws.last=now;
    projectiles.push({type:'slash',x:player.x,y:player.y,r:80,life:150,angle:Math.random()*Math.PI*2});
  }
}

function drawProjectiles(){
  for(const p of projectiles){
    if(p.type==='slash'){
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.angle);
      ctx.beginPath();
      ctx.arc(0,0,p.r,0,Math.PI/2);
      ctx.strokeStyle='rgba(255,255,255,0.7)';
      ctx.lineWidth=8;
      ctx.stroke();
      ctx.restore();
    }
  }
}

function updateProjectiles(){
  for(let i=projectiles.length-1;i>=0;i--){
    const p=projectiles[i];
    p.life-=16;
    if(p.life<=0){ projectiles.splice(i,1); continue; }
    for(let j=enemies.length-1;j>=0;j--){
      const e=enemies[j];
      if(Math.hypot(e.x-p.x,e.y-p.y)<p.r+e.radius){ enemies.splice(j,1); score+=1; xp+=1; }
    }
    if(boss && Math.hypot(boss.x-p.x,boss.y-p.y)<p.r+boss.radius){ boss.hp-=10; if(boss.hp<=0){ boss=null; score+=50; xp+=50; } }
  }
}

function drawHUD(){
  document.getElementById('hpFill').style.width=(player.hp/player.maxHp*100)+'%';
  document.getElementById('hpText').textContent=`${Math.floor(player.hp)}/${player.maxHp}`;
  document.getElementById('scoreText').textContent=`Puntos: ${score}`;
  document.getElementById('xpFill').style.width=(xp%15/15*100)+'%';
  document.getElementById('xpText').textContent=`${xp%15}/15`;
  document.getElementById('levelText').textContent=level;
}

function loop(){
  if(dead){ document.getElementById('deathPanel').style.display='flex'; gamePaused=true; return; }
  if(gamePaused){ requestAnimationFrame(loop); return; }

  ctx.clearRect(0,0,canvas.width,canvas.height);
  movePlayer();
  updateEnemies();
  updateBoss();
  updateProjectiles();
  drawPlayer();
  drawEnemies();
  drawBoss();
  drawProjectiles();
  drawHUD();
  attackMelee();

  if(Math.random()<0.02) spawnEnemy();
  bossTimer += 16;
  if(!boss && bossTimer>=150000){ spawnBoss(); bossTimer=0; }

  requestAnimationFrame(loop);
}

// MenÃº principal
document.getElementById('btnStart').addEventListener('click', ()=>{
  for(const id in weaponsState) weaponsState[id].level=0;
  weaponsState[initialChoice].level=1;
  document.getElementById('mainMenu').style.display='none';
  gamePaused=false;
  dead=false;
  player.hp=player.maxHp;
  loop();
});

document.getElementById('btnDict').addEventListener('click', ()=>{ alert('Diccionario en desarrollo'); });
document.getElementById('btnBack').addEventListener('click', ()=>{ location.href='golf.html'; });

document.querySelectorAll('.card').forEach(card=>{
  card.addEventListener('click',()=>{
    document.querySelectorAll('.card').forEach(c=>c.classList.remove('selected'));
    card.classList.add('selected');
    initialChoice=card.dataset.id;
  });
});

document.getElementById('btnRestart').addEventListener('click', ()=>{
  location.reload();
});
</script>
</body>
</html>
