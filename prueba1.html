<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vampire Survival</title>
<style>
  body, html { margin:0; padding:0; overflow:hidden; background:black; }
  #upgradeMenu {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#222; color:white; padding:20px; border-radius:10px; text-align:center;
    display:none; z-index:10;
  }
  #upgradeMenu button {
    margin:5px; padding:10px 20px; font-size:16px; cursor:pointer;
  }
  #ui {
    position:absolute; top:10px; left:10px; color:white; font-family:Arial;
    font-size:18px; z-index:5;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="upgradeMenu"></div>
<div id="ui">
  Vida: <span id="life">100</span> | Nivel: <span id="level">1</span> | XP: <span id="xp">0</span>/<span id="xpNext">50</span>
</div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gameRunning = true;

const player = {x:canvas.width/2, y:canvas.height/2, radius:15, color:'cyan', speed:5, damage:5, life:100, maxLife:100};
let keys = {};
let mouse = {x:canvas.width/2, y:canvas.height/2};
document.addEventListener('keydown', e=>keys[e.key]=true);
document.addEventListener('keyup', e=>keys[e.key]=false);
document.addEventListener('mousemove', e=>mouse={x:e.clientX, y:e.clientY});

let enemies = [];
let xpBalls = [];
let bullets = [];
let lastFireTime = 0;
const fireCooldown = 1500; // 1.5s

let level = 1;
let xp = 0;
let xpToNext = 50;
const maxLevelBeforeUpgrade = 15;

// Upgrades
const upgradesList = [
    {name:'Aumentar da침o', type:'damage', value:1},
    {name:'Aumentar velocidad', type:'speed', value:0.5},
    {name:'Aumentar vida m치xima', type:'maxLife', value:10}
];

function showUpgradeMenu() {
    gameRunning=false;
    const menu = document.getElementById('upgradeMenu');
    menu.innerHTML = '<h2>Elige una mejora</h2>';
    let options = [];
    while(options.length<3){
        const candidate = upgradesList[Math.floor(Math.random()*upgradesList.length)];
        if(!options.includes(candidate)) options.push(candidate);
    }
    options.forEach(opt=>{
        const btn=document.createElement('button');
        btn.innerText = opt.name;
        btn.onclick = () => {
            applyUpgrade(opt);
            menu.style.display='none';
            gameRunning=true;
        };
        menu.appendChild(btn);
    });
    menu.style.display='block';
}

function applyUpgrade(upgrade){
    if(upgrade.type==='damage') player.damage += upgrade.value;
    if(upgrade.type==='speed') player.speed += upgrade.value;
    if(upgrade.type==='maxLife'){
        player.maxLife += upgrade.value;
        player.life += upgrade.value;
        document.getElementById('life').innerText = player.life;
    }
}

// Movimiento jugador
function movePlayer(){
    if(keys['w'] || keys['ArrowUp']) player.y -= player.speed;
    if(keys['s'] || keys['ArrowDown']) player.y += player.speed;
    if(keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
    if(keys['d'] || keys['ArrowRight']) player.x += player.speed;
    // Limites
    player.x = Math.max(player.radius, Math.min(canvas.width-player.radius, player.x));
    player.y = Math.max(player.radius, Math.min(canvas.height-player.radius, player.y));
}

// Disparo autom치tico
function autoFire(){
    const now = Date.now();
    if(now - lastFireTime > fireCooldown){
        lastFireTime = now;
        const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
        bullets.push({x:player.x, y:player.y, angle:angle, speed:8});
    }
}

// Crear enemigos desde bordes (menos frecuentes)
function spawnEnemy(){
    const side = Math.floor(Math.random()*4);
    let enemy = {radius:15, color:'red', speed:2, life:20};
    if(side===0){enemy.x=0; enemy.y=Math.random()*canvas.height;} // Izquierda
    if(side===1){enemy.x=canvas.width; enemy.y=Math.random()*canvas.height;} // Derecha
    if(side===2){enemy.x=Math.random()*canvas.width; enemy.y=0;} // Arriba
    if(side===3){enemy.x=Math.random()*canvas.width; enemy.y=canvas.height;} // Abajo
    enemies.push(enemy);
}

// XP
function spawnXP(x,y){
    xpBalls.push({x:x, y:y, radius:7, value:10});
}

// Update
function update(){
    if(!gameRunning) return;

    movePlayer();
    autoFire();

    // Mover bullets
    bullets.forEach((b,i)=>{
        b.x += Math.cos(b.angle)*b.speed;
        b.y += Math.sin(b.angle)*b.speed;
        // Colisiones con enemigos
        enemies.forEach((e,j)=>{
            const dx = b.x-e.x;
            const dy = b.y-e.y;
            const dist = Math.sqrt(dx*dx+dy*dy);
            if(dist < e.radius){
                e.life -= player.damage;
                bullets.splice(i,1);
            }
        });
    });

    // Mover enemigos
    enemies.forEach((e,i)=>{
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.sqrt(dx*dx+dy*dy);
        e.x += dx/dist * e.speed;
        e.y += dy/dist * e.speed;
        if(dist < player.radius + e.radius){
            player.life -= 0.5;
            if(player.life<=0) {
                alert('Has muerto!');
                location.reload();
            }
            document.getElementById('life').innerText = Math.floor(player.life);
        }
        if(e.life<=0){
            spawnXP(e.x,e.y);
            enemies.splice(i,1);
        }
    });

    // Mover XP
    xpBalls.forEach((xpb,i)=>{
        const dx = player.x - xpb.x;
        const dy = player.y - xpb.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist<player.radius + xpb.radius){
            xp += xpb.value;
            xpBalls.splice(i,1);
            document.getElementById('xp').innerText = xp;
            if(xp>=xpToNext){
                level++;
                xp = 0;
                xpToNext = Math.floor(xpToNext*1.3);
                document.getElementById('level').innerText = level;
                document.getElementById('xpNext').innerText = xpToNext;
                if(level % maxLevelBeforeUpgrade === 0) showUpgradeMenu();
            }
        }
    });

    // Spawn de enemigos cada cierto tiempo (menos frecuente)
    if(Math.random()<0.008) spawnEnemy(); // m치s bajo que antes
}

// Draw
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Jugador
    ctx.beginPath();
    ctx.arc(player.x,player.y,player.radius,0,Math.PI*2);
    ctx.fillStyle = player.color;
    ctx.fill();
    // Bullets
    bullets.forEach(b=>{
        ctx.beginPath();
        ctx.arc(b.x,b.y,5,0,Math.PI*2);
        ctx.fillStyle='yellow';
        ctx.fill();
    });
    // Enemies
    enemies.forEach(e=>{
        ctx.beginPath();
        ctx.arc(e.x,e.y,e.radius,0,Math.PI*2);
        ctx.fillStyle=e.color;
        ctx.fill();
    });
    // XP
    xpBalls.forEach(xpb=>{
        ctx.beginPath();
        ctx.arc(xpb.x,xpb.y,xpb.radius,0,Math.PI*2);
        ctx.fillStyle='green';
        ctx.fill();
    });
}

// Loop
function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
