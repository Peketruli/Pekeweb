<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vampire Survival</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
    font-family: Arial, sans-serif;
    color: white;
  }
  canvas {
    display: block;
    background: #222;
  }
  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
  }
  .bar {
    width: 200px;
    height: 20px;
    background: #444;
    margin-bottom: 5px;
    border-radius: 5px;
    overflow: hidden;
  }
  .bar-inner {
    height: 100%;
    background: #0f0;
    width: 100%;
  }
  #weaponSelect {
    margin-top: 10px;
  }
  #weaponSelect button {
    margin-right: 5px;
  }
</style>
</head>
<body>
<div id="hud">
  <div>Vida jugador</div>
  <div class="bar"><div class="bar-inner" id="playerHealth"></div></div>
  <div id="weaponSelect">
    <button onclick="selectWeapon('pistol')">Pistola</button>
    <button onclick="selectWeapon('shotgun')">Escopeta</button>
    <button onclick="selectWeapon('rifle')">Rifle</button>
  </div>
  <div>Nivel: <span id="level">1</span></div>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- Jugador ---
const player = {
  x: canvas.width/2,
  y: canvas.height/2,
  size: 30,
  speed: 5,
  health: 100,
  weapon: 'pistol'
};

// --- Armas ---
const weapons = {
  pistol: {damage: 10, speed: 10, cooldown: 300},
  shotgun: {damage: 20, speed: 8, cooldown: 800},
  rifle: {damage: 15, speed: 12, cooldown: 500}
};
let lastShot = 0;

// --- Enemigos ---
let vampires = [];
let level = 1;

// --- Balas ---
let bullets = [];

// --- Controles ---
const keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);
canvas.addEventListener('click', shoot);

// --- Funciones ---
function selectWeapon(name) {
  player.weapon = name;
}

function spawnVampires(num) {
  for(let i=0;i<num;i++){
    vampires.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      size: 25,
      health: 30 + level*5
    });
  }
}

function shoot(e) {
  const now = Date.now();
  const weapon = weapons[player.weapon];
  if(now - lastShot < weapon.cooldown) return;
  lastShot = now;
  
  const rect = canvas.getBoundingClientRect();
  const targetX = e.clientX - rect.left;
  const targetY = e.clientY - rect.top;
  
  bullets.push({
    x: player.x,
    y: player.y,
    dx: targetX - player.x,
    dy: targetY - player.y,
    size: 5,
    damage: weapon.damage,
    speed: weapon.speed
  });
}

// --- Game Loop ---
function update() {
  // Movimiento jugador
  if(keys['w'] || keys['ArrowUp']) player.y -= player.speed;
  if(keys['s'] || keys['ArrowDown']) player.y += player.speed;
  if(keys['a'] || keys['ArrowLeft']) player.x -= player.speed;
  if(keys['d'] || keys['ArrowRight']) player.x += player.speed;

  player.x = Math.max(0, Math.min(canvas.width, player.x));
  player.y = Math.max(0, Math.min(canvas.height, player.y));

  // Actualizar balas
  bullets.forEach((b, i) => {
    const dist = Math.sqrt(b.dx*b.dx + b.dy*b.dy);
    b.x += (b.dx/dist)*b.speed;
    b.y += (b.dy/dist)*b.speed;
    
    // Revisar colisión con vampiros
    vampires.forEach((v,j) => {
      const d = Math.hypot(b.x-v.x, b.y-v.y);
      if(d < v.size + b.size){
        v.health -= b.damage;
        bullets.splice(i,1);
      }
    });
    
    if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height){
      bullets.splice(i,1);
    }
  });

  // Vampiros se mueven hacia jugador
  vampires.forEach((v,i) => {
    const dx = player.x - v.x;
    const dy = player.y - v.y;
    const dist = Math.hypot(dx,dy);
    if(dist > 0){
      v.x += dx/dist * 1.5;
      v.y += dy/dist * 1.5;
    }
    if(dist < v.size + player.size){
      player.health -= 0.5;
    }
    if(v.health <=0){
      vampires.splice(i,1);
    }
  });

  // Si todos muertos, subir nivel
  if(vampires.length === 0){
    level++;
    document.getElementById('level').innerText = level;
    spawnVampires(level + 2);
  }

  // Actualizar HUD
  document.getElementById('playerHealth').style.width = player.health + '%';
  if(player.health <= 0){
    alert("¡Has muerto! Recarga la página para volver a jugar.");
    location.reload();
  }
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  
  // Dibujar jugador
  ctx.fillStyle = 'green';
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.size,0,Math.PI*2);
  ctx.fill();

  // Dibujar vampiros
  ctx.fillStyle = 'purple';
  vampires.forEach(v => {
    ctx.beginPath();
    ctx.arc(v.x,v.y,v.size,0,Math.PI*2);
    ctx.fill();
  });

  // Dibujar balas
  ctx.fillStyle = 'yellow';
  bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.size,0,Math.PI*2);
    ctx.fill();
  });
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// --- Iniciar juego ---
spawnVampires(3);
gameLoop();

</script>
</body>
</html>
