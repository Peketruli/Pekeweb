<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Vampire Survival Arcade</title>
<style>
  body { margin:0; overflow:hidden; background:#111; font-family:Arial, sans-serif; }
  canvas { display:block; margin:0 auto; background:#111; }
  #score { position:absolute; top:10px; left:10px; color:white; font-size:20px; }
  #xpLevel { position:absolute; top:40px; left:10px; color:white; font-size:20px; }
  #levelMenu {
    position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
    background:rgba(0,0,0,0.9); padding:20px; border:2px solid white;
    display:none; color:white; text-align:center; width:300px; font-size:18px;
  }
  #levelMenu button {
    display:block; width:80%; margin:10px auto; padding:10px; font-size:16px;
    cursor:pointer; background:#222; color:white; border:1px solid white;
  }
  #levelMenu button:hover { background:#444; }
</style>
</head>
<body>
<div id="score">Puntuación: 0</div>
<div id="xpLevel">Nivel: 1 | XP: 0/15</div>
<div id="levelMenu">
  <div>¡Subiste de nivel! Elige una habilidad:</div>
  <div id="abilityButtons"></div>
</div>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let playerXP = 0;
let playerLevel = 1;
let xpToNextLevel = 15;
let gamePaused = false;

const player = {
    x: canvas.width/2, y: canvas.height/2, size:30, speed:5,
    color:'cyan', bulletSpeed:10, shootInterval:2500, doubleShot:false, bulletSize:5
};

const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

const bullets=[], vampires=[], xpParticles=[];

function spawnVampire(){
    if(gamePaused) return;
    const edge = Math.floor(Math.random()*4);
    let x,y;
    if(edge===0){x=0; y=Math.random()*canvas.height;}
    else if(edge===1){x=canvas.width; y=Math.random()*canvas.height;}
    else if(edge===2){x=Math.random()*canvas.width; y=0;}
    else{x=Math.random()*canvas.width; y=canvas.height;}
    vampires.push({x,y,size:30,speed:2,color:'red'});
}
setInterval(spawnVampire,2000);

// Habilidades inspiradas en Vampire Survivors
const abilities=[
    {name:"Bala doble", apply:()=>player.doubleShot=true},
    {name:"Disparo más rápido", apply:()=>{player.shootInterval=Math.max(500,player.shootInterval-500); resetShootTimer();}},
    {name:"Más velocidad", apply:()=>player.speed+=1},
    {name:"Bala más rápida", apply:()=>player.bulletSpeed+=3},
    {name:"Bala más grande", apply:()=>player.bulletSize+=2},
    {name:"Control de enemigos", apply:()=>player.freezeEnemies=true}, // puedes implementar efecto extra
    {name:"Más XP", apply:()=>playerXP+=3} // pequeño bonus XP al elegir
];

function shootAtClosestVampire(){
    if(gamePaused || vampires.length===0) return;
    let closest=vampires[0], minDist=Math.hypot(player.x-closest.x,player.y-closest.y);
    for(let i=1;i<vampires.length;i++){
        const dist=Math.hypot(player.x-vampires[i].x,player.y-vampires[i].y);
        if(dist<minDist){minDist=dist; closest=vampires[i];}
    }
    const angle=Math.atan2(closest.y-player.y, closest.x-player.x);
    bullets.push({x:player.x, y:player.y, dx:Math.cos(angle)*player.bulletSpeed, dy:Math.sin(angle)*player.bulletSpeed, size:player.bulletSize});
    if(player.doubleShot){
        const offset=Math.PI/12;
        bullets.push({x:player.x, y:player.y, dx:Math.cos(angle+offset)*player.bulletSpeed, dy:Math.sin(angle+offset)*player.bulletSpeed, size:player.bulletSize});
        bullets.push({x:player.x, y:player.y, dx:Math.cos(angle-offset)*player.bulletSpeed, dy:Math.sin(angle-offset)*player.bulletSpeed, size:player.bulletSize});
    }
}

let shootTimer=setInterval(shootAtClosestVampire, player.shootInterval);
function resetShootTimer(){ clearInterval(shootTimer); shootTimer=setInterval(shootAtClosestVampire, player.shootInterval); }

function showLevelMenu(){
    gamePaused = true;
    const menu=document.getElementById('levelMenu');
    const buttonsDiv=document.getElementById('abilityButtons');
    buttonsDiv.innerHTML='';
    const options=[];
    while(options.length<3){
        const ability=abilities[Math.floor(Math.random()*abilities.length)];
        if(!options.includes(ability)) options.push(ability);
    }
    options.forEach(a=>{
        const btn=document.createElement('button');
        btn.textContent=a.name;
        btn.onclick=()=>{
            a.apply();
            menu.style.display='none';
            gamePaused = false;
            updateXPLevelText();
        };
        buttonsDiv.appendChild(btn);
    });
    menu.style.display='block';
}

function updateXPLevelText(){
    document.getElementById('xpLevel').textContent="Nivel: "+playerLevel+" | XP: "+playerXP+"/"+xpToNextLevel;
}

function update(){
    if(gamePaused) return;

    if(keys['w']) player.y-=player.speed;
    if(keys['s']) player.y+=player.speed;
    if(keys['a']) player.x-=player.speed;
    if(keys['d']) player.x+=player.speed;

    player.x=Math.max(player.size/2, Math.min(canvas.width-player.size/2, player.x));
    player.y=Math.max(player.size/2, Math.min(canvas.height-player.size/2, player.y));

    bullets.forEach((b,i)=>{ b.x+=b.dx; b.y+=b.dy; if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height) bullets.splice(i,1); });

    vampires.forEach((v,vi)=>{
        const angle=Math.atan2(player.y-v.y, player.x-v.x);
        v.x+=Math.cos(angle)*v.speed;
        v.y+=Math.sin(angle)*v.speed;

        bullets.forEach((b,bi)=>{
            const dist=Math.hypot(b.x-v.x, b.y-v.y);
            if(dist<v.size/2+b.size/2){
                const xpAmount=Math.floor(Math.random()*5)+1;
                xpParticles.push({x:v.x, y:v.y, size:10, color:'lime', xp:xpAmount});
                vampires.splice(vi,1); bullets.splice(bi,1);
                score+=1; document.getElementById('score').textContent="Puntuación: "+score;
            }
        });

        const distPlayer=Math.hypot(player.x-v.x, player.y-v.y);
        if(distPlayer<v.size/2+player.size/2){
            alert('¡Has sido atrapado! Puntuación final: '+score+', Nivel: '+playerLevel);
            window.location.reload();
        }
    });

    xpParticles.forEach((p,i)=>{
        const distPlayer=Math.hypot(player.x-p.x, player.y-p.y);
        if(distPlayer<player.size/2+p.size/2){
            playerXP+=p.xp;
            xpParticles.splice(i,1);
            if(playerXP>=xpToNextLevel){
                playerLevel+=1;
                playerXP=playerXP-xpToNextLevel;
                xpToNextLevel=Math.floor(xpToNextLevel*1.5);
                showLevelMenu();
            }
            updateXPLevelText();
        }
    });
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle=player.color; ctx.beginPath(); ctx.arc(player.x,player.y,player.size/2,0,Math.PI*2); ctx.fill();
    bullets.forEach(b=>{ ctx.fillStyle='yellow'; ctx.beginPath(); ctx.arc(b.x,b.y,b.size,0,Math.PI*2); ctx.fill(); });
    vampires.forEach(v=>{ ctx.fillStyle=v.color; ctx.beginPath(); ctx.arc(v.x,v.y,v.size/2,0,Math.PI*2); ctx.fill(); });
    xpParticles.forEach(p=>{ ctx.fillStyle=p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.size/2,0,Math.PI*2); ctx.fill(); });
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
