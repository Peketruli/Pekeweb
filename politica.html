<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pol√≠tica</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    h1, h2 { text-align: center; }
    button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; margin-top: 8px; }
    #btnCrearPartido { background: #007bff; color: #fff; display: block; margin: 10px auto; }
    #crearPartidoForm { margin: 16px auto; padding: 16px; border: 2px solid #ccc; border-radius: 8px; max-width: 400px; background: #fff; }
    #crearPartidoForm input, #crearPartidoForm textarea { width: 100%; padding: 8px; margin: 6px 0; border-radius: 4px; border: 1px solid #ccc; }
    #listaPartidos { display: flex; flex-wrap: wrap; justify-content: center; }
    .partido { border: 2px solid #ccc; border-radius: 8px; padding: 16px; margin: 12px; background: #fff; width: 220px; text-align: center; box-shadow: 0px 2px 6px rgba(0,0,0,0.1); }
    .partido img { width: 100px; height: 100px; object-fit: cover; border-radius: 6px; margin-bottom: 8px; }
    .partido h3 { margin: 8px 0; }
    .unirseBtn { background: #28a745; color: white; }
  </style>
</head>
<body>

  <h1>Pol√≠tica</h1>

  <button id="btnCrearPartido">Crear Partido Pol√≠tico</button>

  <div id="crearPartidoForm" style="display:none;">
    <h3>Crear Partido</h3>
    <input type="text" id="nombrePartido" placeholder="Nombre del partido">
    <input type="color" id="colorPartido" value="#ff0000">
    <input type="file" id="logoPartido">
    <textarea id="descripcionPartido" placeholder="Breve descripci√≥n"></textarea>
    <button id="guardarPartido">Guardar Partido</button>
  </div>

  <h2>Partidos Existentes</h2>
  <div id="listaPartidos"></div>

  <script>
    // Conexi√≥n a Supabase
    const supabaseUrl = "TU_SUPABASE_URL"; // <- pon tu URL de Supabase
    const supabaseKey = "TU_SUPABASE_ANON_KEY"; // <- pon tu clave p√∫blica
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    const btnCrearPartido = document.getElementById('btnCrearPartido');
    const crearPartidoForm = document.getElementById('crearPartidoForm');
    const guardarPartido = document.getElementById('guardarPartido');
    const listaPartidos = document.getElementById('listaPartidos');

    let usuarioActual = { id: "uuid-del-usuario" }; 
    // üëÜ Aqu√≠ deber√≠as poner el id del usuario logueado con Supabase Auth

    // Mostrar / ocultar formulario
    btnCrearPartido.addEventListener('click', () => {
      crearPartidoForm.style.display = crearPartidoForm.style.display === 'none' ? 'block' : 'none';
    });

    // Cargar partidos
    async function cargarPartidos() {
      const { data: partidos, error } = await supabaseClient.from('partidos_politicos').select('*');
      if (error) {
        console.error(error);
        return;
      }
      listaPartidos.innerHTML = '';
      partidos.forEach(p => {
        const div = document.createElement('div');
        div.className = 'partido';
        div.style.borderColor = p.color;
        div.innerHTML = `
          <h3>${p.nombre}</h3>
          ${p.logo ? `<img src="${p.logo}" alt="Logo">` : `<div style="width:100px;height:100px;background:${p.color};margin:0 auto;border-radius:6px;"></div>`}
          <p>${p.descripcion || "Sin descripci√≥n"}</p>
          <button class="unirseBtn" onclick="unirsePartido('${p.id}')">Unirse</button>
        `;
        listaPartidos.appendChild(div);
      });
    }

    // Crear partido
    guardarPartido.addEventListener('click', async () => {
      const nombre = document.getElementById('nombrePartido').value;
      const color = document.getElementById('colorPartido').value;
      const logoFile = document.getElementById('logoPartido').files[0];
      const descripcion = document.getElementById('descripcionPartido').value;

      let logoUrl = '';
      if(logoFile){
        const { data, error } = await supabaseClient.storage.from('logos').upload(`logos/${Date.now()}_${logoFile.name}`, logoFile);
        if(error){ console.error(error); return; }
        logoUrl = supabaseClient.storage.from('logos').getPublicUrl(data.path).publicURL;
      }

      const { error } = await supabaseClient.from('partidos_politicos').insert([{
        nombre, color, logo: logoUrl, descripcion, creador_id: usuarioActual.id
      }]);
      if (error) { console.error(error); return; }

      crearPartidoForm.style.display = 'none';
      cargarPartidos();
    });

    // Unirse a un partido
    async function unirsePartido(partidoId){
      const { error } = await supabaseClient.from('usuarios').update({
        partido_id: partidoId
      }).eq('id', usuarioActual.id);

      if(error){
        console.error(error);
      } else {
        alert("¬°Te has unido al partido!");
      }
    }

    // Cargar al inicio
    cargarPartidos();

    // Hacer funci√≥n accesible desde HTML
    window.unirsePartido = unirsePartido;
  </script>
</body>
</html>
