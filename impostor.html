<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impostor</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- CONFIGURACI√ìN DE COLORES Y ESTILO --- */
        :root { 
            --p: #6366f1;           /* Color Principal (Morado) */
            --bg: #030712;          /* Fondo muy oscuro */
            --card: #111827;        /* Color de las tarjetas */
            --accent: #f59e0b;      /* Acento (Naranja) para pistas */
            --active: #10b981;      /* Verde para turnos y botones */
            --danger: #ef4444;      /* Rojo para salir/impostor */
            --txt: #f8fafc;         /* Texto blanco */
            --border: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }
        
        body { 
            font-family: 'Outfit', sans-serif; 
            background: var(--bg); 
            color: var(--txt); 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #030712 100%);
        }

        .hidden { display: none !important; }

        /* --- PANTALLA DE LOGIN (LOBBY) --- */
        #screen-login { 
            position:fixed; inset:0; z-index:5000; 
            background:var(--bg); 
            display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px; 
        }
        .login-container { display: flex; gap: 20px; width: 90%; max-width: 900px; height: 500px; }
        
        @media(max-width: 700px) { .login-container { flex-direction: column; height: auto; } }

        .lobby-box { 
            flex: 1; 
            background: rgba(17, 24, 39, 0.8); 
            backdrop-filter: blur(10px); 
            border-radius: 24px; 
            padding: 30px; 
            border: 1px solid var(--border); 
            overflow-y: auto; 
        }

        .room-card { 
            background: #1f2937; padding: 15px; border-radius: 12px; margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; border: 1px solid transparent;
        }
        .room-card:hover { border-color: var(--p); transform: translateX(5px); }

        /* --- INTERFAZ DEL JUEGO --- */
        .main-game { flex: 2; padding: 25px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .sidebar { 
            flex: 0.8; min-width: 300px;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); 
            display: flex; flex-direction: column; padding: 20px; 
            border-left: 1px solid var(--border); 
        }
        .panel { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--border); }

        /* --- JUGADORES --- */
        #player-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        
        .player-tag { 
            padding: 12px; border-radius: 14px; background: #1f2937; 
            text-align: center; font-weight: 700; border: 2px solid transparent; position: relative;
        }
        
        /* Efecto cuando es el turno del jugador */
        .is-active-turn { 
            border-color: var(--active); background: #064e3b; 
            animation: pulse 1.5s infinite; 
        }
        @keyframes pulse { 
            0% { box-shadow: 0 0 0 0 rgba(16,185,129,0.4); } 
            70% { box-shadow: 0 0 0 10px rgba(16,185,129,0); } 
            100% { box-shadow: 0 0 0 0 rgba(16,185,129,0); } 
        }
        
        .dead { opacity: 0.4; filter: grayscale(1); text-decoration: line-through; }

        /* --- CHAT --- */
        #chat-messages { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        
        .msg { padding: 8px 12px; border-radius: 8px; background: rgba(255,255,255,0.05); font-size: 0.9rem; border-left: 3px solid transparent; }
        
        /* CLASE IMPORTANTE: MENSAJE VERDE (PISTA) */
        .msg-clue { 
            background: rgba(16, 185, 129, 0.15) !important; 
            border-left-color: var(--active) !important; 
            color: #d1fae5; 
        }
        .msg b { display: block; font-size: 0.75rem; opacity: 0.7; margin-bottom: 2px; text-transform: uppercase; }

        /* --- ELEMENTOS DE FORMULARIO --- */
        input, select, button { 
            padding: 12px; border-radius: 12px; border: 1px solid var(--border); 
            background: #0f172a; color: white; outline: none; width: 100%; 
            font-family: inherit; margin-bottom: 10px; font-size: 1rem;
        }
        
        button { background: var(--p); cursor: pointer; border: none; font-weight: 800; text-transform: uppercase; margin-bottom: 0; }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        
        .btn-start { background: var(--active); box-shadow: 0 4px 15px rgba(16,185,129,0.2); }
        .btn-exit { background: var(--danger); width: auto; font-size: 0.7rem; padding: 8px 16px; margin: 0; }

        /* --- PANTALLA FINAL --- */
        #end-screen { 
            position: fixed; inset: 0; z-index: 9999; 
            background: rgba(0,0,0,0.96); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; 
        }
    </style>
</head>
<body>

    <div id="screen-login">
        <h1 style="font-size: 3rem; margin: 0;">üïµÔ∏è IMPOSTOR </h1>
        <div class="login-container">
            <div class="lobby-box">
                <h3 style="margin-top:0; color:var(--active);">üåê SALAS P√öBLICAS</h3>
                <div id="public-rooms-list">
                    <p style="color:gray;">Buscando salas...</p>
                </div>
            </div>
            <div class="lobby-box" style="max-width: 350px; display:flex; flex-direction:column; justify-content:center;">
                <h3>ENTRAR A JUGAR</h3>
                <input type="text" id="in-user" placeholder="Tu Apodo (Ej: Alex)">
                <input type="text" id="in-room" placeholder="C√≥digo Sala (Ej: SALA1)">
                <button onclick="entrarAlJuego()" style="height: 55px; font-size: 1.1rem;">üöÄ CONECTAR</button>
            </div>
        </div>
    </div>

    <div id="end-screen" class="hidden">
        <h1 id="end-title" style="font-size: 4rem; margin: 0;">---</h1>
        <p id="end-subtitle" style="font-size: 1.5rem; color: gray; margin-bottom: 30px;"></p>
        <div id="host-controls" class="hidden">
            <button onclick="reiniciarSala()" class="btn-start" style="width: auto; padding: 15px 40px;">üîÑ VOLVER AL LOBBY</button>
        </div>
    </div>

    <div id="game-layout" style="display: flex; width: 100%;">
        
        <div class="main-game">
            <div class="panel" style="display:flex; justify-content: space-between; align-items: center;">
                <div>
                    <h2 id="room-display" style="margin:0; color:var(--p);">SALA: ---</h2>
                    <div id="imp-status" class="hidden" style="color:var(--danger); font-weight:bold; font-size:0.9rem; margin-top:5px;">
                        ‚ö†Ô∏è IMPOSTORES VIVOS: <span id="imp-count-val">0</span>
                    </div>
                </div>
                <button onclick="salirDelJuego()" class="btn-exit">SALIR</button>
            </div>

            <div id="host-panel" class="panel hidden" style="border-color: var(--active);">
                <h4 style="margin:0 0 10px 0; color:var(--active);">‚öôÔ∏è AJUSTES DE PARTIDA</h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                    <div>
                        <label style="font-size:0.7rem; color:gray;">CANTIDAD IMPOSTORES</label>
                        <select id="set-imps" onchange="actualizarSala()">
                            <option value="1">1 Impostor</option>
                            <option value="2">2 Impostores</option>
                            <option value="rand">üé≤ Aleatorio</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:0.7rem; color:gray;">CATEGOR√çA</label>
                        <select id="set-cat" onchange="actualizarSala()">
                            <option value="all">üé≤ MIX</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:0.7rem; color:gray;">PRIVACIDAD</label>
                        <select id="set-priv" onchange="actualizarSala()">
                            <option value="true">üîì P√∫blica</option>
                            <option value="false">üîí Privada</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:0.7rem; color:gray;">CONTADOR IMPOSTORES</label>
                        <select id="set-vis" onchange="actualizarSala()">
                            <option value="true">üëÅÔ∏è Visible</option>
                            <option value="false">üï∂Ô∏è Oculto</option>
                        </select>
                    </div>
                </div>
                <button onclick="iniciarPartida()" class="btn-start">EMPEZAR PARTIDA</button>
            </div>

            <div class="panel">
                <h4 style="margin:0 0 10px 0; font-size:0.8rem; color:gray;">JUGADORES EN SALA</h4>
                <div id="player-list"></div>
            </div>

            <div id="role-box" class="panel hidden" style="text-align:center; border: 2px solid var(--p);">
                <div id="role-label" style="font-size:0.7rem; font-weight:bold; letter-spacing:2px; color:gray;">TU PALABRA</div>
                <h2 id="word-display" style="font-size: 2.5rem; margin:10px 0;">---</h2>
                <p id="hint-display" style="color:var(--accent); font-weight:bold; margin:0;"></p>
            </div>

            <div id="vote-box" class="panel hidden">
                <h3 style="color:var(--danger); margin:0 0 10px 0;">üó≥Ô∏è HORA DE VOTAR</h3>
                <div id="vote-options" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;"></div>
            </div>
        </div>

        <div class="sidebar">
            <div id="turn-display" style="text-align:center; padding:10px; background:rgba(255,255,255,0.05); border-radius:10px; font-weight:bold; margin-bottom:15px; color:var(--active);">ESPERANDO...</div>
            
            <div id="chat-messages">
                </div>
            
            <div style="display:flex; gap:5px;">
                <input type="text" id="chat-input" placeholder="Escribe aqu√≠..." style="margin:0;">
                <button onclick="enviarMensaje()" style="width:50px;">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURACI√ìN SUPABASE ---
        // IMPORTANTE: Aseg√∫rate de que estos son tus datos reales
        const SB_URL = 'https://jdvwlfogkzrzovepzjqa.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI';
        const sb = supabase.createClient(SB_URL, SB_KEY);

        // Variables Globales
        let myU = "", myR = "", pList = [], gState = "waiting", tIdx = 0;

        // Base de Datos de Palabras
       // --- BASE DE DATOS MASIVA (ULTIMATE PACK 600+ PALABRAS) ---
const DATA = {
    // 1. MIX GENERAL (Pistas gen√©ricas manuales para el modo Mezcla)
   all: [
    {w:"YOUTUBE", h:"INTERNET"}, {w:"TIKTOK", h:"INTERNET"}, {w:"WHATSAPP", h:"APP"},
    {w:"PEKETRULI", h:"FAMOSO"}, {w:"ABIDUR", h:"NIGGAS"}, {w:"PIOJO", h:"NIGGAS"},
    {w:"GOOGLE", h:"INTERNET"}, {w:"AMAZON", h:"TIENDA"}, {w:"NETFLIX", h:"APP"},
    {w:"IPHONE", h:"TECNOLOG√çA"}, {w:"SAMSUNG", h:"TECNOLOG√çA"}, {w:"WINDOWS", h:"TECNOLOG√çA"},
    {w:"PLAYSTATION", h:"JUEGOS"}, {w:"NINTENDO", h:"JUEGOS"}, {w:"MINECRAFT", h:"JUEGOS"},
    {w:"FORTNITE", h:"JUEGOS"}, {w:"FIFA", h:"DEPORTE"}, {w:"POKEMON", h:"ANIME/JUEGO"},
    {w:"HARRY POTTER", h:"CINE"}, {w:"STAR WARS", h:"CINE"}, {w:"AVENGERS", h:"CINE"},
    {w:"BATMAN", h:"CINE"}, {w:"SPIDERMAN", h:"CINE"}, {w:"JOKER", h:"CINE"},
    {w:"BARBIE", h:"JUGUETE"}, {w:"LEGO", h:"JUGUETE"}, {w:"IKEA", h:"TIENDA"},
    {w:"MCDONALDS", h:"COMIDA"}, {w:"COCA COLA", h:"BEBIDA"}, {w:"NIKE", h:"ROPA"},
    {w:"ADIDAS", h:"ROPA"}, {w:"ZARA", h:"ROPA"}, {w:"ROLEX", h:"ACCESORIO"},
    {w:"FERRARI", h:"VEH√çCULO"}, {w:"TESLA", h:"VEH√çCULO"}, {w:"CORONAVIRUS", h:"SALUD"},
    {w:"MESSI", h:"FAMOSO"}, {w:"CRISTIANO", h:"FAMOSO"}, {w:"SHAKIRA", h:"FAMOSA"},
    {w:"ELON MUSK", h:"FAMOSO"}, {w:"MRBEAST", h:"FAMOSO"}, {w:"IBAI", h:"FAMOSO"},
    {w:"NAVIDAD", h:"FIESTA"}, {w:"HALLOWEEN", h:"FIESTA"}, {w:"CARNAVAL", h:"FIESTA"},
    {w:"BODA", h:"EVENTO"}, {w:"CUMPLEA√ëOS", h:"EVENTO"}, {w:"EXAMEN", h:"ESTUDIOS"},
    {w:"VACACIONES", h:"OCIO"}, {w:"WIFI", h:"TECNOLOG√çA"}, {w:"ROBOT", h:"TECNOLOG√çA"},
    {w:"ZOMBIE", h:"MONSTRUO"}, {w:"VAMPIRO", h:"MONSTRUO"}, {w:"FANTASMA", h:"MONSTRUO"},
    {w:"DINERO", h:"ECONOM√çA"}, {w:"BITCOIN", h:"ECONOM√çA"}, {w:"ORO", h:"MATERIAL"},
    {w:"SOL", h:"NATURALEZA"}, {w:"LUNA", h:"NATURALEZA"}, {w:"LLUVIA", h:"CLIMA"},
    {w:"FUEGO", h:"ELEMENTO"}, {w:"AGUA", h:"ELEMENTO"}, {w:"PIZZA", h:"COMIDA"},
    {w:"SUSHI", h:"COMIDA"}, {w:"CHOCOLATE", h:"COMIDA"}, {w:"CERVEZA", h:"ALCOHOL"},
    {w:"VINO", h:"ALCOHOL"}, {w:"CAF√â", h:"BEBIDA"}, {w:"GUITARRA", h:"M√öSICA"},
    {w:"PIANO", h:"M√öSICA"}, {w:"F√öTBOL", h:"DEPORTE"}, {w:"BALONCESTO", h:"DEPORTE"},
    {w:"TENIS", h:"DEPORTE"}, {w:"LIBRO", h:"CULTURA"}, {w:"PINTURA", h:"ARTE"},
    {w:"CAMA", h:"MUEBLE"}, {w:"SILLA", h:"MUEBLE"}, {w:"RELOJ", h:"OBJETO"},
    {w:"ESPEJO", h:"OBJETO"}, {w:"LLAVE", h:"OBJETO"}, {w:"MOCHILA", h:"OBJETO"},
    {w:"INSTAGRAM", h:"INTERNET"}, {w:"TWITTER", h:"INTERNET"}, {w:"DISCORD", h:"APP"},
    {w:"SPOTIFY", h:"APP"}, {w:"YAHOO", h:"INTERNET"}, {w:"PAYPAL", h:"ECONOM√çA"},
    {w:"UBER", h:"APP"}, {w:"AIRBNB", h:"APP"}, {w:"ALIEXPRESS", h:"TIENDA"},
    {w:"SHEIN", h:"TIENDA"}, {w:"HBO", h:"APP"}, {w:"DISNEY+", h:"APP"},
    {w:"PS5", h:"JUEGOS"}, {w:"XBOX", h:"JUEGOS"}, {w:"STEAM", h:"JUEGOS"},
    {w:"TWITCH", h:"INTERNET"}, {w:"CHATGPT", h:"IA"}, {w:"INTELIGENCIA ARTIFICIAL", h:"TECNOLOG√çA"},
    {w:"DRON", h:"TECNOLOG√çA"}, {w:"IMPRESORA 3D", h:"TECNOLOG√çA"},
    {w:"YATE", h:"VEH√çCULO"}, {w:"HELIC√ìPTERO", h:"VEH√çCULO"},
    {w:"CRIPTO", h:"ECONOM√çA"}, {w:"NFT", h:"INTERNET"},
    {w:"APOCALIPSIS", h:"EVENTO"}, {w:"GUERRA", h:"EVENTO"},
    {w:"BODA REAL", h:"EVENTO"}, {w:"OLIMPIADAS", h:"EVENTO"},
    {w:"LE√ìN", h:"ANIMAL"}, {w:"TIBUR√ìN", h:"ANIMAL"}, {w:"√ÅGUILA", h:"ANIMAL"}, {w:"PING√úINO", h:"ANIMAL"},
    {w:"CANGURO", h:"ANIMAL"}, {w:"PANDA", h:"ANIMAL"}, {w:"PERRO", h:"ANIMAL"}, {w:"GATO", h:"ANIMAL"},
    {w:"HAMSTER", h:"ANIMAL"}, {w:"SERPIENTE", h:"ANIMAL"}, {w:"DINOSAURIO", h:"ANIMAL"}, {w:"MOSQUITO", h:"ANIMAL"},
    {w:"ARA√ëA", h:"ANIMAL"}, {w:"DELF√çN", h:"ANIMAL"}, {w:"BALLENA", h:"ANIMAL"}, {w:"JIRAFA", h:"ANIMAL"},
    {w:"ELEFANTE", h:"ANIMAL"}, {w:"COCODRILO", h:"ANIMAL"}, {w:"RANA", h:"ANIMAL"}, {w:"PATO", h:"ANIMAL"},
    {w:"VACA", h:"ANIMAL"}, {w:"CABALLO", h:"ANIMAL"}, {w:"LOBO", h:"ANIMAL"}, {w:"OSO", h:"ANIMAL"},
    {w:"MURCI√âLAGO", h:"ANIMAL"}, {w:"ABEJA", h:"ANIMAL"}, {w:"HORMIGA", h:"ANIMAL"}, {w:"PULPO", h:"ANIMAL"},
    {w:"CAMELLO", h:"ANIMAL"}, {w:"GORILA", h:"ANIMAL"}, {w:"ZEBRA", h:"ANIMAL"}, {w:"KOALA", h:"ANIMAL"},
    {w:"TORTUGA", h:"ANIMAL"}, {w:"CONEJO", h:"ANIMAL"}, {w:"LORO", h:"ANIMAL"}, {w:"PEZ PAYASO", h:"ANIMAL"},
    {w:"MEDUSA", h:"ANIMAL"}, {w:"CANGREJO", h:"ANIMAL"}, {w:"ESCORPI√ìN", h:"ANIMAL"}, {w:"B√öHO", h:"ANIMAL"},
    {w:"AVESTRUZ", h:"ANIMAL"}, {w:"HIPOP√ìTAMO", h:"ANIMAL"}, {w:"RINOCERONTE", h:"ANIMAL"}, {w:"GUSANO", h:"ANIMAL"},
    {w:"MARIPOSA", h:"ANIMAL"}, {w:"CARACOL", h:"ANIMAL"}, {w:"IGUANA", h:"ANIMAL"}, {w:"LLAMA", h:"ANIMAL"},
    {w:"ALCE", h:"ANIMAL"}, {w:"ZORRO", h:"ANIMAL"}, {w:"MAPACHE", h:"ANIMAL"}, {w:"ERIZO", h:"ANIMAL"},
    {w:"ORNITORRINCO", h:"ANIMAL"}, {w:"CAPIBARA", h:"ANIMAL"}, {w:"PEREZOSO", h:"ANIMAL"}, {w:"LEMUR", h:"ANIMAL"},
    {w:"MANTA RAYA", h:"ANIMAL"}, {w:"CALAMAR", h:"ANIMAL"}, {w:"ESTRELLA DE MAR", h:"ANIMAL"}, {w:"CABALLITO DE MAR", h:"ANIMAL"},
    {w:"TIGRE", h:"ANIMAL"}, {w:"PANTERA", h:"ANIMAL"}, {w:"JAGUAR", h:"ANIMAL"}, {w:"HIENA", h:"ANIMAL"},
    {w:"BUITRE", h:"ANIMAL"}, {w:"FLAMENCO", h:"ANIMAL"}, {w:"CISNE", h:"ANIMAL"}, {w:"PAVO REAL", h:"ANIMAL"},
    {w:"TOPO", h:"ANIMAL"}, {w:"RATA", h:"ANIMAL"}, {w:"RAT√ìN", h:"ANIMAL"}, {w:"ARDILLA", h:"ANIMAL"},
    {w:"CASTOR", h:"ANIMAL"}, {w:"NUTRIA", h:"ANIMAL"}, {w:"FOCA", h:"ANIMAL"}, {w:"MORSA", h:"ANIMAL"},
    {w:"GAVIOTA", h:"ANIMAL"}, {w:"PEL√çCANO", h:"ANIMAL"}, {w:"COLIBR√ç", h:"ANIMAL"}, {w:"CUCARACHA", h:"ANIMAL"},
    {w:"GRILLO", h:"ANIMAL"}, {w:"SALTAMONTES", h:"ANIMAL"}, {w:"LIB√âLULA", h:"ANIMAL"}, {w:"ESCARABAJO", h:"ANIMAL"},
    {w:"ANACONDA", h:"ANIMAL"}, {w:"COBRA", h:"ANIMAL"}, {w:"PUMA", h:"ANIMAL"}, {w:"LINCE", h:"ANIMAL"},
    {w:"CHIMPANC√â", h:"ANIMAL"}, {w:"ORANGUT√ÅN", h:"ANIMAL"}, {w:"MANDRIL", h:"ANIMAL"},
    {w:"ANT√çLOPE", h:"ANIMAL"}, {w:"√ëU", h:"ANIMAL"}, {w:"BISONTE", h:"ANIMAL"},
    {w:"HALC√ìN", h:"ANIMAL"}, {w:"CUERVO", h:"ANIMAL"}, {w:"URRACA", h:"ANIMAL"},
    {w:"TUC√ÅN", h:"ANIMAL"}, {w:"PIRANHA", h:"ANIMAL"}, {w:"ANGUILA", h:"ANIMAL"},
    {w:"MANTIS RELIGIOSA", h:"ANIMAL"}, {w:"CIEMPI√âS", h:"ANIMAL"},
    {w:"MILPI√âS", h:"ANIMAL"}, {w:"SALAMANDRA", h:"ANIMAL"},
    {w:"PIZZA", h:"COMIDA"}, {w:"SUSHI", h:"COMIDA"}, {w:"TACO", h:"COMIDA"}, {w:"PAELLA", h:"COMIDA"},
    {w:"HAMBURGUESA", h:"COMIDA"}, {w:"CHOCOLATE", h:"COMIDA"}, {w:"HELADO", h:"POSTRE"}, {w:"HUEVO", h:"COMIDA"},
    {w:"PAN", h:"COMIDA"}, {w:"QUESO", h:"COMIDA"}, {w:"CAF√â", h:"BEBIDA"}, {w:"CERVEZA", h:"BEBIDA"},
    {w:"PALOMITAS", h:"SNACK"}, {w:"ESPAGUETIS", h:"COMIDA"}, {w:"ENSALADA", h:"COMIDA"}, {w:"PATATAS FRITAS", h:"COMIDA"},
    {w:"KEBAB", h:"COMIDA"}, {w:"TORTILLA", h:"COMIDA"}, {w:"JAM√ìN", h:"COMIDA"}, {w:"MANZANA", h:"FRUTA"},
    {w:"PL√ÅTANO", h:"FRUTA"}, {w:"SAND√çA", h:"FRUTA"}, {w:"UVAS", h:"FRUTA"}, {w:"CROQUETAS", h:"COMIDA"},
    {w:"SOPA", h:"COMIDA"}, {w:"ARROZ", h:"COMIDA"}, {w:"POLLO", h:"COMIDA"}, {w:"FILETE", h:"COMIDA"},
    {w:"GALLETA", h:"POSTRE"}, {w:"LECHE", h:"BEBIDA"}, {w:"AGUA", h:"BEBIDA"}, {w:"VINO", h:"BEBIDA"},
    {w:"REFRESCO", h:"BEBIDA"}, {w:"ZUMO", h:"BEBIDA"}, {w:"T√â", h:"BEBIDA"}, {w:"YOGUR", h:"POSTRE"},
    {w:"MIEL", h:"COMIDA"}, {w:"AZ√öCAR", h:"INGREDIENTE"}, {w:"SAL", h:"INGREDIENTE"}, {w:"PIMIENTA", h:"INGREDIENTE"},
    {w:"KETCHUP", h:"SALSA"}, {w:"MAYONESA", h:"SALSA"}, {w:"MOSTAZA", h:"SALSA"}, {w:"LIM√ìN", h:"FRUTA"},
    {w:"FRESA", h:"FRUTA"}, {w:"CEREZA", h:"FRUTA"}, {w:"PI√ëA", h:"FRUTA"}, {w:"COCO", h:"FRUTA"},
    {w:"AGUACATE", h:"FRUTA"}, {w:"TOMATE", h:"VERDURA"}, {w:"CEBOLLA", h:"VERDURA"}, {w:"AJO", h:"VERDURA"},
    {w:"ZANAHORIA", h:"VERDURA"}, {w:"PEPINO", h:"VERDURA"}, {w:"BR√ìCOLI", h:"VERDURA"}, {w:"COLIFLOR", h:"VERDURA"},
    {w:"LECHUGA", h:"VERDURA"}, {w:"CHAMPI√ë√ìN", h:"VERDURA"}, {w:"PIMIENTO", h:"VERDURA"}, {w:"CALABAZA", h:"VERDURA"},
    {w:"MEL√ìN", h:"FRUTA"}, {w:"MELOCOT√ìN", h:"FRUTA"}, {w:"PERA", h:"FRUTA"}, {w:"KIWI", h:"FRUTA"},
    {w:"MANGO", h:"FRUTA"}, {w:"FRAMBUESA", h:"FRUTA"}, {w:"AR√ÅNDANO", h:"FRUTA"}, {w:"NUECES", h:"FRUTO SECO"},
    {w:"ALMENDRAS", h:"FRUTO SECO"}, {w:"CACAHUETES", h:"FRUTO SECO"}, {w:"PISTACHOS", h:"FRUTO SECO"}, {w:"AVELLANAS", h:"FRUTO SECO"},
    {w:"CHURROS", h:"POSTRE"}, {w:"DONUT", h:"POSTRE"}, {w:"CROISSANT", h:"POSTRE"}, {w:"MAGDALENA", h:"POSTRE"},
    {w:"TARTA", h:"POSTRE"}, {w:"FLAN", h:"POSTRE"}, {w:"GELATINA", h:"POSTRE"}, {w:"TURR√ìN", h:"POSTRE"},
    {w:"BOCADILLO", h:"COMIDA"}, {w:"S√ÅNDWICH", h:"COMIDA"}, {w:"EMPANADA", h:"COMIDA"}, {w:"NACHOS", h:"SNACK"},
    {w:"BURRITO", h:"COMIDA"}, {w:"LASA√ëA", h:"COMIDA"}, {w:"RAVIOLIS", h:"COMIDA"}, {w:"FIDEU√Å", h:"COMIDA"},
    {w:"RAMEN", h:"COMIDA"}, {w:"CURRY", h:"COMIDA"}, {w:"GUACAMOLE", h:"COMIDA"},
    {w:"HUMMUS", h:"COMIDA"}, {w:"FALAFEL", h:"COMIDA"}, {w:"COUS COUS", h:"COMIDA"},
    {w:"RISOTTO", h:"COMIDA"}, {w:"GNOCCHI", h:"COMIDA"}, {w:"PIZZA CALZONE", h:"COMIDA"},
    {w:"HOT DOG", h:"COMIDA"}, {w:"AREPA", h:"COMIDA"}, {w:"EMPANADILLA", h:"COMIDA"},
    {w:"TAMAL", h:"COMIDA"}, {w:"MOUSSE", h:"POSTRE"}, {w:"BROWNIE", h:"POSTRE"},
    {w:"CHEESECAKE", h:"POSTRE"}, {w:"PANCAKE", h:"POSTRE"},
    {w:"SMOOTHIE", h:"BEBIDA"}, {w:"BATIDO", h:"BEBIDA"},
    {w:"PLAYA", h:"LUGAR"}, {w:"MONTA√ëA", h:"LUGAR"}, {w:"CINE", h:"LUGAR"}, {w:"HOSPITAL", h:"LUGAR"},
    {w:"ESCUELA", h:"LUGAR"}, {w:"C√ÅRCEL", h:"LUGAR"}, {w:"CEMENTERIO", h:"LUGAR"}, {w:"GIMNASIO", h:"LUGAR"},
    {w:"BIBLIOTECA", h:"LUGAR"}, {w:"DISCOTECA", h:"LUGAR"}, {w:"AEROPUERTO", h:"LUGAR"}, {w:"BA√ëO", h:"LUGAR"},
    {w:"COCINA", h:"LUGAR"}, {w:"LUNA", h:"ASTRO"}, {w:"MARTE", h:"ASTRO"}, {w:"PAR√çS", h:"CIUDAD"},
    {w:"LONDRES", h:"CIUDAD"}, {w:"NUEVA YORK", h:"CIUDAD"}, {w:"TOKIO", h:"CIUDAD"}, {w:"EGIPTO", h:"PA√çS"},
    {w:"MADRID", h:"CIUDAD"}, {w:"ZOO", h:"LUGAR"}, {w:"CIRCO", h:"LUGAR"}, {w:"HOTEL", h:"LUGAR"},
    {w:"IGLESIA", h:"LUGAR"}, {w:"SUPERMERCADO", h:"LUGAR"}, {w:"BOSQUE", h:"LUGAR"}, {w:"ISLA", h:"LUGAR"},
    {w:"VOLC√ÅN", h:"NATURALEZA"}, {w:"PISCINA", h:"LUGAR"}, {w:"ESTADIO", h:"LUGAR"}, {w:"TEATRO", h:"LUGAR"},
    {w:"MUSEO", h:"LUGAR"}, {w:"PARQUE", h:"LUGAR"}, {w:"FARMACIA", h:"LUGAR"}, {w:"GASOLINERA", h:"LUGAR"},
    {w:"BANCO", h:"LUGAR"}, {w:"RESTAURANTE", h:"LUGAR"}, {w:"OFICINA", h:"LUGAR"}, {w:"F√ÅBRICA", h:"LUGAR"},
    {w:"CASTILLO", h:"LUGAR"}, {w:"CUEVA", h:"LUGAR"}, {w:"DESIERTO", h:"LUGAR"}, {w:"SELVA", h:"LUGAR"},
    {w:"POLO NORTE", h:"LUGAR"}, {w:"ESPACIO", h:"LUGAR"}, {w:"CIELO", h:"NATURALEZA"}, {w:"INFIERNO", h:"MITOLOG√çA"},
    {w:"UNIVERSIDAD", h:"LUGAR"}, {w:"GUARDER√çA", h:"LUGAR"}, {w:"PELUQUER√çA", h:"LUGAR"}, {w:"TALLER", h:"LUGAR"},
    {w:"COMISAR√çA", h:"LUGAR"}, {w:"BOMBEROS", h:"LUGAR"}, {w:"PUERTO", h:"LUGAR"}, {w:"FARO", h:"LUGAR"},
    {w:"GRANJA", h:"LUGAR"}, {w:"PUEBLO", h:"LUGAR"}, {w:"CIUDAD", h:"LUGAR"}, {w:"CALLE", h:"LUGAR"},
    {w:"CARRETERA", h:"INFRAESTRUCTURA"}, {w:"PUENTE", h:"INFRAESTRUCTURA"}, {w:"T√öNEL", h:"INFRAESTRUCTURA"}, {w:"ASCENSOR", h:"OBJETO"},
    {w:"ESCALERAS", h:"OBJETO"}, {w:"BALC√ìN", h:"CASA"}, {w:"JARD√çN", h:"CASA"}, {w:"S√ìTANO", h:"CASA"},
    {w:"√ÅTICO", h:"CASA"}, {w:"GARAJE", h:"CASA"}, {w:"SAL√ìN", h:"CASA"}, {w:"HABITACI√ìN", h:"CASA"},
    {w:"ROMA", h:"CIUDAD"}, {w:"CHINA", h:"PA√çS"}, {w:"M√âXICO", h:"PA√çS"}, {w:"ARGENTINA", h:"PA√çS"},
    {w:"BRASIL", h:"PA√çS"}, {w:"ALEMANIA", h:"PA√çS"}, {w:"AUSTRALIA", h:"PA√çS"}, {w:"ANT√ÅRTIDA", h:"CONTINENTE"},
    {w:"RELOJ", h:"OBJETO"}, {w:"ESPEJO", h:"OBJETO"}, {w:"LLAVE", h:"OBJETO"}, {w:"PARAGUAS", h:"OBJETO"},
    {w:"GAFAS", h:"ACCESORIO"}, {w:"MOCHILA", h:"OBJETO"}, {w:"PAPEL", h:"MATERIAL"}, {w:"SART√âN", h:"COCINA"},
    {w:"GUITARRA", h:"M√öSICA"}, {w:"PIANO", h:"M√öSICA"}, {w:"CAMA", h:"MUEBLE"}, {w:"SILLA", h:"MUEBLE"},
    {w:"ORDENADOR", h:"TECNOLOG√çA"}, {w:"COCHE", h:"VEH√çCULO"}, {w:"AVI√ìN", h:"VEH√çCULO"}, {w:"MANDO", h:"TECNOLOG√çA"},
    {w:"ZAPATOS", h:"ROPA"}, {w:"MASCARILLA", h:"SALUD"}, {w:"LIBRO", h:"CULTURA"}, {w:"L√ÅPIZ", h:"PAPELER√çA"},
    {w:"TIJERAS", h:"PAPELER√çA"}, {w:"CUCHILLO", h:"COCINA"}, {w:"TENEDOR", h:"COCINA"}, {w:"LAVADORA", h:"ELECTRODOM√âSTICO"},
    {w:"NEVERA", h:"ELECTRODOM√âSTICO"}, {w:"MICROONDAS", h:"ELECTRODOM√âSTICO"}, {w:"TELEVISI√ìN", h:"ELECTRODOM√âSTICO"}, {w:"BICICLETA", h:"VEH√çCULO"},
    {w:"MOTO", h:"VEH√çCULO"}, {w:"ANILLO", h:"JOYA"}, {w:"MESA", h:"MUEBLE"}, {w:"SOF√Å", h:"MUEBLE"},
    {w:"L√ÅMPARA", h:"OBJETO"}, {w:"ALFOMBRA", h:"DECORACI√ìN"}, {w:"CUADRO", h:"ARTE"}, {w:"JUGUETE", h:"JUGUETE"},
    {w:"PELOTA", h:"JUGUETE"}, {w:"MU√ëECA", h:"JUGUETE"}, {w:"CUNA", h:"MUEBLE"}, {w:"PA√ëAL", h:"BEB√â"},
    {w:"BIBER√ìN", h:"BEB√â"}, {w:"CHUPETE", h:"BEB√â"}, {w:"ESCOBA", h:"LIMPIEZA"}, {w:"FREGONA", h:"LIMPIEZA"},
    {w:"CUBO", h:"LIMPIEZA"}, {w:"ESPONJA", h:"HIGIENE"}, {w:"TOALLA", h:"HIGIENE"}, {w:"JAB√ìN", h:"HIGIENE"},
    {w:"CHAMP√ö", h:"HIGIENE"}, {w:"PEINE", h:"HIGIENE"}, {w:"CEPILLO", h:"HIGIENE"}, {w:"PASTA DENTAL", h:"HIGIENE"},
    {w:"HILO DENTAL", h:"HIGIENE"}, {w:"DESODORANTE", h:"HIGIENE"}, {w:"PERFUME", h:"HIGIENE"}, {w:"MAQUILLAJE", h:"BELLEZA"},
    {w:"PINTALABIOS", h:"BELLEZA"}, {w:"ESMALTE", h:"BELLEZA"}, {w:"SECADOR", h:"ELECTRODOM√âSTICO"}, {w:"PLANCHA", h:"ELECTRODOM√âSTICO"},
    {w:"ASPIRADORA", h:"ELECTRODOM√âSTICO"}, {w:"VENTILADOR", h:"CLIMATIZACI√ìN"}, {w:"AIRE ACONDICIONADO", h:"CLIMATIZACI√ìN"}, {w:"RADIADOR", h:"CLIMATIZACI√ìN"},
    {w:"ESTUFA", h:"CLIMATIZACI√ìN"}, {w:"HORNO", h:"ELECTRODOM√âSTICO"}, {w:"TOSTADORA", h:"ELECTRODOM√âSTICO"}, {w:"BATIDORA", h:"ELECTRODOM√âSTICO"},
    {w:"CAFETERA", h:"ELECTRODOM√âSTICO"}, {w:"OLLA", h:"COCINA"}, {w:"CAZUELA", h:"COCINA"}, {w:"PLATO", h:"COCINA"},
    {w:"VASO", h:"COCINA"}, {w:"TAZA", h:"COCINA"}, {w:"COPA", h:"COCINA"}, {w:"BOTELLA", h:"COCINA"},
    {w:"LATA", h:"ENVASE"}, {w:"ABRELATAS", h:"COCINA"}, {w:"SACACORCHOS", h:"COCINA"}, {w:"MECHERO", h:"OBJETO"},
    {w:"CERILLAS", h:"OBJETO"}, {w:"VELA", h:"DECORACI√ìN"}, {w:"INCIENSO", h:"AROMA"}, {w:"JARR√ìN", h:"DECORACI√ìN"},
    {w:"MACETA", h:"JARD√çN"}, {w:"REGADERA", h:"JARD√çN"}, {w:"MANGUERA", h:"JARD√çN"}, {w:"RASTRILLO", h:"HERRAMIENTA"},
    {w:"PALA", h:"HERRAMIENTA"}, {w:"MARTILLO", h:"HERRAMIENTA"}, {w:"DESTORNILLADOR", h:"HERRAMIENTA"}, {w:"TALADRO", h:"HERRAMIENTA"},
    {w:"M√âDICO", h:"PROFESI√ìN"}, {w:"POLIC√çA", h:"PROFESI√ìN"}, {w:"BOMBERO", h:"PROFESI√ìN"}, {w:"PROFESOR", h:"PROFESI√ìN"},
    {w:"ASTRONAUTA", h:"PROFESI√ìN"}, {w:"PAYASO", h:"PROFESI√ìN"}, {w:"MAGO", h:"PROFESI√ìN"}, {w:"COCINERO", h:"PROFESI√ìN"},
    {w:"YOUTUBER", h:"PROFESI√ìN"}, {w:"FUTBOLISTA", h:"PROFESI√ìN"}, {w:"PRESIDENTE", h:"PROFESI√ìN"}, {w:"DETECTIVE", h:"PROFESI√ìN"},
    {w:"LADR√ìN", h:"PROFESI√ìN"}, {w:"JUEZ", h:"PROFESI√ìN"}, {w:"PILOTO", h:"PROFESI√ìN"}, {w:"PIRATA", h:"PERSONAJE"},
    {w:"NINJA", h:"PERSONAJE"}, {w:"VAMPIRO", h:"MONSTRUO"}, {w:"ZOMBIE", h:"MONSTRUO"}, {w:"FANTASMA", h:"MONSTRUO"},
    {w:"REY", h:"T√çTULO"}, {w:"SOLDADO", h:"PROFESI√ìN"}, {w:"GRANJERO", h:"PROFESI√ìN"}, {w:"MEC√ÅNICO", h:"PROFESI√ìN"},
    {w:"PELUQUERO", h:"PROFESI√ìN"}, {w:"DENTISTA", h:"PROFESI√ìN"}, {w:"CAMARERO", h:"PROFESI√ìN"}, {w:"ALBA√ëIL", h:"PROFESI√ìN"},
    {w:"FONTANERO", h:"PROFESI√ìN"}, {w:"ELECTRICISTA", h:"PROFESI√ìN"}, {w:"PINTOR", h:"PROFESI√ìN"}, {w:"ESCRITOR", h:"PROFESI√ìN"},
    {w:"CANTANTE", h:"PROFESI√ìN"}, {w:"ACTOR", h:"PROFESI√ìN"}, {w:"MODELO", h:"PROFESI√ìN"}, {w:"CIENT√çFICO", h:"PROFESI√ìN"},
    {w:"VETERINARIO", h:"PROFESI√ìN"}, {w:"ABOGADO", h:"PROFESI√ìN"}, {w:"CURA", h:"RELIGI√ìN"}, {w:"MONJA", h:"RELIGI√ìN"},
    {w:"TAXISTA", h:"PROFESI√ìN"}, {w:"CONDUCTOR", h:"PROFESI√ìN"}, {w:"CARTERO", h:"PROFESI√ìN"}, {w:"JARDINERO", h:"PROFESI√ìN"},
    {w:"PESCADOR", h:"PROFESI√ìN"}, {w:"MINERO", h:"PROFESI√ìN"}, {w:"ARQUE√ìLOGO", h:"PROFESI√ìN"}, {w:"ESPIA", h:"PROFESI√ìN"},
    {w:"ENFERMERO", h:"PROFESI√ìN"}, {w:"FARMAC√âUTICO", h:"PROFESI√ìN"}, {w:"PSIC√ìLOGO", h:"PROFESI√ìN"}, {w:"ARQUITECTO", h:"PROFESI√ìN"},
    {w:"INGENIERO", h:"PROFESI√ìN"}, {w:"PROGRAMADOR", h:"PROFESI√ìN"}, {w:"DISE√ëADOR", h:"PROFESI√ìN"}, {w:"PERIODISTA", h:"PROFESI√ìN"},
    {w:"FOT√ìGRAFO", h:"PROFESI√ìN"}, {w:"M√öSICO", h:"PROFESI√ìN"}, {w:"BAILAR√çN", h:"PROFESI√ìN"}, {w:"DEPORTISTA", h:"PROFESI√ìN"},
    {w:"ENTRENADOR", h:"PROFESI√ìN"}, {w:"√ÅRBITRO", h:"PROFESI√ìN"}, {w:"GUARDAESPALDAS", h:"PROFESI√ìN"}, {w:"PORTERO", h:"PROFESI√ìN"},
    {w:"AZAFATA", h:"PROFESI√ìN"}, {w:"CAPIT√ÅN", h:"PROFESI√ìN"}, {w:"MARINERO", h:"PROFESI√ìN"}, {w:"CARNICERO", h:"PROFESI√ìN"},
    {w:"PESCADERO", h:"PROFESI√ìN"}, {w:"FRUTERO", h:"PROFESI√ìN"}, {w:"PANADERO", h:"PROFESI√ìN"}, {w:"PASTELERO", h:"PROFESI√ìN"},
    {w:"CAJERO", h:"PROFESI√ìN"}, {w:"LIMPIADOR", h:"PROFESI√ìN"}, {w:"BASURERO", h:"PROFESI√ìN"}, {w:"BUTANERO", h:"PROFESI√ìN"},
    {w:"REPARTIDOR", h:"PROFESI√ìN"}, {w:"TAXISTA", h:"PROFESI√ìN"}, {w:"CAMIONERO", h:"PROFESI√ìN"}, {w:"ASTR√ìLOGO", h:"PROFESI√ìN"},
    {w:"BATMAN", h:"SUPERH√âROE"}, {w:"SPIDERMAN", h:"SUPERH√âROE"}, {w:"SUPERMAN", h:"SUPERH√âROE"}, {w:"JOKER", h:"VILLANO"},
    {w:"THANOS", h:"VILLANO"}, {w:"GOKU", h:"ANIME"}, {w:"NARUTO", h:"ANIME"}, {w:"PIKACHU", h:"POKEMON"},
    {w:"MARIO", h:"VIDEOJUEGO"}, {w:"SONIC", h:"VIDEOJUEGO"}, {w:"DARTH VADER", h:"CINE"}, {w:"YODA", h:"CINE"},
    {w:"HOMER SIMPSON", h:"SERIE"}, {w:"BOB ESPONJA", h:"DIBUJOS"}, {w:"MICKEY MOUSE", h:"DIBUJOS"}, {w:"ELSA", h:"CINE"},
    {w:"SHREK", h:"CINE"}, {w:"BARBIE", h:"JUGUETE"}, {w:"IRON MAN", h:"SUPERH√âROE"}, {w:"CAPIT√ÅN AM√âRICA", h:"SUPERH√âROE"},
    {w:"THOR", h:"SUPERH√âROE"}, {w:"HULK", h:"SUPERH√âROE"}, {w:"WONDER WOMAN", h:"SUPERH√âROE"}, {w:"DEADPOOL", h:"SUPERH√âROE"},
    {w:"LUFFY", h:"ANIME"}, {w:"ZORO", h:"ANIME"}, {w:"SAILOR MOON", h:"ANIME"}, {w:"TOTORO", h:"ANIME"},
    {w:"GODZILLA", h:"CINE"}, {w:"KING KONG", h:"CINE"}, {w:"TERMINATOR", h:"CINE"}, {w:"ROBOCOP", h:"CINE"},
    {w:"ALIEN", h:"CINE"}, {w:"PREDATOR", h:"CINE"}, {w:"MATRIX", h:"CINE"}, {w:"TITANIC", h:"CINE"},
    {w:"AVATAR", h:"CINE"}, {w:"JURASSIC PARK", h:"CINE"}, {w:"FROZEN", h:"CINE"}, {w:"TOY STORY", h:"CINE"},
    {w:"CARS", h:"CINE"}, {w:"NEMO", h:"CINE"}, {w:"MINIONS", h:"CINE"}, {w:"GRU", h:"CINE"},
    {w:"VOLDEMORT", h:"CINE"}, {w:"DOBBY", h:"CINE"}, {w:"GANDALF", h:"CINE"}, {w:"FRODO", h:"CINE"},
    {w:"GOLLUM", h:"CINE"}, {w:"LEGOLAS", h:"CINE"}, {w:"JON SNOW", h:"SERIE"}, {w:"DAENERYS", h:"SERIE"},
    {w:"WALTER WHITE", h:"SERIE"}, {w:"SQUID GAME", h:"SERIE"}, {w:"STRANGER THINGS", h:"SERIE"}, {w:"WEDNESDAY", h:"SERIE"},
    {w:"MANDALORIAN", h:"SERIE"}, {w:"BABY YODA", h:"SERIE"}, {w:"LUIGI", h:"VIDEOJUEGO"}, {w:"BOWSER", h:"VIDEOJUEGO"},
    {w:"PEACH", h:"VIDEOJUEGO"}, {w:"ZELDA", h:"VIDEOJUEGO"}, {w:"LINK", h:"VIDEOJUEGO"}, {w:"KIRBY", h:"VIDEOJUEGO"},
    {w:"DONKEY KONG", h:"VIDEOJUEGO"}, {w:"PACMAN", h:"VIDEOJUEGO"}, {w:"TETRIS", h:"VIDEOJUEGO"}, {w:"AMONG US", h:"VIDEOJUEGO"},
    {w:"CREEPER", h:"VIDEOJUEGO"}, {w:"ENDRMAN", h:"VIDEOJUEGO"}, {w:"STEVE", h:"VIDEOJUEGO"}, {w:"HEROBRINE", h:"VIDEOJUEGO"},
    {w:"KRATOS", h:"VIDEOJUEGO"}, {w:"MASTER CHIEF", h:"VIDEOJUEGO"}, {w:"LARA CROFT", h:"VIDEOJUEGO"}, {w:"CRASH BANDICOOT", h:"VIDEOJUEGO"},
    {w:"F√öTBOL", h:"DEPORTE"}, {w:"BALONCESTO", h:"DEPORTE"}, {w:"TENIS", h:"DEPORTE"}, {w:"NATACI√ìN", h:"DEPORTE"},
    {w:"AJEDREZ", h:"JUEGO"}, {w:"BOXEO", h:"DEPORTE"}, {w:"BAILE", h:"ACTIVIDAD"}, {w:"PINTURA", h:"ARTE"},
    {w:"LECTURA", h:"HOBBY"}, {w:"YOGA", h:"EJERCICIO"}, {w:"PESCA", h:"HOBBY"}, {w:"SKATE", h:"DEPORTE"},
    {w:"ESQU√ç", h:"DEPORTE"}, {w:"SURF", h:"DEPORTE"}, {w:"GOLF", h:"DEPORTE"}, {w:"KARATE", h:"DEPORTE"},
    {w:"VIDEOJUEGOS", h:"HOBBY"}, {w:"FOTOGRAF√çA", h:"HOBBY"}, {w:"CAMPING", h:"ACTIVIDAD"}, {w:"POKER", h:"JUEGO"},
    {w:"RUGBY", h:"DEPORTE"}, {w:"BEISBOL", h:"DEPORTE"}, {w:"VOLEIBOL", h:"DEPORTE"}, {w:"ATLETISMO", h:"DEPORTE"},
    {w:"CICLISMO", h:"DEPORTE"}, {w:"FORMULA 1", h:"DEPORTE"}, {w:"MOTOGP", h:"DEPORTE"}, {w:"ESCALADA", h:"DEPORTE"},
    {w:"BUCEO", h:"DEPORTE"}, {w:"PARACAIDAS", h:"EXTREMO"}, {w:"SENDERISMO", h:"ACTIVIDAD"}, {w:"GIMNASIA", h:"DEPORTE"},
    {w:"JUDO", h:"DEPORTE"}, {w:"TAEKWONDO", h:"DEPORTE"}, {w:"LUCHA LIBRE", h:"DEPORTE"}, {w:"ESGRIMA", h:"DEPORTE"},
    {w:"TIRO CON ARCO", h:"DEPORTE"}, {w:"PING PONG", h:"DEPORTE"}, {w:"BADMINTON", h:"DEPORTE"}, {w:"PADEL", h:"DEPORTE"},
    {w:"WATERPOLO", h:"DEPORTE"}, {w:"REMO", h:"DEPORTE"}, {w:"VELA", h:"DEPORTE"}, {w:"KAYAK", h:"DEPORTE"},
    {w:"RAFTING", h:"EXTREMO"}, {w:"PARAPENTE", h:"EXTREMO"}, {w:"PUENTING", h:"EXTREMO"}, {w:"PATINAJE", h:"DEPORTE"},
    {w:"HOCKEY", h:"DEPORTE"}, {w:"CURLING", h:"DEPORTE"}, {w:"BALONMANO", h:"DEPORTE"}, {w:"F√öTBOL AMERICANO", h:"DEPORTE"},
    {w:"CRICKET", h:"DEPORTE"}, {w:"BILLAR", h:"JUEGO"}, {w:"BOLOS", h:"JUEGO"}, {w:"DARDOS", h:"JUEGO"},
    {w:"JARDINER√çA", h:"HOBBY"}, {w:"COCINA", h:"HOBBY"}, {w:"COSTURA", h:"HOBBY"}, {w:"TEJER", h:"HOBBY"},
    {w:"CER√ÅMICA", h:"ARTE"}, {w:"ORIGAMI", h:"ARTE"}, {w:"MAGIA", h:"ESPECT√ÅCULO"}, {w:"ASTRONOM√çA", h:"CIENCIA"},
    {w:"PIR√ÅMIDE", h:"MONUMENTO"}, {w:"COLISEO", h:"MONUMENTO"}, {w:"MURALLA CHINA", h:"MONUMENTO"}, {w:"TORRE EIFFEL", h:"MONUMENTO"},
    {w:"ESTATUA LIBERTAD", h:"MONUMENTO"}, {w:"TAJ MAHAL", h:"MONUMENTO"}, {w:"MACHU PICCHU", h:"MONUMENTO"}, {w:"CRISTOBAL COL√ìN", h:"HISTORIA"},
    {w:"NAPOLE√ìN", h:"HISTORIA"}, {w:"CLEOPATRA", h:"HISTORIA"}, {w:"JULIO C√âSAR", h:"HISTORIA"}, {w:"EINSTEIN", h:"HISTORIA"},
    {w:"DA VINCI", h:"ARTE/CIENCIA"}, {w:"MOZART", h:"M√öSICA"}, {w:"BEETHOVEN", h:"M√öSICA"}, {w:"HITLER", h:"HISTORIA"},
    {w:"GANDHI", h:"HISTORIA"}, {w:"MANDELA", h:"HISTORIA"}, {w:"JESUCRISTO", h:"RELIGI√ìN"}, {w:"BUDA", h:"RELIGI√ìN"},
    {w:"VIKINGO", h:"HISTORIA"}, {w:"SAMURAI", h:"HISTORIA"}, {w:"CABALLERO", h:"HISTORIA"}, {w:"MOMIA", h:"MONSTRUO"},
    {w:"GLADIADOR", h:"HISTORIA"}, {w:"FARA√ìN", h:"HISTORIA"}, {w:"EMPERADOR", h:"T√çTULO"}, {w:"DICTADOR", h:"POL√çTICA"},
    {w:"REINA ISABEL", h:"REALEZA"}, {w:"LADY DI", h:"REALEZA"}, {w:"KENNEDY", h:"HISTORIA"}, {w:"LINCOLN", h:"HISTORIA"},
    {w:"CHE GUEVARA", h:"HISTORIA"}, {w:"FIDEL CASTRO", h:"HISTORIA"}, {w:"MAO", h:"HISTORIA"}, {w:"LENIN", h:"HISTORIA"},
    {w:"STALIN", h:"HISTORIA"}, {w:"CHURCHILL", h:"HISTORIA"}, {w:"ARMSTRONG", h:"HISTORIA"}, {w:"GAGARIN", h:"HISTORIA"},
    {w:"NEWTON", h:"CIENCIA"}, {w:"DARWIN", h:"CIENCIA"}, {w:"GALILEO", h:"CIENCIA"}, {w:"TESLA", h:"CIENCIA"},
    {w:"EDISON", h:"CIENCIA"}, {w:"BELL", h:"CIENCIA"}, {w:"CURIE", h:"CIENCIA"}, {w:"PICASSO", h:"ARTE"},
    {w:"DAL√ç", h:"ARTE"}, {w:"VAN GOGH", h:"ARTE"}, {w:"SHAKESPEARE", h:"LITERATURA"}, {w:"CERVANTES", h:"LITERATURA"},
    {w:"ELVIS", h:"M√öSICA"}, {w:"MICHAEL JACKSON", h:"M√öSICA"}, {w:"MARILYN MONROE", h:"CINE"}, {w:"CHAPLIN", h:"CINE"},
    {w:"WALT DISNEY", h:"CINE"}, {w:"STEVE JOBS", h:"TECNOLOG√çA"}, {w:"BILL GATES", h:"TECNOLOG√çA"}, {w:"ZUCKERBERG", h:"TECNOLOG√çA"},
    {w:"SOL", h:"ASTRO"}, {w:"TIERRA", h:"ASTRO"}, {w:"LLUVIA", h:"CLIMA"}, {w:"NIEVE", h:"CLIMA"},
    {w:"FUEGO", h:"ELEMENTO"}, {w:"VIENTO", h:"CLIMA"}, {w:"ARCO√çRIS", h:"CLIMA"}, {w:"TERREMOTO", h:"DESASTRE"},
    {w:"TSUNAMI", h:"DESASTRE"}, {w:"CEREBRO", h:"CUERPO"}, {w:"CORAZ√ìN", h:"CUERPO"}, {w:"HUESO", h:"CUERPO"},
    {w:"SANGRE", h:"CUERPO"}, {w:"ADN", h:"BIOLOG√çA"}, {w:"ROBOT", h:"TECNOLOG√çA"}, {w:"COHETE", h:"VEH√çCULO"},
    {w:"√ÅTOMO", h:"CIENCIA"}, {w:"GRAVEDAD", h:"F√çSICA"}, {w:"OX√çGENO", h:"ELEMENTO"}, {w:"ORO", h:"MATERIAL"},
    {w:"PLATA", h:"MATERIAL"}, {w:"BRONCE", h:"MATERIAL"}, {w:"HIERRO", h:"MATERIAL"}, {w:"ALUMINIO", h:"MATERIAL"},
    {w:"PL√ÅSTICO", h:"MATERIAL"}, {w:"VIDRIO", h:"MATERIAL"}, {w:"MADERA", h:"MATERIAL"}, {w:"PIEDRA", h:"MATERIAL"},
    {w:"ARENA", h:"MATERIAL"}, {w:"BARRO", h:"MATERIAL"}, {w:"NUBE", h:"CLIMA"}, {w:"TRUENO", h:"CLIMA"},
    {w:"RAYO", h:"CLIMA"}, {w:"HURAC√ÅN", h:"CLIMA"}, {w:"TORNADO", h:"CLIMA"}, {w:"INUNDACI√ìN", h:"DESASTRE"},
    {w:"SEQU√çA", h:"CLIMA"}, {w:"AVALANCHA", h:"DESASTRE"}, {w:"METEORITO", h:"ASTRO"}, {w:"AGUJERO NEGRO", h:"ASTRO"},
    {w:"GALAXIA", h:"ASTRO"}, {w:"ESTRELLA", h:"ASTRO"}, {w:"PLANETA", h:"ASTRO"}, {w:"SAT√âLITE", h:"ASTRO"},
    {w:"COMETA", h:"ASTRO"}, {w:"ECLIPSE", h:"ASTRO"}, {w:"ESTACIONES", h:"TIEMPO"}, {w:"PRIMAVERA", h:"TIEMPO"},
    {w:"VERANO", h:"TIEMPO"}, {w:"OTO√ëO", h:"TIEMPO"}, {w:"INVIERNO", h:"TIEMPO"}, {w:"D√çA", h:"TIEMPO"},
    {w:"NOCHE", h:"TIEMPO"}, {w:"PULM√ìN", h:"CUERPO"}, {w:"H√çGADO", h:"CUERPO"}, {w:"EST√ìMAGO", h:"CUERPO"},
    {w:"RI√ë√ìN", h:"CUERPO"}, {w:"M√öSCULO", h:"CUERPO"}, {w:"PIEL", h:"CUERPO"}, {w:"DIENTES", h:"CUERPO"},
    {w:"LENGUA", h:"CUERPO"}, {w:"OJOS", h:"CUERPO"}, {w:"OREJAS", h:"CUERPO"}, {w:"NARIZ", h:"CUERPO"},
    {w:"PELO", h:"CUERPO"}, {w:"U√ëAS", h:"CUERPO"}, {w:"VIRUS", h:"SALUD"}, {w:"BACTERIA", h:"SALUD"},
    {w:"C√âLULA", h:"BIOLOG√çA"}, {w:"MICROSCOPIO", h:"CIENCIA"}, {w:"TELESCOPIO", h:"CIENCIA"}, {w:"TERM√ìMETRO", h:"OBJETO"},
    {w:"SMARTWATCH", h:"TECNOLOG√çA"}, {w:"AURICULARES", h:"TECNOLOG√çA"},
    {w:"TABLET", h:"TECNOLOG√çA"}, {w:"POWERBANK", h:"TECNOLOG√çA"},
    {w:"CARGADOR", h:"TECNOLOG√çA"}, {w:"CABLE USB", h:"TECNOLOG√çA"},
    {w:"WEBCAM", h:"TECNOLOG√çA"}, {w:"MICR√ìFONO", h:"TECNOLOG√çA"},
    {w:"ALTAVOZ", h:"TECNOLOG√çA"}, {w:"PROYECTOR", h:"TECNOLOG√çA"},
    {w:"DRON", h:"TECNOLOG√çA"}, {w:"GPS", h:"TECNOLOG√çA"},
    {w:"STREAMER", h:"PROFESI√ìN"}, {w:"MODERADOR", h:"INTERNET"},
    {w:"COMMUNITY MANAGER", h:"PROFESI√ìN"}, {w:"DATA SCIENTIST", h:"PROFESI√ìN"},
    {w:"HACKER", h:"PROFESI√ìN"}, {w:"ANALISTA", h:"PROFESI√ìN"},
    {w:"CONSULTOR", h:"PROFESI√ìN"}, {w:"ECONOMISTA", h:"PROFESI√ìN"},
    {w:"TRADER", h:"PROFESI√ìN"}, {w:"INVERSOR", h:"PROFESI√ìN"},
    {w:"LOKI", h:"PERSONAJE"}, {w:"SCARLET WITCH", h:"SUPERH√âROE"},
    {w:"BLACK PANTHER", h:"SUPERH√âROE"}, {w:"ANT-MAN", h:"SUPERH√âROE"},
    {w:"VISION", h:"PERSONAJE"}, {w:"ULTRON", h:"VILLANO"},
    {w:"GERALT DE RIVIA", h:"PERSONAJE"}, {w:"CIRI", h:"PERSONAJE"},
    {w:"YENNEFER", h:"PERSONAJE"}, {w:"ARAGORN", h:"PERSONAJE"},
    {w:"EZIO AUDITORE", h:"VIDEOJUEGO"}, {w:"ALTA√èR", h:"VIDEOJUEGO"},
    {w:"CROSSFIT", h:"DEPORTE"}, {w:"TRIATL√ìN", h:"DEPORTE"},
    {w:"POWERLIFTING", h:"DEPORTE"}, {w:"HALTEROFILIA", h:"DEPORTE"},
    {w:"SNOWBOARD", h:"DEPORTE"}, {w:"LONGBOARD", h:"DEPORTE"},
    {w:"KITESURF", h:"DEPORTE"}, {w:"WINDSURF", h:"DEPORTE"},
    {w:"ESCALADA EN ROCA", h:"DEPORTE"}, {w:"ULTRAMARAT√ìN", h:"DEPORTE"},
    {w:"ALEJANDRO MAGNO", h:"HISTORIA"}, {w:"AN√çBAL", h:"HISTORIA"},
    {w:"RAMS√âS II", h:"HISTORIA"}, {w:"TUTANKAM√ìN", h:"HISTORIA"},
    {w:"LEONARDO DA VINCI", h:"HISTORIA"}, {w:"MIGUEL √ÅNGEL", h:"ARTE"},
    {w:"REYES CAT√ìLICOS", h:"HISTORIA"}, {w:"NAPOLE√ìN BONAPARTE", h:"HISTORIA"},
    {w:"INTELIGENCIA ARTIFICIAL", h:"TECNOLOG√çA"},
    {w:"MACHINE LEARNING", h:"TECNOLOG√çA"},
    {w:"ENERG√çA SOLAR", h:"ENERG√çA"},
    {w:"ENERG√çA NUCLEAR", h:"ENERG√çA"},
    {w:"FUSI√ìN", h:"CIENCIA"},
    {w:"ANTIMATERIA", h:"CIENCIA"},
    {w:"NANOTECNOLOG√çA", h:"CIENCIA"},
    {w:"BIOTECNOLOG√çA", h:"CIENCIA"}
]
};

        // --- 2. FUNCIONES DE INICIO ---

        async function loadPublicRooms() {
            const { data } = await sb.from('rooms').select('code').eq('status', 'waiting').eq('is_public', true).limit(10);
            const list = document.getElementById('public-rooms-list');
            
            if(!data || data.length === 0) { 
                list.innerHTML = "<small style='color:gray;'>No hay salas p√∫blicas disponibles.</small>"; 
                return; 
            }
            
            list.innerHTML = data.map(r => `
                <div class="room-card" onclick="document.getElementById('in-room').value='${r.code}'">
                    <span>üè† <b>${r.code}</b></span>
                    <small style="color:var(--p);">UNIRSE</small>
                </div>
            `).join('');
        }
        setInterval(loadPublicRooms, 5000); 
        loadPublicRooms(); 

        async function entrarAlJuego() {
            myU = document.getElementById('in-user').value.trim();
            myR = document.getElementById('in-room').value.trim().toUpperCase();
            if(!myU || !myR) return alert("Faltan datos.");

            try {
                // Limpieza previa local
                await sb.from('players').delete().match({ room_id: myR, username: myU });
                
                let { data: r } = await sb.from('rooms').select('*').eq('code', myR).maybeSingle();
                let esHost = false;

                if(!r) {
                    esHost = true;
                    // Creamos sala
                    await sb.from('rooms').insert([{ code: myR, status: 'waiting', is_public:true, show_counter:true }]);
                } else if(r.status !== 'waiting') {
                    return alert("¬°Partida empezada!");
                }

                await sb.from('players').insert([{ room_id: myR, username: myU, is_host: esHost }]);
                
                document.getElementById('screen-login').classList.add('hidden');
                document.getElementById('room-display').innerText = "SALA: " + myR;
                
                setupRealtime();
                uiUpdate(); 
            } catch(e) { console.error(e); }
        }

        async function salirDelJuego() {
            if(confirm("¬øSalir?")) {
                // 1. Borrarme a m√≠ mismo
                await sb.from('players').delete().match({ room_id: myR, username: myU });
                
                // 2. COMPROBAR SI LA SALA QUED√ì VAC√çA (NUEVO)
                // Usamos count: 'exact' y head: true para solo contar sin bajar datos
                const { count } = await sb.from('players').select('*', { count: 'exact', head: true }).eq('room_id', myR);
                
                if(count === 0) {
                    // Si hay 0 jugadores, borrar la sala y los mensajes
                    await sb.from('rooms').delete().eq('code', myR);
                    await sb.from('messages').delete().eq('room_id', myR);
                    console.log("Sala vac√≠a eliminada.");
                }

                location.reload();
            }
        }

        // --- 3. TIEMPO REAL ---
        function setupRealtime() {
            const channel = sb.channel('game_channel');

            channel.on('postgres_changes', { event: '*', schema: 'public', table: 'rooms' }, (payload) => {
                // Si la sala se borr√≥ (payload.eventType === 'DELETE'), recargamos a los que queden (por seguridad)
                if(payload.eventType === 'DELETE' && payload.old.code === myR) {
                    alert("El anfitri√≥n cerr√≥ la sala o se vaci√≥.");
                    location.reload();
                }
                if(payload.new && payload.new.code === myR) uiUpdate();
            });

            channel.on('postgres_changes', { event: '*', schema: 'public', table: 'players' }, (payload) => {
                if((payload.new && payload.new.room_id === myR) || (payload.old && payload.old.room_id === myR)) uiUpdate();
            });

            channel.on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, (payload) => {
                if(payload.new.room_id === myR) {
                    const chat = document.getElementById('chat-messages');
                    const msg = document.createElement('div');
                    const claseExtra = payload.new.is_clue ? ' msg-clue' : '';
                    msg.className = 'msg' + claseExtra;
                    msg.innerHTML = `<b>${payload.new.username}</b> ${payload.new.content}`;
                    chat.appendChild(msg);
                    chat.scrollTop = chat.scrollHeight; 
                }
            });

            channel.subscribe();
        }

        // --- 4. ACTUALIZACI√ìN UI (CORE) ---
        async function uiUpdate() {
            if(!myR) return;

            const { data: ps } = await sb.from('players').select('*').eq('room_id', myR).order('created_at');
            const { data: r } = await sb.from('rooms').select('*').eq('code', myR).maybeSingle();

            if(!ps || !r) return; // Si algo falla o la sala se borr√≥

            pList = ps; 
            gState = r.status; 
            tIdx = r.turn_index;
            const me = ps.find(p => p.username === myU);
            
            // Si yo ya no existo (kick o error), recargo
            if(!me) { location.reload(); return; }

            // --- A) PANTALLA FINAL ---
            // CORRECCI√ìN: Si status es 'waiting', ocultamos pantalla final S√ç O S√ç.
            if(r.status === 'waiting') {
                document.getElementById('end-screen').classList.add('hidden');
            } else if(r.winner_side) {
                document.getElementById('end-screen').classList.remove('hidden');
                document.getElementById('end-title').innerText = "GANAN: " + r.winner_side.toUpperCase();
                document.getElementById('end-subtitle').innerText = "Impostores: " + r.impostor_id;
                
                if(me.is_host) document.getElementById('host-controls').classList.remove('hidden');
                else document.getElementById('host-controls').classList.add('hidden');
            }

            // --- B) PANEL HOST Y SINCRONIZACI√ìN ---
            if(me.is_host && gState === 'waiting') {
                document.getElementById('host-panel').classList.remove('hidden');
                
                // Sincronizar men√∫s visuales solo si no los estoy tocando
                if(document.activeElement.tagName !== 'SELECT') {
                    document.getElementById('set-priv').value = r.is_public ? 'true' : 'false';
                    document.getElementById('set-vis').value = r.show_counter ? 'true' : 'false';
                }
            } else {
                document.getElementById('host-panel').classList.add('hidden');
            }

            // --- C) CONTADORES Y JUGADORES ---
            const infoDiv = document.getElementById('imp-status');
            if(gState !== 'waiting' && r.show_counter) {
                infoDiv.classList.remove('hidden');
                document.getElementById('imp-count-val').innerText = r.impostores_vivos;
            } else {
                infoDiv.classList.add('hidden');
            }

            document.getElementById('player-list').innerHTML = ps.map((p, i) => `
                <div class="player-tag ${i===tIdx && gState==='playing' ? 'is-active-turn' : ''} ${!p.is_alive ? 'dead' : ''}">
                    ${p.is_host ? 'üëë ' : ''}${p.username} ${p.has_voted ? '‚úÖ' : ''}
                </div>
            `).join('');

            // --- D) ESTADO JUEGO ---
            const turnLabel = document.getElementById('turn-display');
            if(gState === 'playing') {
                document.getElementById('role-box').classList.remove('hidden');
                const imps = (r.impostor_id || "").split(',');
                const soyImp = imps.includes(myU);
                document.getElementById('role-label').innerText = soyImp ? "TU MISI√ìN" : "TU PALABRA";
                document.getElementById('word-display').innerText = soyImp ? "üïµÔ∏è IMPOSTOR" : r.word;
                document.getElementById('hint-display').innerText = soyImp ? "Pista: " + r.hint : "Categor√≠a: " + r.hint;
                
                const activeP = ps[tIdx];
                if(activeP) {
                    turnLabel.innerText = "HABLA: " + activeP.username;
                    turnLabel.style.color = (activeP.username === myU) ? "var(--active)" : "white";
                    if(activeP.username === myU) turnLabel.innerText += " (¬°TU TURNO!)";
                }
            } else if(gState === 'voting') {
                document.getElementById('role-box').classList.add('hidden');
                turnLabel.innerText = "üó≥Ô∏è MOMENTO DE VOTAR";
                turnLabel.style.color = "var(--danger)";
            } else {
                document.getElementById('role-box').classList.add('hidden');
                turnLabel.innerText = "ESPERANDO JUGADORES...";
                turnLabel.style.color = "var(--active)";
            }

            // --- E) VOTACI√ìN ---
            const vb = document.getElementById('vote-box');
            if(gState === 'voting' && me.is_alive && !me.has_voted) {
                vb.classList.remove('hidden');
                vb.querySelector('#vote-options').innerHTML = ps.filter(p=>p.is_alive).map(p => `
                    <button onclick="votar('${p.username}')">${p.username}</button>
                `).join('') + `<button onclick="votar('skip')" style="background:gray; grid-column:span 2;">‚è≠Ô∏è SALTAR VOTO</button>`;
            } else {
                vb.classList.add('hidden');
            }

            // --- CORRECCI√ìN FINAL DEL BUCLE ---
            // Solo ejecutamos l√≥gica de host si estamos JUGANDO o VOTANDO.
            // Si estamos 'waiting', NO HACEMOS NADA. Esto arregla el reinicio infinito.
            if(me.is_host && gState !== 'waiting') {
                hostLogic(r, ps);
            }
        }

/* ================= SALIR AL CERRAR ================= */
window.addEventListener("beforeunload", () => {
    if(myU && myR) {
        navigator.sendBeacon(
            `${SB_URL}/rest/v1/players?room_id=eq.${myR}&username=eq.${myU}`,
            ""
        );
    }
});

        /* ================= KICK ================= */
async function kickPlayer(username) {
    if(!confirm("¬øExpulsar a "+username+"?")) return;
    await sb.from("players").delete().match({room_id:myR,username});
    await sb.from("messages").insert([{
        room_id:myR,
        username:"SISTEMA",
        content:username+" fue expulsado",
        is_clue:true
    }]);
}

        // --- 5. L√ìGICA DE JUEGO ---

        async function actualizarSala() {
            const esPublica = document.getElementById('set-priv').value === 'true';
            const mostrarContador = document.getElementById('set-vis').value === 'true';
            
            await sb.from('rooms').update({
                is_public: esPublica,
                show_counter: mostrarContador
            }).eq('code', myR);
        }

        async function iniciarPartida() {
            if(pList.length < 3) return alert("M√≠nimo 3 jugadores.");
            
            const cat = document.getElementById('set-cat').value;
            const impVal = document.getElementById('set-imps').value;
            
            let numImp = (impVal === 'rand') ? Math.floor(Math.random() * (pList.length - 1)) + 1 : parseInt(impVal);
            if(numImp >= pList.length) numImp = pList.length - 1;

            const shuffled = [...pList].sort(() => 0.5 - Math.random());
            const chosenImps = shuffled.slice(0, numImp).map(p => p.username);
            const wData = DATA[cat][Math.floor(Math.random() * DATA[cat].length)];

            // Importante: Actualizamos el estado con los ajustes actuales del DOM
            const esPublica = document.getElementById('set-priv').value === 'true';
            const mostrarContador = document.getElementById('set-vis').value === 'true';

            await sb.from('messages').delete().eq('room_id', myR);
            await sb.from('players').update({ is_alive:true, has_voted:false, voted_for:null }).eq('room_id', myR);
            
            await sb.from('rooms').update({
                status: 'playing',
                word: wData.w,
                hint: wData.h,
                impostor_id: chosenImps.join(','),
                impostores_vivos: chosenImps.length,
                winner_side: null,
                turn_index: 0,
                is_public: esPublica,
                show_counter: mostrarContador
            }).eq('code', myR);
        }

        async function enviarMensaje() {
            const inp = document.getElementById('chat-input');
            const txt = inp.value.trim();
            if(!txt) return;

            const turnoPlayer = pList[tIdx];
            const esMiTurno = (gState === 'playing' && turnoPlayer && turnoPlayer.username === myU);

            await sb.from('messages').insert([{ 
                room_id: myR, username: myU, content: txt, is_clue: esMiTurno 
            }]);
            inp.value = "";

            if(esMiTurno) {
                let nextIdx = tIdx + 1;
                while(pList[nextIdx] && !pList[nextIdx].is_alive) nextIdx++;

                if(nextIdx >= pList.length) await sb.from('rooms').update({ status:'voting' }).eq('code', myR);
                else await sb.from('rooms').update({ turn_index: nextIdx }).eq('code', myR);
            }
        }

        async function votar(voto) { 
            await sb.from('players').update({ has_voted:true, voted_for:voto }).match({ room_id:myR, username:myU });
            document.getElementById('vote-box').classList.add('hidden');
        }

        async function reiniciarSala() {
            document.getElementById('end-screen').classList.add('hidden');
            
            // Reseteamos TODO para evitar que la hostLogic se confunda
            await sb.from('rooms').update({ 
                status:'waiting', winner_side:null, word:null, impostor_id:null, impostores_vivos:0
            }).eq('code',myR);
            
            await sb.from('players').update({ 
                is_alive:true, has_voted:false, voted_for:null 
            }).eq('room_id',myR);
        }

        // --- 6. C√ÅLCULO RESULTADOS (HOST) ---
        async function hostLogic(r, ps) {
            // DOBLE SEGURIDAD: Si estamos esperando, FUERA.
            if(r.status === 'waiting') return;

            const vivos = ps.filter(p => p.is_alive);
            const hanVotado = vivos.filter(p => p.has_voted);

            if(vivos.length > 0 && vivos.length === hanVotado.length) {
                let counts = {}; 
                hanVotado.forEach(p => { counts[p.voted_for] = (counts[p.voted_for] || 0) + 1; });
                
                let expulsado = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);

                if(expulsado !== 'skip') {
                    await sb.from('players').update({ is_alive:false }).match({ room_id:myR, username:expulsado });
                    
                    const listaImps = (r.impostor_id || "").split(',');
                    if(listaImps.includes(expulsado)) {
                        const quedan = r.impostores_vivos - 1;
                        if(quedan <= 0) return await sb.from('rooms').update({ winner_side:'tripulaci√≥n', impostores_vivos:0 }).eq('code', myR);
                        await sb.from('rooms').update({ impostores_vivos: quedan }).eq('code', myR);
                    }
                }

                // Recalcular post-muerte
                const nuevosVivos = ps.filter(p => p.is_alive && p.username !== expulsado);
                const listaImps = (r.impostor_id || "").split(',');
                const impsVivos = nuevosVivos.filter(p => listaImps.includes(p.username)).length;
                const crewVivos = nuevosVivos.length - impsVivos;

                if(impsVivos >= crewVivos) return await sb.from('rooms').update({ winner_side:'impostores' }).eq('code', myR);

                await sb.from('players').update({ has_voted:false, voted_for:null }).eq('room_id', myR);
                await sb.from('rooms').update({ status:'playing', turn_index:0 }).eq('code', myR);
            }
        }

        document.getElementById('chat-input').onkeypress = (e) => { if(e.key === 'Enter') enviarMensaje(); };
    </script>
</body>
</html>
