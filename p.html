<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Juego de Cartas - Salas</title>
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Arial', sans-serif;
        background: #1a1a1a; /* Gris oscuro */
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1, h2 {
        margin-top: 20px;
        text-align: center;
    }

    .salas-container, .crear-sala, .sala-activa {
        margin: 20px;
        text-align: center;
    }

    .sala, .jugador {
        background: #333;
        padding: 15px;
        border-radius: 10px;
        margin: 10px;
        cursor: pointer;
        box-shadow: 0 0 10px #ff6600; /* toque Halloween */
        transition: 0.3s;
    }

    .sala:hover, .jugador:hover {
        transform: scale(1.05);
    }

    input, button {
        padding: 10px;
        border-radius: 5px;
        border: none;
        margin: 5px;
    }

    button {
        cursor: pointer;
        background: #ff6600;
        color: #fff;
        transition: 0.3s;
    }

    button:hover {
        transform: scale(1.05);
    }

    .fichas button {
        margin: 5px;
    }

</style>
</head>
<body>

<h1>Juego de Cartas - Salas</h1>

<div class="crear-sala">
    <input type="text" id="nombreSala" placeholder="Nombre de la sala">
    <button onclick="crearSala()">Crear Sala</button>
</div>

<h2>Salas disponibles</h2>
<div class="salas-container" id="salasContainer">
    <!-- Salas se mostrarán aquí -->
</div>

<div class="sala-activa" id="salaActiva" style="display:none;">
    <h2 id="nombreSalaActiva"></h2>
    <div id="jugadoresSala"></div>

    <h3>Apostar fichas</h3>
    <div class="fichas">
        <button onclick="apostar(1)">Blanca (1)</button>
        <button onclick="apostar(5)">Roja (5)</button>
        <button onclick="apostar(25)">Azul (25)</button>
        <button onclick="apostar(100)">Verde (100)</button>
    </div>
    <button id="startBtn" onclick="iniciarPartida()" disabled>Iniciar Partida</button>
</div>

<script>
const maxJugadoresPorSala = 5;

// Jugadores existentes con sus pekepuntos reales
let todosJugadores = [
    {nombre: "Alice", pekepuntos: 500},
    {nombre: "Bob", pekepuntos: 300},
    {nombre: "Charlie", pekepuntos: 250},
    {nombre: "Diana", pekepuntos: 400},
    {nombre: "Eve", pekepuntos: 150}
];

let salas = []; // Lista de salas
let salaActual = null; // Sala en la que estamos

function mostrarSalas() {
    const container = document.getElementById('salasContainer');
    container.innerHTML = '';
    salas.forEach((sala, index) => {
        const div = document.createElement('div');
        div.classList.add('sala');
        div.innerHTML = `<strong>${sala.nombre}</strong> - ${sala.jugadores.length}/${maxJugadoresPorSala} jugadores`;
        div.onclick = () => unirseSala(index);
        container.appendChild(div);
    });
}

function crearSala() {
    const nombre = document.getElementById('nombreSala').value.trim();
    if(nombre === '') {
        alert("Introduce un nombre para la sala");
        return;
    }
    const nuevaSala = { nombre: nombre, jugadores: [] };
    salas.push(nuevaSala);
    document.getElementById('nombreSala').value = '';
    mostrarSalas();
}

function unirseSala(index) {
    const sala = salas[index];
    if(sala.jugadores.length >= maxJugadoresPorSala) {
        alert("La sala está llena");
        return;
    }

    const jugadorNombre = prompt("Introduce tu nombre:");
    if(!jugadorNombre) return;

    // Verificar que el jugador existe en todosJugadores
    const jugadorExistente = todosJugadores.find(j => j.nombre === jugadorNombre);
    if(!jugadorExistente) {
        alert("Jugador no encontrado en el sistema.");
        return;
    }

    // Evitar duplicados en la misma sala
    if(sala.jugadores.some(j => j.nombre === jugadorNombre)) {
        alert("Ya estás en esta sala");
        return;
    }

    // Unirse a la sala
    sala.jugadores.push({ nombre: jugadorNombre, apuesta: 0 });
    salaActual = sala;
    mostrarSalaActiva();
    mostrarSalas();
}

function mostrarSalaActiva() {
    if(!salaActual) return;
    document.getElementById('salaActiva').style.display = 'block';
    document.getElementById('nombreSalaActiva').innerText = `Sala: ${salaActual.nombre}`;

    const cont = document.getElementById('jugadoresSala');
    cont.innerHTML = '';
    salaActual.jugadores.forEach(j => {
        const jugadorInfo = todosJugadores.find(t => t.nombre === j.nombre);
        const div = document.createElement('div');
        div.classList.add('jugador');
        div.innerHTML = `<strong>${j.nombre}</strong> - Pekepuntos: ${jugadorInfo.pekepuntos} - Apuesta: ${j.apuesta}`;
        cont.appendChild(div);
    });

    verificarApuestas();
}

function apostar(valor) {
    if(!salaActual) return;

    // Apostar para el primer jugador de la sala que no haya apostado
    for(let i=0; i < salaActual.jugadores.length; i++) {
        const j = salaActual.jugadores[i];
        if(j.apuesta === 0) {
            const jugadorInfo = todosJugadores.find(t => t.nombre === j.nombre);
            if(jugadorInfo.pekepuntos >= valor) {
                j.apuesta += valor;
                jugadorInfo.pekepuntos -= valor;
            } else {
                alert(`${j.nombre} no tiene suficientes pekepuntos`);
            }
            break;
        }
    }
    mostrarSalaActiva();
}

function verificarApuestas() {
    if(!salaActual) return;
    const todosApostaron = salaActual.jugadores.length > 0 && salaActual.jugadores.every(j => j.apuesta > 0);
    document.getElementById('startBtn').disabled = !todosApostaron;
}

function iniciarPartida() {
    alert("¡La partida comienza!");
    // Aquí se añadirá la lógica del juego de cartas
}

mostrarSalas();
</script>

</body>
</html>
