<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino - Juego de Cartas</title>
<style>
body {
  background: radial-gradient(circle at center, #222 0%, #000 100%);
  color: white;
  font-family: Arial, sans-serif;
  margin: 0;
  overflow: hidden;
}
#mesa {
  position: relative;
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}
#centro {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  gap: 40px;
}
.hueco {
  width: 80px;
  height: 120px;
  border: 2px dashed rgba(255,255,255,0.2);
  border-radius: 10px;
}
#jugadores {
  position: absolute;
  width: 100%; height: 100%;
  pointer-events: none;
}
.jugador {
  position: absolute;
  text-align: center;
  width: 150px;
}
#jug1 { bottom: 20px; left: 50%; transform: translateX(-50%); }
#jug2 { top: 20px; left: 50%; transform: translateX(-50%); }
#jug3 { top: 50%; left: 20px; transform: translateY(-50%); }
#jug4 { top: 50%; right: 20px; transform: translateY(-50%); }
#jug5 { top: 30%; left: 50%; transform: translateX(-50%); }

#controles {
  position: absolute;
  bottom: 10px;
  right: 10px;
  display: flex;
  gap: 10px;
}
button {
  background: #ff7b00;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  color: #fff;
  font-weight: bold;
}
button:hover {
  background: #ffa200;
}

/* === CARTAS Y ANIMACIONES === */
@keyframes barajar {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  25% { transform: translate(-48%, -52%) rotate(5deg); }
  50% { transform: translate(-52%, -48%) rotate(-5deg); }
  75% { transform: translate(-49%, -51%) rotate(4deg); }
  100% { transform: translate(-50%, -50%) rotate(0deg); }
}

@keyframes volarCarta {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.5) rotate(0deg);
  }
  to {
    opacity: 1;
    transform: translate(var(--tx), var(--ty)) scale(1) rotate(var(--rot));
  }
}

.carta {
  position: absolute;
  width: 60px;
  height: 90px;
  background: #fff;
  border-radius: 8px;
  border: 1px solid #111;
  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 18px;
  color: #000;
  backface-visibility: hidden;
}

.carta.reverso {
  background: repeating-linear-gradient(45deg, #b02, #b02 6px, #701 6px, #701 12px);
  color: transparent;
}

#mesa-cartas {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 100%; height: 100%;
  pointer-events: none;
}

#animacion-barajar {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
}
</style>
</head>
<body>
<div id="mesa">
  <!-- Huecos centrales -->
  <div id="centro">
    <div class="hueco"></div>
    <div class="hueco"></div>
    <div class="hueco"></div>
    <div class="hueco"></div>
    <div class="hueco"></div>
  </div>

  <!-- Jugadores -->
  <div id="jugadores">
    <div class="jugador" id="jug1">Jugador 1</div>
    <div class="jugador" id="jug2">Jugador 2</div>
    <div class="jugador" id="jug3">Jugador 3</div>
    <div class="jugador" id="jug4">Jugador 4</div>
    <div class="jugador" id="jug5">Jugador 5</div>
  </div>

  <!-- Cartas y animaciones -->
  <div id="mesa-cartas">
    <div id="animacion-barajar"></div>
  </div>

  <div id="controles">
    <button id="iniciarPartidaBtn">Iniciar partida</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabase = window.supabase.createClient('https://jdvwlfogkzrzovepzjqa.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI');

// Datos simulados del usuario y la sala
const usuario = { id: 'u1', username: 'Peketruli' };
const salaActual = { id: 1, name: 'Mesa Halloween' };

// üé¨ Iniciar Partida
document.getElementById('iniciarPartidaBtn').addEventListener('click', async ()=>{
  try {
    // Simular datos de jugadores
    const jugadores = [
      {id:'u1', username:'Peketruli'},
      {id:'u2', username:'Player2'},
      {id:'u3', username:'Player3'},
      {id:'u4', username:'Player4'}
    ];

    const mesa = document.getElementById('mesa-cartas');
    const animBarajar = document.getElementById('animacion-barajar');
    mesa.innerHTML = '<div id="animacion-barajar"></div>';

    // === Animaci√≥n de barajar ===
    for(let i=0;i<6;i++){
      const c = document.createElement('div');
      c.className = 'carta reverso';
      c.style.top = '50%';
      c.style.left = '50%';
      c.style.transform = `translate(-50%, -50%) rotate(${i*4}deg)`;
      c.style.animation = `barajar 0.5s ${i*0.1}s ease-in-out infinite alternate`;
      animBarajar.appendChild(c);
    }

    await new Promise(r=>setTimeout(r,2000));
    animBarajar.innerHTML = '';

    // === Crear baraja ===
    const palos = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const valores = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
    let baraja = [];
    for (let p of palos) for (let v of valores) baraja.push({ valor:v, palo:p });
    baraja.sort(()=>Math.random() - 0.5);

    // === Repartir 2 cartas a cada jugador ===
    const manos = {};
    for (let j of jugadores){
      manos[j.id] = [baraja.pop(), baraja.pop()];
    }

    // === Animaci√≥n de repartir ===
    const posiciones = [
      {x:0, y:180},  // jugador1 (abajo)
      {x:0, y:-180}, // jugador2 (arriba)
      {x:-250, y:0}, // jugador3 (izquierda)
      {x:250, y:0},  // jugador4 (derecha)
      {x:0, y:-80}   // jugador5 (centro superior)
    ];

    for (let i=0;i<jugadores.length;i++){
      const destino = posiciones[i] || {x:0,y:0};
      for (let c=0;c<2;c++){
        const carta = document.createElement('div');
        carta.className = 'carta reverso';
        carta.style.top = '50%';
        carta.style.left = '50%';
        carta.style.setProperty('--tx', `${destino.x + c*20}px`);
        carta.style.setProperty('--ty', `${destino.y}px`);
        carta.style.setProperty('--rot', `${Math.random()*10-5}deg`);
        carta.style.animation = 'volarCarta 0.8s forwards';
        mesa.appendChild(carta);
        await new Promise(r=>setTimeout(r,150));
      }
    }

    // Mostrar tus cartas abajo
    const misCartas = manos[usuario.id];
    if(misCartas){
      setTimeout(()=>{
        mesa.querySelectorAll('.carta').forEach(c=>c.remove());
        misCartas.forEach((carta,i)=>{
          const div = document.createElement('div');
          div.className = 'carta';
          div.textContent = `${carta.valor}${carta.palo}`;
          div.style.left = `calc(50% + ${i*70 - 35}px)`;
          div.style.bottom = '20px';
          div.style.position = 'absolute';
          mesa.appendChild(div);
        });
      }, 1500);
    }

  } catch(e) {
    console.error(e);
    alert('Error al iniciar partida');
  }
});
</script>
</body>
</html>
