<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üéÑ Blog - Rebeld√≠a IN.AR üéÖ</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
  :root{
    --text: #fff5f5;
    --accent-red: #ff4444;
    --accent-green: #33ff77;
  }

body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 50px;
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: linear-gradient(180deg,#012 0%,#114 40%,#002 100%);
  color: var(--text);
  overflow-x: hidden;
}

/* üéÑ Copos de nieve */
.snowflake {
  position: fixed;
  top: -10px;
  color: #fff;
  font-size: 1.2em;
  user-select: none;
  z-index: 9999;
  animation: fall linear infinite;
}
@keyframes fall {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0.8; }
}

/* üéÅ Luces navide√±as */
.christmas-lights {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 40px;
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 999;
  background: transparent;
  pointer-events: none;
}
.bulb {
  width: 16px;
  height: 24px;
  border-radius: 50%;
  box-shadow: 0 0 10px currentColor;
  animation: blink 1.2s infinite alternate;
}
@keyframes blink {
  0%,100% {opacity: 1; transform: scale(1);}
  50% {opacity: 0.3; transform: scale(1.2);}
}
.bulb:nth-child(1){color:red;}
.bulb:nth-child(2){color:gold;}
.bulb:nth-child(3){color:lime;}
.bulb:nth-child(4){color:deepskyblue;}
.bulb:nth-child(5){color:magenta;}
.bulb:nth-child(6){color:orange;}
.bulb:nth-child(7){color:cyan;}
.bulb:nth-child(8){color:greenyellow;}

/* üéÖ Santa volando */
#santa {
  position: fixed;
  bottom: 120px;
  left: -200px;
  width: 180px;
  height: auto;
  z-index: 50;
  animation: santaFly 18s linear infinite;
}
@keyframes santaFly {
  0% { transform: translateX(-200px) scale(1); opacity: 0; }
  10% { opacity: 1; }
  50% { transform: translateX(100vw) scale(1); opacity: 1; }
  90% { opacity: 0.8; }
  100% { transform: translateX(120vw) scale(1); opacity: 0; }
}

/* ‚ú® Efectos */
button, .like-btn {
  position: relative;
  z-index: 1;
}
button::after, .like-btn::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(circle, rgba(255,255,255,0.15), transparent 70%);
  animation: twinkle 2s infinite alternate;
  pointer-events: none;
}
@keyframes twinkle { from{opacity:0.2;} to{opacity:0.7;} }

/* Bot√≥n Home */
.home-btn {
  position: absolute;
  top: 20px;
  left: 20px;
  padding: 10px 20px;
  background: #f33;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(255,0,0,0.6);
}
.home-btn:hover { background: #ff5555; transform: scale(1.05); }

/* Contenedor principal */
.blog-container {
  background: rgba(255,255,255,0.05);
  padding: 20px;
  border-radius: 12px;
  max-width: 800px;
  margin-top: 80px;
  box-shadow: 0 0 30px rgba(255,255,255,0.1);
  z-index: 2;
}

/* Blogs */
.blog-post, .new-blog, .blog-details {
  background: rgba(255,255,255,0.07);
  color: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
}

.blog-post:hover {
  transform: scale(1.02);
  box-shadow: 0 0 20px rgba(255,0,0,0.4);
}

.like-btn { font-size: 1.5em; color: #ff4444; }
.like-btn.liked { color: #ff0000; }

input, textarea {
  width: 100%;
  padding: 10px;
  background: #111;
  border: 1px solid #444;
  color: white;
  border-radius: 6px;
}

.btn {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: #ff4444;
  color: white;
  cursor: pointer;
  margin: 5px;
  font-weight: bold;
  transition: all 0.25s ease;
}
.btn:hover { background: #ff7777; transform: scale(1.1) translateY(-2px); }

.blog-media { margin-top:10px; max-width:100%; border-radius:6px; }
.hidden { display:none; }

/* Auth */
.auth-container, .user-info {
  position:absolute;
  top:20px;
  right:20px;
  display:flex;
  align-items:center;
  gap:10px;
}
.auth-button { background:#222; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; }
.user-info { display:none; cursor:pointer; }
#userLogo { width:40px; height:40px; border-radius:50%; }
#userName { font-weight:bold; color:gold; }
.dropdown-menu {
  display:none;
  position:absolute;
  top:60px;
  right:20px;
  background:#111;
  border-radius:5px;
  width:150px;
  text-align:left;
  box-shadow:0 4px 8px rgba(0,0,0,0.6);
}
.dropdown-menu td { padding:10px; cursor:pointer; }
.dropdown-menu td:hover { background:#333; }
</style>
</head>
<body>

<!-- üéÑ Luces -->
<div class="christmas-lights">
  <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
  <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
  <div class="bulb"></div><div class="bulb"></div>
</div>

<img id="santa" src="https://i.imgur.com/8V7j0Va.png" alt="Santa Claus">

<button class="home-btn" onclick="window.location.href='h.html'">üè† Volver</button>

<div class="auth-container" id="authContainer">
  <button class="auth-button" onclick="window.location.href='l.html'">Iniciar sesi√≥n / registrarse</button>
</div>
<div class="user-info" id="userInfo">
  <h3 id="userName"></h3>
  <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
</div>
<div class="dropdown-menu" id="dropdownMenu">
  <table><tr><td onclick="logout()">Cerrar sesi√≥n</td></tr></table>
</div>

<div class="blog-container">
  <h1>üéÖ Blog Navide√±o üéÑ</h1>
  <button class="btn" onclick="showNewBlogForm()">Publicar nuevo blog</button>

  <div id="newBlogForm" class="new-blog hidden">
    <h2>Nuevo Blog</h2>
    <input type="text" id="newTitle" placeholder="T√≠tulo">
    <textarea id="newContent" rows="5" placeholder="Escribe tu blog aqu√≠..."></textarea>
    <input type="file" id="newMedia" accept="image/*,video/*,image/gif">
    <button class="btn" onclick="publishBlog()">Publicar</button>
    <button class="btn" onclick="hideNewBlogForm()">Cancelar</button>
  </div>

  <div id="blogsList"></div>

  <div id="blogDetails" class="blog-details hidden">
    <h2 id="blogTitleDetail"></h2>
    <div id="blogMediaDetail"></div>
    <p id="blogContentDetail"></p>
    <h3>Comentarios</h3>
    <div id="commentsList"></div>
    <div id="newCommentForm">
      <textarea id="newCommentText" rows="3" placeholder="Escribe tu comentario..."></textarea>
      <button class="btn" onclick="publishComment()">Publicar comentario</button>
    </div>
    <button class="btn" onclick="closeBlog()">Volver</button>
  </div>
</div>

<script>
/* ‚ùÑÔ∏è Nieve */
function createSnowflake(){
  const s=document.createElement("div");
  s.classList.add("snowflake");
  s.textContent="‚ùÑ";
  s.style.left=Math.random()*100+"vw";
  s.style.animationDuration=(3+Math.random()*5)+"s";
  s.style.fontSize=(0.8+Math.random()*1.2)+"em";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),8000);
}
setInterval(createSnowflake,150);

/* üîî Sonido en like */
const bell = new Audio("https://cdn.pixabay.com/download/audio/2022/02/23/audio_3b8f4e21c4.mp3?filename=christmas-bells-117356.mp3");

const { createClient } = supabase;
const db = createClient("https://jdvwlfogkzrzovepzjqa.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI");

function getCurrentUser(){return JSON.parse(localStorage.getItem("currentUser"))||null;}
function isUserLoggedIn(){return !!getCurrentUser();}
function loadUserInfo(){
  const u=getCurrentUser();const auth=document.getElementById("authContainer");const info=document.getElementById("userInfo");
  if(u){info.style.display="flex";auth.style.display="none";document.getElementById("userName").textContent=u.username||"Usuario";document.getElementById("userLogo").src=u.logo||"logoDefault.png";}
  else{info.style.display="none";auth.style.display="flex";}
}
document.addEventListener("DOMContentLoaded",()=>{loadUserInfo();loadBlogs();});

async function registrarActividad(a){
  const u=getCurrentUser();const usuario=u?.username||"Desconocido";
  try{await db.from("actividad").insert([{usuario,accion:a,fecha:new Date().toISOString()}]);}catch(err){console.error(err);}
}

function logout(){registrarActividad("ha cerrado sesi√≥n");localStorage.removeItem("currentUser");window.location.href="login.html";}

async function loadBlogs(){
  const list=document.getElementById("blogsList");list.innerHTML="Cargando blogs...";
  const {data,error}=await db.from("blog").select("*").order("created_at",{ascending:false});
  if(error){list.innerHTML="Error al cargar blogs";return;}
  if(!data||!data.length){list.innerHTML="<p>No hay blogs.</p>";return;}
  list.innerHTML="";const u=getCurrentUser();
  data.forEach(b=>{
    const d=document.createElement("div");d.className="blog-post";
    d.innerHTML=`<h3>${b.title}</h3><p style="font-size:0.9em;color:gray;">Autor: ${b.author||"An√≥nimo"}</p>
    ${b.media_url?`<img src="${b.media_url}" class="blog-media">`:''}
    <p>‚ù§Ô∏è <span id="likeCount-${b.id}">${b.likes||0}</span>
    <button class="like-btn" id="likeBtn-${b.id}">‚ù§Ô∏è</button></p>`;
    d.addEventListener("click",e=>{if(!e.target.classList.contains("like-btn"))openBlog(b);});
    const btn=d.querySelector(`#likeBtn-${b.id}`);
    btn.addEventListener("click",e=>{e.stopPropagation();toggleLike(b.id);});
    if(u&&localStorage.getItem(`like_${b.id}_${u.id}`))btn.classList.add("liked");
    list.appendChild(d);
  });
}

async function toggleLike(id){
  const u=getCurrentUser();if(!u){alert("Inicia sesi√≥n para dar like");return;}
  const key=`like_${id}_${u.id}`;const el=document.getElementById(`likeCount-${id}`);const btn=document.getElementById(`likeBtn-${id}`);
  const liked=localStorage.getItem(key);const current=parseInt(el.textContent)||0;
  const newLikes=liked?current-1:current+1;el.textContent=newLikes;btn.classList.toggle("liked");
  if(liked)localStorage.removeItem(key);else{localStorage.setItem(key,"true");bell.currentTime=0;bell.play();}
  await db.from("blog").update({likes:newLikes}).eq("id",id);
}
</script>
</body>
</html>
