<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RebeldÃ­a IN.AR â€” Halloween (Noche en cementerio)</title>

<!-- Fuentes -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Creepster&display=swap" rel="stylesheet">

<!-- Dependencias -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>

<style>
:root{
  --text: #f5f3f4;
  --accent-orange: #ff8a33;
  --accent-purple: #6b2a7a;
}

/* Reset base */
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%; overflow-x:hidden; font-family:"Inter", Arial, sans-serif; color:var(--text);}
body {position:relative;padding:50px 20px 140px;background: linear-gradient(180deg,#1b0b2b 0%,#3a103a 50%,#0b0b0b 100%);overflow-x:hidden;}

/* ---------- MONTE y CEMENTERIO ---------- */
.scene-bg {position:fixed;bottom:0;left:0;width:100%;height:50%;z-index:1;pointer-events:none;}
.scene-bg svg { width:100%; height:100%; display:block; }

/* ---------- LUNA ---------- */
.moon {position:fixed;top:50px;left:60px;width:130px;height:130px;border-radius:50%;background: radial-gradient(circle at 30% 25%, rgba(255,255,230,0.95) 0%, rgba(255,255,220,0.85) 20%, rgba(240,240,200,0.55) 30%, rgba(220,220,200,0.15) 50%, transparent 70%);box-shadow:0 0 90px rgba(255,240,180,0.08), 0 6px 40px rgba(0,0,0,0.6) inset;z-index:2;}
.moon::after {content:"";position:absolute;inset:-20px;border-radius:50%;background: radial-gradient(circle, rgba(255,230,160,0.06), transparent 35%);filter: blur(12px);}

/* ---------- FOG LAYERS ---------- */
.fog-layer {position:fixed; left:-20%; width:140%; height:35vh; bottom:-8%; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0)); filter: blur(22px); opacity:0.45; z-index:3; pointer-events:none; animation: fogShift 28s linear infinite;}
.fog-layer.layer2 { bottom:-4%; opacity:0.28; height:30vh; filter: blur(28px); animation-duration:36s }
.fog-layer.layer3 { bottom:-16%; opacity:0.18; height:40vh; filter: blur(36px); animation-duration:46s; transform: scaleX(1.1) }
@keyframes fogShift {0%{ transform:translateX(0) }50%{ transform:translateX(-8%) }100%{ transform:translateX(0) }}

/* ---------- BATs ---------- */
.bat-svg {position:fixed;width:110px;height:auto;display:block;z-index:4;pointer-events:none;opacity:0.95;filter: drop-shadow(0 8px 18px rgba(0,0,0,0.6));}
.bat-1 { top:18%; left:-18%; animation: batFly1 12s linear infinite; transform-origin:center; }
.bat-2 { top:32%; left:-30%; animation: batFly2 16s linear infinite; transform-origin:center; opacity:0.9; transform:scale(.8) }
.bat-3 { top:46%; left:-10%; animation: batFly3 10s linear infinite; transform-origin:center; opacity:0.95; transform:scale(.95) }
@keyframes batFly1 {0%{transform:translateX(0) translateY(0) rotate(0deg)}25%{transform:translateX(220px) translateY(-10px) rotate(-8deg)}50%{transform:translateX(480px) translateY(6px) rotate(10deg)}75%{transform:translateX(760px) translateY(-4px) rotate(-6deg)}100%{transform:translateX(1100px) translateY(0) rotate(0deg);opacity:0}}
@keyframes batFly2 {0%{transform:translateX(0) translateY(0) rotate(0deg)}20%{transform:translateX(140px) translateY(6px) rotate(6deg)}45%{transform:translateX(380px) translateY(-12px) rotate(-10deg)}70%{transform:translateX(740px) translateY(8px) rotate(8deg)}100%{transform:translateX(1100px) translateY(0) rotate(0deg);opacity:0}}
@keyframes batFly3 {0%{transform:translateX(0) translateY(0) rotate(0deg)}30%{transform:translateX(260px) translateY(-18px) rotate(-14deg)}60%{transform:translateX(540px) translateY(12px) rotate(12deg)}100%{transform:translateX(1100px) translateY(0) rotate(0deg);opacity:0}}

/* ---------- PARTICULAS ---------- */
.particles {position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:3;}
.particle {position:absolute; width:6px; height:6px; background:orange; border-radius:50%; opacity:0.6; animation: rise 8s linear infinite;}
@keyframes rise {0%{transform:translateY(0)}100%{transform:translateY(-120vh)}}

/* ---------- BOTONES ---------- */
.btn { font-weight:600; padding:12px 22px; border-radius:12px; border:none; cursor:pointer; transition:all .25s ease; box-shadow:0 6px 18px rgba(0,0,0,0.45); display:inline-flex; align-items:center; gap:10px; color:white; background:linear-gradient(180deg,#f39c12,#f57c00); z-index:5;}
.btn:hover { transform: scale(1.1) translateY(-3px); box-shadow:0 0 50px 18px rgba(255,160,70,0.9),0 18px 60px rgba(0,0,0,0.7); }

/* ---------- NAV INFERIOR ---------- */
.nav-container { position:fixed; bottom:20px; left:0; width:100%; background-color: rgba(0,0,0,0.7); padding:15px 0; display:flex; justify-content:space-around; align-items:center; z-index:5;}
.nav-button { padding:10px 16px; margin:0 6px; border-radius:10px; border:none; background: linear-gradient(180deg,#f39c12,#f57c00); color:white; font-weight:600; cursor:pointer; transition: all 0.25s ease; box-shadow:0 4px 18px rgba(0,0,0,0.45);}
.nav-button:hover { transform: translateY(-6px) scale(1.08); box-shadow:0 0 48px 16px rgba(255,160,70,0.9),0 20px 60px rgba(0,0,0,0.7); }

/* ---------- CONTAINER Y CARDS ---------- */
.container {text-align: center; max-width:1100px; margin:0 auto; display:flex; flex-direction:column; gap:26px; align-items:center; z-index:5; position:relative; }
.card { width:100%; background: rgba(255,255,255,0.02); border-radius:14px; padding:18px; box-shadow: 0 6px 30px rgba(0,0,0,0.6); backdrop-filter: blur(4px); border:1px solid rgba(255,255,255,0.03); color: #eae8e8; z-index:5; text-align: center;}
.lead { font-size:16px; line-height:1.5; color:#eae8e8; }
.header h1 { text-align: center; font-family:"Creepster",cursive; font-size:48px; color:var(--accent-orange); text-shadow:0 4px 26px rgba(0,0,0,0.6),0 0 18px rgba(255,140,50,0.08); }

/* ---------- PERFIL ARRIBA DERECHA ---------- */
.auth-container, .user-info {position:fixed; top:16px; right:16px; display:flex; align-items:center; gap:10px; z-index:10;}
.auth-button {padding:10px 18px; font-size:1em; color:white; background-color:#333; border:none; cursor:pointer; border-radius:6px; text-decoration:none; transition:all .2s;}
.auth-button:hover {transform:scale(1.08); box-shadow:0 0 30px rgba(255,255,255,0.4);}
.user-info {display:none; cursor:pointer;}
#userLogo { width:40px; height:40px; border-radius:50%; }
#userName { font-weight:600; font-size:1em; color:white; }

/* ---------- DROPDOWN ---------- */
.dropdown-menu { display:none; position:absolute; top:56px; right:0; background-color:#000; border-radius:6px; box-shadow:0 4px 12px rgba(0,0,0,0.4); width:160px; text-align:left; z-index:10; }
.dropdown-menu td { padding:10px; cursor:pointer; color:white; }
.dropdown-menu td:hover { background-color: #333; }

/* ---------- MODAL ---------- */
#updatesModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.95); background-color:rgba(0,0,0,0.95); color:white; padding:20px; border-radius:10px; width:80%; max-width:400px; z-index:20; transition:all 0.25s ease; }
#updatesContent { text-align:left; max-height:300px; overflow-y:auto; }
#modalOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:15; }
#closeUpdatesButton { margin-top:15px; padding:10px 15px; border:none; border-radius:5px; background-color:#dc3545; color:white; cursor:pointer; }
#closeUpdatesButton:hover { transform:scale(1.05); box-shadow:0 0 30px rgba(220,50,50,0.8); }

.container .card h1, .container .card h2, .container .card h3, .container .card p.lead { text-align:center; }

.actions { justify-content:center; }

/* ---------- PANEL ADMIN ---------- */
#adminPanel { display:none; text-align:left; }
#adminPanel table { width:100%; border-collapse: collapse; margin-top:8px; color:white; }
#adminPanel th, #adminPanel td { border:1px solid rgba(255,255,255,0.2); padding:6px 10px; font-size:14px; }
#adminPanel th { background: rgba(255,255,255,0.08); }

/* ---------- RESPONSIVE ---------- */
@media(max-width:720px){ .header h1{font-size:36px;} .nav-button{font-size:14px;padding:8px 12px;} }
</style>
</head>
<body>
<!-- SCENE BACKGROUND -->
<div class="scene-bg">
<svg viewBox="0 0 1440 400" preserveAspectRatio="none">
  <polygon points="0,400 0,250 200,280 400,220 600,280 800,240 1000,300 1200,260 1440,300 1440,400" fill="#0b0b0b"/>
  <rect x="220" y="260" width="10" height="40" fill="#1c1c1c"/>
  <rect x="240" y="245" width="8" height="55" fill="#1c1c1c"/>
  <rect x="380" y="250" width="10" height="50" fill="#1c1c1c"/>
  <rect x="780" y="265" width="10" height="35" fill="#1c1c1c"/>
  <rect x="800" y="240" width="8" height="60" fill="#1c1c1c"/>
  <rect x="1150" y="265" width="10" height="35" fill="#1c1c1c"/>
</svg>
</div>
<div class="moon"></div>
<div class="fog-layer layer1"></div>
<div class="fog-layer layer2"></div>
<div class="fog-layer layer3"></div>
<img class="bat-svg bat-1" src="murci-removebg-preview.png" />
<img class="bat-svg bat-2" src="murci-removebg-preview.png" />
<img class="bat-svg bat-3" src="murci-removebg-preview.png" />

<div class="container">
  <div class="header card">
    <h1 id="siteTitle">RebeldÃ­a IN.AR</h1>
    <p class="lead" style="margin-top:6px; color:#dcd9d9">Un lugar para el alumnado â€” ahora con espÃ­ritu de Halloween ðŸŽƒ</p>
  </div>

  <div class="card" aria-labelledby="welcomeTitle">
    <h2 id="welcomeTitle" style="color:var(--accent-orange); margin-bottom:8px">Bienvenidos</h2>
    <p class="lead">AquÃ­ podÃ©is escribir, organizar grupos, votar y divertiros. Este espacio es para la comunidad del instituto â€” Â¡usadlo con responsabilidad y evitad contenido que pueda causar problemas con el centro!</p>
    <div class="actions" style="margin-top:12px;">
      <button id="casinoButton" class="btn" onclick="window.location.href='c.html'">ðŸŽ° Casino</button>
      <button id="newsButton" class="btn" onclick="window.location.href='golf.html'">Zona arcade</button>
      <button id="politicaButton" class="btn" onclick="window.location.href='po.html'">ðŸ“œ PolÃ­tica</button>
      <button id="newsButton" class="btn" onclick="window.location.href='periodico.html'">ðŸ“° Noticias</button>
      <button class="auth-button" onclick="window.location.href='admin.html'">Admin</button>
    </div>
  </div>

  <div class="card" aria-labelledby="motiveTitle">
    <h2 id="motiveTitle" style="color:var(--accent-orange); margin-bottom:8px">Motivo</h2>
    <p class="lead">La intenciÃ³n de la web es servir como espacio para el alumnado: debates, proyectos, clubs y mÃ¡s. Usadlo con responsabilidad.</p>
  </div>

<div class="card">
  <h2 style="color:var(--accent-orange)">Enviar PeticiÃ³n</h2>
  <textarea id="peticionInput" placeholder="Escribe tu peticiÃ³n aquÃ­..." rows="3" style="width:100%; border-radius:6px; padding:8px; margin-bottom:8px;"></textarea>
  <button class="btn" id="enviarPeticionBtn">Enviar PeticiÃ³n</button>
</div>

<div class="card">
  <h2 style="color:var(--accent-orange)">Enviar Reporte</h2>
  <select id="tipoReporte" style="width:100%; padding:8px; border-radius:6px; margin-bottom:8px;">
    <option value="inapropiado">Contenido inapropiado</option>
    <option value="error">Error / fallo</option>
    <option value="otro">Otro</option>
  </select>
  <textarea id="reporteInput" placeholder="Describe el reporte..." rows="3" style="width:100%; border-radius:6px; padding:8px; margin-bottom:8px;"></textarea>
  <button class="btn" id="enviarReporteBtn">Enviar Reporte</button>
</div>

  <div class="card" id="adminPanel">
    <h2 style="color:var(--accent-purple)">Panel Admin - Peticiones y Reportes</h2>
    <h3>Peticiones</h3>
    <table id="peticionesTable">
      <thead>
        <tr><th>ID</th><th>Usuario</th><th>Contenido</th><th>Fecha</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <h3 style="margin-top:12px;">Reportes</h3>
    <table id="reportesTable">
      <thead>
        <tr><th>ID</th><th>Usuario</th><th>Tipo</th><th>DescripciÃ³n</th><th>Fecha</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div class="auth-container" id="authContainer">
  <button class="auth-button" onclick="window.location.href='l.html'">Iniciar sesiÃ³n / Registrarse</button>
</div>

<div class="user-info" id="userInfo" title="Abrir menÃº de usuario">
  <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
  <div style="text-align:left">
    <div id="userName" style="font-weight:600">Usuario</div>
    <div style="font-size:12px;color:#cfcacd">Ver perfil</div>
  </div>
</div>

<div class="dropdown-menu" id="dropdownMenu">
  <table>
    <tr><td onclick="logout()">ðŸšª Cerrar sesiÃ³n</td></tr>
  </table>
</div>

<!-- Bottom navigation -->
<div class="nav-container">
  <button class="nav-button" onclick="window.location.href='b.html'">Blog</button>
  <button class="nav-button" onclick="window.location.href='ch.html'">Chat</button>
  <button class="nav-button" onclick="window.location.href='https://sites.google.com/arrigorriagabhi.net/ikaslea/inicio'">Juegos</button>
  <button class="nav-button" onclick="window.location.href='e.html'">Encuesta</button>
</div>

<script>
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

document.addEventListener("DOMContentLoaded", async () => {
  const authContainer = document.getElementById("authContainer");
  const userInfo = document.getElementById("userInfo");
  const dropdownMenu = document.getElementById("dropdownMenu");
  const adminPanel = document.getElementById("adminPanel");

  // ---- Cargar info de usuario ----
  async function loadUserInfo() {
    let user = null;
    const { data: { session } } = await supabase.auth.getSession();
    if (session?.user) {
      user = {
        username: session.user.user_metadata?.username || session.user.email,
        email: session.user.email,
        logo: session.user.user_metadata?.logo || "logoDefault.png"
      };
      localStorage.setItem("currentUser", JSON.stringify(user));
    } else {
      try { user = JSON.parse(localStorage.getItem("currentUser")); } catch {}
    }

    if (user) {
      userInfo.style.display = "flex";
      authContainer.style.display = "none";
      document.getElementById("userName").textContent = user.username;
      document.getElementById("userLogo").src = user.logo;

      if (user.username === "Peketruli") {
        adminPanel.style.display = "block";
        await loadAdminData(); // carga inicial
      }
    } else {
      userInfo.style.display = "none";
      authContainer.style.display = "flex";
      adminPanel.style.display = "none";
    }
  }

  await loadUserInfo();

  // ---- Toggle menÃº usuario ----
  userInfo.addEventListener("click", () => {
    dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
  });
  document.addEventListener("click", e => {
    if (!userInfo.contains(e.target) && !dropdownMenu.contains(e.target)) dropdownMenu.style.display = "none";
  });

  // ---- Cerrar sesiÃ³n ----
  window.logout = async function() {
    await supabase.auth.signOut();
    localStorage.removeItem("currentUser");
    window.location.href = "l.html";
  };

  // ---- Cargar datos admin ----
  async function loadAdminData() {
    const { data: peticiones } = await supabase.from("peticiones").select("*").order("created_at", { ascending: false });
    const { data: reportes } = await supabase.from("reportes").select("*").order("created_at", { ascending: false });

    const tbodyP = document.querySelector("#peticionesTable tbody");
    const tbodyR = document.querySelector("#reportesTable tbody");
    tbodyP.innerHTML = "";
    tbodyR.innerHTML = "";

    if (peticiones) peticiones.forEach(p => {
      const fecha = p.created_at ? new Date(p.created_at).toLocaleString() : "â€”";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${p.id}</td><td>${p.usuario}</td><td>${p.contenido}</td><td>${fecha}</td>`;
      tbodyP.appendChild(tr);
    });

    if (reportes) reportes.forEach(r => {
      const fecha = r.created_at ? new Date(r.created_at).toLocaleString() : "â€”";
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${r.id}</td><td>${r.usuario}</td><td>${r.tipo}</td><td>${r.descripcion}</td><td>${fecha}</td>`;
      tbodyR.appendChild(tr);
    });
  }

  // ---- Enviar peticiÃ³n ----
  document.getElementById("enviarPeticionBtn")?.addEventListener("click", async () => {
    const contenido = document.getElementById("peticionInput").value.trim();
    if (!contenido) return alert("Escribe algo antes de enviar.");
    const user = JSON.parse(localStorage.getItem("currentUser")) || { username: "Anonimo" };

    const { error } = await supabase.from("peticiones").insert([{ usuario: user.username, contenido }]);
    if (error) return alert("Error al enviar: " + error.message);

    document.getElementById("peticionInput").value = "";
    alert("âœ… PeticiÃ³n enviada correctamente.");
    if (user.username === "Peketruli") loadAdminData();
  });

  // ---- Enviar reporte ----
  document.getElementById("enviarReporteBtn")?.addEventListener("click", async () => {
    const descripcion = document.getElementById("reporteInput").value.trim();
    const tipo = document.getElementById("tipoReporte").value;
    if (!descripcion) return alert("Describe el reporte antes de enviar.");
    const user = JSON.parse(localStorage.getItem("currentUser")) || { username: "Anonimo" };

    const { error } = await supabase.from("reportes").insert([{ usuario: user.username, tipo, descripcion }]);
    if (error) return alert("Error al enviar: " + error.message);

    document.getElementById("reporteInput").value = "";
    alert("âœ… Reporte enviado correctamente.");
    if (user.username === "Peketruli") loadAdminData();
  });
});
</script>
</body>
</html>
