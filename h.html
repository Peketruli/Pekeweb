<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rebeldía IN.AR — Halloween (Noche en cementerio)</title>

<!-- Fuentes -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Creepster&display=swap" rel="stylesheet">

<!-- Dependencias -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>

<style>
:root{
  --text: #f5f3f4;
  --accent-orange: #ff8a33;
  --accent-purple: #6b2a7a;
}

/* Reset base */
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%; overflow-x:hidden; font-family:"Inter", Arial, sans-serif; color:var(--text);}
body {
  position:relative;
  padding:50px 20px 140px;
  background: linear-gradient(180deg,#1b0b2b 0%,#3a103a 50%,#0b0b0b 100%);
  overflow-x:hidden;
}

/* ---------- MONTE y CEMENTERIO (silhuetas al fondo) ---------- */
.scene-bg {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:50%;
  z-index:1;
  pointer-events:none;
}
.scene-bg svg { width:100%; height:100%; display:block; }

/* ---------- LUNA ---------- */
.moon {
  position:fixed;
  top:50px;
  left:60px;
  width:130px;
  height:130px;
  border-radius:50%;
  background: radial-gradient(circle at 30% 25%, rgba(255,255,230,0.95) 0%, rgba(255,255,220,0.85) 20%, rgba(240,240,200,0.55) 30%, rgba(220,220,200,0.15) 50%, transparent 70%);
  box-shadow:0 0 90px rgba(255,240,180,0.08), 0 6px 40px rgba(0,0,0,0.6) inset;
  z-index:2;
}
.moon::after {
  content:"";
  position:absolute;
  inset:-20px;
  border-radius:50%;
  background: radial-gradient(circle, rgba(255,230,160,0.06), transparent 35%);
  filter: blur(12px);
}

/* ---------- FOG LAYERS ---------- */
.fog-layer {
  position:fixed;
  left:-20%;
  width:140%;
  height:35vh;
  bottom:-8%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));
  filter: blur(22px);
  opacity:0.45;
  z-index:3;
  pointer-events:none;
  animation: fogShift 28s linear infinite;
}
.fog-layer.layer2 { bottom:-4%; opacity:0.28; height:30vh; filter: blur(28px); animation-duration:36s }
.fog-layer.layer3 { bottom:-16%; opacity:0.18; height:40vh; filter: blur(36px); animation-duration:46s; transform: scaleX(1.1) }
@keyframes fogShift {
  0%{ transform:translateX(0) }
  50%{ transform:translateX(-8%) }
  100%{ transform:translateX(0) }
}

/* ---------- BATs ---------- */
.bat-svg {
  position:fixed;
  width:110px;
  height:auto;
  display:block;
  z-index:4;
  pointer-events:none;
  opacity:0.95;
  filter: drop-shadow(0 8px 18px rgba(0,0,0,0.6));
}
.bat-1 { top:18%; left:-18%; animation: batFly1 12s linear infinite; transform-origin:center; }
.bat-2 { top:32%; left:-30%; animation: batFly2 16s linear infinite; transform-origin:center; opacity:0.9; transform:scale(.8) }
.bat-3 { top:46%; left:-10%; animation: batFly3 10s linear infinite; transform-origin:center; opacity:0.95; transform:scale(.95) }
@keyframes batFly1 {0%{transform:translateX(0) translateY(0) rotate(0deg)}25%{transform:translateX(220px) translateY(-10px) rotate(-8deg)}50%{transform:translateX(480px) translateY(6px) rotate(10deg)}75%{transform:translateX(760px) translateY(-4px) rotate(-6deg)}100%{transform:translateX(1100px) translateY(0) rotate(0deg);opacity:0}}
@keyframes batFly2 {0%{transform:translateX(0) translateY(0) rotate(0deg)}20%{transform:translateX(140px) translateY(6px) rotate(6deg)}45%{transform:translateX(380px) translateY(-12px) rotate(-10deg)}70%{transform:translateX(740px) translateY(8px) rotate(8deg)}100%{transform:translateX(1100px) translateY(0) rotate(0deg);opacity:0}}
@keyframes batFly3 {0%{transform:translateX(0) translateY(0) rotate(0deg)}30%{transform:translateX(260px) translateY(-18px) rotate(-14deg)}60%{transform:translateX(540px) translateY(12px) rotate(12deg)}100%{transform:translateX(1100px) translateY(0) rotate(0deg);opacity:0}}

/* ---------- PARTICULAS ---------- */
.particles {
  position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:3;
}
.particle {
  position:absolute; width:6px; height:6px; background:orange; border-radius:50%;
  opacity:0.6; animation: rise 8s linear infinite;
}
@keyframes rise {0%{transform:translateY(0)}100%{transform:translateY(-120vh)}}

/* ---------- BOTONES PRINCIPALES ---------- */
.btn { 
  font-weight:600; 
  padding:12px 22px; 
  border-radius:12px; 
  border:none; 
  cursor:pointer; 
  transition:all .25s ease; 
  box-shadow:0 6px 18px rgba(0,0,0,0.45); 
  display:inline-flex; 
  align-items:center; 
  gap:10px; 
  color:white; 
  background:linear-gradient(180deg,#f39c12,#f57c00);
  z-index:5;
}
.btn:hover {
  transform: scale(1.1) translateY(-3px);
  box-shadow:0 0 50px 18px rgba(255,160,70,0.9),0 18px 60px rgba(0,0,0,0.7);
}

/* ---------- BOTONES DE NAVEGACIÓN INFERIOR ---------- */
.nav-container {
  position:fixed;
  bottom:20px;
  left:0;
  width:100%;
  background-color: rgba(0,0,0,0.7);
  padding:15px 0;
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:5;
}
.nav-button {
  padding:10px 16px;
  margin:0 6px;
  border-radius:10px;
  border:none;
  background: linear-gradient(180deg,#f39c12,#f57c00);
  color:white;
  font-weight:600;
  cursor:pointer;
  transition: all 0.25s ease;
  box-shadow:0 4px 18px rgba(0,0,0,0.45);
}
.nav-button:hover {
  transform: translateY(-6px) scale(1.08);
  box-shadow:0 0 48px 16px rgba(255,160,70,0.9),0 20px 60px rgba(0,0,0,0.7);
}

/* ---------- CONTAINER Y CARDS ---------- */
.container {text-align: center; max-width:1100px; margin:0 auto; display:flex; flex-direction:column; gap:26px; align-items:center; z-index:5; position:relative; }
.card { 
  width:100%; 
  background: rgba(255,255,255,0.02); 
  border-radius:14px; 
  padding:18px; 
  box-shadow: 0 6px 30px rgba(0,0,0,0.6); 
  backdrop-filter: blur(4px); 
  border:1px solid rgba(255,255,255,0.03); 
  color: #eae8e8; 
  z-index:5; 
  text-align: center;
}
.lead { font-size:16px; line-height:1.5; color:#eae8e8; }
.header h1 { text-align: center; font-family:"Creepster",cursive; font-size:48px; color:var(--accent-orange); text-shadow:0 4px 26px rgba(0,0,0,0.6),0 0 18px rgba(255,140,50,0.08); }

/* ---------- PERFIL ARRIBA DERECHA ---------- */
.auth-container, .user-info {
  position:fixed;
  top:16px;
  right:16px;
  display:flex;
  align-items:center;
  gap:10px;
  z-index:10;
}
.auth-button {
  padding:10px 18px;
  font-size:1em;
  color:white;
  background-color:#333;
  border:none;
  cursor:pointer;
  border-radius:6px;
  text-decoration:none;
  transition:all .2s;
}
.auth-button:hover {
  transform:scale(1.08);
  box-shadow:0 0 30px rgba(255,255,255,0.4);
}
.user-info {
  display:none;
  cursor:pointer;
}
#userLogo { width:40px; height:40px; border-radius:50%; }
#userName { font-weight:600; font-size:1em; color:white; }

/* ---------- MENÚ DESPLEGABLE ---------- */
.dropdown-menu {
  display:none;
  position:absolute;
  top:56px;
  right:0;
  background-color:#000;
  border-radius:6px;
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
  width:160px;
  text-align:left;
  z-index:10;
}
.dropdown-menu td {
  padding:10px;
  cursor:pointer;
  color:white;
}
.dropdown-menu td:hover { background-color: #333; }

/* ---------- MODAL ---------- */
#updatesModal {
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(0.95);
  background-color:rgba(0,0,0,0.95);
  color:white;
  padding:20px;
  border-radius:10px;
  width:80%;
  max-width:400px;
  z-index:20;
  transition:all 0.25s ease;
}
#updatesContent { text-align:left; max-height:300px; overflow-y:auto; }
#modalOverlay {
  display:none;
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background-color:rgba(0,0,0,0.5);
  z-index:15;
}
#closeUpdatesButton {
  margin-top:15px;
  padding:10px 15px;
  border:none;
  border-radius:5px;
  background-color:#dc3545;
  color:white;
  cursor:pointer;
}
#closeUpdatesButton:hover {
  transform:scale(1.05);
  box-shadow:0 0 30px rgba(220,50,50,0.8);
}

container .card h1,
.container .card h2,
.container .card h3,
.container .card p.lead {
  text-align: center; /* asegura que los encabezados y textos queden centrados */
}

.actions {
  justify-content: center; /* botones centrados en la card */
}
  
/* ---------- RESPONSIVE ---------- */
@media(max-width:720px){
  .header h1{font-size:36px;}
  .nav-button{font-size:14px;padding:8px 12px;}
}
</style>
</head>
<body>
  <!-- SCENE BACKGROUND -->
<div class="scene-bg">
<svg viewBox="0 0 1440 400" preserveAspectRatio="none">
  <!-- Montes -->
  <polygon points="0,400 0,250 200,280 400,220 600,280 800,240 1000,300 1200,260 1440,300 1440,400" fill="#0b0b0b"/>
  <!-- Cementerio -->
  <rect x="220" y="260" width="10" height="40" fill="#1c1c1c"/>
  <rect x="240" y="245" width="8" height="55" fill="#1c1c1c"/>
  <rect x="380" y="250" width="10" height="50" fill="#1c1c1c"/>
  <rect x="780" y="265" width="10" height="35" fill="#1c1c1c"/>
  <rect x="800" y="240" width="8" height="60" fill="#1c1c1c"/>
  <rect x="1150" y="265" width="10" height="35" fill="#1c1c1c"/>
</svg>
</div>


<!-- MOON (estática) -->
<div class="moon" aria-hidden="true"></div>

<!-- Fog layers -->
<div class="fog-layer layer1" aria-hidden="true"></div>
<div class="fog-layer layer2" aria-hidden="true"></div>
<div class="fog-layer layer3" aria-hidden="true"></div>

<!-- decorative subtle sky flicker -->
<div class="sky-flicker" aria-hidden="true"></div>

<!-- MURCIELAGOS -->
<img class="bat-svg bat-1" src="murci-removebg-preview.png" />
<img class="bat-svg bat-2" src="murci-removebg-preview.png" />
<img class="bat-svg bat-3" src="murci-removebg-preview.png" />

  <!-- PARTICULAS -->
<div class="particles">
  <div class="particle" style="left:10%;animation-delay:0s"></div>
  <div class="particle" style="left:20%;animation-delay:2s"></div>
  <div class="particle" style="left:35%;animation-delay:1s"></div>
  <div class="particle" style="left:55%;animation-delay:3s"></div>
  <div class="particle" style="left:70%;animation-delay:2.5s"></div>
  <div class="particle" style="left:85%;animation-delay:4s"></div>
</div>


<!-- main content container -->
<div class="container">
  <div class="header card" role="banner">
    <div class="smoke-behind" aria-hidden="true"></div>
    <h1 id="siteTitle">Rebeldía IN.AR</h1>
    <p class="lead" style="margin-top:6px; color:#dcd9d9">Un lugar para el alumnado — ahora con espíritu de Halloween 🎃</p>
  </div>

  <div class="card" aria-labelledby="welcomeTitle">
    <h2 id="welcomeTitle" style="color:var(--accent-orange); margin-bottom:8px">Bienvenidos</h2>
    <p class="lead">Aquí podéis escribir, organizar grupos, votar y divertiros. Este espacio es para la comunidad del instituto — ¡usadlo con responsabilidad y evitad contenido que pueda causar problemas con el centro!</p>
    <div class="actions" style="margin-top:12px;">
      <button id="casinoButton" class="btn" onclick="window.location.href='c.html'">🎰 Casino</button>
      <button id="updatesButton" class="btn">🌟 Nuevas Actualizaciones</button>
      <button id="politicaButton" class="btn" onclick="window.location.href='po.html'">📜 Política</button>
      <button id="casinoButton" class="btn" onclick="window.location.href='periodico.html'">Noticias</button>
      <button id="golfButton" class="btn" onclick="window.location.href='golf.html'" style="display:none;">Zona pruebas</button>
      <button class="auth-button" onclick="window.location.href='admin.html'">Admin</button>
    </div>
  </div>

  <div class="card" aria-labelledby="motiveTitle">
    <h2 id="motiveTitle" style="color:var(--accent-orange); margin-bottom:8px">Motivo</h2>
    <p class="lead">La intención de la web es servir como espacio para el alumnado: debates, proyectos, clubs y más. Usadlo con responsabilidad.</p>
  </div>
</div>

<!-- Top-right auth/user UI -->
<div class="auth-container" id="authContainer">
  <button class="auth-button" onclick="window.location.href='l.html'">Iniciar sesión / Registrarse</button>
</div>

<div class="user-info" id="userInfo" title="Abrir menú de usuario">
  <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
  <div style="text-align:left">
    <div id="userName" style="font-weight:600">Usuario</div>
    <div style="font-size:12px;color:#cfcacd">Ver perfil</div>
  </div>
</div>

<div class="dropdown-menu" id="dropdownMenu" role="menu" aria-hidden="true">
  <table>
    <tr><td onclick="logout()">🚪 Cerrar sesión</td></tr>
  </table>
</div>

<!-- Modal actualizaciones -->
<div id="updatesModal" role="dialog" aria-modal="true" aria-labelledby="updatesTitle">
  <h3 id="updatesTitle" style="color:var(--accent-orange)">Actualizaciones Recientes</h3>
  <div id="updatesContent" class="small" style="max-height:220px; overflow:auto; color:#dfdcdb">
    <ul>
      <li>Trabajando en zona arcade</li>
      <li>Reclamar 100 pekepuntos al dia</li>
      <li>Periodico hoy mismo</li>
    </ul>
  </div>
  <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
    <button id="closeUpdatesButton" class="auth-button">Cerrar</button>
  </div>
</div>
<div id="modalOverlay"></div>

<!-- Bottom navigation -->
<div class="nav-container" role="navigation" aria-label="Navegación principal">
  <button class="nav-button" onclick="window.location.href='b.html'">Blog</button>
  <button class="nav-button" onclick="window.location.href='ch.html'">Chat</button>
  <button class="nav-button" onclick="window.location.href='https://sites.google.com/arrigorriagabhi.net/ikaslea/inicio'">Juegos</button>
  <button class="nav-button" onclick="window.location.href='e.html'">Encuesta</button>
</div>
<script>
/* ===== Supabase (usa tu URL y KEY originales) ===== */
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// ============================
// Gestión de usuario y UI
// ============================
document.addEventListener("DOMContentLoaded", async () => {
  const authContainer = document.getElementById("authContainer");
  const userInfo = document.getElementById("userInfo");
  const dropdownMenu = document.getElementById("dropdownMenu");
  const updatesButton = document.getElementById("updatesButton");
  const updatesModal = document.getElementById("updatesModal");
  const modalOverlay = document.getElementById("modalOverlay");
  const closeUpdatesButton = document.getElementById("closeUpdatesButton");
  const downloadButton = document.getElementById("downloadButton");
  const golfButton = document.getElementById("golfButton"); // ⛳ nuevo botón

  // ============================
  // Cargar info de usuario
  // ============================
  async function loadUserInfo() {
    let user = null;

    // 1️⃣ Intentar desde Supabase
    if (window.supabase) {
      const { data: { session } } = await supabase.auth.getSession();
      if (session?.user) {
        user = {
          username: session.user.user_metadata?.username || session.user.email,
          email: session.user.email,
          logo: session.user.user_metadata?.logo || "logoDefault.png"
        };
        // Guardamos en localStorage para persistencia simple
        localStorage.setItem("currentUser", JSON.stringify(user));
      }
    }

    // 2️⃣ Si no hay sesión, intentar desde localStorage
    if (!user) {
      try {
        const stored = JSON.parse(localStorage.getItem("currentUser"));
        if (stored) user = stored;
      } catch(e) { console.warn("Error parseando currentUser", e); }
    }

    // ============================
    // Actualizar UI
    // ============================
    if (user) {
      userInfo.style.display = "flex";
      authContainer.style.display = "none";
      document.getElementById("userName").textContent = user.username || "Usuario";
      document.getElementById("userLogo").src = user.logo || "logoDefault.png";

      // Mostrar botón de descarga solo a Peketruli o SabinoArana
      if (user.username === "Peketruli" || user.username === "SabinoArana") {
        if (downloadButton) {
          downloadButton.style.display = "inline-flex";
          downloadButton.textContent = "📥 Descargar registros";
        }
      } else if (downloadButton) {
        downloadButton.style.display = "none";
      }

      // ⛳ Mostrar el botón de golf solo a Peketruli
      if (user.username === "Peketruli") {
        if (golfButton) golfButton.style.display = "inline-flex";
      } else {
        if (golfButton) golfButton.style.display = "none";
      }

    } else {
      userInfo.style.display = "none";
      authContainer.style.display = "flex";
      if (downloadButton) downloadButton.style.display = "none";
      if (golfButton) golfButton.style.display = "none";
    }
  }

  await loadUserInfo();

  // ============================
  // Dropdown menu
  // ============================
  userInfo.addEventListener("click", () => {
    const isOpen = dropdownMenu.style.display === "block";
    dropdownMenu.style.display = isOpen ? "none" : "block";
    dropdownMenu.setAttribute("aria-hidden", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (e) => {
    if (!userInfo.contains(e.target) && !dropdownMenu.contains(e.target)) {
      dropdownMenu.style.display = "none";
      dropdownMenu.setAttribute("aria-hidden", "true");
    }
  });

  // ============================
  // Modal de actualizaciones
  // ============================
  if (updatesButton) updatesButton.addEventListener("click", () => {
    updatesModal.style.display = "block";
    modalOverlay.style.display = "block";
    updatesModal.style.transform = "translate(-50%,-50%) scale(1)";
  });
  if (closeUpdatesButton) closeUpdatesButton.addEventListener("click", () => {
    updatesModal.style.display = "none";
    modalOverlay.style.display = "none";
  });
  if (modalOverlay) modalOverlay.addEventListener("click", () => {
    updatesModal.style.display = "none";
    modalOverlay.style.display = "none";
  });

  // ============================
  // Logout
  // ============================
  window.logout = async function() {
    if (window.supabase) {
      try { await supabase.auth.signOut(); } 
      catch(e){ console.warn("Supabase logout error", e); }
    }
    localStorage.removeItem("currentUser");
    window.location.href = "l.html";
  };

  // ============================
  // Download PDF (solo admin)
  // ============================
  window.downloadPDF = function() {
    if (!downloadButton) return;
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const users = JSON.parse(localStorage.getItem("users")) || [];
    let content = "Datos de los registros:\n\n";
    users.forEach(u => {
      content += `Nombre: ${u.username || "N/A"}\nCorreo: ${u.email || "N/A"}\nLogo: ${u.logo ? "Sí" : "No"}\n\n`;
    });
    const lines = doc.splitTextToSize(content, 180);
    doc.text(lines, 10, 10);
    doc.save("registros.pdf");
  };

  if (downloadButton) downloadButton.addEventListener("click", downloadPDF);
});
</script>

</body>
</html>
