<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rebeld√≠a IN.AR ‚Äî Halloween</title>

<!-- Fuentes -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Creepster&display=swap" rel="stylesheet">

<!-- Dependencias -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>

<style>
:root{
  --bg-dark:#0b0b10;
  --purple-1:#2a0b3a;
  --orange-1:#ff6a00;
  --accent: #ff8a33;
  --card-bg: rgba(255,255,255,0.03);
  --glass: rgba(255,255,255,0.04);
  --text: #f5f3f4;
}

/* Reset ligero */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}

/* Fondo general: oscuro + sutil gradiente + niebla */
body{
  background: radial-gradient(circle at 20% 10%, rgba(255,140,0,0.04), transparent 8%),
              linear-gradient(180deg, rgba(15,6,25,1) 0%, rgba(6,8,16,1) 100%);
  color:var(--text);
  font-family: "Inter", Arial, sans-serif;
  -webkit-font-smoothing:antialiased;
  padding:40px 20px 140px 20px;
  overflow-x:hidden;
  position:relative;
}

/* Container central */
.container {
  max-width:1100px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  gap:26px;
  align-items:center;
  z-index:5;
  position:relative;
}

/* T√≠tulo con humo */
.header {
  position:relative;
  text-align:center;
  padding:10px 20px;
  width:100%;
}
#siteTitle {
  font-family: "Creepster", cursive;
  font-size:48px;
  letter-spacing:1px;
  margin-bottom:6px;
  color:var(--accent);
  text-shadow:
    0 2px 6px rgba(0,0,0,0.8),
    0 0 22px rgba(255,138,51,0.12);
  display:inline-block;
  position:relative;
  z-index:6;
  transform-origin:center;
  animation: titleFloat 6s ease-in-out infinite;
}

/* faint smoke behind title */
.smoke {
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%, -18%);
  width:460px;
  height:120px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
  filter: blur(14px);
  opacity:0.5;
  border-radius:50%;
  z-index:4;
  animation: smokeMove 8s ease-in-out infinite;
}

/* Cards */
.card {
  width:100%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:14px;
  padding:18px;
  box-shadow: 0 6px 30px rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  border:1px solid rgba(255,255,255,0.03);
}

/* Intro text */
.lead {
  font-size:16px;
  line-height:1.5;
  color:#e9e7e7;
}

/* Actions area */
.actions {
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  margin-top:6px;
}

/* Botones principales estilo halloween */
.btn {
  font-family:inherit;
  font-weight:600;
  padding:12px 22px;
  border-radius:12px;
  border:none;
  cursor:pointer;
  transition:transform .15s ease, box-shadow .2s ease;
  box-shadow: 0 6px 18px rgba(0,0,0,0.45);
  text-decoration:none;
  display:inline-flex;
  align-items:center;
  gap:10px;
}

/* Specific buttons */
#casinoButton{ background:linear-gradient(180deg,#f39c12,#f57c00); color:#1a0b00;}
#updatesButton{ background: linear-gradient(180deg,#6b2a7a,#3b0f4a); color:white; }
#politicaButton{ background: linear-gradient(180deg,#2e8b57,#1f6a40); color:white; }
#uyButton{ background: linear-gradient(180deg,#d22b2b,#a51313); color:white; }
#eleccionesButton{ background: linear-gradient(180deg,#2b5ad2,#1237a0); color:white; }

/* Hover: fuego/halo naranja */
.btn:hover{
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 14px 40px rgba(0,0,0,0.6);
}
#casinoButton:hover,
#updatesButton:hover,
#politicaButton:hover,
#uyButton:hover,
#eleccionesButton:hover{
  box-shadow: 0 14px 40px rgba(255,138,51,0.22), 0 8px 30px rgba(0,0,0,0.6);
  outline: 0;
  text-shadow: 0 0 12px rgba(255,160,70,0.18);
  transform: translateY(-3px) scale(1.03);
}

/* small admin/auth button */
.auth-button{
  background:transparent;
  color:var(--text);
  border:1px solid rgba(255,255,255,0.06);
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
}

/* Top-right auth/user area */
.auth-container, .user-info {
  position:fixed;
  top:18px;
  right:18px;
  display:flex;
  align-items:center;
  gap:8px;
  z-index:20;
}
.user-info{ display:none; cursor:pointer; background:var(--glass); padding:6px 8px; border-radius:10px; }

/* User logo */
#userLogo {
  width:42px; height:42px; border-radius:50%; object-fit:cover; border:2px solid rgba(255,255,255,0.06);
}

/* Dropdown menu */
.dropdown-menu {
  display:none;
  position:fixed;
  top:72px;
  right:18px;
  background: #09090a;
  color:var(--text);
  border-radius:10px;
  box-shadow:0 12px 40px rgba(0,0,0,0.6);
  width:170px;
  z-index:40;
  overflow:hidden;
}
.dropdown-menu table{width:100%}
.dropdown-menu td{ padding:12px 14px; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.02)}
.dropdown-menu td:hover{ background: rgba(255,255,255,0.02); color:var(--accent)}

/* Nav-fab bottom (responsive) */
.nav-container {
  position:fixed;
  bottom:18px;
  left:50%;
  transform:translateX(-50%);
  width:calc(100% - 40px);
  max-width:1000px;
  display:flex;
  justify-content:space-between;
  gap:8px;
  padding:12px;
  z-index:12;
  background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.32));
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}

/* Small nav buttons */
.nav-button {
  flex:1;
  margin:0 4px;
  padding:10px 8px;
  border-radius:8px;
  background:transparent;
  color:var(--text);
  border:1px solid rgba(255,255,255,0.04);
  cursor:pointer;
  transition:all .15s ease;
}
.nav-button:hover{ transform:translateY(-3px); background: rgba(255,255,255,0.02) }

/* Download PDF special button (appears only for admins) */
#downloadButton{
  background:linear-gradient(180deg,#d9534f,#c9302c);
  color:white;
  padding:10px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  display:none;
}

/* Modal */
#updatesModal {
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(.98);
  background: linear-gradient(180deg, rgba(20,10,30,0.98), rgba(10,6,18,0.98));
  color:var(--text);
  padding:18px;
  border-radius:12px;
  width:92%;
  max-width:420px;
  z-index:60;
  box-shadow: 0 20px 60px rgba(0,0,0,0.7);
}
#modalOverlay {
  display:none;
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.6);
  z-index:50;
}

/* small utilities */
.small { font-size:13px; color:#d8d6d6; }
.h2 { font-size:20px; margin-bottom:8px; color:var(--accent) }

/* Fog at bottom */
.fog {
  position:fixed;
  bottom:-10%;
  left:-10%;
  width:120%;
  height:40vh;
  background:
    radial-gradient(closest-side, rgba(255,255,255,0.04), rgba(255,255,255,0.0) 40%),
    radial-gradient(closest-side, rgba(255,255,255,0.03), rgba(255,255,255,0.0) 30%);
  filter: blur(30px);
  opacity:0.55;
  z-index:3;
  animation: fogMove 18s linear infinite;
  pointer-events:none;
}

/* Bats (pure CSS, light) */
.bat {
  position:absolute;
  top:16%;
  left:8%;
  width:40px;
  height:18px;
  transform-origin:center;
  z-index:8;
  opacity:0.9;
  animation: batFly 8s linear infinite;
}
.bat::before, .bat::after {
  content:"";
  position:absolute;
  top:0;
  height:100%;
  width:50%;
  background:transparent;
  border-top:5px solid transparent;
  border-bottom:5px solid transparent;
  border-right:24px solid rgba(18,18,18,0.95);
  border-radius:6px 6px 0 0;
}
/* Add a second bat via cloning in HTML for variety */

/* Animations */
@keyframes titleFloat {
  0%,100%{ transform:translateY(0) }
  50%{ transform:translateY(-6px) }
}
@keyframes smokeMove {
  0%{ transform:translate(-50%, -18%) scale(1); opacity:.45 }
  50%{ transform:translate(-54%, -22%) scale(1.06); opacity:.55 }
  100%{ transform:translate(-50%, -18%) scale(1); opacity:.45 }
}
@keyframes fogMove {
  0%{ transform:translateX(0) }
  50%{ transform:translateX(-6%) }
  100%{ transform:translateX(0) }
}
@keyframes batFly {
  0%{ transform:translateX(0) rotate(0deg) }
  25%{ transform:translateX(120px) rotate(-12deg) }
  50%{ transform:translateX(300px) rotate(6deg) }
  75%{ transform:translateX(520px) rotate(-8deg) }
  100%{ transform:translateX(800px) rotate(0deg); opacity:0; }
}

/* Responsive */
@media (max-width:720px){
  #siteTitle{ font-size:36px }
  .container{ padding:10px }
  .nav-container{ flex-direction:column; gap:8px; bottom:12px; left:8px; transform:none; width:calc(100% - 16px) }
}
</style>
</head>
<body>

<!-- Decorative bats (multiple for parallax) -->
<div class="bat" style="top:8%; left:-6%; animation-duration:10s; opacity:.9;"></div>
<div class="bat" style="top:22%; left:-12%; animation-duration:12s; transform:scale(.8); opacity:.75;"></div>
<div class="bat" style="top:44%; left:-10%; animation-duration:9s; transform:scale(.9); opacity:.85;"></div>

<!-- Fog and smoke -->
<div class="fog" aria-hidden="true"></div>
<div class="container">
  <div class="header card" role="banner">
    <div class="smoke" aria-hidden="true"></div>
    <h1 id="siteTitle">Rebeld√≠a IN.AR</h1>
    <p class="lead small">Un lugar para el alumnado ‚Äî ahora con esp√≠ritu de Halloween üéÉ</p>
  </div>

  <div class="card" aria-labelledby="welcomeTitle">
    <h2 id="welcomeTitle" class="h2">Bienvenidos</h2>
    <p class="lead">Aqu√≠ pod√©is escribir, organizar grupos, votar y divertiros. Este espacio es para la comunidad del instituto ‚Äî ¬°respetando las normas comunes y evitando contenido que pueda causar problemas con el centro!</p>
    <div class="actions" style="margin-top:12px;">
      <button id="casinoButton" class="btn" onclick="window.location.href='c.html'">üé∞ Casino</button>
      <button id="updatesButton" class="btn">üåü Nuevas Actualizaciones</button>
      <button id="politicaButton" class="btn" onclick="window.location.href='po.html'">üìú Pol√≠tica</button>
      <button id="uyButton" class="btn" onclick="window.location.href='u.html'">üá∫üáæ URGENTE</button>
      <button id="eleccionesButton" class="btn" onclick="window.location.href='elecciones.html'">üó≥Ô∏è Elecciones</button>

      <!-- Admin / download (hidden por defecto, se muestra si eres admin) -->
      <button id="downloadButton" title="Descargar registros (admin)"></button>
      <button class="auth-button" onclick="window.location.href='admin.html'">Admin</button>
    </div>
  </div>

  <div class="card" aria-labelledby="motiveTitle">
    <h2 id="motiveTitle" class="h2">Motivo</h2>
    <p class="lead">La intenci√≥n de la web es servir como espacio para el alumnado: debates, proyectos, clubs y m√°s. Usadlo con responsabilidad.</p>
  </div>
</div>

<!-- Top-right auth/user UI -->
<div class="auth-container" id="authContainer">
  <button class="auth-button" onclick="window.location.href='l.html'">Iniciar sesi√≥n / Registrarse</button>
</div>

<div class="user-info" id="userInfo" title="Abrir men√∫ de usuario">
  <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
  <div style="text-align:left">
    <div id="userName" style="font-weight:600">Usuario</div>
    <div style="font-size:12px;color:#cfcacd">Ver perfil</div>
  </div>
</div>

<div class="dropdown-menu" id="dropdownMenu" role="menu" aria-hidden="true">
  <table>
    <tr><td onclick="window.location.href='perfil.html'">üë§ Ver perfil</td></tr>
    <tr><td onclick="logout()">üö™ Cerrar sesi√≥n</td></tr>
  </table>
</div>

<!-- Modal actualizaciones -->
<div id="updatesModal" role="dialog" aria-modal="true" aria-labelledby="updatesTitle">
  <h3 id="updatesTitle" class="h2">Actualizaciones Recientes</h3>
  <div id="updatesContent" class="small" style="max-height:220px; overflow:auto;">
    <ul>
      <li>Nuevo sistema de Pol√≠tica ‚Äî se preparan elecciones pr√≥ximamente.</li>
      <li>Mejoras visuales: tema de Halloween aplicado.</li>
      <li>Trabajando en el m√≥dulo del casino y en estabilidad.</li>
    </ul>
  </div>
  <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
    <button id="closeUpdatesButton" class="auth-button">Cerrar</button>
  </div>
</div>
<div id="modalOverlay"></div>

<!-- Bottom navigation (responsive) -->
<div class="nav-container" role="navigation" aria-label="Navegaci√≥n principal">
  <button class="nav-button" onclick="window.location.href='b.html'">Blog</button>
  <button class="nav-button" onclick="window.location.href='ch.html'">Chat</button>
  <button class="nav-button" onclick="window.location.href='calendario.html'">Calendario</button>
  <button class="nav-button" onclick="window.location.href='https://sites.google.com/arrigorriagabhi.net/ikaslea/inicio'">Juegos</button>
  <button class="nav-button" onclick="window.location.href='e.html'">Encuesta</button>
</div>

<script>
/* ===== Supabase (usa tu URL y KEY originales) ===== */
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

/* DOM references */
document.addEventListener("DOMContentLoaded", () => {
  const authContainer = document.getElementById("authContainer");
  const userInfo = document.getElementById("userInfo");
  const dropdownMenu = document.getElementById("dropdownMenu");
  const updatesButton = document.getElementById("updatesButton");
  const updatesModal = document.getElementById("updatesModal");
  const modalOverlay = document.getElementById("modalOverlay");
  const closeUpdatesButton = document.getElementById("closeUpdatesButton");
  const downloadButton = document.getElementById("downloadButton");

  // Cargar info de usuario desde localStorage (tu flujo original)
  function loadUserInfo() {
    try {
      const user = JSON.parse(localStorage.getItem("currentUser"));
      if (user) {
        // Mostrar UI de usuario
        userInfo.style.display = "flex";
        authContainer.style.display = "none";
        document.getElementById("userName").textContent = user.username || "Usuario";
        document.getElementById("userLogo").src = user.logo || "logoDefault.png";

        // Mostrar bot√≥n de descargar solo para usuarios concretos
        // CORRECCI√ìN: usar operador l√≥gico || (antes hab√≠a error de sintaxis)
        if (user.username === "Peketruli" || user.username === "SabinoArana") {
          downloadButton.style.display = "inline-flex";
          downloadButton.textContent = "üì• Descargar registros";
        } else {
          downloadButton.style.display = "none";
        }
      } else {
        userInfo.style.display = "none";
        authContainer.style.display = "flex";
      }
    } catch (err) {
      console.error("Error al parsear currentUser:", err);
      userInfo.style.display = "none";
      authContainer.style.display = "flex";
    }
  }

  loadUserInfo();

  // Toggle dropdown
  userInfo.addEventListener("click", (e) => {
    const isOpen = dropdownMenu.style.display === "block";
    dropdownMenu.style.display = isOpen ? "none" : "block";
    dropdownMenu.setAttribute("aria-hidden", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (event) => {
    const userEl = document.getElementById("userInfo");
    const menuEl = document.getElementById("dropdownMenu");
    if (userEl && menuEl && !userEl.contains(event.target) && !menuEl.contains(event.target)) {
      menuEl.style.display = "none";
      menuEl.setAttribute("aria-hidden", "true");
    }
  });

  // Modal updates
  updatesButton.addEventListener("click", () => {
    updatesModal.style.display = "block";
    modalOverlay.style.display = "block";
    updatesModal.style.transform = "translate(-50%,-50%) scale(1)";
  });
  closeUpdatesButton.addEventListener("click", () => {
    updatesModal.style.display = "none";
    modalOverlay.style.display = "none";
  });
  modalOverlay.addEventListener("click", () => {
    updatesModal.style.display = "none";
    modalOverlay.style.display = "none";
  });

  // Logout
  window.logout = async function() {
    try {
      await supabase.auth.signOut();
    } catch (err) {
      // silencioso si falla (puede que uses otro flujo)
      console.warn("supabase signOut error (si es que no hay sesi√≥n):", err);
    }
    localStorage.removeItem("currentUser");
    window.location.href = "l.html";
  };

  // Download PDF (admin)
  window.downloadPDF = function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let content = "Datos de los registros:\n\n";
    users.forEach(user => {
      content += `Nombre de usuario: ${user.username || "N/A"}\nCorreo electr√≥nico: ${user.email || "N/A"}\nLogo: ${user.logo ? "S√≠" : "No"}\n\n`;
    });
    doc.setFontSize(10);
    // dividir en l√≠neas si es muy largo
    const lines = doc.splitTextToSize(content, 180);
    doc.text(lines, 10, 10);
    doc.save("registros.pdf");
  };

  downloadButton.addEventListener("click", downloadPDF);

}); // DOMContentLoaded end
</script>
</body>
</html>
