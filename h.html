<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rebeldía IN.AR — Halloween (Noche en cementerio)</title>

<!-- Fuentes -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Creepster&display=swap" rel="stylesheet">

<!-- Dependencias -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>

<style>
:root{
  --bg-dark:#05060a;
  --sky-dark:#081026;
  --accent-orange:#ff8a33;
  --accent-purple:#6b2a7a;
  --card-bg: rgba(255,255,255,0.02);
  --text:#f5f3f4;
}

/* Reset y base */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:"Inter", Arial, sans-serif;
  -webkit-font-smoothing:antialiased;
  background:
    radial-gradient(1200px 700px at 80% 10%, rgba(255,180,110,0.02), transparent 10%),
    linear-gradient(180deg, var(--sky-dark) 0%, var(--bg-dark) 100%);
  color:var(--text);
  min-height:100vh;
  overflow-x:hidden;
  padding:48px 20px 140px;
  position:relative;
}

/* ---------- MOON (estática) ---------- */
.moon {
  position:fixed;
  top:36px;
  left:48px;
  width:130px;
  height:130px;
  z-index:3;
  border-radius:50%;
  background:
    radial-gradient(circle at 30% 25%, rgba(255,255,230,0.95) 0%, rgba(255,255,220,0.85) 20%,
                    rgba(240,240,200,0.55) 30%, rgba(220,220,200,0.15) 50%, rgba(200,200,180,0.03) 70%, transparent 100%);
  box-shadow: 0 0 90px rgba(255,240,180,0.08), 0 6px 40px rgba(0,0,0,0.6) inset;
  filter: blur(0.2px);
  pointer-events:none;
  opacity:0.98;
}

/* subtle moon halo */
.moon::after {
  content:"";
  position:absolute;
  inset:-26px;
  border-radius:50%;
  background: radial-gradient(circle, rgba(255,230,160,0.04), transparent 35%);
  filter: blur(12px);
  pointer-events:none;
}

/* Container central */
.container { max-width:1100px; margin:0 auto; display:flex; flex-direction:column; gap:26px; align-items:center; z-index:8; position:relative }

/* Header & smoke behind title */
.header { position:relative; text-align:center; padding:10px 20px; width:100%; z-index:12 }
#siteTitle { font-family:"Creepster", cursive; font-size:48px; color:var(--accent-orange); text-shadow: 0 4px 26px rgba(0,0,0,0.6), 0 0 18px rgba(255,140,50,0.08); display:inline-block; position:relative; z-index:14 }
.smoke-behind {
  position:absolute; left:50%; top:42%; transform:translate(-50%,-18%);
  width:560px; height:140px; border-radius:50%;
  background: linear-gradient(180deg, rgba(255,255,255,0.018), rgba(255,255,255,0.002));
  filter: blur(16px);
  opacity:0.5; z-index:10;
}

/* Cards */
.card { width:100%; background: linear-gradient(180deg, rgba(255,255,255,0.018), rgba(255,255,255,0.008)); border-radius:14px; padding:18px; box-shadow: 0 6px 30px rgba(0,0,0,0.6); backdrop-filter: blur(4px); border:1px solid rgba(255,255,255,0.03); color: #eae8e8 }

/* Lead text */
.lead { font-size:16px; line-height:1.5; color:#e9e7e7 }

/* Actions */
.actions { display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center; margin-top:6px; }

/* Buttons general */
.btn { font-weight:600; padding:12px 22px; border-radius:12px; border:none; cursor:pointer; transition:transform .15s ease, box-shadow .2s ease; box-shadow:0 6px 18px rgba(0,0,0,0.45); display:inline-flex; align-items:center; gap:10px; }
#casinoButton{ background:linear-gradient(180deg,#f39c12,#f57c00); color:#1a0b00 }
#updatesButton{ background: linear-gradient(180deg,#6b2a7a,#3b0f4a); color:white }
#politicaButton{ background: linear-gradient(180deg,#2e8b57,#1f6a40); color:white }
#uyButton{ background: linear-gradient(180deg,#d22b2b,#a51313); color:white }
#eleccionesButton{ background: linear-gradient(180deg,#2b5ad2,#1237a0); color:white }
.btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 14px 40px rgba(0,0,0,0.6) }

/* Hover warm glow (candle/torch feel) */
.btn:hover {
  box-shadow: 0 18px 60px rgba(255,140,60,0.12), 0 8px 30px rgba(0,0,0,0.6);
  text-shadow: 0 0 10px rgba(255,160,70,0.12);
}

/* top-right auth */
.auth-container, .user-info { position:fixed; top:18px; right:18px; display:flex; align-items:center; gap:8px; z-index:40 }
.user-info{ display:none; cursor:pointer; background: rgba(255,255,255,0.02); padding:6px 8px; border-radius:10px }

/* user logo */
#userLogo { width:42px; height:42px; border-radius:50%; object-fit:cover; border:2px solid rgba(255,255,255,0.04) }

/* dropdown menu */
.dropdown-menu { display:none; position:fixed; top:72px; right:18px; background:#070708; color:var(--text); border-radius:10px; box-shadow:0 12px 40px rgba(0,0,0,0.6); width:180px; z-index:45; overflow:hidden }
.dropdown-menu table{width:100%}
.dropdown-menu td{ padding:12px 14px; cursor:pointer; border-bottom:1px solid rgba(255,255,255,0.02)}
.dropdown-menu td:hover{ background: rgba(255,255,255,0.02); color:var(--accent-orange) }

/* bottom nav */
.nav-container { position:fixed; bottom:18px; left:50%; transform:translateX(-50%); width:calc(100% - 40px); max-width:1000px; display:flex; justify-content:space-between; gap:8px; padding:12px; z-index:30; background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.32)); border-radius:14px; border:1px solid rgba(255,255,255,0.03); box-shadow:0 10px 30px rgba(0,0,0,0.6) }
.nav-button { flex:1; margin:0 4px; padding:10px 8px; border-radius:8px; background:transparent; color:var(--text); border:1px solid rgba(255,255,255,0.04); cursor:pointer; transition:all .15s ease }
.nav-button:hover { transform:translateY(-3px); background: rgba(255,255,255,0.02) }

/* download button admin */
#downloadButton{ background:linear-gradient(180deg,#d9534f,#c9302c); color:white; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; display:none }

/* modal */
#updatesModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(.98); background: linear-gradient(180deg, rgba(20,10,30,0.98), rgba(10,6,18,0.98)); color:var(--text); padding:18px; border-radius:12px; width:92%; max-width:420px; z-index:60; box-shadow:0 20px 60px rgba(0,0,0,0.7) }
#modalOverlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); z-index:50 }

/* responsive */
@media (max-width:720px){ #siteTitle{ font-size:36px } .container{ padding:10px } .nav-container{ flex-direction:column; gap:8px; bottom:12px; left:8px; transform:none; width:calc(100% - 16px) } }

/* ---------- FOG (capas) ---------- */
.fog-layer {
  position:fixed;
  left:-20%;
  width:140%;
  height:35vh;
  bottom:-8%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));
  filter: blur(22px);
  opacity:0.45;
  z-index:6;
  pointer-events:none;
  animation: fogShift 28s linear infinite;
}
.fog-layer.layer2 { bottom:-4%; opacity:0.28; height:30vh; filter: blur(28px); animation-duration:36s }
.fog-layer.layer3 { bottom:-16%; opacity:0.18; height:40vh; filter: blur(36px); animation-duration:46s; transform: scaleX(1.1) }

/* fog move */
@keyframes fogShift {
  0%{ transform:translateX(0) }
  50%{ transform:translateX(-8%) }
  100%{ transform:translateX(0) }
}

/* ---------- BATS (SVG + motion) ---------- */
/* We'll place SVG bats absolute and animate them across the screen */
.bat-svg {
  position:fixed;
  width:110px;
  height:auto;
  z-index:20;
  pointer-events:none;
  opacity:0.95;
  filter: drop-shadow(0 8px 18px rgba(0,0,0,0.6));
}

/* flight paths using transform translateX and translateY */
.bat-1 { top:18%; left:-18%; animation: batFly1 12s linear infinite; transform-origin:center; }
.bat-2 { top:32%; left:-30%; animation: batFly2 16s linear infinite; transform-origin:center; opacity:0.9; transform:scale(.8) }
.bat-3 { top:46%; left:-10%; animation: batFly3 10s linear infinite; transform-origin:center; opacity:0.95; transform:scale(.95) }

/* different keyframes for variety */
@keyframes batFly1 {
  0% { transform: translateX(0) translateY(0) rotate(0deg) }
  25% { transform: translateX(220px) translateY(-10px) rotate(-8deg) }
  50% { transform: translateX(480px) translateY(6px) rotate(10deg) }
  75% { transform: translateX(760px) translateY(-4px) rotate(-6deg) }
  100% { transform: translateX(1100px) translateY(0) rotate(0deg); opacity:0 }
}
@keyframes batFly2 {
  0% { transform: translateX(0) translateY(0) rotate(0deg) }
  20% { transform: translateX(140px) translateY(6px) rotate(6deg) }
  45% { transform: translateX(380px) translateY(-12px) rotate(-10deg) }
  70% { transform: translateX(740px) translateY(8px) rotate(8deg) }
  100% { transform: translateX(1100px) translateY(0) rotate(0deg); opacity:0 }
}
@keyframes batFly3 {
  0% { transform: translateX(0) translateY(0) rotate(0deg) }
  30% { transform: translateX(260px) translateY(-18px) rotate(-14deg) }
  60% { transform: translateX(540px) translateY(12px) rotate(12deg) }
  100% { transform: translateX(1100px) translateY(0) rotate(0deg); opacity:0 }
}

/* small subtle twinkle / distant candle flicker */
.sky-flicker {
  position:fixed;
  right:6%;
  top:10%;
  width:10px;
  height:10px;
  border-radius:50%;
  background: radial-gradient(circle, rgba(255,210,140,0.9) 0%, rgba(255,160,60,0.35) 40%, transparent 60%);
  filter: blur(6px);
  z-index:4;
  opacity:0.8;
  animation: flicker 3s linear infinite;
}
@keyframes flicker {
  0%{ transform:scale(1); opacity:0.6 }
  50%{ transform:scale(1.35); opacity:1 }
  100%{ transform:scale(1); opacity:0.6 }
}
</style>
</head>
<body>

<!-- MOON (estática) -->
<div class="moon" aria-hidden="true"></div>

<!-- Fog layers -->
<div class="fog-layer layer1" aria-hidden="true"></div>
<div class="fog-layer layer2" aria-hidden="true"></div>
<div class="fog-layer layer3" aria-hidden="true"></div>

<!-- decorative subtle sky flicker -->
<div class="sky-flicker" aria-hidden="true"></div>

<!-- SVG bats (inline to ensure visibility) -->
<!-- Bat shape is a simple silhouette but clear on dark backgrounds -->
<svg class="bat-svg bat-1" viewBox="0 0 120 60" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
  <path d="M60 26c8-7 16-11 28-11 0 0-6 9-9 12 8-1 16 0 28 5-12 1-22 6-28 12 2-6-6-7-19-7-12 0-21 1-19 7-6-6-16-11-28-12 12-5 20-6 28-5-3-3-9-12-9-12 12 0 20 4 28 11z" fill="#0b0b0b"/>
</svg>

<svg class="bat-svg bat-2" viewBox="0 0 120 60" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
  <path d="M60 26c8-7 16-11 28-11 0 0-6 9-9 12 8-1 16 0 28 5-12 1-22 6-28 12 2-6-6-7-19-7-12 0-21 1-19 7-6-6-16-11-28-12 12-5 20-6 28-5-3-3-9-12-9-12 12 0 20 4 28 11z" fill="#0b0b0b"/>
</svg>

<svg class="bat-svg bat-3" viewBox="0 0 120 60" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
  <path d="M60 26c8-7 16-11 28-11 0 0-6 9-9 12 8-1 16 0 28 5-12 1-22 6-28 12 2-6-6-7-19-7-12 0-21 1-19 7-6-6-16-11-28-12 12-5 20-6 28-5-3-3-9-12-9-12 12 0 20 4 28 11z" fill="#0b0b0b"/>
</svg>

<!-- main content container -->
<div class="container">
  <div class="header card" role="banner">
    <div class="smoke-behind" aria-hidden="true"></div>
    <h1 id="siteTitle">Rebeldía IN.AR</h1>
    <p class="lead" style="margin-top:6px; color:#dcd9d9">Un lugar para el alumnado — ahora con espíritu de Halloween 🎃</p>
  </div>

  <div class="card" aria-labelledby="welcomeTitle">
    <h2 id="welcomeTitle" style="color:var(--accent-orange); margin-bottom:8px">Bienvenidos</h2>
    <p class="lead">Aquí podéis escribir, organizar grupos, votar y divertiros. Este espacio es para la comunidad del instituto — ¡usadlo con responsabilidad y evitad contenido que pueda causar problemas con el centro!</p>
    <div class="actions" style="margin-top:12px;">
      <button id="casinoButton" class="btn" onclick="window.location.href='c.html'">🎰 Casino</button>
      <button id="updatesButton" class="btn">🌟 Nuevas Actualizaciones</button>
      <button id="politicaButton" class="btn" onclick="window.location.href='po.html'">📜 Política</button>
      <button id="uyButton" class="btn" onclick="window.location.href='u.html'">🇺🇾 URGENTE</button>
      <button id="eleccionesButton" class="btn" onclick="window.location.href='elecciones.html'">🗳️ Elecciones</button>

      <!-- Admin / download (hidden por defecto, se muestra si eres admin) -->
      <button id="downloadButton" title="Descargar registros (admin)">📥 Descargar registros</button>
      <button class="auth-button" onclick="window.location.href='admin.html'">Admin</button>
    </div>
  </div>

  <div class="card" aria-labelledby="motiveTitle">
    <h2 id="motiveTitle" style="color:var(--accent-orange); margin-bottom:8px">Motivo</h2>
    <p class="lead">La intención de la web es servir como espacio para el alumnado: debates, proyectos, clubs y más. Usadlo con responsabilidad.</p>
  </div>
</div>

<!-- Top-right auth/user UI -->
<div class="auth-container" id="authContainer">
  <button class="auth-button" onclick="window.location.href='l.html'">Iniciar sesión / Registrarse</button>
</div>

<div class="user-info" id="userInfo" title="Abrir menú de usuario">
  <img id="userLogo" src="logoDefault.png" alt="Logo del usuario">
  <div style="text-align:left">
    <div id="userName" style="font-weight:600">Usuario</div>
    <div style="font-size:12px;color:#cfcacd">Ver perfil</div>
  </div>
</div>

<div class="dropdown-menu" id="dropdownMenu" role="menu" aria-hidden="true">
  <table>
    <tr><td onclick="window.location.href='perfil.html'">👤 Ver perfil</td></tr>
    <tr><td onclick="logout()">🚪 Cerrar sesión</td></tr>
  </table>
</div>

<!-- Modal actualizaciones -->
<div id="updatesModal" role="dialog" aria-modal="true" aria-labelledby="updatesTitle">
  <h3 id="updatesTitle" style="color:var(--accent-orange)">Actualizaciones Recientes</h3>
  <div id="updatesContent" class="small" style="max-height:220px; overflow:auto; color:#dfdcdb">
    <ul>
      <li>Nuevo sistema de Política — se preparan elecciones próximamente.</li>
      <li>Mejoras visuales: tema de Halloween aplicado (noche en cementerio).</li>
      <li>Trabajando en el módulo del casino y en estabilidad.</li>
    </ul>
  </div>
  <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
    <button id="closeUpdatesButton" class="auth-button">Cerrar</button>
  </div>
</div>
<div id="modalOverlay"></div>

<!-- Bottom navigation -->
<div class="nav-container" role="navigation" aria-label="Navegación principal">
  <button class="nav-button" onclick="window.location.href='b.html'">Blog</button>
  <button class="nav-button" onclick="window.location.href='ch.html'">Chat</button>
  <button class="nav-button" onclick="window.location.href='calendario.html'">Calendario</button>
  <button class="nav-button" onclick="window.location.href='https://sites.google.com/arrigorriagabhi.net/ikaslea/inicio'">Juegos</button>
  <button class="nav-button" onclick="window.location.href='e.html'">Encuesta</button>
</div>

<script>
/* ===== Supabase (usa tu URL y KEY originales) ===== */
const SUPABASE_URL = "https://jdvwlfogkzrzovepzjqa.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdndsZm9na3pyem92ZXB6anFhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwMzY1MjEsImV4cCI6MjA3MzYxMjUyMX0.IwVFrvuluY0tfgE82XnqYSsRjFPsDYnlfyirHjKu1TI";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

document.addEventListener("DOMContentLoaded", () => {
  const authContainer = document.getElementById("authContainer");
  const userInfo = document.getElementById("userInfo");
  const dropdownMenu = document.getElementById("dropdownMenu");
  const updatesButton = document.getElementById("updatesButton");
  const updatesModal = document.getElementById("updatesModal");
  const modalOverlay = document.getElementById("modalOverlay");
  const closeUpdatesButton = document.getElementById("closeUpdatesButton");
  const downloadButton = document.getElementById("downloadButton");

  // Cargar info de usuario desde localStorage (tu flujo original)
  function loadUserInfo() {
    try {
      const user = JSON.parse(localStorage.getItem("currentUser"));
      if (user) {
        // Mostrar UI de usuario
        userInfo.style.display = "flex";
        authContainer.style.display = "none";
        document.getElementById("userName").textContent = user.username || "Usuario";
        document.getElementById("userLogo").src = user.logo || "logoDefault.png";

        // Mostrar botón de descargar solo para usuarios concretos
        if (user.username === "Peketruli" || user.username === "SabinoArana") {
          downloadButton.style.display = "inline-flex";
          downloadButton.textContent = "📥 Descargar registros";
        } else {
          downloadButton.style.display = "none";
        }
      } else {
        userInfo.style.display = "none";
        authContainer.style.display = "flex";
      }
    } catch (err) {
      console.error("Error al parsear currentUser:", err);
      userInfo.style.display = "none";
      authContainer.style.display = "flex";
    }
  }

  loadUserInfo();

  // Toggle dropdown
  userInfo.addEventListener("click", (e) => {
    const isOpen = dropdownMenu.style.display === "block";
    dropdownMenu.style.display = isOpen ? "none" : "block";
    dropdownMenu.setAttribute("aria-hidden", isOpen ? "true" : "false");
  });

  document.addEventListener("click", (event) => {
    const userEl = document.getElementById("userInfo");
    const menuEl = document.getElementById("dropdownMenu");
    if (userEl && menuEl && !userEl.contains(event.target) && !menuEl.contains(event.target)) {
      menuEl.style.display = "none";
      menuEl.setAttribute("aria-hidden", "true");
    }
  });

  // Modal updates
  updatesButton.addEventListener("click", () => {
    updatesModal.style.display = "block";
    modalOverlay.style.display = "block";
    updatesModal.style.transform = "translate(-50%,-50%) scale(1)";
  });
  closeUpdatesButton.addEventListener("click", () => {
    updatesModal.style.display = "none";
    modalOverlay.style.display = "none";
  });
  modalOverlay.addEventListener("click", () => {
    updatesModal.style.display = "none";
    modalOverlay.style.display = "none";
  });

  // Logout
  window.logout = async function() {
    try {
      await supabase.auth.signOut();
    } catch (err) {
      console.warn("supabase signOut error (si es que no hay sesión):", err);
    }
    localStorage.removeItem("currentUser");
    window.location.href = "l.html";
  };

  // Download PDF (admin)
  window.downloadPDF = function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let content = "Datos de los registros:\n\n";
    users.forEach(user => {
      content += `Nombre de usuario: ${user.username || "N/A"}\nCorreo electrónico: ${user.email || "N/A"}\nLogo: ${user.logo ? "Sí" : "No"}\n\n`;
    });
    doc.setFontSize(10);
    const lines = doc.splitTextToSize(content, 180);
    doc.text(lines, 10, 10);
    doc.save("registros.pdf");
  };

  downloadButton.addEventListener("click", downloadPDF);

}); // DOMContentLoaded end
</script>
</body>
</html>
